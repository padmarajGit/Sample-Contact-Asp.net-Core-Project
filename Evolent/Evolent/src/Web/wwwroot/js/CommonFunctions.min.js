function ChangePasswordView(){this.Init()}function EditProfileView(){this.Init()}function DashboardView(){this.Init()}function SiteAdminDashBoardView(){this.Init()}function MyDashBoardView(){this.Init()}function OnNavigate(){SetHolidayTitle()}function SetHolidayTitle(){setTimeout(function(){$("#holidayCalendar").find("div.holiday").each(function(){if(new Date(this.title)!="Invalid Date"){var n=HolidayName(new Date(this.title));n!=""&&(this.title=n)}});$("#holidayCalendar").find("div.calendarLeaveAP,div.calendarLeaveABNT").each(function(){if(new Date(this.title)!="Invalid Date"){var n=LeaveName(new Date(this.title));n!=""&&(this.title=n)}})},1)}function HolidayName(n){var t=kendo.toString(n,"MM/dd/yyyy");return $("#hdnHolidayName").val(""),$("#hdnHolidayName").val(t),$("#hdnHolidayName option:selected").text()}function LeaveName(n){var t=kendo.toString(n,"MM/dd/yyyy");return $("#hdnLeaveName").val(""),$("#hdnLeaveName").val(t),$("#hdnLeaveName option:selected").text()}function CssNameClass(n){var t="",i=kendo.toString(n,"MM/dd/yyyy");return $("#hdnLeaveName").val(""),$("#hdnLeaveName").val(i),t=$("#hdnLeaveName option:selected").text(),t!=""?"calendarLeave"+$("#hdnLeaveName option:selected").attr("attr-lstatus"):"holiday"}function AboutCompanyView(){this.Init()}function CompanyInfoView(){this.Init()}function CompanyPayrollView(){this.Init()}function onGridDataBound(){var n,t;this.dataSource.view().length==0&&(n=this.dataSource.page(),n>1&&this.dataSource.page(n-1));setTimeout(function(){$("#GIROBankDetailsGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit GIRO bank detail");$("#GIROBankDetailsGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#GIROBankDetailsGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update GIRO bank detail");$("#GIROBankDetailsGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$("#GIROBankDetailsGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete GIRO bank detail");$(".k-i-close").removeClass("k-icon k-i-close");KGrdPageSizeDdlPosition("GIROBankDetailsGrid",0)},1);t=$("#GIROBankDetailsGrid").data("kendoGrid");t.dataSource.total()<1?$("#chkIsInterbankGIRO").attr("checked",!1):$("#chkIsInterbankGIRO").attr("checked",!0);CheckInterbankGIROSetup()}function CheckInterbankGIROSetup(){$("#chkIsInterbankGIRO").is(":checked")?$("#ddlBankName, #txtBranchCode, #txtAccountNumber, #txtAccountName").prop("disabled",!1):$("#ddlBankName, #txtBranchCode, #txtAccountNumber, #txtAccountName").prop("disabled",!0)}function RadioBtnCheck(){$("#rdnPackage").prop("checked")?$("#prepaidDiv").show():$("#prepaidDiv").hide();$("#rdnPerYear").prop("checked")?$("#perYearDate").show():$("#perYearDate").hide();$("#rdnCPF").prop("checked")?($("#CPFsubmission").show(),$("#SDLsubmission").hide(),$("#rdnPaySlip").hide()):$("#rdnSDL").prop("checked")?($("#SDLsubmission").show(),$("#CPFsubmission").hide(),$("#rdnPaySlip").hide()):$("#rdnReportsOnly").prop("checked")?($("#SDLsubmission").hide(),$("#CPFsubmission").hide()):($("#SDLsubmission").hide(),$("#CPFsubmission").hide());$("#chkNoReminders").prop("checked")?($("#ddlReminderAlert").attr("disabled",!0),$("#ddlNoOfReminderSend").attr("disabled",!0),$("#txtRecEmail").attr("disabled",!0),$("#txtRecName").attr("disabled",!0)):($("#ddlReminderAlert").attr("disabled",!1),$("#ddlNoOfReminderSend").attr("disabled",!1),$("#txtRecEmail").attr("disabled",!1),$("#txtRecName").attr("disabled",!1))}function openPayItemModal(n){var t=$.get(baseURL+"Company/LoadCompanyPayItem",{companyPayItemId:n});t.done(function(n){CompanyPayrollView.prototype.PayItemClearFields();$("#AddPayItem").modal("show");$("#CompanyPayItemId").val(n.companyPayItemId);$("#PayItemDesc").val(n.description);n.type==="Standard"?$("#PayItemDesc").prop("disabled",!0):$("#PayItemDesc").prop("disabled",!1);$("#ddlPayItemCategory").val(n.category);$("#ddlTypeOfWage").val(n.typeOfWage);$("#ddlCPFApplicable").val(n.cpfApplicable);$("#ddlIR8ACategory").val(n.iR8ACategory);$("#chkIsUniversalPayItem").prop("checked",n.isUniversalForAllEmployees);n.isVariableAmount?$("#rdnVariable").prop("checked",!0):$("#rdnFixed").prop("checked",!0);$("#ddlVariableAmountBasedOn").val(n.variableAmountBasedOn);n.isVariableAmount?($("#ddlVariableAmountBasedOn").show(),$("#divPercentageForAmt").show(),$("#txtFixedAmount").hide(),$("#rdnProrateNo, #rdnProrateYes").prop("checked",!1).prop("disabled",!0),$("#ddlVariableAmountBasedOn").change()):($("#txtFixedAmount").show(),$("#ddlVariableAmountBasedOn").hide(),$("#divPercentageForAmt").hide(),n.isProrate?$("#rdnProrateYes").prop("checked",!0):$("#rdnProrateNo").prop("checked",!0));$("#txtFixedAmount").val(n.amount);$("#PercentageForAmt").val(n.amountPercentageInCaseOfVariable);$("#payItemStartDate").datepicker("setDate",kendo.toString(new Date(n.startDate),"dd/MMM/yyyy"));$("#ddlPayItemEndDate").val(n.endsOn);$("#ddlPayItemEndDate").change();n.startDate!=""&&AddOrMinusDayFromDate(new Date(n.startDate),"payItemEndDate",!0,1,"setStartDate");$("#payItemEndDate").datepicker("setDate",kendo.toString(new Date(n.endDate),"dd/MMM/yyyy"));$("#txtRepeatForTimes").val(n.repeatForTimes);$("#ddlPayItemCategory").change()});t.fail(function(){ShowAlertBox("Error while opening pay item details")})}function deletePayItem(n){var t=ShowConfirmationAlertBox("If you delete this pay item then corresponding employee pay items will be deleted.<br> Are you sure about deleting this pay item?");t.then(function(){var t=$.post(baseURL+"Company/DeleteCompanyPayItem",{companyPayItemId:n});t.done(function(){ShowAlertBox("Pay item deleted successfully");RemoveItemFromGrid("companyPayItemsGrid",n)});t.fail(function(){ShowAlertBox("Error while deleting pay item")})})}function CompanyTimesheetView(){this.Init()}function ValidateLeavePattern(n){return/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n)}function daysInMonth(n,t){switch(n){case"Feb":return t%4==0&&t%100||t%400==0?29:28;case"Apr":case"Jun":case"Sep":case"Nov":return 30;default:return 31}}function deleteCompanyLeaveType(n){var t=!1,i=ShowConfirmationAlertBox("Are you sure about deleting this company leave type?");i.then(function(){t=CompanyTimesheetView.prototype.DeleteCompanyLeave(n);t?(RemoveItemFromGrid("CompanyLeavesGrid",n),ShowAlertBox("Company Leave type deleted successfully")):ShowAlertBox("Error while deleting company leave type")})}function customBoolEditor(n){var t=$("<label class='btn btn-default'><input hidden name='include' type='radio' data-bind='checked:include' value=true>Yes<\/label><label class='btn btn-default'><input hidden name='include' type='radio' data-bind='checked:include' value=false >No<\/label>");t.appendTo(n)}function editLeaveType(n){var i=$("#CompanyLeavesGrid").data("kendoGrid"),t=i.dataSource.get(n);$("#hdnLeaveId").val(n);$("#ddlLeaveType").val(t.leaveType).attr("selected","selected");CompanyTimesheetView.prototype.SetDayOrWeek();$("#ddlLeaveYear").val(t.year).attr("selected","selected");$("#txtLeaveAllowed").val(t.leavesAllowed);t.include?$("#chkIncludeLeave").prop("checked",!0):$("#chkIncludeLeave").prop("checked",!1);$("#ddlLeaveYear").prop("disabled",!0);$("#ddlLeaveType").prop("disabled",!0);t.isLYCFAllowed?($("#chkIsLYCFAllowed").prop("checked",!0),CompanyTimesheetView.prototype.SetLYCFAllowedFields($("#chkIsLYCFAllowed").is(":checked")),$("#txtNoOfDaysLYCFAllowed").val(t.noOfDaysLYCFAllowed),$("#txtLYCFLapseDay").val(t.lycfLapseDay),$("#ddlLYCFLapseMonth").val(t.lycfLapseMonth).attr("selected","selected")):($("#chkIsLYCFAllowed").prop("checked",!1),CompanyTimesheetView.prototype.SetLYCFAllowedFields(!1));$("#txtLeaveAllowed").focusout();$("#AddLeaveAllowed").modal("show")}function CompanyEmailSetupView(){this.Init()}function ManageEmployeeView(){this.Init()}function editEmployee(n){window.location.href=baseURL+"Employee/BasicInformation?empId="+n}function EmployeeBasicInformationView(){this.Init()}function LeaveManagmentView(){this.Init()}function ApproveLeave(n,t){$("#hdnLeaveId").val(n);$("#hdnMaternityTypeId").val(t);$("#confirmLeaveApprovalPopup").modal("toggle")}function RejectLeave(n,t){var r=$("#ManageLeavesGrid").data("kendoGrid"),i=r.dataSource.get(n);$("#hdnLeaveId").val(n);$("#hdnMaternityTypeId").val(t);$("#lblEmpName").html(i.employeeName);$("#lblLeaveType").html(i.leaveType);$("#lblFromDt").html(kendo.toString(kendo.parseDate(i.fromDate),"dd MMM yyyy"));$("#lblToDt").html(kendo.toString(kendo.parseDate(i.toDate),"dd MMM yyyy"));i.numberOfDays>0?($("#displayNoOfDays").text("Number of Days"),$("#lblNoOfDays").html(i.numberOfDays)):($("#displayNoOfDays").text("Number of Weeks"),$("#lblNoOfDays").html(i.numberOfWeeks));$("#txtRejectionReason").val("");$("#LeaveRejectPopup").modal()}function MyLeavesView(){this.Init()}function CancelLeave(n,t){var i=ShowConfirmationAlertBox("Are you sure you want to cancel this leave?");i.then(function(){var r="",i;if((t==1||t==2)&&$.when($.ajax({url:baseURL+"Employee/CheckIfPostMaternityLeaveCancelledOrRejected",data:{leaveId:n,isCancelOrReject:"Cancel"},type:"POST",async:!1})).then(function(n){n!=""&&(r=n)}),r=="")i=!1,$.when($.ajax({url:baseURL+"Employee/CancelLeave",data:{leaveId:n},type:"POST",async:!1})).then(function(n){i=n?!0:!1}),i?(ShowAlertBox("Leave cancelled"),refreshGrid($("#EmployeeLeavesGrid")),refreshGrid($("#EmployeeLeaveSummaryGird"))):ShowAlertBox("Error while canceling Leave");else{ShowAlertBox(r);return}});event.stopImmediatePropagation()}function RequestCancellation(n,t){t=="Approved"?$("label[for='txtCancellationReqReason']").html("This leave is from an elapsed date & has been Approved. Please enter a reason to submit a cancellation request."):t=="Approved But Not Taken"&&$("label[for='txtCancellationReqReason']").html("This leave is from future date & has been Approved. Please enter a reason to submit a cancellation request.");$("#hdnLeaveId, #txtCancellationReqReason").val("");$("#hdnLeaveId").val(n);$("#LeaveCancellationReqPopup").modal();event.stopImmediatePropagation()}function GetDateInFormat(n,t){return kendo.toString(n==""?kendo.parseDate(n):kendo.parseDate(new Date(n)),t)}function LoadEmployeeLeaveInfo(n){var t=$.get(baseURL+"Employee/LoadEmployeeLeaveInfo",{leaveId:n});t.done(function(n){$("#lblEmployeeName").text(n.employeeName);$("#lblEmpLeaveType").text(n.leaveType);$("#lblLeaveFromDate").text(kendo.toString(kendo.parseDate(n.fromDate),"dd MMM yyyy"));$("#lblLeaveToDate").text(kendo.toString(kendo.parseDate(n.toDate),"dd MMM yyyy"));n.numberOfWeeks>0?($("#lblNumberOfDays").text(n.numberOfWeeks),$("#lblDisplayInWeeksOrDays").text("Number of Weeks")):($("#lblNumberOfDays").text(n.numberOfDays),$("#lblDisplayInWeeksOrDays").text("Number of Days"));n.expectedDeliveryDate!=null?($("#displayExpectedDeliveryDate").text("Expected Delivery Date"),$("#lblExpectedDeliveryDate").text(kendo.toString(kendo.parseDate(n.expectedDeliveryDate),"dd MMM yyyy"))):($("#displayExpectedDeliveryDate").text(""),$("#lblExpectedDeliveryDate").text(""));$("#txtReasonForLeave").val(n.reasonForLeave);$("#txtReasonForRejection").val(n.reasonForRejection);$("#txtReasonForCancellation").val(n.reasonForCancellation);$("#lblLeaveRequestDocName").text(n.leaveDocFileName===""?"No file attached":n.leaveDocFileName);$("#hdnDocAssetId").val(n.docAssetId);$("#EmployeeLeaveInfo").modal("toggle")});t.fail(function(){ShowAlertBox("Fail to load employee leave information!")})}function EditEmployeeLeaveInfo(n){var i=$("#EmployeeLeavesGrid").data("kendoGrid"),t=i.dataSource.get(n);t.leaveType!=""&&MyLeavesView.prototype.LoadEmployeeLeaveBalance(t.leaveType,t.leaveYear);$("#leaveId").val(n);$("#EmployeeAssetId").val(t.employeeAssetId);$("#LeaveDocAssetId").val(t.leaveDocAssetId);$("#lblFileName").html(t.leaveDocFileName===""?"No file attached":t.leaveDocFileName);$("#ddlLeaveYear").val(t.leaveYear).attr("selected","selected");$("#ddlFullHalfDay").val(t.leaveDay).attr("selected","selected");$("#ddlLeaveType").val(t.leaveType).attr("selected","selected");$("#ddlLeaveType").prop("readonly",!0);$("#ddlLeaveType").addClass("fieldset-disabled");$("#ddlLeaveType").addClass("pointer-none");$("#ddlLeaveFromDate").datepicker("setDate",new Date(t.fromDate.valueOf()));$("#leaveToDate").prop("disabled",!1).prop("readonly",!1);$("#ddlLeaveToDate").datepicker("setStartDate",new Date(t.fromDate.valueOf()));$("#ddlLeaveToDate").datepicker("setDate",new Date(t.toDate.valueOf()));$("#txtLeaveReason").val(t.reasonForLeave);t.numberOfDays>0?($("#ddlDaysOrWeeks").val("Days"),$("#txtNumberOfDaysOrWeeks").val(t.numberOfDays),$("#hdnOldAppliedDays").val(t.numberOfDays),$("#hdnOldAppliedInDaysOrWeeks").val("Days"),$("#txtNumberOfDays").val(t.numberOfDays)):t.numberOfWeeks>0&&($("#ddlDaysOrWeeks").val("Weeks"),$("#txtNumberOfDaysOrWeeks").val(t.numberOfWeeks),$("#hdnOldAppliedDays").val(t.numberOfWeeks),$("#hdnOldAppliedInDaysOrWeeks").val("Weeks"));t.expectedDeliveryDate!=null&&$("#ddlExpectedDeliveryDate").datepicker("setDate",new Date(t.expectedDeliveryDate.valueOf()));MyLeavesView.prototype.CheckMedicalCertificateReqForMedicalLeave();$("#EmployeeApplyLeave").modal("show")}function ApproveLeaveRequestView(){this.Init()}function EmployeeEmployeementSalaryView(){this.Init()}function SetSerialNumberToKGrid(n){return n.dataSource.page()==undefined?0:(n.dataSource.page()-1)*n.dataSource.pageSize()}function deleteEmpDocument(n){var t=ShowConfirmationAlertBox("Are you sure about deleting this document?");t.then(function(){var t=$.post(baseURL+"Employee/DeleteEmployeeDocument",{employeeAssetId:n});t.done(function(){ShowAlertBox("Employee document deleted successfully");RemoveItemFromGrid("EmployeeDocumentGrid",n)});t.fail(function(){ShowAlertBox("Error while deleting employee document")})})}function EmployeeSalaryHistoryView(){this.Init()}function openPayslip(n,t,i){var r=$("#hdnUserType").val();window.location.href=baseURL+"Employee/EmployeePayslip?empId="+n+"&normalUser="+r+"&month="+t+"&year="+i}function EmployeePayslipView(){this.Init()}function ManageTimesheetView(){this.Init()}function ConfirmDayApproval(n,t){var i=ShowConfirmationAlertBox("Are you sure you want to approve the attendance for the day?");i.then(function(){if(n!==""){var i=$.post(baseURL+"Timesheet/ApproveDailyTimesheet",{monthlyAttendanceId:n,monthDay:t});i.done(function(n){n?(ShowAlertBox("Timesheet approved for the day!"),refreshGrid($("#TimesheetListGird"))):ShowAlertBox(n+" Fail to approve timesheet !")});i.fail(function(n){ShowAlertBox(n+" Fail to approve timesheet !")})}})}function ConfirmMonthApproval(n){$("#hdnEmployeeId").val("");$("#hdnEmployeeId").val(n);InitializeConfirmationPopup("Confirm Timesheet Approval","Are you sure you want to approve the timesheet for this month?","","ApproveMonthTimesheet")}function ApproveMonthTimesheet(){var t=$("#hdnEmployeeId").val(),i=$("#ddlFilterByYear").val(),r=$("#ddlFilterByMonth").val(),n;t!==""&&r!==""&&i!==""&&(n=$.post(baseURL+"Timesheet/ApproveMonthTimesheet",{employeeId:t,month:r,year:i}),n.done(function(){$("#ConfirmationPopup").modal("hide");ShowAlertBox("Timesheet approved for the month");refreshGrid($("#TimesheetListGird"))}),n.fail(function(){ShowAlertBox("Failed to approve month timesheet !")}))}function setGridWeekDayHeader(n,t){var u=["Su","Mo","Tu","We","Th","Fr","Sa"],i=n.getDay(),f=new Date(n.getYear(),n.getMonth()+1,0).getDate(),r;for(day=1;day<=31;day++)r=$("#"+t+" th[data-field=day"+day+"] span[day='day']"),day<=f?i<6?((day==28||day==29||day==30||day==31)&&hideShowGridColumn("day"+day,t,!0),r.html(u[i]),i=i+1):i>=6&&((day==28||day==29||day==30||day==31)&&hideShowGridColumn("day"+day,t,!0),r.html(u[i]),i=0):hideShowGridColumn("day"+day,t,!1)}function hideShowGridColumn(n,t,i){var r=$("#"+t).data("kendoGrid");i?i&&r.showColumn(n):r.hideColumn(n)}function OffsetLeaves(n,t,i,r,u,f){var o=$("#ddlOffsetBy").css("padding-top"),e;$("#divOffset").css("padding-top",o.split("px")[0]-1+"px");$("#hdnActiveEmployeeId").val("");$("#hdnActiveEmployeeId").val(f);e=$.post(baseURL+"Timesheet/GetEmployeeDisplayName",{employeeId:f});e.done(function(n){$("#lblEmpName").html(n)});$("#ddlOffsetBy").prop("selectedIndex",0);$("#ddlOffsetBy").change();$("#lblhrLess").html(i);$("#txtOffset").val(i);$("#hdnDailyWorkingHrs").val(r);n<t?$("#offsetLeaves").modal("show"):(ShowAlertBox("No offset is required!"),$("#offsetLeaves").modal("hide"))}function openTimesheetApproval(n){var t=$("#ddlFilterByYear").val(),i=$("#ddlFilterByMonth").val();window.location.href=baseURL+"Timesheet/TimesheetApproval?empId="+n+"&month="+i+"&year="+t}function MyTimesheetView(){this.Init()}function TimesheetApprovalView(){this.Init()}function ApproveTimesheet(){var t=$("#hdnEmployeeId").val(),i=$("#hdnMonth").val(),r=$("#hdnYear").val(),n;t!==""&&i!==""&&r!==""&&(n=$.post(baseURL+"Timesheet/ApproveMonthTimesheet",{employeeId:t,month:i,year:r}),n.done(function(){refreshGrid($("#TimesheetApprovalGrid"));$("#ConfirmationPopup").modal("hide");$.when(showConfirmationWindow("Timesheet approved for the month")).then(function(n){n&&(window.location.href=baseURL+"Timesheet/ManageTimesheet")})}),n.fail(function(n){ShowAlertBox(n+" Fail to approve month timesheet !")}))}function showConfirmationWindow(n){return showConfirmWindow("#confirmationTemplate",n)}function showConfirmWindow(n,t){var i=new jQuery.Deferred,r=!1;return $("<div id='popupWindow'><\/div>").appendTo("body").kendoWindow({width:"325px",modal:!0,title:!1,resizable:!1,close:function(){this.destroy();i.resolve(r)}}).data("kendoWindow").content($(n).html()).center().open(),$(".popupMessage").html(t),$("#popupWindow .confirm_yes").val("OK"),$("#popupWindow .confirm_yes").click(function(n){n.preventDefault();r=!0;$("#popupWindow").data("kendoWindow").close()}),i.promise()}function OffsetEmployeeLeaves(n,t,i,r){var f=$("#ddlOffsetBy option:selected").text(),e=$("#txtOffset").val(),u=$.post(baseURL+"Timesheet/OffsetLeave",{employeeId:n,month:t,year:i,offsetBy:f,offsetValue:e});u.done(function(){ShowAlertBox("Leave offset has been added successfully!");$("#offsetLeaves").modal("hide");r=="TimesheetListGird"&&refreshGrid($("#TimesheetListGird"))});u.fail(function(n){ShowAlertBox(n+" Fail to add leave offset!")})}function ApproveTimesheetForDay(n){$("#hdnAttendanceId").val(n);InitializeConfirmationPopup("Confirm Timesheet Approval","Are you sure you want to approve the timesheet for this day?","","ApproveDayTimesheet")}function ApproveDayTimesheet(){var t=$("#hdnAttendanceId").val(),n;t!==""&&(n=$.post(baseURL+"Timesheet/ApproveDayTimesheet",{attendanceId:t}),n.done(function(){refreshGrid($("#TimesheetApprovalGrid"));$("#ConfirmationPopup").modal("hide")}),n.fail(function(n){ShowAlertBox(n+" Fail to approve timesheet !")}))}function ProcessPayrollView(){this.Init()}function rerunPayroll(n,t,i){var r=$.post(baseURL+"Payroll/GetPayrollValidation",{payrollYear:i,payrollMonth:t});r.done(function(r){r.length>0?ShowSummaryBox("Warning Message(s) - Resolve first and run payroll again",r):($("#payrollIdHash").val(n),$("#lblRerunPayrollMonth").html(t.bold()+" "+i.bold()),$("#confirmPayrollRerunPopup").modal("toggle"))});r.fail(function(n){ShowAlertBox(n+" Fail to get payroll validations !")})}function redirectToProcessPayroll(n,t,i){var r=$.post(baseURL+"Payroll/GetPayrollValidation",{payrollYear:i,payrollMonth:t});r.done(function(t){t.length>0?ShowSummaryBox("Warning Message(s) - Resolve first and run payroll again",t):window.location.href=baseURL+"Payroll/ReviewEmployees?payrollId="+n});r.fail(function(n){ShowAlertBox(n+" Fail to get payroll validations !")})}function ReviewEmployeesView(){this.Init()}function CalculateResigneesCountForMonth(){var n=0,t=$("#ResigneesForMonthGrid").data("kendoGrid").dataSource._data;for(i=0;i<t.length;i++)t[i].employeeId>0&&(n=n+1);$("#lblResigneesForMonth").html(n)}function AddEmployeeResigneesToGrid(){var n=$("#txtEmployeeName").attr("e-id"),r=$("#txtEmployeeName_listbox li").find("div[e-id="+$("#txtEmployeeName").attr("e-id")+"]"),i="",t;i=r.length>0?r.text():$("#txtEmployeeName").val().trim();var u=!1,f=$("#AddResigneesGrid").data("kendoGrid").dataSource.data(),e=f.length;for(t=0;t<e;t++)if(f[t].employeeId==n){u=!0;break}u?ShowAlertBox("Employee is already added!"):i!=""&&n!=undefined&&n!=""?$("#AddResigneesGrid").data("kendoGrid").dataSource.add({employeeId:n,employeeName:i,resignationDate:null}):ShowAlertBox("Please select Employee to add.")}function UpdateEmployeesReginees(){for(var i=!0,r=!1,t=$("#AddResigneesGrid").data("kendoGrid").dataSource.data(),u=t.length,n=0;n<u;n++)t[n].employeeId>0&&(r=!0,(t[n].resignationDate==""||t[n].resignationDate==null)&&(i=!1));if(i&&r)for(n=0;n<u;n++)t[n].employeeId>0&&(isSuccess=MarkEmployeeAsResignee(t[n].employeeId,t[n].resignationDate));i||ShowAlertBox("Please select resign date!");r||ShowAlertBox("Please add employee resignees to save!");isSuccess&&(ShowAlertBox("Employee Status updated!"),refreshGrid($("#ResigneesForMonthGrid")),$("#AddResigneesPopup").modal("hide"),$("#AddResigneesGrid").data("kendoGrid").dataSource.data([]))}function MarkEmployeeAsResignee(n,t){var i=$.post(baseURL+"Payroll/MarkEmployeeAsResignee",{empId:n,resignationDate:t});return i.done(function(){return!0}),i.fail(function(){return!1}),!0}function DeleteEmployeeRegineeFromGrid(){var n=!1,t=0,i=$("#AddResigneesGrid").data("kendoGrid"),r=$("#AddResigneesGrid");if($("#AddResigneesGrid").find("input:checked").each(function(){this.id!="header-chk-res"&&(t++,n=RemoveEmployeeRegineeFromGrid(this.id))}),t===0){ShowAlertBox("Please select employee to remove.");return}n?(ShowAlertBox("Employee(s) removed!"),$("#header-chk-res").removeAttr("checked")):ShowAlertBox("Employee(s) fail to remove.")}function RemoveEmployeeRegineeFromGrid(n){for(var i=$("#AddResigneesGrid").data("kendoGrid").dataSource.data(),r=i.length,t=0;t<r;t++)if(i[t].employeeId==n)return $("#AddResigneesGrid").data("kendoGrid").dataSource.remove(i[t]),!0;return!1}function resignationDateEditor(n,t){var r=$('<div class="input-group input-append date custom-grid-date"><input type="text" id="resignDate" class="form-control"/><span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"><\/span><\/span><\/div>').appendTo(n),i=new Date,u=new Date(i.getFullYear(),i.getMonth(),1);r.datepicker({format:"mm/dd/yyyy",startDate:u,autoclose:!0});$("#resignDate").change(function(){$(this).attr("value",$("#resignDate").val());t.model.resignationDate=$("#resignDate").val()})}function CalculateEmployeesCountForMonth(){var n=0,t=$("#EmployeesForMonthGrid").data("kendoGrid").dataSource._data;for(i=0;i<t.length;i++)t[i].employeeId>0&&n++;$("#lblEmployeesForMonth").html(n)}function OpenPayrollEntryPopup(n,t){$("#hdnPayItemUpdated").val(!1);var i=$.post(baseURL+"Payroll/GetPayrollEntryData",{employeePayrollId:t,employeeId:n});i.done(function(i){$("#EmployeeId").val(n);$("#EmployeePayrollId").val(t);$("#Month").val(i.month);$("#Year").val(i.year);$("#hdrPayrollEntry").html("Payroll Entry - "+i.month+" "+i.year);i.hasUnpaidLeaves==="Y"?($("#rdnUnpaidYes").prop("checked",!0),$("#txtUnpaidLeaveCnt").prop("readonly",!1)):($("#txtUnpaidLeaveCnt").prop("readonly",!0),$("#rdnUnpaidNo").prop("checked",!0));$("#txtUnpaidLeaveCnt").val(i.unpaidLeaveCount);$("#txtTotalWorkedDays").val(i.totalWorkedDays);$("#txtTotalLeaveBalance").val(i.totalLeaveBalance);$("#lblBasicSalary").text(i.basicSalaryType+" Basic Salary ");$("#txtBasicSalary").val(i.basicSalary);$("#txtMonthlyBasicSalary").val(i.monthlyBasicSalary);$("#ddlAvailablePayItems").val("");$("#AddPayrollEntryPopup").modal("toggle");var r=$("#PayrollPayItemGrid").data("kendoGrid");r!=undefined&&(r.destroy(),$("#PayrollPayItemGrid").html("").removeClass());LoadEmpPayrollPayItemGrid(n);GetEmployeePaymentCurrency(n)});i.fail(function(){$("#AddPayrollEntryPopup").modal("toggle");ShowAlertBox("Fail to load payroll entry details")});event.stopImmediatePropagation()}function GetEmployeePaymentCurrency(n){var t=$.post(baseURL+"Payroll/GetEmployeePaymentCurrency",{employeeId:n});t.done(function(n){$("#lblEmpPaymentCurrency").text("("+n+")");$("#lblEmpPaymentCurrency1").text("("+n+")")});t.fail(function(){ShowAlertBox("Fail to load Employee Payment Currency")})}function LoadEmpPayrollPayItemGrid(n){function t(){if(setTimeout(function(){$("#PayrollPayItemGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Pay Item");$("#PayrollPayItemGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#PayrollPayItemGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Pay Item");$("#PayrollPayItemGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$("#PayrollPayItemGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Pay Item");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");$("#PayrollPayItemGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("PayrollPayItemGrid")});$("#PayrollPayItemGrid a.k-grid-update.grid-update").on("click",function(){var r=$(this).closest("tr"),t=r.find("#pickerStartDate"),i=r.find("#pickerEndDate"),n=r.find("#txtValue"),f=r.find("#txtAmountBasedOn"),u=$("#PayrollPayItemGrid").data("kendoGrid").dataItem(r);u.frequency==="Fixed"?(n.val().trim()!=""&&n.attr("attr-value")!=n.val().trim()||t.val().toLowerCase()!=t.attr("start-dt").toLowerCase()||i.val().toLowerCase()!=i.attr("end-dt").toLowerCase())&&(t.attr("start-dt",t.val()),i.attr("end-dt",i.val()),n.attr("attr-value",n.val()),u.dirty||HandleUpdateEvent("#PayrollPayItemGrid",baseURL+"Employee/UpdateEmployeePayItem",{payItemData:JSON.stringify([u])}),$("#hdnPayItemUpdated").val(!0)):(n.val().trim()!=""&&n.attr("attr-value")!=n.val().trim()||t.val().toLowerCase()!=t.attr("start-dt").toLowerCase()||i.val().toLowerCase()!=i.attr("end-dt").toLowerCase())&&(t.attr("start-dt",t.val()),i.attr("end-dt",i.val()),n.attr("attr-value",n.val()),f.attr("attr-amountBasedOn",f.val()),u.dirty||HandleUpdateEvent("#PayrollPayItemGrid",baseURL+"Employee/UpdateEmployeePayItem",{payItemData:JSON.stringify([u])}),$("#hdnPayItemUpdated").val(!0))});KGrdPageSizeDdlPosition("PayrollPayItemGrid",$(".k-list-scroller").length-1)},1),this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}}var i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeePayItems",dataType:"json"},update:{url:baseURL+"Employee/UpdateEmployeePayItem",dataType:"json"},destroy:{url:baseURL+"Employee/DeleteEmployeePayItem",dataType:"json"},parameterMap:function(t,i){return((i==="update"||i==="destroy")&&$("#hdnPayItemUpdated").val(!0),i!="read"&&t.models)?{payItemData:kendo.stringify(t.models)}:i==="read"?{employeeId:n}:void 0}},batch:!0,pageSize:2,schema:{model:{id:"employeePayItemId",fields:{employeeId:{editable:!1},employeePayItemId:{editable:!1},description:{editable:!1},category:{editable:!1},cpfApplicable:{editable:!1},frequency:{editable:!1},hours:{editable:!0},periodFrom:{editable:!0},periodTo:{editable:!0},variableType:{editable:!1},amountBasedOn:{editable:!0,type:"number"},value:{editable:!0,type:"number"},startDate:{editable:!0},endDate:{editable:!0},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#PayrollPayItemGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{template:'<input type="checkbox" id="#:data.employeePayItemId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeePayItemId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:"50px"},{field:"description",title:"Description",width:"150px",template:function(n){return n.endDate!=""&&n.endDate!=null&&CompareDate(kendo.toString(kendo.parseDate(new Date(n.endDate)),"dd/MM/yyyy"))?"<font title='Expired' color='#bb2121'>"+n.description+"<\/font>":n.description}},{field:"category",title:"Category",width:"100px"},{field:"cpfApplicable",title:"CPF?",width:"60px"},{field:"frequency",title:"Frequency",width:"90px"},{field:"hours",title:"Hours",width:"120px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:'<span style="display:block !important">OT<\/span> <span style="display:block !important">Hours<\/span>',editor:function(n,t){var i=$("<input id='txtHours' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$' class='k-input k-textbox' attr-hours='"+t.model.hours+"' value='"+t.model.hours+"' data-bind='value:"+t.field+"' />").appendTo(n)}},{field:"periodFrom",title:"Period From",width:"120px",editor:function(n,t){var i=$("<input id='pickerPeriodFrom' class='k-input k-textbox' start-dt='"+t.model.periodFrom+"' value='"+t.model.periodFrom+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerPeriodFrom").change(function(){$(this).attr("value",$("#pickerPeriodFrom").val());t.model.startDate=$("#pickerPeriodFrom").val()})}},{field:"periodTo",title:"Period To",width:"120px",editor:function(n,t){var i=$("<input id='pickerPeriodTo' class='k-input k-textbox' end-dt='"+t.model.periodTo+"' value='"+t.model.periodTo+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerPeriodTo").change(function(){$(this).attr("value",$("#pickerPeriodTo").val());t.model.endDate=$("#pickerPeriodTo").val()})}},{field:"variableType",title:"Variable Type",width:"140px"},{field:"amountBasedOn",title:"Amount Based On",width:"100px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:'<span style="display:block !important">Amount<\/span> <span style="display:block !important">Based On<\/span>',editor:function(n,t){var i;i=t.model.frequency=="Variable"&&t.model.variableType!="Other user entered amount (may differ every month)"?$("<input id='txtAmountBasedon' maxlength='10' class='k-input k-textbox' attr-amountBasedOn='"+t.model.amountBasedOn+"' value='"+t.model.amountBasedOn+"' data-bind='value:"+t.field+"' />").appendTo(n):$("<input id='txtAmountBasedon' maxlength='10' class='k-input k-textbox disabledBackGround' attr-amountBasedOn='"+t.model.amountBasedOn+"' value='"+t.model.amountBasedOn+"' data-bind='value:"+t.field+"' disabled />").appendTo(n);$("#txtAmountBasedon").change(function(){this.value=parseFloat(this.value).toFixed(2);$(this).attr("value",$("#txtAmountBasedon").val());t.model.amountBasedOn=$("#txtAmountBasedon").val()})}},{field:"value",title:"Amount",width:"100px",headerTemplate:'<span id="lblHeaderAmt"><\/span>',template:function(n){if($("#PayrollPayItemGrid").find("#lblHeaderAmt").html()==""){var t=n.currency===null?"":n.currency;$("#PayrollPayItemGrid").find("#lblHeaderAmt").html("Amount ("+t+")")}return formatAmountWithCurrency(n.value,n.currency,n.currencySymbol)},editor:function(n,t){t.model.frequency=="Variable"&&(t.model.variableType=="Amount per day for the total working days in a month"||t.model.variableType=="Amount per day for the days actually worked in a month"||t.model.variableType=="% of present month basic salary"||t.model.variableType=="Number of times")?$("<input id='txtValue' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$'  class='k-input k-textbox disabledBackGround' disabled attr-value='"+t.model.value+"' value='"+t.model.value+"' data-bind='value:"+t.field+"' />").appendTo(n):$("<input id='txtValue' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$'  class='k-input k-textbox' attr-value='"+t.model.value+"' value='"+t.model.value+"' data-bind='value:"+t.field+"' />").appendTo(n);$("#txtValue").change(function(){this.value=parseFloat(this.value).toFixed(2);$(this).attr("value",$("#txtValue").val());t.model.value=$("#txtValue").val()})}},{field:"startDate",title:"Effective Date",width:"120px",editor:function(n,t){var i=$("<input id='pickerStartDate' start-dt ='"+t.model.startDate+"' class='k-input k-textbox' value='"+t.model.startDate+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerStartDate").change(function(){$(this).attr("value",$("#pickerStartDate").val());t.model.startDate=$("#pickerStartDate").val()})}},{field:"endDate",title:"End Date",width:"120px",editor:function(n,t){var i=$("<input id='pickerEndDate' class='k-input k-textbox' end-dt='"+t.model.endDate+"' value='"+t.model.endDate+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerEndDate").change(function(){$(this).attr("value",$("#pickerEndDate").val());t.model.endDate=$("#pickerEndDate").val()})}},{command:[{name:"edit",text:{edit:" ",update:" ",cancel:" "}},{name:"destroy",text:""}],title:"&nbsp;",width:"100px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){$("#PayrollPayItemGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk",function(){$("#PayrollPayItemGrid tbody input:checkbox").prop("checked",this.checked)})}function effectiveDateEditor(n,t){var i=$('<div class="input-group input-append date custom-grid-date"><input type="text" id="dtpEffectiveDate" class="form-control"/><span class="input-group-addon add-on"><img src="'+baseURL+'images/date.png" /><\/span><\/div>').appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#dtpEffectiveDate").change(function(){$(this).attr("value",$("#dtpEffectiveDate").val());t.model.effectiveDate=$("#dtpEffectiveDate").val()})}function endDateEditor(n,t){var i=$('<div class="input-group input-append date custom-grid-date"><input type="text" id="dtpEndDate" class="form-control"/><span class="input-group-addon add-on"><img src="'+baseURL+'images/date.png" /><\/span><\/div>').appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#dtpEndDate").change(function(){$(this).attr("value",$("#dtpEndDate").val());t.model.endDate=$("#dtpEndDate").val()})}function ConfirmPayrollView(){this.Init()}function BonusListView(){this.Init()}function EditBonus(n){window.location.href=baseURL+"Payroll/EditBonus?bonusId="+n}function AddBonusView(){this.Init()}function bonusIncludeEditor(n){var t=$("<label class='btn btn-default'><input hidden name='include' type='radio' data-bind='checked:include' value=true>Yes<\/label><label class='btn btn-default'><input hidden name='include' type='radio' data-bind='checked:include' value=false >No<\/label>");t.appendTo(n)}function FinalizePaymentView(){this.Init()}function PayslipsView(){this.Init()}function OpenPayslipViewer(n,t,i,r){window.location.href=baseURL+"Payslip/PayslipViewer?id="+encodeURIComponent(n)+"&y="+t+"&m="+i+"&isBonusPay="+r}function MyPayslipsView(){this.Init()}function IR8AView(){this.Init()}function EmployeeLeaveReportView(){this.Init()}function PayrollClaimReportView(){this.Init()}function GeneralLedgerView(){this.Init()}function PayslipSendReportView(){this.Init()}function LeaveBalanceReportView(){this.Init()}function EmployeePayReportView(){this.Init()}function CPFView(){this.Init()}function GenerateCPFFile(n,t,i,r,u){window.location.href=baseURL+"Payroll/GenerateCPFFile?cpfYear="+n+"&cpfMonth="+t+"&csnNumber="+i+"&interestAmt="+r+"&CurrencyCode="+u}function PayrollReports(){this.Init()}function PaymentListingReport(){this.Init()}function CPFReport(){this.Init()}function PayItemsDetailReport(){this.Init()}function ManageUserView(){this.Init()}function EditUser(n){var t=$.get(baseURL+"Settings/LoadUserInfo",{userId:n});t.done(function(t){ManageUserView.prototype.EditUserClearFields();$("#UserId").val(n);$("#txtEmailAddress").val(t.emailAddress);$("#txtEmployeeCode").val(t.employeeCode);$("#txtFullName").val(t.firstName+" "+t.lastName);$("#txtPhoneNumber").val(t.mobileNumber);$("#ddlRoleList").val(t.roleName);$("#userEditPopup").modal("toggle")});t.fail(function(){ShowAlertBox("Fail to load user information!")})}function ManageSystemAdminsView(){this.Init()}function ManageRolesView(){this.Init()}function DisplayFields(){this.Init()}function GetDisplayFieldsDetails(n,t,i){if(i.preventDefault(),n=="National Holiday"&&t==0){$("#ddlHolidayYear").val((new Date).getFullYear());$("#divDisplayFieldsPartialPage, #divLeaveTypesPartialPage").hide();$("#divNationalHolidayPartialPage").show();LoadNationalHolidayDetails();return}if(n=="Leave Types"&&t==0){$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#divDisplayFieldsPartialPage, #divNationalHolidayPartialPage").hide();$("#divLeaveTypesPartialPage").show();DisplayFields.prototype.LoadLeaveTypesGrid();return}$("#divDisplayFieldsPartialPage").show();$("#divNationalHolidayPartialPage, #divLeaveTypesPartialPage").hide();$("#lblDisplayFieldHeader").text(n);$("#hdnActiveListName").val(n);$("#hdnActiveListId").val(t);refreshGrid($("#DisplayFieldDetailGrid"))}function LoadNationalHolidayDetails(){LoadNationalHolidayGrid()}function ExpenseView(){this.Init()}function AddExpense(){window.location.href=baseURL+"Expense/AddExpense"}function EditExpense(n,t){window.location.href=t==="Fuel/Mileage Expenses"?baseURL+"Expense/AddMileage?expenseIdHash="+n:t==="Per Diem"?baseURL+"Expense/AddPerDiem?expenseIdHash="+n:baseURL+"Expense/AddExpense?expenseIdHash="+n}function DeleteExpense(n){var t=ShowConfirmationAlertBox("Are you sure about deleting the selected expense?");t.then(function(){var t=$.post(baseURL+"Expense/DeleteExpense",{expenseId:n});t.done(function(t){t?(ShowAlertBox("Selected expense have been deleted."),RemoveItemFromGrid("ExpenseGrid",n)):ShowAlertBox("Error while deleting expense")});t.fail(function(){ShowAlertBox("Error while deleting expense")})})}function AddExpenseView(){this.Init()}function ManageReimburseAmountModifyReasonControls(){var i=$("#txtReimburseAmount").val(),n=$("#txtReimburseAmount").attr("originalValue"),t;parseFloat(i)>0?(n==undefined&&(t=$("#hdnReimburseAmount").val(),parseFloat(t)>0&&(n=t,$("#txtReimburseAmount").attr("originalValue",n))),parseFloat(n)==parseFloat(i)&&$("#hdnReimburseAmountModifyReason").val()==""?($("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#divReasonForModifyingReimbursementAmount").removeClass("hidden"),$("#txtReasonForModifyingReimbursementAmount").prop("required",!0))):($("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#divReasonForModifyingReimbursementAmount").addClass("hidden"))}function FileUploadDivborder(){var n=$("#fileUploadExpenseReceipt").val();n&&($("#divRightSection").removeClass("divDottedBorderError"),$("#divRightSection").addClass("divDottedBorder"))}function AddMileageView(){this.Init()}function CalculateMileageDistanceAmount(){var n=$("#txtDistance").val(),t=$("#hdnMileageCurrency").val(),i=$("#ddlReimburseCurrency").val(),r=$("#hdnMileageRate").val(),u=0,f;$("#Amount").val(parseFloat(n*r));parseFloat(n*r)>0?(f=GetCurrencyExchangeRate(t,i,1),$("#CurrencyExRate").val(parseFloat(f)),u=(n*f*r).toFixed(2),$("#txtReimburseAmount").val(u),$("#txtReimburseAmount").closest(".form-group").removeClass("has-error has-danger"),$("#txtReimburseAmount").attr("originalValue",$("#txtReimburseAmount").val()),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtReimburseAmount").val(""));t!=i&&parseFloat(u)>0?($("#lblMileageExchangeRate").text("Exchange Rate : 1 "+t+" = "+$("#CurrencyExRate").val()+" "+i),$("#lblMileageExchangeRate").css("visibility","visible"),$("#btnChangeMileageExchangeRate").css("visibility","visible")):($("#lblMileageExchangeRate").css("visibility","hidden"),$("#btnChangeMileageExchangeRate").css("visibility","hidden"))}function AddPerDiemView(){this.Init()}function BulkAddExpenseView(){this.Init()}function CheckValue(n){var t=parseInt(n.value);t<0&&(n.value="")}function OpenAddListModal(){$("#hdnListName").val("ExpenseMerchant");$("#txtListItemName").val("");$("#AddListItem").attr("Source","BulkExpense");$("#AddListItem").modal()}function ValidateBulkReferenceNumber(){$("#AddBulkExpenseGrid tbody tr").each(function(){var i=$(this).find('input[txt-merchant="merchant"]').val(),r=$(this).find('select[ddl-category="category"] option:selected').val(),n=$(this).find('input[txt-Ref="ref"]').val(),t;(n.length<=0||$(this).find('input[type="file"]#fUploadReceipt')[0].files.length<=0)&&(t=ValidateReferenceNumber("Expense",r,n,i,0),t&&($(this).find('input[txt-Ref="ref"]').val(""),ShowAlertBox("Invoice number already exists!")))})}function GetCurrencyExchangeRate(n,t,i){var r=0;return n===""||t===""||n===t?1:($.when($.ajax({url:baseURL+"Expense/GetCurrencyExchangeRate",data:{amount:i,fromCurrency:n,toCurrency:t},type:"GET",async:!1})).then(function(n){r=n}),r)}function ExpenseReportsView(){this.Init()}function EditExpenseReport(n){window.location.href=baseURL+"Expense/AddExpenseReport?expenseReportIdHash="+n}function DeleteExpenseReport(n){var t=ShowConfirmationAlertBox("Are you sure about deleting the selected report?");t.then(function(){var t=$.post(baseURL+"Expense/DeleteExpenseReport",{expenseReportId:n});t.done(function(t){t?(ShowAlertBox("Report deleted successfully"),RemoveItemFromGrid("ExpenseReportsGrid",n)):ShowAlertBox("Error while deleting report")});t.fail(function(){ShowAlertBox("Error while deleting report")})})}function AddExpenseReportsView(){this.Init()}function EditExpenseFromReport(n,t,i){var r=$.get(baseURL+"Expense/LoadExpense",{expenseId:n});r.done(function(n){AddExpenseReportsView.prototype.ClearFields();$("#ddlExpenseType").val(t);$("#ddlExpenseCategory").val(n.category);$("#ddlExpenseType").change();$("#EmployeeId").val(n.employeeId);$("#CompanyId").val(n.companyId);$("#ExpenseId").val(n.expenseId);$("#Status").val(n.status);$("#datePickerExpense").datepicker("setDate",new Date(n.dateIncurred));$("#chkInvoiceNotAvailable").prop("checked",n.isInvoiceNotAvailable);$("#datePickerExpenseToDateIncurred").datepicker("setDate",new Date(n.toDateIncurred));n.status=="Rejected"?($("#divRejectionReason").removeClass("hidden"),$("#txtExpenseRejectionReason").val(n.rejectionReason)):$("#divRejectionReason").addClass("hidden");ExpenseReportEnableAllFields();t=="Expense"?($("#ddlExpeCurrency").val(n.currency),$("#txtExpenseAmount").val(n.amount),$("#ddlReimburseCurrencyPopup").val(n.reimburseCurrency),$("#txtReimburseAmountPopup").val(n.reimburseAmount),$("#txtReimburseAmountPopup").attr("originalValue",n.reimburseAmount),n.currency!=n.reimburseCurrency&&($("#lblExchangeChngRatePopup").text("1 "+n.currency+" = "+n.currencyExRate+" "+n.reimburseCurrency),$("#btnChangeExpenseReportExchangeRate").css("visibility","visible")),$("#ddlMerchant").val(n.merchant),$("#chkclmReimbursement").prop("checked",n.isClaimReimbursement),$("#ddlExpenseReportCountry").val(n.country)):t=="Per Diem"?($("#ddlPerDiemCurrency").val(n.currency),$("#txtPerDiemAmount").val(n.amount),$("#ddlReimburseCurrencyPDPopup").val(n.reimburseCurrency),$("#txtReimburseAmountPDPopup").val(n.reimburseAmount),$("#txtReimburseAmountPDPopup").attr("originalValue",n.reimburseAmount),n.currency!=n.reimburseCurrency&&($("#lblExchangeChngRatePDPopup").text("1 "+n.currency+" = "+n.currencyExRate+" "+n.reimburseCurrency),$("#btnChangePerDiemReportExchangeRate").css("visibility","visible")),$("#chkClmReimburseDiem").prop("checked",n.isClaimReimbursement),$("#ddlExpenseReportCountry").val(n.country)):t=="Mileage"&&(n.mileageUsing==="Distance"?$("#rdnDistanceTraveled").prop("checked",!0):$("#rdnOdometerReading").prop("checked",!0),AddExpenseReportsView.prototype.ShowControlByrbdCalculateMileage(),$("#ddlMLGReimburseCurrency").val(n.reimburseCurrency),$("#txtMLGReimburseAmount").attr("originalValue",n.reimburseAmount),$("#txtMLGReimburseAmount").val(n.reimburseAmount),$("#chkclmReimburseForMileage").prop("checked",n.isClaimReimbursement),$("#Amount").val(n.amount),n.currency!=n.reimburseCurrency&&($("#lblExchangeChngRateMileage").text("1 "+n.currency+" = "+n.currencyExRate+" "+n.reimburseCurrency),$("#btnChangeMileageReportExchangeRate").css("visibility","visible")));AddExpenseReportsView.prototype.SetInvoiceNumberRequired(n.isInvoiceNotAvailable);$("#CurrencyExRate").val(n.currencyExRate);n.reimburseAmountModifyReason!=""?($("#txtReasonForModifyingReimbursementAmount").val(n.reimburseAmountModifyReason),$("#divReasonForModifyingReimbursementAmount").removeClass("hidden"),$("#txtReasonForModifyingReimbursementAmount").prop("required",!0),$("#hdnReimburseAmountModifyReason").val(n.reimburseAmountModifyReason)):(AddExpenseReportsView.prototype.HideShowModifyReasonControls(0,0),$("#hdnReimburseAmountModifyReason").val(""));$("#ddlPerDiemRateList").val(n.perDiemRate);$("#txtDays").val(n.noOfDays);$("#ddlVehicle").val(n.vehicle);$("#txtStartReading").val(n.startReading);$("#txtEndReading").val(n.endReading);$("#DistanceHidden").val(n.distance);$("#txtMileageDistance").val(n.distance);$("#txtInvoiceReferenceNo").val(n.referenceNo);$("#ExpenseReportId").val(n.reportReferenceId);$("#txtDesc").val(n.description);$("#ExpenseReceiptAssetId").val(n.expenseReceiptAssetId);$("#EmployeeAssetId").val(n.employeeAssetId);n.expenseReceiptAssetId!=null?(n.expenseAssetType=="Image"?($("#imgExpenseReceipt").attr("src",baseURL+"Asset/Original/"+n.expenseReceiptAssetId),$("#lnkReceiptDoc").attr("href","#").addClass("hide-span")):n.expenseAssetType=="Document"&&($("#imgExpenseReceipt").attr("src",baseURL+"images/no-preview.png"),$("#lnkReceiptDoc").attr("href",baseURL+"Asset/Download/"+n.expenseReceiptAssetId).removeClass("hide-span")),$("#fileUploadExpenseReceipt").prop("required",!1),$("#divModalRightSection").removeClass("divDottedBorderError")):$("#lnkReceiptDoc").attr("href","#").addClass("hide-span");$("#ExpenseId").val()?$("#btnSaveExpense").val("SAVE"):$("#btnSaveExpense").val("SAVE AND INCLUDE");i!=undefined&&i&&DisableAllControlsOfExpenseDetailsFromReportApproval();$("#txtDesc").focusout();$("#AddExpenseModal").modal("show")});r.fail(function(){ShowAlertBox("Fail to open expense!")})}function ExpenseReportEnableAllFields(){$("#ddlExpenseType, #txtMileageDistance").attr("disabled",!1);$("#txtMLGReimburseAmount, #txtReimburseAmountPopup,#txtReimburseAmountPDPopup ").attr("disabled",!1);$("#ddlExpenseCategory, #AdvExpenseDt, #ddlExpeCurrency, #txtExpenseAmount").attr("disabled",!1);$("#ddlMileageCategory, #txtStartReading, #txtEndReading, #rdnDistanceTraveled, #rdnOdometerReading").attr("disabled",!1);$("#txtInvoiceReferenceNo, #ddlVehicle, #ddlMerchant, #txtDesc").attr("disabled",!1);$("#ddlPerDiemRateList, #ddlPerDiemCurrency, #txtPerDiemAmount, #txtDays").attr("disabled",!1);$("#chkClmReimburseDiem, #chkclmReimbursement, #chkInvoiceNotAvailable, #chkclmReimburseForMileage").attr("disabled",!1);$("#linkAddExpenseMerchant, #linkAddMileageVehicle").removeClass("disabledDiv");$("#lblExchangeChngRatePopup, #lblExchangeChngRatePDPopup, #lblExchangeChngRateMileage").attr("disabled",!1);$("#btnChangePerDiemReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangeExpenseReportExchangeRate").removeClass("disabledDiv");$("#txtReasonForModifyingReimbursementAmount, #fileUploadExpenseReceipt").attr("disabled",!1);$("#ddlExpenseReportCountry, #AdvExpenseDtToDateIncurred").attr("disabled",!1);$("#btnSaveExpense").css("visibility","visible")}function excludeExpense(n){var t=ShowConfirmationAlertBox("Are you sure about removing this expense?");t.then(function(){var t=!1,i;$.when($.ajax({url:baseURL+"Expense/ExcludeExpense",data:{expenseId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1});t?ShowAlertBox("Expenses removed successfully"):ShowAlertBox("Error while removing expenses");i=$("#hdnExpenseReportIdHash").val();window.location.href=baseURL+"Expense/AddExpenseReport?expenseReportIdHash="+encodeURIComponent(i)});event.stopImmediatePropagation()}function conditionalSum(n){for(var r=$(n).data("kendoGrid").dataSource.data(),t,u=0,i=0;i<r.length;i++)t=r[i],t.isClaimReimbursement===!1&&(u+=t.reimburseAmount);return u}function ExcludeAdvancedPayment(n){var t=ShowConfirmationAlertBox("Are you sure about removing this advance payment?");t.then(function(){var t=!1,i;$.when($.ajax({url:baseURL+"Expense/ExcludeAdvancePayment",data:{advPaymentId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1});t?ShowAlertBox("Advances removed successfully."):ShowAlertBox("Error while removing advances");i=$("#hdnExpenseReportIdHash").val();window.location.href=baseURL+"Expense/AddExpenseReport?expenseReportIdHash="+encodeURIComponent(i)});event.stopImmediatePropagation()}function EditAdvancedPayments(n){var n={expenseAdvPaymentId:n},t=$.get(baseURL+"Expense/LoadAdvancePayment",n);t.done(function(n){AddExpenseReportsView.prototype.AdvancePaymentPopupClearFields();$("#ExpenseAdvPaymentId").val(n.expenseAdvPaymentId);$("#ddlAdvPmtPopupCurrency").val(n.currency);$("#txtAdvPmtPopupAmount").val(n.amount);$("#ddlAdvPmtPopupReimburseCurr").val(n.reimburseCurrency);$("#txtAdvPmtPopupReimburseAmt").val(n.reimburseAmount);$("#CurrencyExRate").val(n.currencyExRate);$("#txtRef").val(n.referenceNo);$("#txtNote").val(n.notes);$("#ddlAdvPaymentPaidThrough").val(n.paidThrough);$("#datePickerAdvPayDate").datepicker("setDate",kendo.toString(new Date(n.date),"dd/MMM/yyyy"));n.currency!=n.reimburseCurrency&&parseFloat(n.amount)>0?($("#lblAdvPmtPopupExchangeRate").text("1 "+n.currency+" = "+n.currencyExRate+" "+n.reimburseCurrency),$("#lblAdvPmtPopupExchangeRate").css("visibility","visible")):$("#lblAdvPmtPopupExchangeRate").css("visibility","hidden");$("#ExpenseAdvPaymentId").val()?$("#btnRecAdvPay").val("SAVE"):$("#btnRecAdvPay").val("SAVE AND INCLUDE");$("#txtNote").focusout();$("#recordAdvancePaymentModal").modal("show")});t.fail(function(){ShowAlertBox("Fail to open pay item!")})}function MyApprovalsView(){this.Init()}function ViewReportApprovalPage(n,t){window.location.href=baseURL+"Expense/ReportApproval?id="+n+"&a="+t}function ReportApprovalView(){this.Init()}function OpenExpenseDetailsFromReportApproval(n,t){EditExpenseFromReport(n,t,!0);objThis.HideShowValidatePerdiemControls(t);AddExpenseReportsView.prototype.ShowHideControls(t)}function DisableAllControlsOfExpenseDetailsFromReportApproval(){$("#expensePopupHeader").text("Expense Details");$("#ddlExpenseType, #txtMileageDistance").attr("disabled",!0);$("#txtMLGReimburseAmount, #txtReimburseAmountPopup,#txtReimburseAmountPDPopup ").attr("disabled",!0);$("#ddlExpenseCategory, #AdvExpenseDt, #ddlExpeCurrency, #txtExpenseAmount").attr("disabled",!0);$("#ddlMileageCategory, #txtStartReading, #txtEndReading, #rdnDistanceTraveled, #rdnOdometerReading").attr("disabled",!0);$("#txtInvoiceReferenceNo, #ddlVehicle, #ddlMerchant, #txtDesc").attr("disabled",!0);$("#ddlPerDiemRateList, #ddlPerDiemCurrency, #txtPerDiemAmount, #txtDays").attr("disabled",!0);$("#chkClmReimburseDiem, #chkclmReimbursement, #chkInvoiceNotAvailable, #chkclmReimburseForMileage").attr("disabled",!0);$("#linkAddExpenseMerchant, #linkAddMileageVehicle").addClass("disabledDiv");$("#lblExchangeChngRatePopup, #lblExchangeChngRatePDPopup, #lblExchangeChngRateMileage").attr("disabled",!0);$("#btnChangePerDiemReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangeExpenseReportExchangeRate").addClass("disabledDiv");$("#txtReasonForModifyingReimbursementAmount, #fileUploadExpenseReceipt").attr("disabled",!0);$("#ddlExpenseReportCountry, #AdvExpenseDtToDateIncurred").attr("disabled",!0);$("#btnSaveExpense").css("visibility","hidden")}function RejectExpense(n){$("#txtRptExpenseRejectionReason").val("");$("#hdnRptExpenseId").val(n);$("#RejectExpenseReportModal").modal()}function ApproveReportExpense(n){var t=!1;$.when($.ajax({url:baseURL+"Expense/ApproveReportExpense",data:{expenseId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1});t?refreshGrid($("#ApprovalItemGrid")):ShowAlertBox("Error while approving expense");event.stopImmediatePropagation()}function AdvancedPaymentViews(){this.Init()}function AdvancePaymentObject(){if(!$("#btnAddAdvancePayment").hasClass("disabled")){var f=$("#ExpenseAdvPaymentId").val(),n=$("#ddlEmployeeList").val(),t=$("#advancePaymentDate").val(),i=$("#ddlPaidThrough").val(),e=$("#txtRef").val(),r=$("#ddlAdvPmtCurrency").val(),u=$("#txtAdvPmtAmount").val(),o=$("#ddlAdvPmtReimburseCurrency").val(),s=$("#txtAdvPmtReimburseAmount").val(),h=$("#CurrencyExRate").val(),c=$("#txtNote").val();if(!(n.length<=0)&&!(r.length<=0)&&!(t.length<=0)&&!(i.length<=0)&&!(u.length<=0))return{ExpenseAdvPaymentId:f,EmployeeId:n,Date:t,PaidThrough:i,ReferenceNo:e,Amount:u,Currency:r,Notes:c,ReimburseAmount:s,ReimburseCurrency:o,CurrencyExRate:h}}}function ViewAdvancePayment(n){n&&(window.location.href=baseURL+"Expense/ViewAdvancePayment?id="+n)}function EditAdvancedPayment(n){var t=$.get(baseURL+"Expense/LoadAdvancePayment",{expenseAdvPaymentId:n});t.done(function(n){AdvancedPaymentViews.prototype.AdvancePaymentClearFields();$("#ExpenseAdvPaymentId").val(n.expenseAdvPaymentId);$("#ddlEmployeeList").val(n.employeeId);$("#ddlAdvPmtCurrency").val(n.currency);$("#txtAdvPmtAmount").val(n.amount);$("#ddlAdvPmtReimburseCurrency").val(n.reimburseCurrency);$("#txtAdvPmtReimburseAmount").val(n.reimburseAmount);$("#ddlPaidThrough").val(n.paidThrough);$("#txtRef").val(n.referenceNo);$("#txtNote").val(n.notes);$("#ddladavancePaymentDate").datepicker("setDate",kendo.toString(new Date(n.date),"dd/MMM/yyyy"));$("#CurrencyExRate").val(n.currencyExRate);$("#lblAdvPmtExchangeRate").text("Rate : 1 "+n.currency+" = "+n.currencyExRate+" "+n.reimburseCurrency);$("#RecordAdvancePayment").modal("show")});t.fail(function(){ShowAlertBox("Fail to open advance payment!")})}function EmployeeAdvancePaymentView(){this.Init()}function WorkPermitAlertViews(){this.Init()}function workPermit(n){window.location.href=baseURL+"Employee/BasicInformation?empId="+n}function ProbationCompletionAlertViews(){this.Init()}function ProbationCompletion(n){window.location.href=baseURL+"Employee/EmploymentSalary?empId="+n}function MyAlertsView(){this.Init()}function ViewDetails(n,t){var i=MarkNotificationViewed(n);i&&t!=""&&(window.location.href=baseURL+t)}function MarkAllViewed(){$("#MyAlertsGrid").data("kendoGrid").dataSource.total()>0&&$.ajax({url:baseURL+"Alerts/MarkAllNotificationViewed",type:"POST",async:!1,success:function(){refreshGrid($("#MyAlertsGrid"))},error:function(){ShowAlertBox("Fail to mark notifications as viewed!")}})}function MarkNotificationViewed(n){var t=!1;return $.ajax({url:baseURL+"Alerts/MarkNotificationViewed",data:{id:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t}function CompanySettingsView(){this.Init()}function deletePerDiemRateItem(n){var t=ShowConfirmationAlertBox("Are you sure about deleting selected per diem rate?");t.then(function(){var t=$.post(baseURL+"Settings/DeletePerDiemRate",{perDiemRateId:n});t.done(function(){ShowAlertBox("Per Diem Rate deleted successfully");RemoveItemFromGrid("PerDiemRateGrid",n)});t.fail(function(){ShowAlertBox("Error while deleting per diem rate")})})}function openPerDiemRateModal(n){var t=$.get(baseURL+"Settings/LoadPerDiemRates",{perDiemRateId:n});t.done(function(n){CompanySettingsView.prototype.PerDiemRateClearFields();$("#AddPerDiemRate").modal("show");$("#PerDiemRateId").val(n.perDiemRateId);$("#ddlPerDiemRateCountry option").filter(function(){return $(this).text()==n.country}).prop("selected",!0);$("#txtPerDiemRateCurrency").val(n.currency);$("#txtPerDiemRate").val(n.perDiemRate)});t.fail(function(){ShowAlertBox("Error while opening per diem rate")})}function deletePayrollExchangeRate(n){var t=ShowConfirmationAlertBox("Are you sure about deleting selected exchange rate?");t.then(function(){var t=$.post(baseURL+"Settings/DeletePayrollExchangeRate",{exchangeRateId:n});t.done(function(){ShowAlertBox("Exchange Rate deleted successfully");RemoveItemFromGrid("PayrollExchangeRatesGrid",n)});t.fail(function(){ShowAlertBox("Error while deleting exchange rate")})})}function openPayrollExchangeRateModal(n){var t=$.get(baseURL+"Settings/LoadPayrollExchangeRates",{exchangeRateId:n});t.done(function(n){CompanySettingsView.prototype.PayrollExchangeRatesClearFields();$("#PayrollExchangeRates").modal("show");$("#ExchangeRateId").val(n.exchangeRateId);$("#ddlPayrollExchangeRatesYear").val(n.year);$("#ddlPayrollExchangeRatesMonth").val(n.month);$("#ddlPayrollExchangeRatesFromCurrency").val(n.fromCurrencyCode);$("#ddlPayrollExchangeRatesToCurrency").val(n.toCurrencyCode);$("#txtPayrollExchangeRate").val(n.rate)});t.fail(function(){ShowAlertBox("Error while opening exchange rate")})}function SubsciptionView(){this.Init()}function CommonDisplayFieldsView(){this.Init()}function GetCommonDisplayFieldDetails(n,t,i){i.preventDefault();$("#lblCommonDisplayFieldHeader").text(n);$("#hdnActiveListName").val(n);$("#hdnActiveListId").val(t);refreshGrid($("#CommonDisplayFieldsGrid"))}function CommonPayItemView(){this.Init()}function openCommonPayItemModal(n){var n={commonPayItemId:n},t=$.get(baseURL+"GlobalSettings/LoadCommonPayItemDetails",n);t.done(function(n){CommonPayItemView.prototype.PayItemClearFields();$("#AddCommonPayItem").modal("show");$("#hdnCommonPayItemId").val(n.commonPayItemId);$("#PayItemDesc").val(n.description);n.type==="Standard"?$("#PayItemDesc").prop("disabled",!0):$("#PayItemDesc").prop("disabled",!1);$("#ddlPayItemCategory").val(n.category);$("#ddlTypeOfWage").val(n.typeOfWage);$("#ddlCPFApplicable").val(n.cpfApplicable);$("#ddlIR8ACategory").val(n.iR8ACategory);$("#chkIsUniversalPayItem").prop("checked",n.isUniversalForAllEmployees);n.isVariableAmount?$("#rdnVariable").prop("checked",!0):$("#rdnFixed").prop("checked",!0);$("#ddlVariableAmountBasedOn").val(n.variableAmountBasedOn);n.isVariableAmount?($("#ddlVariableAmountBasedOn").show(),$("#divPercentageForAmt").show(),$("#txtFixedAmount").hide(),$("#rdnProrateNo, #rdnProrateYes").prop("checked",!1).prop("disabled",!0),$("#ddlVariableAmountBasedOn").change()):($("#txtFixedAmount").show(),$("#ddlVariableAmountBasedOn").hide(),$("#divPercentageForAmt").hide(),n.isProrate?$("#rdnProrateYes").prop("checked",!0):$("#rdnProrateNo").prop("checked",!0));$("#txtFixedAmount").val(n.amount);$("#PercentageForAmt").val(n.amountPercentageInCaseOfVariable);n.startDate!=""&&AddOrMinusDayFromDate(new Date(n.startDate),"payItemStartDate",!0,0,"setStartDate");$("#payItemStartDate").datepicker("setDate",kendo.toString(new Date(n.startDate),"dd/MMM/yyyy"));$("#ddlPayItemEndDate").val(n.endsOn);$("#ddlPayItemEndDate").change();n.startDate!=""&&AddOrMinusDayFromDate(new Date(n.startDate),"payItemEndDate",!0,1,"setStartDate");$("#payItemEndDate").datepicker("setDate",kendo.toString(new Date(n.endDate),"dd/MMM/yyyy"));$("#txtRepeatForTimes").val(n.repeatForTimes);$("#ddlPayItemCategory").change()});t.fail(function(){ShowAlertBox("Error while opening pay item details")})}function deleteCommonPayItem(n){var t=ShowConfirmationAlertBox("Are you sure about deleting selected pay item?");t.then(function(){var t=$.post(baseURL+"GlobalSettings/DeleteCommonPayItem",{commonPayItemId:n});t.done(function(){ShowAlertBox("Pay item deleted successfully");RemoveItemFromGrid("CommonPayItemsGrid",n)});t.fail(function(){ShowAlertBox("Error while deleting pay item")})})}function EmailTemplateView(){this.Init()}function ManageCompaniesView(){this.Init()}function customStatusEditor(n){var t=$("<label class='btn btn-default grid-btn-width'><input hidden name='isDeleted' type='radio' data-bind='checked:isDeleted' value=false >Active<\/label><label class='btn btn-default grid-btn-width'><input hidden name='isDeleted' type='radio' data-bind='checked:isDeleted' value=true>Inactive<\/label>");t.appendTo(n)}function GenerateGIROView(){this.Init()}function BanksView(){this.Init()}function openAddNewBankModal(n){var n={bankId:n},t=$.get(baseURL+"Settings/LoadBankDetails",n);t.done(function(n){BanksView.prototype.BankClearFields();$("#hdnBankId").val(n.bankId);$("#txtBankCode").val(n.bankCode);$("#txtBankName").val(n.bankName);$("#txtSwiftBICCode").val(n.swiftBICCode);$("#AddNewBankPopup").modal("show")});t.fail(function(){ShowAlertBox("Fail to add new bank popup!")})}function deleteBankDetails(n){var t=ShowConfirmationAlertBox("Are you sure about deleting selected bank details?");t.then(function(){var t=$.post(baseURL+"Settings/DeleteBankDetails",{bankId:n});t.done(function(){ShowAlertBox("Bank details deleted!");RemoveItemFromGrid("BanksGrid",n)});t.fail(function(){ShowAlertBox("Fail to delete Bank details!")})})}function LeaveReportView(){this.Init()}function UploadPayslipView(){this.Init()}function DownloadPayslipView(){this.Init()}function PayrollReportsView(){this.Init()}function ManageModuleAccess(){this.Init()}function formatAmountWithCurrency(n,t,i){return n==null||n==""?"-":kendo.toString(i)+" "+kendo.toString(n,"n2")}function refreshGrid(n){n.data("kendoGrid").dataSource.read();n.data("kendoGrid").refresh()}function InitializeConfirmationPopup(n,t,i,r){$("#lblPopupHeader").text(n);$("#lblPopupContentLine1").text(t);$("#lblPopupContentLine2").text(i);$("#divForOKButton").empty();$("#divForOKButton").append('<input type="button" id="btnPopupOK" onclick="'+r+'()" value="OK" class="btn btn-primary btn-form" />');$("#ConfirmationPopup").modal()}function CalculateTotalTime(n,t,r){var u=0,f=0,e,o;for(i=0;i<n.length;i++)n[i][t]>0&&n[i][r].length!=0&&n[i][r]!=0&&(e=n[i][r].toString().split(":"),u=u+parseInt(e[0])+parseInt(e[1])/60,f=f+parseInt(e[1]));return o=u.toString().split("."),u=parseInt(o[0]),f=f%60,u.toString().length==1&&(u="0"+u),f.toString().length==1&&(f="0"+f),u+":"+f}function doApplyGridFilter(n,t,i,r){var e=$("#"+n).data("kendoGrid"),o=e.dataSource.filter(),u=o?o.filters:[],f;if(u&&u.length>0)for(f=0;f<u.length;f++)if(t=="gte"||t=="lte"||t=="contains"){if(u[f].field===i&&u[f].operator==t){u.splice(f,1);break}}else if(u[f].field===i){u.splice(f,1);break}r!="0"&&u.push({field:i,operator:t,value:r});e.dataSource.filter({logic:"and",filters:u})}function doApplyKendoGridFilter(n,t,i,r,u){var o=$("#"+n).data("kendoGrid"),s,f,c,e,h;if(u!=undefined&&u==!0?(o.dataSource.filter({}),s=o.dataSource.filter()):s=o.dataSource.filter(),f=s?s.filters:[],f&&f.length>0)for(c=[],e=0;e<f.length;e++)if(f[e].field===i){f.splice(e,1);break}r!="0"&&(typeof r=="object"?$(r).each(function(){f.push({field:i,operator:t,value:this.valueOf()})}):f.push({field:i,operator:t,value:r}));h=typeof u=="undefined"||!u?"and":"or";o.dataSource.filter({logic:h,filters:f})}function DoApplyNestedKGridFilter(n,t,i,r,u,f,e){var c=$("#"+n).data("kendoGrid"),o,h=[],s=[];if(o=c.dataSource.filter(),o!=undefined)for(idx=0;idx<o.filters.length;idx++)if(o.filters[idx].filters!=undefined)for(row=0;row<o.filters[idx].filters.length;row++)e||h.push(o.filters[idx].filters[row]);else o.filters[idx].field!=i&&s.push(o.filters[idx]);r!="0"&&(typeof r=="object"?$(r).each(function(){(e?h:s).push({field:i,operator:t,value:this.valueOf()})}):(e?h:s).push({field:i,operator:t,value:r}));h.length>0&&s.push({logic:f,filters:h});s.length>0?c.dataSource.filter({logic:u,filters:s}):c.dataSource.filter({})}function ValidateImage(n,t,i,r){var c=n.val().split(".").pop().toLowerCase(),o,f,e,s,h,u;if(i.html(""),$.inArray(c,["png","jpg","jpeg"])===-1){t.html("");i.html("Please upload files having extensions:<b> .jpg .jpeg .png<\/b>.");n.val("");f=!1;/*@cc_on/^10/.test(@_jscript_version)&&(f=!0)@*/;return f&&n.replaceWith(n.val("").clone(!0)),!1}if(n[0].files.length>0){for(o=0,u=0;u<n[0].files.length;u++)e=n[0].files[u],o+=e.size;if(o>parseInt($("#hdnFileSize").val())){t.html("");i.html("");f=!1;/*@/^10/.test(@_jscript_version)&&(f=!0)@*/;return f&&n.replaceWith(n.val("").clone(!0)),n.val(""),i.html("Please upload file having file size less than "+$("#hdnFileSize").val()+"MB."),!1}}if(n[0].files.length>0){for(s=new Image,h=window.URL||window.webkitURL,u=0;u<n[0].files.length;u++)e=n[0].files[u];s.onload=function(){var u=$("#hdnMaxWidth").val(),f=$("#hdnMaxHeight").val(),e=this.width,o=this.height;if(e>u&&o>f)return t.html(""),i.html("Image size must be less than or equal to "+u+"X"+f+" pixels"),n.val(""),!1;r!=undefined&&r!=""&&r=="EmployeePhoto"&&ShowUploadedImage("divUploadEmployeePhoto","fileEmployeePhoto","imgEmpPhoto",!1)};s.src=h.createObjectURL(e)}return i.html(""),!0}function ValidateDocument(n,t,i){var o=n.val().split(".").pop().toLowerCase(),f,u,e,r;if(i.html(""),$.inArray(o,["pdf","doc","docx","xls","xlsx","png","jpg","jpeg","gif"])===-1)return t.html(""),i.html("Valid extensions:<b> .png .jpg .jpeg .gif .pdf, .doc, .docx, .xls, .xlsx<\/b>."),n.val(""),r=!1,r&&n.replaceWith(n.val("").clone(!0)),!1;if(n[0].files.length>0){for(f=0,u=0;u<n[0].files.length;u++)e=n[0].files[u],f+=e.size;if(f>parseInt($("#hdnFileSize").val())){t.html("");i.html("");r=!1;/*@/^10/.test(@_jscript_version)&&(r=!0)@*/;return r&&n.replaceWith(n.val("").clone(!0)),n.val(""),i.html("Please upload file having file size less than "+$("#hdnFileSize").val()+"MB."),!1}}return i.html(""),!0}function ValidateExcel(n,t){var u,r,i,f;if(this.fileControl=n,u=[".xls,.xlsx"],!/(\.xls)$/i.test(this.fileControl.val().toLowerCase())&&!/(\.xlsx)$/i.test(this.fileControl.val().toLowerCase()))return t.html("Please upload files having extensions: <b>"+u.join(", ")+"<\/b> only."),t.show(),this.fileControl.empty(),this.fileControl.val(""),!1;if(this.fileControl[0].files.length>0){for(r=0,i=0;i<this.fileControl[0].files.length;i++)f=this.fileControl[0].files[i],r+=f.size;if(r>parseInt($("#hdnfilesize").val()))return t.html(""),t.html("Please upload file having file size less than "+$("#hdnFileSize").val()+"MB."),this.fileControl.empty(),this.fileControl.val(""),!1}return t.html(""),!0}function showSuccessNotification(n){$("#notificationMessage").text(n);$("#notificationIcon").removeClass();$("#notificationIcon").addClass("glyphicon glyphicon-ok");var t=$("#snackbar");t.addClass("show");t.attr("style","background-color:#DFF2BF; color:#4F8A10;");setTimeout(function(){t.removeClass("show")},4e3)}function showErrorNotification(n){$("#notificationMessage").text(n);$("#notificationIcon").removeClass();$("#notificationIcon").addClass("glyphicon glyphicon-hand-right");var t=$("#snackbar");t.addClass("show");t.attr("style","background-color:#FFD2D2; color:#D8000C;");setTimeout(function(){t.removeClass("show")},8e3)}function showWarningNotification(n){$("#notificationMessage").text(n);$("#notificationIcon").removeClass();$("#notificationIcon").addClass("glyphicon glyphicon-record");var t=$("#snackbar");t.addClass("show");t.attr("style","background-color:#FEEFB3; color:#9F6000;");setTimeout(function(){t.removeClass("show")},4e3)}function ShowSummaryBox(n,t){var r="<ul>",i;for(idx in t)r+="<li class='form-label padding-top2'>"+t[idx]+"<\/li>";r+="<\/ul>";$("<div id='divSummaryBox' style='padding-left: 1px !important;padding-top: 10px !important; max-height: 200px !important;'><\/div>").kendoAlert({title:n,content:r,width:"600px"}).data("kendoAlert").open();i=$("div[aria-describedby='divSummaryBox']");i.find("button[type=button].k-button").addClass("btn btn-primary btn-form alertMsgBtn").removeClass("k-button").parent(".k-dialog-buttongroup").css("padding-bottom","5px");i.find("span.k-window-title").removeClass().addClass("modal-title page-main-header");i.find("div.k-window-titlebar.k-header").removeClass().addClass("modal-header")}function ShowAlertBox(n,t){$("<div id='DivConfirmation'><\/div>").kendoAlert({title:!1,content:n,width:t!=undefined?t:"300px"}).data("kendoAlert").open();$("div[aria-describedby='DivConfirmation']").find("button[type=button].k-button").addClass("btn btn-primary btn-form alertMsgBtn").removeClass("k-button").parent(".k-dialog-buttongroup").css("padding-bottom","5px")}function ShowMessageBox(n,t,i){$("<div id='DivMyMessage'><\/div>").kendoAlert({title:n,content:t,width:i!=undefined?i:"300px"}).data("kendoAlert").open();$("div[aria-describedby='DivMyMessage']").find("button[type=button].k-button").addClass("btn btn-primary btn-form alertMsgBtn").removeClass("k-button").parent(".k-dialog-buttongroup").css("padding-bottom","5px")}function ShowConfirmationAlertBox(n){var i=$("<div id='DivConfirmationOkCancel'><\/div>").kendoConfirm({title:!1,content:n}).data("kendoConfirm").open().result,t=$("div[aria-describedby='DivConfirmationOkCancel']").find("button[type=button].k-button");return t.addClass("btn btn-primary btn-form alertMsgBtn").removeClass("k-button k-primary").parent(".k-dialog-buttongroup").css("padding-bottom","5px"),$(t.eq(0)).attr("style","width:50%; margin-right: 0 !important").attr("ok-btn","Y"),$(t.eq(1)).attr("style","width:50%; margin-left: 4px !important"),i}function ShowKendoDialogConfirmation(n,t,i,r,u){var f="",o,e;if(i.length>0){f="<ul>";for(idx in i)f+="<li class='form-label padding-top2'>"+i[idx]+"<\/li>";f+="<\/ul>"}o=$("#"+n).kendoDialog({width:"450px",title:!1,closable:!1,modal:!0,content:f!=""?t+"<br /><div class=''>"+f+"<\/div>":t,actions:[{text:"YES"},{text:"NO"},{text:"CANCEL"}]});e=$("div#"+n).closest("div.k-widget.k-window.k-dialog");e.find("div.k-window-titlebar.k-dialog-titlebar").addClass("KDialogTitle");e.find("button[type='button'].k-button").addClass("btn btn-primary btn-form kDialogMsgBtn").removeClass("k-button k-primary").parent(".k-dialog-buttongroup").css("padding-bottom","5px");$('button[type="button"].kDialogMsgBtn').each(function(){this.innerHTML=="YES"&&(r!=""&&this.setAttribute("title",r),this.setAttribute("id","confirmYesBtn"));this.innerHTML=="NO"&&(u!=""&&this.setAttribute("title",u),this.setAttribute("id","confirmNoBtn"))});o.data("kendoDialog").open()}function setFooterPaddingTop(){var n=$("footer div").outerHeight();$("footer").css("padding-top",n-10)}function SetHeaderChkBoxCheckUnCheck(n){var t=$("#"+n+" tbody input:checkbox").length,i=$("#"+n+" tbody input[type='checkbox']:checked").length;t==i&&t>0?$("#"+n+" input[type=checkbox].checkAll").prop("checked",!0):$("#"+n+" input[type=checkbox].checkAll").prop("checked",!1)}function HandleUpdateEvent(n,t,i){var r=$.post(t,i);r.done(function(){return!0});r.fail(function(){return!1})}function AddOrMinusDayFromDate(n,t,i,r,u){i?n.setDate(n.getDate()+r):n.setDate(n.getDate()-r);$("#"+t).datepicker(u,n)}function ShowHideDropDownOption(n,t,i){var r=$("#"+n+" option[value='"+t+"']"),u=r.parent().is("span");i?u||r.wrap("<span>").hide():i||u&&r.unwrap("<span>").show()}function GetFormatedDate(n){return[{Jan:01,Feb:02,Mar:03,Apr:04,May:05,Jun:06,Jul:07,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12}][0][n.split("/")[1]]+"/"+n.split("/")[0]+"/"+n.split("/")[2]}function ShowUploadedImage(n,t,i,r){var e=$.trim($("#"+t).val()),f;if(e!=""){var u=i!=undefined?i:"upload_receipt",o="",s=/^([a-zA-Z0-9\s_\\.()\-:])+(.pdf|.doc|.docx|.xls|.xlsx|.txt)$/;o=r==!0?/^([a-zA-Z0-9\s_\\.()\-:])+(.jpg|.jpeg|.gif|.png|.bmp|.pdf|.doc|.docx|.xls|.xlsx|.txt)$/:/^([a-zA-Z0-9\s_\\.()\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;o.test($("#"+t).val().toLowerCase())?typeof FileReader!="undefined"?($("#"+n).show(),u=="upload_receipt"&&($("#"+n).find("img#upload_receipt").remove(),$("#"+n).append("<img id='"+u+"' alt='Receipt'class='img-thumbnail img-Receipt' />")),f=new FileReader,f.onload=function(t){s.test(e)?$("#"+n+" img#"+u).attr("src",baseURL+"images/no-preview.png"):$("#"+n+" img#"+u).attr("src",t.target.result)},f.readAsDataURL($("#"+t)[0].files[0])):ShowAlertBox("This browser does not support FileReader."):r?ShowAlertBox("Please upload a valid file."):ShowAlertBox("Please upload a valid image file.")}}function InsertRowItem(n){var o=0,i="d26a9207-d794-44bc-8568-147174cc3d89",s=$("#"+n).data("kendoGrid"),r,t,f;if(s)for(r=s.dataSource,o=r.data().length,i=RandomGridUID(r.data()[o-1].uid),indx=0;indx<r.data().length;indx++)i==r.data()[indx].uid&&(i=RandomGridUID(r.data()[indx].uid));var e=$("#"+n+" tbody tr"),h=e.eq(0),u="";if(u=$(e[e.length-1]).hasClass("k-alt")?'<tr data-uid="'+i+'" role="row">':'<tr class="k-alt" data-uid="'+i+'" role="row">',u+=h.html(),u+="<\/tr>",u=u.replace("attached_green.png","attached.png"),$("#"+n+" tbody").append(u),t=$("#"+n+" tbody tr[data-uid='"+i+"']"),t.find('input[type="checkbox"]').length>0&&(f=Math.floor(1e3+Math.random()*9e3),t.find('input[type="checkbox"][chk-bx="reim"]').attr("id",f),t.find('input[type="checkbox"][chk-bx="reim"]').parent("td").find("label.checkbox-inline").attr("for",f),f=Math.floor(1e3+Math.random()*9e3),t.find('input[type="checkbox"][chk-bx="invoice"]').attr("id",f),t.find('input[type="checkbox"][chk-bx="invoice"]').parent("td").find("label.checkbox-inline").attr("for",f)),t.find("div.date.custom-grid-date").length>0)t.find("#DivPayslipDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});if(t.find("div.date.custom-grid-date").length>0)t.find("#DivPayslipToDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$(t).find('input[type="file"]#fUploadReceipt').change(function(){ValidateAttachmentFile(this)});$(t).find('input[type="text"]#blkAmt').on("keyup blur",function(n){if($(this).val($(this).val().replace(/[^0-9\.]/g,"")),!AllowOneDotInNumber(this))return!1;(n.which!=46||$(this).val().indexOf(".")!=-1)&&(n.which<48||n.which>57)&&n.preventDefault()});$(t).find('select[ddl-country="country"]').change(function(){AddBulkExpenseGetCurrencyByCountry(this)});t.find("#DivPayslipDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var n=t.find("#DivPayslipDt").datepicker("getDate");n==null||(t.find("#DivPayslipToDt").datepicker("setStartDate",new Date(n.valueOf())),t.find("#DivPayslipToDt").datepicker("setDate",null))})}function RandomGridUID(n){return n.substring(0,n.length-5)+Math.floor(1e4+Math.random()*9e3)}function DivYesNoSelection(n,t){var i=$("#"+n).hasClass("div-Select"),r=$("#"+t).hasClass("div-Select");r&&$("#"+t).removeClass("div-Select");i?$("#"+n).removeClass("div-Select"):$("#"+n).addClass("div-Select")}function RemoveItemFromGrid(n,t){var i=$("#"+n).data("kendoGrid"),u=i.dataSource.get(t),r;i.dataSource.remove(u);i.dataSource.view().length==0&&(r=i.dataSource.page(),r>1&&i.dataSource.page(r-1))}function ValidateAndScrollToEmptyField(){$('form[data-toggle="validator"]').not('[id="frmAddExpenseModel"],[id="frmRecordAdvancePayment"]').on("submit",function(n){var t=$(n.currentTarget).find(".has-error").length;if($(n.currentTarget).attr("err-cnt")==undefined)$(n.currentTarget).attr("err-cnt",t);else if(t==$(n.currentTarget).attr("err-cnt"))return $(n.currentTarget).removeAttr("err-cnt"),!1;window.setTimeout(function(){var n=$(".has-error");n.length&&$("html, body").animate({scrollTop:n.offset().top-50},400)},0)})}function ShowHideDdlOptionByAnotherDdl(n,t){var i=$("#"+n+" option:selected"),r=$("#"+n+" option:not(:selected)");i.length>0&&i.each(function(){ShowHideDropDownOption(t,this.value,!1)});r.length>0&&r.each(function(){ShowHideDropDownOption(t,this.value,!0)})}function SetHeaderTitle(n){for(var e,i=n.trim().split(" "),r="",u="",f=!1,t=0;t<i.length;t++)e="",f=r==""?!0:!1,i[t].length<=6&&t!=i.length-1&&i[t+1].length<5?(f?e=i[t]+" "+i[t+1]:u=u+i[t]+" "+i[t+1]+" ",t=t+1):f?e=i[t]:u=u+i[t]+" ",f?r=r+'<span class="cut-txt">'+e+"<\/span>":t!=i.length-1||f||(r=r+'<span class="cut-txt">'+u+"<\/span>",u="");return r}function ReturnTxt(){}function CompareDate(n){var t=kendo.toString(kendo.parseDate(new Date),"dd/MM/yyyy").split("/"),i=n.split("/");return i[2]<t[2]||i[2]==t[2]&&i[1]<t[1]?!0:!1}function addMonths(n,t){return n.setMonth(n.getMonth()+t),n}function KGridColumnMenuCustomize(n,t,i){var u=n,r;u.element.find(">li:not(.k-item.k-columns-item)").remove();r=u.element.find("li.k-item.k-columns-item.k-state-default.k-last").find("ul.k-menu-group").find('li[role="menuitemcheckbox"]');r.each(function(){var n=$(this).find("span.k-link").text();n==t?$(this).hide():i!=undefined?i[0][n]!=undefined?$(this).attr("aria-checked")=="false"&&$(this).find("span").css("webkit-text-fill-color","red"):$(this).hide():$(this).attr("aria-checked")=="false"&&$(this).hide()});r.click(function(){$(this).attr("aria-checked")=="true"?$(this).find("span").css("webkit-text-fill-color","red"):$(this).find("span").css("webkit-text-fill-color","")});$(".k-item.k-columns-item").find("ul.k-group.k-menu-group").mouseleave(function(){GridIdForColReSize!=""&&GridIdForColReSize!=undefined&&($("#"+GridIdForColReSize).find('.k-grid-header table[role="grid"]').css("width",""),$("#"+GridIdForColReSize).find('.k-grid-content table[role="grid"]').css("width",""),$("#"+GridIdForColReSize).find(".k-grid-footer-wrap table").css("width",""))})}function ReturnAlphabet(n){return["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","Q","R","S","T","U","V","W","X","Y","Z"][n]}function SetKGridExportExcelHeader(n,t,i,r,u,f,e){var v,c,o,l,s,p;if(n.frozenRows=2,n.mergedCells=["A1:"+ReturnAlphabet(n.rows[0].cells.length-1)+"1"],v=[{value:t,fontSize:12,textAlign:"center",background:"#d3d3d3",bold:!0}],n.rows.splice(0,0,{cells:v,type:"header",height:40}),i||r||e!=undefined){var y=n.rows,h=0,a=[];for(e!=undefined&&(a=GetGridColumnByFormat(e,"{0:n2}")),c=0;c<y.length;c++)if(o=y[c],(o.type=="group-footer"||o.type=="footer")&&i)for(l=0;l<o.cells.length;l++)s=o.cells[l],s.value&&(s.value=$(s.value).text()!=""?$(s.value).text():s.value,s.hAlign="right");else o.type=="data"?(r&&(h+=1,o.cells[u].value=h),a.length&&$(a).each(function(){o.cells[0].value==undefined?o.cells[this+1].format="#,##0.00":o.cells[this].format="#,##0.00"})):o.type=="group-header"&&r&&h!=0&&(h=0)}p=n.columns;p.forEach(function(n,t){(f==1&&n.width>90||f==2&&n.width>=90||f==3&&t!=0||f==4&&n.width>95||f==5||f==6&&n.width==110)&&(delete n.width,n.autoWidth=!0)})}function KGridPagableObj(n){var t=n==!1?"":"items per page";return{numeric:!0,pageSizes:[5,10,15,20,25,50,90,"All"],buttonCount:3,messages:{itemsPerPage:t}}}function KGrdPageSizeDdlPosition(n,t,i){$("#"+n+" .k-pager-sizes span.k-dropdown-wrap").on("click",function(){setTimeout(function(){$(".k-list-scroller").css("height","210px");var i=t==undefined?$(".k-list-scroller").outerHeight():$(".k-list-scroller:eq("+t+")").outerHeight();$("div.k-animation-container").css("top",$("#"+n+" .k-pager-sizes").offset().top-i+3)},0)});i==!0&&$('a[title="Customize Columns"]').click(function(){var n=$(this).offset().top+$(this).outerHeight()+3+"px";$('span:contains("Customize Columns")').closest("div.k-animation-container").css("top",n)})}function PreventClmReorder(n,t,i){if(n.column.reorderable==!1||n.newIndex==i&&n.oldIndex>i){var r=$("#"+t).data("kendoGrid");setTimeout(function(){r.reorderColumn(n.oldIndex,r.columns[n.newIndex])},0)}}function GetTreeViewCheckedNodes(n){var i=$("#"+n).data("kendoTreeView").dataSource.view(),t=[];return $(i).each(function(){if(this.hasChildren){var n=this.children.view();$(n).each(function(){this.checked&&this.enabled&&t.push(this.name)})}}),t.toString()}function GetTreeViewCheckedNodeIds(n){var i=$("#"+n).data("kendoTreeView").dataSource.view(),t=[];return $(i).each(function(){if(this.hasChildren){var n=this.children.view();$(n).each(function(){this.checked&&this.enabled&&t.push(this.id)})}}),t.toString()}function GetEmployeesWithInvalidField(n,t){var i=null;return $.ajax({url:baseURL+"Employee/GetEmployeesWithInvalidField",data:{employeeIds:n,field:t},type:"GET",async:!1,success:function(n){i=n},error:function(){ShowAlertBox("Error while validating field");i=null}}),i}function LoadBulkAddExpenseGrid(){function i(){r();$("#AddBulkExpenseGrid #DivPayslipDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$("#AddBulkExpenseGrid #DivPayslipToDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$("#AddBulkExpenseGrid tbody tr").find('input[type="file"]#fUploadReceipt').change(function(){ValidateAttachmentFile(this)});$("#AddBulkExpenseGrid tbody tr").find('input[type="text"]#blkAmt').on("keyup blur",function(n){if($(this).val($(this).val().replace(/[^0-9\.]/g,"")),!AllowOneDotInNumber(this))return!1;(n.which!=46||$(this).val().indexOf(".")!=-1)&&(n.which<48||n.which>57)&&n.preventDefault()});$("#AddBulkExpenseGrid tbody tr").find('select[ddl-country="country"]').change(function(){AddBulkExpenseGetCurrencyByCountry(this)});$("#AddBulkExpenseGrid tbody tr #DivPayslipDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var i=$("#AddBulkExpenseGrid tbody tr"),n=i.eq(0),t=n.find("#DivPayslipDt").datepicker("getDate");t==null||(n.find("#DivPayslipToDt").datepicker("setStartDate",new Date(t.valueOf())),n.find("#DivPayslipToDt").datepicker("setDate",null))})}function r(){if(n==undefined){var t=$.post(baseURL+"Expense/GetListItems");t.done(function(t){n=t;$("#AddBulkExpenseGrid [ddl-category='category']").append($("<option><\/option>").val("").html(""));$("#AddBulkExpenseGrid [ddl-currency='currency']").append($("<option><\/option>").val("").html(""));$("#AddBulkExpenseGrid [ddl-country='country']").append($("<option><\/option>").val("").html(""));$.each(n.Category.value,function(){this.text.toLowerCase()!="per diem"&&this.text.toLowerCase()!="fuel/mileage expenses"&&$("#AddBulkExpenseGrid [ddl-category='category']").append($("<option><\/option>").val(this.text).html(this.text))});$.each(n.Currencies.value,function(){$("#AddBulkExpenseGrid [ddl-currency='currency']").append($("<option><\/option>").val(this.text).html(this.text))});$.each(n.Countries.value,function(){$("#AddBulkExpenseGrid [ddl-country='country']").append($("<option><\/option>").val(this.text).html(this.text))})});t.fail(function(){return!1})}}var n,t=new kendo.data.DataSource({data:[{srNo:1}],batch:!0,pageSize:30,scrollable:!0});$("#AddBulkExpenseGrid").kendoGrid({dataSource:t,dataBound:function(n){i(n)},columns:[{field:"srNo",hidden:!0},{field:"",title:"From Date*",width:"90px",template:function(){return'<div style="display:flex;"><div id="DivPayslipDt" class="input-group input-append date custom-grid-date"><input type="text" id="PaySlipDate" style="font-size:11px !important;" class="form-control"/><span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"><\/span><\/span><\/div>'}},{field:"",title:"To Date*",width:"90px",template:function(){return'<div style="display:flex;"><div id="DivPayslipToDt" class="input-group input-append date custom-grid-date"><input type="text" id="PaySlipToDate" style="font-size:11px !important;" class="form-control"/><span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"><\/span><\/span><\/div>'}},{field:"",title:"Country*",width:"60px",template:function(){var n=Math.floor(1e3+Math.random()*9e3);return'<select ddl-country="country" class="form-control ddl_kendogrd"><\/select>'}},{field:"",title:"Merchant*",width:"100px",template:function(){return'<input width="89" txt-merchant="merchant" class="form-control txtbx_kendogrd"><\/input>'}},{field:"",title:"Category*",width:"100px",template:function(){return'<select ddl-category="category" class="form-control ddl_kendogrd"><\/select>'}},{field:"",title:"Reimbursable",width:"55px",headerTemplate:"Reimbursable",headerAttributes:{style:"padding: 1.0em 0.1em 0.4em 0.1em !important;"},attributes:{style:"text-align:center;"},template:function(){var n=Math.floor(1e3+Math.random()*9e3);return'<input type="checkbox" chk-bx="reim" id="'+n+'" class="chk-box" checked="true"><label class="checkbox-inline" for="'+n+'"><\/label>'}},{field:"",title:"Currency*",width:"60px",template:function(){return'<select ddl-currency="currency" class="form-control ddl_kendogrd"><\/select>'}},{field:"",title:"Amount*",width:"60px",template:function(){return'<input type="text" id="blkAmt" name="blkAmt" min="0" maxlength="15" onBlur="CheckValue(this);" width="89px" txt-amt="amt" class="form-control allownumericwithdecimal txtbx_kendogrd"><\/input>'}},{field:"",width:"45px",headerTemplate:'<span style="display:block !important">Invoice<\/span><span style="display:block !important">Not<\/span> <span style="display:block !important">Available<\/span>',headerAttributes:{style:"padding: 0.1em 0.5em 0.2em 0.1em !important;"},attributes:{style:"text-align:center;"},template:function(){var n=Math.floor(1e3+Math.random()*9e3);return'<input type="checkbox" chk-bx="invoice" id="'+n+'" class="chk-box"><label class="checkbox-inline" for="'+n+'"><\/label>'}},{field:"",width:"65px",headerTemplate:'<span style="display:block !important">Invoice<\/span> <span style="display:block !important">No.<\/span>',headerAttributes:{style:"padding: 0.1em 0.5em 0.2em 0.1em !important;"},template:function(){return'<input width="89" txt-Ref="ref" id="blkRefNumber" name="blkRefNumber"  onBlur="ValidateBulkReferenceNumber(this);"  class="form-control txtbx_kendogrd"><\/input>'}},{field:"",title:"Receipt",width:"45px",headerTemplate:"Receipt",template:function(){return"<div id='divUploadReceipt' class='pointer' title='Upload Receipt' ><img src='"+baseURL+"images/attached.png' class='img-responsive' onclick='DownloadReceipt(this);' /><input class='uploadReceipt' type='file' name='fUploadReceipt' id='fUploadReceipt'><\/div>"}},{field:"",title:"Description",width:"80px",template:function(){return'<input width="69px" txt-description="desc" class="form-control txtbx_kendogrd"><\/input>'}},{field:"",title:"",width:"30px",template:"<div class='pointer' title='Delete Row' onclick='DeleteRow(this);'><img src='"+baseURL+"images/close.png' class='img-responsive' /><\/div>"}]})}function LoadBulkAddPerdiemExpenseGrid(){function i(){r();$("#AddPerdiemExpenseGrid #DivBlkPerDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$("#AddPerdiemExpenseGrid #DivBlkPerToDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$("#AddPerdiemExpenseGrid tbody tr").find('input[type="text"]#blkReimAmt').on("keyup blur",function(n){if($(this).val($(this).val().replace(/[^0-9\.]/g,"")),!AllowOneDotInNumber(this))return!1;(n.which!=46||$(this).val().indexOf(".")!=-1)&&(n.which<48||n.which>57)&&n.preventDefault()});$("#AddPerdiemExpenseGrid tbody tr").find('select[ddl-country="country"]').change(function(){AddBulkPerdiemExpenseGetReimburseCurrency(this);LoadPerdiemRatesByCountrySpecificBulk(this);GetBulkPerDiemRateByCountryInsertRow(this)});$("#AddPerdiemExpenseGrid tbody tr #DivBlkPerDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var i=$("#AddPerdiemExpenseGrid tbody tr"),n=i.eq(0),t=n.find("#DivBlkPerDt").datepicker("getDate");t==null||(n.find("#DivBlkPerToDt").datepicker("setStartDate",new Date(t.valueOf())),n.find("#DivBlkPerToDt").datepicker("setDate",null))});$("#AddPerdiemExpenseGrid tbody tr #DivBlkPerToDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var r=$("#AddPerdiemExpenseGrid tbody tr"),n=r.eq(0),t=n.find("#DivBlkPerDt").datepicker("getDate"),i;if(t!=null){if(t=n.find("#DivBlkPerDt").datepicker("getDate"),i=n.find("#DivBlkPerToDt").datepicker("getDate"),i.valueOf()==t.valueOf()){$("#DivBlkPerToDt").datepicker("setDate","");ShowMessageBox("Warning!!!","Per-Diem claims are not permitted when From Date is same as To Date","300px");$("#noOfNight").val("");return}CalculateNoOfDaysBulkPerDiem(this);GetBulkPerDiemAmount(this)}});$("#AddPerdiemExpenseGrid tbody tr").find('select[ddl-perdiemrates="perdiemrates"]').change(function(){GetBulkPerDiemAmount(this)})}function r(){if(n==undefined){var i=$("#ExpenseReportId").val(),t=$.post(baseURL+"Expense/GetListItemsBulkPerDiem",{expeRptId:i});t.done(function(t){n=t;$("#AddPerdiemExpenseGrid [ddl-currency='blkPerCurrency']").append($("<option><\/option>").val("").html(""));$("#AddPerdiemExpenseGrid [ddl-country='country']").append($("<option><\/option>").val("").html(""));$("#AddPerdiemExpenseGrid [ddl-reimCurrency='reimCurrency']").append($("<option><\/option>").val("").html(""));$("#AddPerdiemExpenseGrid [ddl-perdiemrates='perdiemrates']").append($("<option><\/option>").val("").html(""));$.each(n.Currencies.value,function(){$("#AddPerdiemExpenseGrid [ddl-currency='blkPerCurrency']").append($("<option><\/option>").val(this.text).html(this.text))});$.each(n.Countries.value,function(){$("#AddPerdiemExpenseGrid [ddl-country='country']").append($("<option><\/option>").val(this.text).html(this.text))});$.each(n.Currencies.value,function(){$("#AddPerdiemExpenseGrid [ddl-reimCurrency='reimCurrency']").append($("<option><\/option>").val(this.text).html(this.text))})});t.fail(function(){return!1})}}var n,t=new kendo.data.DataSource({data:[{srNo:1}],batch:!0,pageSize:30,scrollable:!0});$("#AddPerdiemExpenseGrid").kendoGrid({dataSource:t,dataBound:function(n){i(n)},columns:[{field:"srNo",hidden:!0},{field:"",title:"From Date*",width:"90px",template:function(){return'<div style="display:flex;"><div id="DivBlkPerDt" class="input-group input-append date custom-grid-date"><input type="text" id="blkPerDate" style="font-size:11px !important;" class="form-control"/><span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"><\/span><\/span><\/div>'}},{field:"",title:"To Date*",width:"90px",template:function(){return'<div style="display:flex;"><div id="DivBlkPerToDt" class="input-group input-append date custom-grid-date"><input type="text" id="blkPerToDate" style="font-size:11px !important;" class="form-control"/><span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"><\/span><\/span><\/div>'}},{field:"",title:"Country*",width:"60px",template:function(){var n=Math.floor(1e3+Math.random()*9e3);return'<select ddl-country="country" class="form-control ddl_kendogrd"><\/select>'}},{field:"",title:"Per Diem Rate*",width:"100px",template:function(){var n=Math.floor(1e3+Math.random()*9e3);return'<select ddl-perdiemrates="perdiemrates" class="form-control ddl_kendogrd"><\/select>'}},{field:"",title:"No. Of Nights(s)*",width:"70px",template:function(){return'<input width="70" txt-noOfNight="noOfNight" id="noOfNight" name="noOfNight" onBlur="ChangeNoOfNights(this);" class="form-control txtbx_kendogrd"><\/input>'}},{field:"",title:"Currency*",width:"60px",template:function(){return'<select ddl-currency="blkPerCurrency" class="form-control ddl_kendogrd" disabled ><\/select>'}},{field:"",title:"Amount*",width:"60px",template:function(){return'<input type="text" id="blkPerAmt" name="blkPerAmt" min="0" maxlength="15"  width="89px" txt-blkPerAmt="blkPerAmt" class="form-control allownumericwithdecimal txtbx_kendogrd" disabled><\/input>'}},{field:"",title:"Reimbursable",width:"55px",headerTemplate:"Reimbursable",headerAttributes:{style:"padding: 1.0em 0.1em 0.4em 0.1em !important;"},attributes:{style:"text-align:center;"},template:function(){var n=Math.floor(1e3+Math.random()*9e3);return'<input type="checkbox" chk-bx="reim" id="'+n+'" class="chk-box" checked="true"><label class="checkbox-inline" for="'+n+'"><\/label>'}},{field:"",title:"Currency*",width:"60px",hidden:!0,template:function(){return'<select ddl-reimCurrency="reimCurrency" class="form-control ddl_kendogrd" disabled><\/select>'}},{field:"",title:"Amount*",width:"60px",hidden:!0,template:function(){return'<input type="text" id="blkReimAmt" name="blkReimAmt" min="0" maxlength="15" onBlur="CheckValue(this);" width="89px" txt-blkReimAmt="blkReimAmt" class="form-control allownumericwithdecimal txtbx_kendogrd"><\/input>'}},{field:"",title:"Description",width:"80px",template:function(){return'<input width="69px" txt-description="desc" class="form-control txtbx_kendogrd"><\/input>'}},{field:"",title:"",width:"30px",template:"<div class='pointer' title='Delete Row' onclick='DeleteBulkPerDiemRow(this);'><img src='"+baseURL+"images/close.png' class='img-responsive' /><\/div>"}]})}function AddNewListItem(){var n=$("#txtListItemName").val(),t;if(!(n.length<=0)){if(CheckTypeExists(n)){ShowAlertBox("List item already exists.");return}t=$.post(baseURL+"Settings/AddListItemName",{listName:$("#hdnListName").val(),listItemName:n});t.done(function(t){t?($("#AddListItem").modal("hide"),$("#txtListItemName").val(""),AddDdlOption(n),ShowAlertBox("List item added successfully.")):ShowAlertBox("Error while adding list item.")});t.fail(function(){ShowAlertBox("Error while adding list item.")})}}function SubmitBulkExpenses(n,t){var u=0,f=0,i=[],r=!1,e=$("#ddlBulkExpenseType").val(),o;if(e==""||e==undefined)return ShowMessageBox("Warning:","Please select Type to save data"),!1;if(e=="Expense"){if(($("#AddBulkExpenseGrid tbody tr").each(function(){return i=ValidateBulkAddExpenseRow(this),i.length>0?!1:void 0}),i.length>0)||i.length>0)return ShowSummaryBox("Bulk Add Expense Required Fields",i),!1;if($("#AddBulkExpenseGrid tbody tr").each(function(){var t;r=!1;var u=$(this).find('input[txt-merchant="merchant"]').val(),f=$(this).find('select[ddl-category="category"] option:selected').val(),n=$(this).find('input[txt-Ref="ref"]').val();if(n.length>0&&(t=ValidateReferenceNumber("Expense",f,n,u,0),t))return $(this).find('input[txt-Ref="ref"]').val(""),i.push("You have entered existing invoice number(s)"),ShowSummaryBox("Invoice number already exists!",i),r=!0,!1}),o=!1,$("#AddBulkExpenseGrid tbody tr").each(function(){r=!1;var i=$(this).find('input[txt-merchant="merchant"]').val(),u=$(this).find('select[ddl-category="category"] option:selected').val(),n=$(this).find('input[txt-Ref="ref"]').val(),t=0;n.length>0&&$("#AddBulkExpenseGrid tbody tr").each(function(){r=!1;var e=$(this).find('input[txt-merchant="merchant"]').val(),s=$(this).find('select[ddl-category="category"] option:selected').val(),f=$(this).find('input[txt-Ref="ref"]').val();if(f.length>0&&(i==e&&u==s&&n==f&&t++,t>=2)){o=!0;return}})}),o)return ShowAlertBox("You have entered existing invoice number(s). Please avoid duplicate invoice number(s)"),!1;if(r)return!1;if($("#AddBulkExpenseGrid tbody tr").each(function(){var o=!1,n=new FormData,s=$(this).find("input#PaySlipDate").val(),h=$(this).find('input[txt-merchant="merchant"]').val(),c=$(this).find('select[ddl-category="category"] option:selected').val(),r=$(this).find('select[ddl-currency="currency"] option:selected').val(),e=$(this).find('input[txt-amt="amt"]').val(),v=$(this).find('input[txt-description="desc"]').val(),y=$(this).find('input[type="checkbox"][chk-bx="reim"]').prop("checked"),l=$("#hdnReimburseCurrency").val(),a=GetCurrencyExchangeRate(r,l,1),p=(a*e).toFixed(2),w=$(this).find('input[type="checkbox"][chk-bx="invoice"]').prop("checked"),b=$(this).find('input[txt-Ref="ref"]').val(),k=$(this).find("input#PaySlipToDate").val(),d=$(this).find('select[ddl-country="country"] option:selected').val(),i;s.length<=0||h.length<=0||c.length<=0||r.length<=0||e.length<=0||(i=$(this).find('input[type="file"]#fUploadReceipt')[0].files[0],i&&n.append(i.name,i),n.append("parameterDateIncurred",s),n.append("parameterMerchant",h),n.append("parameterCategory",c),n.append("parameterCurrency",r),n.append("parameterAmount",e),n.append("parameterDescription",v),n.append("parameterIsInvoiceNotAvail",w),n.append("parameterRefNo",b),n.append("parameterIsClaimRem",y),n.append("parameterReimburseCurrency",l),n.append("parameterReimburseAmount",p),n.append("parameterCurrencyExRate",a),n.append("parameterToDateIncurred",k),n.append("parameterCountry",d),t!=""&&t!=undefined&&n.append("parameterReportReferenceId",t),u++,o=SaveBulkExpense(n),o&&f++)}),u===f)if(n)window.location.href=baseURL+"Expense/Expense";else return $("#BulkAddExpenseModal").modal("hide"),!0;else ShowAlertBox("Error while adding expense")}else{if($("#AddPerdiemExpenseGrid tbody tr").each(function(){return i=ValidateBulkAddPerdiemRow(this),i.length>0?!1:void 0}),i.length>0)return ShowSummaryBox("Bulk Add Per Diem Expense Required Fields : ",i),!1;if($("#AddPerdiemExpenseGrid tbody tr").each(function(){var o=!1,n=new FormData,s=$(this).find("input#blkPerDate").val(),h=$(this).find("input#blkPerToDate").val(),c=$(this).find('select[ddl-country="country"] option:selected').val(),l=$(this).find('select[ddl-perdiemrates="perdiemrates"] option:selected').val(),a=$(this).find('input[txt-noOfNight="noOfNight"]').val(),i=$(this).find('select[ddl-currency="blkPerCurrency"] option:selected').val(),r=$(this).find('input[txt-blkPerAmt="blkPerAmt"]').val(),y=$(this).find('input[type="checkbox"][chk-bx="reim"]').prop("checked"),e=$("#hdnReimburseCurrency").val(),v=GetCurrencyExchangeRate(i,e,1),p=(v*r).toFixed(2),w=$(this).find('input[txt-description="desc"]').val();s.length<=0||h.length<=0||c.length<=0||l.length<=0||a.length<=0||i.length<=0||r.length<=0||e.length<=0||(n.append("parameterDateblkPerDate",s),n.append("parameterDateblkPerToDate",h),n.append("parameterCountry",c),n.append("parameterCategory","Per Diem"),n.append("parameterType","Per Diem"),n.append("parameterPerdiemrates",l),n.append("parameterNoOfNight",a),n.append("parameterBlkPerCurrency",i),n.append("parameterBlkPerAmt",r),n.append("parameterIsClaimRem",y),n.append("parameterReimburseCurrency",e),n.append("parameterReimburseAmount",p),n.append("parameterCurrencyExRate",v),n.append("parameterDescription",w),t!=""&&t!=undefined&&n.append("parameterReportReferenceId",t),u++,o=SaveBulkPerdiemExpense(n),o&&f++)}),u===f)if(n)window.location.href=baseURL+"Expense/Expense";else return $("#BulkAddExpenseModal").modal("hide"),!0;else ShowAlertBox("Error while adding expense")}}function CheckTypeExists(n){var t=!1;return $("#AddBulkExpenseGrid tbody tr:eq(0)").find("select[ddl-merchant=merchant] option").each(function(){if(this.value.trim().toLowerCase()==n.trim().toLowerCase())return t=!0,!1}),t}function AddDdlOption(n){$("#AddBulkExpenseGrid tbody tr").find("select[ddl-merchant=merchant]").each(function(){$(this).append($("<option>",{value:n,text:n}))})}function SaveBulkExpense(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/AddBulkExpense",data:n,contentType:!1,processData:!1,datatype:"json",type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t}function DeleteRow(n){var i=$("#AddBulkExpenseGrid tbody tr").length;if(i>1){var t=$(n).closest("tr"),r=$("#AddBulkExpenseGrid").data("kendoGrid").dataItem(t),u=$("#AddBulkExpenseGrid").data("kendoGrid");u.removeRow(r);$("#AddBulkExpenseGrid").find(t).remove()}else ShowAlertBox("Grid should have at least one record.")}function DeleteBulkPerDiemRow(n){var i=$("#AddPerdiemExpenseGrid tbody tr").length;if(i>1){var t=$(n).closest("tr"),r=$("#AddPerdiemExpenseGrid").data("kendoGrid").dataItem(t),u=$("#AddPerdiemExpenseGrid").data("kendoGrid");u.removeRow(r);$("#AddPerdiemExpenseGrid").find(t).remove()}else ShowAlertBox("Grid should have at least one record.")}function DownloadReceipt(n){var t=$(n).parent("div").find('input[type="file"].uploadReceipt');$(t).click()}function ValidateAttachmentFile(n){/^([a-zA-Z0-9\s_\\.()\-:])+(.jpg|.jpeg|.gif|.png|.bmp|.pdf|.doc|.docx|.xls|.xlsx|.txt)$/.test($(n).val().toLowerCase())?$(n).closest("#divUploadReceipt").find("img.img-responsive").attr("src",baseURL+"images/attached_green.png"):(e.preventDefault(),$(n).val(""),ShowAlertBox("Please upload a valid file."))}function ValidateBulkAddExpenseRow(n){var t=[],r=$(n).find("input#PaySlipDate").val(),u=$(n).find('input[txt-merchant="merchant"]').val(),f=$(n).find('select[ddl-category="category"] option:selected').val(),e=$(n).find('select[ddl-currency="currency"] option:selected').val(),o=$(n).find('input[txt-amt="amt"]').val(),s=$(n).find('input[type="checkbox"][chk-bx="invoice"]').prop("checked"),h=$(n).find('select[ddl-country="country"] option:selected').val(),c=$(n).find("input#PaySlipToDate").val(),i;return r.length<=0&&t.push("Enter Expense From Date"),c.length<=0&&t.push("Enter Expense To Date"),h.length<=0&&t.push("Select Country"),u.length<=0&&t.push("Enter Merchant"),f.length<=0&&t.push("Select Category"),e.length<=0&&t.push("Select Currency"),o.length<=0&&t.push("Enter Amount"),s==!1&&(i=$(n).find('input[txt-Ref="ref"]').val(),(i.length<=0||$(n).find('input[type="file"]#fUploadReceipt')[0].files.length<=0)&&t.push("Enter Invoice No. and Upload Receipt or select Invoice not available to continue")),t}function ValidateBulkAddPerdiemRow(n){var t=[],i=$(n).find("input#blkPerDate").val(),r=$(n).find("input#blkPerToDate").val(),u=$(n).find('select[ddl-country="country"] option:selected').val(),f=$(n).find('select[ddl-perdiemrates="perdiemrates"] option:selected').val(),e=$(n).find('input[txt-noOfNight="noOfNight"]').val();return(i==undefined||i.length<=0)&&t.push("Enter From Date"),(r==undefined||r.length<=0)&&t.push("Enter To Date"),(u==undefined||u.length<=0)&&t.push("Select Country"),(f==undefined||f.length<=0)&&t.push("Select Per Diem Rate"),(e==undefined||e.length<=0)&&t.push("Enter No. Of Night(s)"),t}function SaveBulkPerdiemExpense(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/AddBulkPerdiemExpense",data:n,contentType:!1,processData:!1,datatype:"json",type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t}function BulkAddExpenseRequiredFieldsSummary(){var n=[];return n.push("Enter Expense From Date"),n.push("Enter Expense To Date"),n.push("Select Country"),n.push("Enter Merchant"),n.push("Select Category"),n.push("Select Currency"),n.push("Enter Amount"),n.push("Enter Invoice No. and Upload Receipt or select Invoice not available to continue"),n}function FilterByCompanyName(n){$("#txtFilterByEmpName").on("focusout keypress input",function(t){var i=$("#txtFilterByEmpName").val();if(t.keyCode==13)return doApplyGridFilter(n,"contains","companyName",i==""?0:i),!1;doApplyGridFilter(n,"contains","companyName",i==""?0:i)})}function AddBulkExpenseGetCurrencyByCountry(n){var i=$(n).val(),t;i!=""&&(t=$.get(baseURL+"Expense/LoadCurrencyByCounty",{countryName:i}),t.done(function(t){var r=$("#AddBulkExpenseGrid tbody tr").length,i;r>0?(i=$(n).closest("tr"),$(i).find('select[ddl-currency="currency"]').val(t.currency).attr("selected",!0)):ShowAlertBox("Grid should have at least one record.")}),t.fail(function(){}))}function AddBulkPerdiemExpenseGetCurrencyByCountry(n){var i=$(n).val(),t;i!=""&&(t=$.get(baseURL+"Expense/LoadCurrencyByCounty",{countryName:i}),t.done(function(t){var r=$("#AddPerdiemExpenseGrid tbody tr").length,i;r>0?(i=$(n).closest("tr"),t.currency!=null&&$(i).find('select[ddl-currency="blkPerCurrency"]').val(t.currency).attr("selected",!0)):ShowAlertBox("Grid should have at least one record.")}),t.fail(function(){}))}function AddBulkPerdiemExpenseGetReimburseCurrency(n){var i=$("#EmployeeId").val(),t=$.post(baseURL+"Expense/EmployeeReimburseCurrency",{employeeId:i});t.done(function(t){var i,r;t&&(i=$("#AddPerdiemExpenseGrid tbody tr").length,i>0?(r=$(n).closest("tr"),$(r).find('select[ddl-reimCurrency="reimCurrency"]').val(t).attr("selected",!0)):ShowAlertBox("Grid should have at least one record."))});t.fail(function(){})}function CalculateNoOfDaysBulkPerDiem(n){var t=$(n).closest("tr"),i=kendo.toString(kendo.parseDate($(t).find("#DivBlkPerDt").datepicker("getDate")),"MM-dd-yyyy"),r=kendo.toString(kendo.parseDate($(t).find("#DivBlkPerToDt").datepicker("getDate")),"MM-dd-yyyy"),u;i!=null&&r!=null?(u=BulkPerDiemDaydiff(objThis.parseDate(i),objThis.parseDate(r)),$(t).find("#noOfNight").val(u)):$(t).find("#noOfNight").val("")}function BulkPerDiemDaydiff(n,t){return(t-n)/864e5}function BulkPerDiemRateCurrency(n){var t=$(n).closest("tr"),r=$(t).find('select[ddl-perdiemrates="perdiemrates"]').val(),u=$(t).find("#noOfNight").val(),i;r>0&&u.length>0&&(i=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:r,NoOfDays:u}),i.done(function(n){$(t).find('select[ddl-currency="blkPerCurrency"]').val(n.currency).attr("selected",!0)}),i.fail(function(){ShowAlertBox("Fail to get per diem information!")}))}function GetBulkPerDiemRateByCountryInsertRow(n){if($(n).val()!=""){var i=$(n).closest("tr"),r=$(n).val(),u=$("#hdnReimburseCurrency").val(),t=$.get(baseURL+"Expense/LoadPerDiemAmountByCountry",{country:r,currency:u});t.done(function(t){$(i).find('select[ddl-perdiemrates="perdiemrates"]').val(t).attr("selected","selected");GetBulkPerDiemAmountOnCountry(n,t)});t.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}}function GetBulkPerDiemAmountOnCountry(n,t){var i=$(n).closest("tr"),u=t,f=$(i).find("#noOfNight").val(),r;u>0&&f.length>0&&(r=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:u,NoOfDays:f}),r.done(function(n){var r,u,t,f;$(i).find('select[ddl-currency="blkPerCurrency"]').val(n.currency).attr("selected",!0);$(i).find("#blkPerAmt").val(n.amount);r=$("#hdnReimburseCurrency").val();u=n.currency;parseFloat(n.amount)>0?(t=GetCurrencyExchangeRate(u,r,1),f=(t*n.amount).toFixed(2),$(i).find("#blkReimAmt").val((t*n.amount).toFixed(2))):$(i).find("#blkReimAmt").val("")}),r.fail(function(){ShowAlertBox("Fail to get per diem information!")}))}function GetBulkPerDiemAmount(n){var t=$(n).closest("tr"),r=$(t).find('select[ddl-perdiemrates="perdiemrates"]').val(),u=$(t).find("#noOfNight").val(),i;r>0&&u.length>0&&(i=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:r,NoOfDays:u}),i.done(function(n){var r,u,i,f;$(t).find('select[ddl-currency="blkPerCurrency"]').val(n.currency).attr("selected",!0);$(t).find("#blkPerAmt").val(n.amount);r=$("#hdnReimburseCurrency").val();u=n.currency;parseFloat(n.amount)>0?(i=GetCurrencyExchangeRate(u,r,1),f=(i*n.amount).toFixed(2),$(t).find("#blkReimAmt").val((i*n.amount).toFixed(2))):$(t).find("#blkReimAmt").val("")}),i.fail(function(){ShowAlertBox("Fail to get per diem information!")}))}function LoadPerdiemRatesByCountrySpecificBulk(n){var r;if($(n).val()!=""){var t=$(n).closest("tr"),u=$(n).val(),f=$("#hdnReimburseCurrency").val(),i=$("#ExpenseId").val();i==""&&(i=0);r=$.get(baseURL+"Expense/LoadPerdiemRateByCountry",{country:u,currency:f,expenseId:i,reportId:0});r.done(function(n){$(t).find('select[ddl-perdiemrates="perdiemrates"]').empty();$.each(n,function(n,i){$("<option>").val(i.value).text(i.text).appendTo($(t).find('select[ddl-perdiemrates="perdiemrates"]'));$(t).find('select[ddl-perdiemrates="perdiemrates"]').val(i.value).attr("selected",!0)})});r.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}}function GetBulkPerDiemRateByCountry(n){if($(n).val()!=""){var i=$(n).closest("tr"),r=$(n).val(),u=$("#hdnReimburseCurrency").val(),t=$.get(baseURL+"Expense/LoadPerDiemAmountByCountry",{country:r,currency:u});t.done(function(t){$(i).find('select[ddl-perdiemrates="perdiemrates"]').val(t).attr("selected","selected");GetBulkPerDiemAmount(n)});t.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}}function ChangeNoOfNights(n){GetBulkPerDiemAmount(n)}function InsertRowPerDiemItem(n){var o=0,i="d26a9207-d794-44bc-8568-147174cc3d90",s=$("#"+n).data("kendoGrid"),r,t,e;if(s)for(r=s.dataSource,o=r.data().length,i=RandomGridUID(r.data()[o-1].uid),indx=0;indx<r.data().length;indx++)i==r.data()[indx].uid&&(i=RandomGridUID(r.data()[indx].uid));var f=$("#"+n+" tbody tr"),h=f.eq(0),u="";if(u=$(f[f.length-1]).hasClass("k-alt")?'<tr data-uid="'+i+'" role="row">':'<tr class="k-alt" data-uid="'+i+'" role="row">',u+=h.html(),u+="<\/tr>",$("#"+n+" tbody").append(u),t=$("#"+n+" tbody tr[data-uid='"+i+"']"),t.find('input[type="checkbox"]').length>0&&(e=Math.floor(1e3+Math.random()*9e3),t.find('input[type="checkbox"][chk-bx="reim"]').attr("id",e),t.find('input[type="checkbox"][chk-bx="reim"]').parent("td").find("label.checkbox-inline").attr("for",e)),t.find("div.date.custom-grid-date").length>0)t.find("#DivBlkPerDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});if($(t).find('select[ddl-perdiemrates="perdiemrates"]').empty(),t.find("div.date.custom-grid-date").length>0)t.find("#DivBlkPerToDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$(t).find('input[type="text"]#blkPerAmt').on("keyup blur",function(n){if($(this).val($(this).val().replace(/[^0-9\.]/g,"")),!AllowOneDotInNumber(this))return!1;(n.which!=46||$(this).val().indexOf(".")!=-1)&&(n.which<48||n.which>57)&&n.preventDefault()});$(t).find('input[type="text"]#blkReimAmt').on("keyup blur",function(n){if($(this).val($(this).val().replace(/[^0-9\.]/g,"")),!AllowOneDotInNumber(this))return!1;(n.which!=46||$(this).val().indexOf(".")!=-1)&&(n.which<48||n.which>57)&&n.preventDefault()});$(t).find('select[ddl-country="country"]').change(function(){LoadPerdiemRatesByCountrySpecificBulk(this);GetBulkPerDiemRateByCountryInsertRow(this)});t.find("#DivBlkPerDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var n=t.find("#DivBlkPerDt").datepicker("getDate");n==null||(t.find("#DivBlkPerToDt").datepicker("setStartDate",new Date(n.valueOf())),t.find("#DivBlkPerToDt").datepicker("setDate",null))});t.find("#DivBlkPerToDt").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var n=t.find("#DivBlkPerDt").datepicker("getDate"),i;if(n!=null){if(n=t.find("#DivBlkPerDt").datepicker("getDate"),i=t.find("#DivBlkPerToDt").datepicker("getDate"),i.valueOf()==n.valueOf()){$("#DivBlkPerToDt").datepicker("setDate","");ShowMessageBox("Warning!!!","Per-Diem claims are not permitted when From Date is same as To Date","300px");t.find("#noOfNight").val("");return}CalculateNoOfDaysBulkPerDiem(this);GetBulkPerDiemAmount(this)}});$(t).find('select[ddl-perdiemrates="perdiemrates"]').change(function(){GetBulkPerDiemAmount(this)})}function DistroyGridDataSrc(n){var t=$("#"+n).data("kendoGrid");t!=undefined&&(t.destroy(),$("#"+n).html("").removeClass())}function AllowOneDotInNumber(n){var i=$(n).val().trim(),t=!0;return i.split(".").length==2?t=!0:i.split(".").length>2?t=!1:i.replace(".","").length==0&&(t=!1),t==!1&&$(n).val(""),t}function SaveGridState(n){var o="",r="",t=$("#"+n).data("kendoGrid"),i,f,e;if(t!=undefined){var s=[],h=[],u="";for(r=t.dataSource,o={page:r.page(),pageSize:r.pageSize(),sort:r.sort(),group:r.group(),filter:r.filter()},i=0;i<t.columns.length;i++)h.push(t.columns[i].field),u==""?u='{"'+t.columns[i].field+'":'+t.columns[i].hidden:u+=', "'+t.columns[i].field+'":'+t.columns[i].hidden+(i==t.columns.length-1?"}":""),i==t.columns.length-1&&s.push(JSON.parse(u));f=kendo.stringify(o)+"%"+kendo.stringify(s)+"%"+kendo.stringify(h);f&&(e=$.post(baseURL+"Reports/SaveGridConfiguration",{gridId:n,grdConfig:f}),e.done(function(n){if(n)return!0;ShowAlertBox("Fail to save Grid State")}),e.fail(function(){ShowAlertBox("Fail to save Grid State")}))}}function RestoreKGridState(n,t){var i="",r="",f="",e="",u={gSize:null,gSort:null,gFilter:"",gGroup:null,gPage:null,clmnState:null,clmnOrder:null};return $.ajax({url:baseURL+"Reports/GetGridConfiguration",data:{gridId:n},type:"GET",async:!1,success:function(n){i=n},error:function(){ShowAlertBox("Fail to save Grid State")}}),i!=undefined&&i!=""&&i!="%%%"&&(r=i.split("%")[0]!=undefined?JSON.parse(i.split("%")[0]):null,f=i.split("%")[1]!=undefined?JSON.parse(i.split("%")[1]):null,e=i.split("%")[2]!=undefined?JSON.parse(i.split("%")[2]):null,r!=null&&(u.gPage=r.page!=undefined?r.page:1,u.gGroup=r.group!=undefined?r.group:null,u.gsort=r.sort!=undefined?r.sort:null,u.gSize=r.pageSize!=undefined?r.pageSize:null)),f!=null&&(u.clmnState=f),u.gGroup==null&&(u.gGroup=t),u.gColOrder=e!=undefined?e:"",u}function GridConfigurationClick(n){$("#btnGridConfig").click(function(t){t.preventDefault();SaveGridState(n)})}function GetGridColumnByFormat(n,t){var u=0,f=[],r=$("#"+n).data("kendoGrid").columns,i;if(r!=undefined)for(i=0;i<r.length;i++)r[i].hidden==!0?u=u+1:r[i].format!=undefined&&r[i].format==t&&f.push(i-u);return f}function SortDropDownListByText(n){$("#"+n).each(function(){var n=$(this).val();$(this).html($("option",$(this)).sort(function(n,t){return n.text.toUpperCase()==t.text.toUpperCase()?0:n.text.toUpperCase()<t.text.toUpperCase()?-1:1}));$(this).val(n)})}function DdlOptionAdd(n,t){var i=$("#"+n+" option[value='"+t+"']").val(),r,u,f;i!=undefined&&(r=$("#"+n+" option[value='"+t+"']").text(),u=$("#"+n+" option[value='"+t+"']").is(":selected"),$("#"+n+" option[value='"+t+"']").remove(),f=$("<option>",{value:i,text:r,selected:u}),$(f).insertBefore("#"+n+" option:nth-child(1)"))}function AvoidMultipleSubmit(n,t){ValidateAllRequiredField(t)&&$("#"+n).addClass("XDisabled")}function ValidateAllRequiredField(n){var t=!0;return $("form#"+n+" input[required], form#"+n+" select[required], form#"+n+" label[required], form#"+n+" textarea[required]").each(function(){return $(this).is("input:text")||$(this).is("textarea")?t=this.value.trim()==""?!1:!0:$(this).is("input:checkbox")||$(this).is("input:radio")?t=this.checked:$(this).is("select")?t=$(this).attr("multiple")==undefined?this.value==""?!1:!0:$(this).find("option:selected").length==0?!1:!0:$(this).is("input:file")?t=this.value==""?!1:!0:$(this).is("label")?t=$(this).text()==""?!1:!0:$(this).is("input:hidden")&&(t=this.value==""?!1:!0),t==!1?!1:void 0}),t}function SetSearchListPosition(n,t){if(t.parent("div.k-animation-container").length>0){t.parent("div.k-animation-container").addClass("hidden");var i=$("#"+n).offset().top+$("#"+n).outerHeight();t.parent("div.k-animation-container").css("top",i);t.parent("div.k-animation-container").removeClass("hidden")}}function getMonthFromString(n){var t=Date.parse(n+"1, 2012");return isNaN(t)?-1:new Date(t).getMonth()+1}function ValidateReferenceNumber(n,t,i,r,u){var f=null;return $.ajax({url:baseURL+"Expense/ValidateReferenceNumber",data:{type:n,category:t,refNumber:i,merchant:r,expenseId:u},type:"GET",async:!1,success:function(n){f=n},error:function(){ShowAlertBox("Error while validating invoice number");f=null}}),f}var baseURL=$("#BaseUrl").data("baseurl"),GridIdForColReSize="";$("#dashboardNavBar #dashHeader ul.nav.navbar-nav > li").hover(function(){$("#dashboardNavBar #dashHeader ul.nav.navbar-nav > li.open").removeClass("open")});$("img#imgCompLogo").on("error",function(){$(this).attr("src",baseURL+"images/logo.png")});$('input[type="submit"]').hover(function(){$(this).parents("form").removeAttr("err-cnt")});$("#anchCompLst").unbind("click").on("click",function(n){n.preventDefault();n.stopPropagation();$(window).scrollTop(0);$("#ddlSearchableCtrl").data("kendoDropDownList")==undefined&&$("#ddlSearchableCtrl").kendoDropDownList({filter:"contains",dataTextField:"name",dataValueField:"id",optionLabel:"ALL",dataSource:{transport:{read:{url:baseURL+"Dashboard/LoadCompanyList",dataType:"json"}}}});$("#CompanyModalPopup").modal("show")});$("#CompanyModalPopup").on("hidden.bs.modal",function(){var n=$("#ddlSearchableCtrl").data("kendoDropDownList");n!=undefined&&n.value("")});$("#btnAccessBaseCompany").unbind("click").on("click",function(n){n.preventDefault();n.stopPropagation();var t=$.post(baseURL+"Dashboard/ChangeCompnay",{companyId:0});t.done(function(n){n?($("#CompanyModalPopup").modal("hide"),window.location.href=baseURL+"Dashboard/Index"):ShowAlertBox("Fail to change company")});t.fail(function(){ShowAlertBox("Fail to change company")})});$("#btnChangeCompany").unbind("click").on("click",function(n){var t,i;n.preventDefault();n.stopPropagation();t=$("#ddlSearchableCtrl").data("kendoDropDownList").value();t!=""?(i=$.post(baseURL+"Dashboard/ChangeCompnay",{companyId:t}),i.done(function(n){n?($("#CompanyModalPopup").modal("hide"),window.location.href=baseURL+"Dashboard/Index"):ShowAlertBox("Fail to change company")}),i.fail(function(){ShowAlertBox("Fail to change company")})):ShowAlertBox("Please select company")});ChangePasswordView.prototype.Init=function(){var n=document.getElementById("successDiv"),t=document.getElementById("failureDiv");$("#hdnResponseMessage").val()=="SUCCESS"?(n.style.display="block",t.style.display="none",$("#successDiv").fadeTo(2e3,500).slideUp(500,function(){$("#successDiv").slideUp(500)})):$("#hdnResponseMessage").val()=="ERROR"&&(n.style.display="none",t.style.display="block",$("#failureDiv").fadeTo(2e3,500).slideUp(500,function(){$("#failureDiv").slideUp(500)}));$("#NewPassword, #Password, #ConfirmPassword").blur(function(){var n=$("#Password").val(),t=$("#NewPassword").val(),i=$("#ConfirmPassword").val();n!=""&&(t!=""||i!="")&&(n==t?($("#divNewPasswordError").removeClass("hide-span"),$("#NewPassword").parent("div.form-group").addClass("has-error has-danger"),$("#btnChangePwd").addClass("disabled")):($("#divNewPasswordError").addClass("hide-span"),$("#NewPassword").parent("div.form-group").removeClass("has-error has-danger")))});$("#ChangePasswordForm").validator().on("submit",function(n){$("#divNewPasswordError").hasClass("hide-span")||($("#btnChangePwd").addClass("disabled"),$("#NewPassword").parent("div.form-group").addClass("has-error has-danger"),$("#NewPassword").focus(),n.preventDefault())})};EditProfileView.prototype.Init=function(){$("#btnClear").click(function(n){n.preventDefault();$("#password").val("");$("#confirmpassword").val("");$("#mobilenumber").val("");$("#officenumber").val("")});$("#fileUploadUserProfile").change(function(){ShowUploadedImage("divProfilePic","fileUploadUserProfile","imgUserPic",!1)});$("#lblUploadPhoto").on("click",function(){$("#fileUploadUserProfile").click()})};DashboardView.prototype.Init=function(){$("#btnProcessPayroll").click(function(n){n.preventDefault();var t=$("#hdnPayrollIdHash").val();window.location.href=baseURL+"Payroll/ReviewEmployees?payrollId="+encodeURIComponent(t)});$("#btnRerunPayroll").click(function(n){var t=ShowConfirmationAlertBox("Are you sure you want to Re-run the payroll for "+$("#paraRerunMonth").text()+"?");t.then(function(){n.preventDefault();var t=$("#hdnReranPayrollIdHash").val();window.location.href=baseURL+"Payroll/ReviewEmployees?payrollId="+encodeURIComponent(t)})});$("#btnProceedReranOK").click(function(n){n.preventDefault();var t=$("#reranpayrollIdHash").val();window.location.href=baseURL+"Payroll/ReviewEmployees?payrollId="+encodeURIComponent(t)});$("#btnMyExpense").click(function(n){n.preventDefault();window.location.href=baseURL+"Expense/Expense"});$("#btnTimeSheet").click(function(n){n.preventDefault();window.location.href=baseURL+"Timesheet/MyTimesheet"});$("#btnReport").click(function(n){n.preventDefault();window.location.href=baseURL+"Expense/ExpenseReport"});var n=function(n,t){for(var u=$("area"),f=u.length,r=[],e=681,i=0;i<f;i++)r[i]=u[i].coords.split(",");this.resize=function(){for(var i,o,s=t.offsetWidth/e,n=0;n<f;n++){for(o=r[n].length,i=0;i<o;i++)r[n][i]*=s;u[n].coords=r[n].join(",")}return e=t.offsetWidth,!0};window.onresize=this.resize},t=new n(document.getElementById("map_ID"),document.getElementById("img_ID"));t.resize();return};SiteAdminDashBoardView.prototype.Init=function(){$("#ddlSearchable").removeClass("hidden");$("#ddlSearchable").kendoDropDownList({filter:"contains",dataTextField:"name",dataValueField:"name",optionLabel:"ALL",dataSource:{transport:{read:{url:baseURL+"Dashboard/LoadCompanyList",dataType:"json"}}},close:function(){var n=this.value();doApplyGridFilter("ActiveComapnyForLoggedInGrid","contains","companyName",n==""?0:n)}});this.LoadActiveComapnyForLoggedInGrid()};SiteAdminDashBoardView.prototype.LoadActiveComapnyForLoggedInGrid=function(){function i(){setTimeout(function(){KGrdPageSizeDdlPosition("ActiveComapnyForLoggedInGrid",1)},1)}var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Dashboard/GetActiveOrganizationsList",dataType:"json"}},batch:!0,pageSize:10,schema:{model:{id:"companyId",fields:{companyId:{editable:!1},companyName:{editable:!1},registrationNumber:{editable:!1},mobileNumber:{editable:!1},email:{editable:!1}}}}});$("#ActiveComapnyForLoggedInGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,selectable:"row",columns:[{field:"companyId",hidden:!0},{title:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:50},{field:"companyName",width:"250px",title:"Company Name"},{field:"registrationNumber",width:"130px",title:"Registration Number"},{field:"contactPerson",width:"130px",title:"Contact Person",template:"#if(contactPerson === null || contactPerson === ''){# - #}else{# #=contactPerson# #}#"},{field:"email",width:"160px",title:"Email",template:"#if(email === null || email === ''){# - #}else{# #=email# #}#"},{title:"Click to Access",template:function(n){return'<input type="button" onclick="SiteAdminDashBoardView.prototype.ChangeCompnay(\''+n.companyId+'\')" value="Access Company" class="btn btn-primary custom-grid-button" />'},width:"100px"}],dataBound:i,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};SiteAdminDashBoardView.prototype.ChangeCompnay=function(n){if(n!=""){var t=$.post(baseURL+"Dashboard/ChangeCompnay",{companyId:n});t.done(function(n){n?window.location.href=baseURL+"Dashboard/Index":ShowAlertBox("Fail to change company")});t.fail(function(){ShowAlertBox("Fail to change company")})}};MyDashBoardView.prototype.Init=function(){var n=this;n.SelectHolidaysInCalender();$("#divNote").html($("#hdnEmployeeNote").val());$("#divNote").blur(function(){var t=this.innerHTML.trim(),n;t!=""&&(n=$.post(baseURL+"Dashboard/AddEmployeeNote",{note:t}),n.done(function(){return!1}),n.fail(function(){ShowAlertBox("Fail to save note.!")}))})};MyDashBoardView.prototype.SelectHolidaysInCalender=function(){var t=new Date,i=t.getFullYear(),n=$.get(baseURL+"Settings/CalendarDetailsGet",{year:null});n.done(function(n){for(var r,e,o=JSON.stringify(n),i=JSON.parse(o),f=[],t=0;t<i.length;t++){i[t].detailType=="Holiday"?$("#hdnHolidayName").append(new Option(i[t].detailName,i[t].detailDate)):(i[t].detailType=="AP"||i[t].detailType=="ABNT")&&(r=new Option(i[t].detailName,i[t].detailDate),r.setAttribute("attr-lstatus",i[t].detailType),$("#hdnLeaveName").append(r));var u=new Date(i[t].detailDate),s=u.getUTCMonth(),h=u.getUTCDate()+1,c=u.getUTCFullYear();f.push(+new Date(c,s,h))}e=new Date;$("#holidayCalendar").kendoCalendar({value:e,dates:f,navigate:OnNavigate,footer:!1,month:{content:'# if ($.inArray(+data.date, data.dates) != -1) { #<div title="#= data.date #" class="#=CssNameClass(data.date)#">#= data.value #<\/div># } else { ##= data.value ## } #'}});SetHolidayTitle()});n.fail(function(){ShowAlertBox("Fail to load holidays list!")})};AboutCompanyView.prototype.Init=function(){if($("#CompanyId").val()==""){var n=$("#hdnClientGroupCountry").val()!=""?$("#hdnClientGroupCountry").val():"Singapore";$("#ddlCompanyCountry").val(n);$("#ddlCompanyAddressCountry").val(n)}else $("#ddlCompanyAddressCountry").val($("#ddlCompanyAddressCountry").val()==""?$("#ddlCompanyCountry").val():$("#ddlCompanyAddressCountry").val());$("#fileUploadCompanyLogo").change(function(n){var i=$("#fileUploadCompanyLogo"),r=$("#lblFileName"),u=$("#lblErrorMedia"),t;ValidateImage(i,r,u)&&(t=n.target.files[0].name,$("#lblFileName").text(t))});$("#ddlCompanyCountry").change(function(){var n=$(this).val();$("#ddlCompanyAddressCountry").val(n)});$("#companyRegistrationNumber").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpUEN").html("Checking..."),n=$.get(baseURL+"Company/UENExistence",{UEN:$(this).val()}),n.done(function(n){n?($("#companyRegistrationNumber").addClass("error-box"),$("#helpUEN").html("Company Registration Number is already exist!"),$("#companyRegistrationNumber").focus(),$("#companyRegistrationNumber").attr("isAlreadyTaken",!0)):($("#companyRegistrationNumber").removeClass("error-box"),$("#helpUEN").html(""),$("#companyRegistrationNumber").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpUEN").html("Error while verifying Company Registration Number")}))});$("#btnSaveAboutCompany, #btnCreateCompany").on("click",function(n){var t=$("#companyRegistrationNumber").attr("isAlreadyTaken");typeof t!=typeof undefined&&(ShowAlertBox("Company Registration Number is already exist."),$("#companyRegistrationNumber").focus(),n.preventDefault())})};CompanyInfoView.prototype.Init=function(){var n=this,t;ValidateAndScrollToEmptyField();ShowHideDdlOptionByAnotherDdl("ddlMultiSelect","ddlCompBaseCurrency");$("#ddlMultiSelect").multiselect({buttonWidth:"100%",maxHeight:300,numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size",onChange:function(){ShowHideDdlOptionByAnotherDdl("ddlMultiSelect","ddlCompBaseCurrency")}});$("#fileCompanyLogo").change(function(n){var i=$("#fileCompanyLogo"),r=$("#lblFileName"),u=$("#lblErrorMedia"),t;ValidateImage(i,r,u)&&(t=n.target.files[0].name,$("#lblFileName").text(t))});$("#btnClear").click(function(t){t.preventDefault();n.ClearFields()});$("#ddlCompanyCountry").change(function(){var t=$(this).val(),i=this.getAttribute("old-value"),r;i!=t&&(r=ShowConfirmationAlertBox("This change in company country will affect the existing employees. <br> Click OK to continue."),r.then(function(){return $("#ddlCompanyAddressCountry").val(t),n.SelectCountryCurrency(),t=="Singapore"&&$("#lblContactSection").html("Contact Info / IR8A Setup"),!0},function(){return $("#ddlCompanyCountry").val(i),!1}))});$("#ddlCompanyCountry").val()=="Singapore"&&$("#lblContactSection").html("Contact Info / IR8A Setup");($("#ddlMultiSelect").val()==null||$("#ddlMultiSelect").val()==""||$("#ddlMultiSelect").val()==undefined)&&(n.SelectCountryCurrency(),$("#ddlCompBaseCurrency").val()==""&&(t=$("#ddlCompanyCountry option:selected"),$("#ddlCompBaseCurrency option[value="+t.attr("attr-CountryCurrency")+"]").attr("selected",!0)));$("#ddlCompBaseCurrency").change(function(){});$("#companyRegNumber").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpUEN").html("Checking..."),n=$.get(baseURL+"Company/UENExistence",{UEN:$(this).val()}),n.done(function(n){n?($("#companyRegNumber").addClass("error-box"),$("#helpUEN").html("Company Registration Number is already exist!"),$("#companyRegNumber").focus(),$("#companyRegNumber").attr("isAlreadyTaken",!0)):($("#companyRegNumber").removeClass("error-box"),$("#helpUEN").html(""),$("#companyRegNumber").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpUEN").html("Error while verifying Company Registration Number")}))});$("#btnSaveCompanyBasicInfo").on("click",function(n){var t=$("#companyRegNumber").attr("isAlreadyTaken");typeof t!=typeof undefined&&(ShowAlertBox("Company Registration Number is already exist."),$("#companyRegNumber").focus(),n.preventDefault())})};CompanyInfoView.prototype.SelectCountryCurrency=function(){var n=$("#ddlCompanyCountry option:selected"),t;n.length>0&&n.val()!=""&&(t=n.attr("attr-CountryCurrency"),t!=""&&($("#ddlMultiSelect option[value="+t+"]").attr("selected",!0),$("#ddlMultiSelect").multiselect("refresh"),ShowHideDdlOptionByAnotherDdl("ddlMultiSelect","ddlCompBaseCurrency")))};CompanyInfoView.prototype.ClearFields=function(){$("#companyName").val("");$("#companyPrefix").val("");$("#companyRegNumber").val("");$("#contactPersonName").val("");$("#mobileNumber").val("");$("#phoneNumber").val("");$("#ddlCompanyCountry").val("");$("#ddlCompanyAddressCountry").val("");$("#fax").val("");$("#email").val("");$("#addressLine1").val("");$("#addressLine2").val("");$("#addressLine3").val("");$("#postalCode").val("");$("#ddlDesignation").val("")};CompanyPayrollView.prototype.Init=function(){var n=this,t,r;$("#ddlReminderAlert").find("option:contains('Select')").hide();$("#ddlReminderAlert").find("option:contains('First Working Day Of Next Month')").hide();$("#ddlReminderAlert").find("option:contains('Last Working Day Of Current Month')").hide();var i=$("#hdnBaseCountry").val().trim();$("#CPFsubmission").hide();$("#SDLsubmission").hide();$("#prepaidDiv").hide();$("#rdnPaySlip").hide();$("perYearDate").hide();RadioBtnCheck();$("#txtCSNNumber").kendoMaskedTextBox({mask:"AAAAAAAAAA-AAA-AA"});i=="Singapore"?($("#chkProcessPayrollWithExcelOnly").attr("checked",!1),$("#chkProcessPayrollWithExcelOnly").attr("readonly",!0),$("#divProcessPayrollWithExcelOnly").addClass("pointer-none")):$("#PayrollInfoId").val()==""&&($("#chkProcessPayrollWithExcelOnly").is(":checked")||$("#chkProcessPayrollWithExcelOnly").attr("checked",!0));$("#datePickerRA").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#startDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#endDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#rdnPackage").click(function(){$("#prepaidDiv").show()});$("#rdnMonthly").click(function(){$("#prepaidDiv").hide()});$("#rdnCPF").click(function(){$("#CPFsubmission").show();$("#SDLsubmission").hide();$("#rdnPaySlip").hide()});$("#rdnPayslip").click(function(){$("#CPFsubmission").hide();$("#SDLsubmission").hide()});$("#rdnSDL").click(function(){$("#SDLsubmission").show();$("#CPFsubmission").hide();$("#rdnPaySlip").hide()});$("#rdnReportsOnly").click(function(){$("#SDLsubmission").hide();$("#CPFsubmission").hide()});$("#rdnPerYear").click(function(){$("#perYearDate").show()});$("#rdnPerMonth").click(function(){$("#perYearDate").hide()});$("#rdnPerEmp").click(function(){$("#perYearDate").hide()});$("#chkNoReminders").click(function(){$("#ddlReminderAlert").attr("disabled",$(this).is(":checked"));$("#ddlNoOfReminderSend").attr("disabled",$(this).is(":checked"));$("#txtRecEmail").attr("disabled",$(this).is(":checked"));$("#txtRecName").attr("disabled",$(this).is(":checked"))});ValidateAndScrollToEmptyField();CheckInterbankGIROSetup();this.LoadGIROBankDetailGrid();this.LoadCSNNumberGrid();this.LoadCompanyPayItemsGrid();this.SetPasswordStructureVisibility($("#chkPassProtectedPayslips").is(":checked"));$("#chkPassProtectedPayslips").change(function(){n.SetPasswordStructureVisibility($(this).is(":checked"))});$("#chkIncludeExpensesInPayroll").change(function(){});$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#ddlWorkWeek").change(function(){$(this).val()=="Custom"?$("#divCompWorkWeek").removeClass("pointer-none"):($("#divCompWorkWeek").find("input[type=checkbox]:checked").removeAttr("checked"),$("#divCompWorkWeek").addClass("pointer-none"),$(".error-WorkWeek-day").hide())});$("#frmCompanyPayrollInfo").submit(function(){if($("#ddlWorkWeek").val()=="Custom"){var n=$("#divCompWorkWeek input[type=checkbox]:checked");return n.length==0?($(".error-WorkWeek-day").show(),!1):!0}});$("#ddlWorkWeek").val()!="Custom"&&($("#divCompWorkWeek").find("input[type=checkbox]:checked").removeAttr("checked"),$("#divCompWorkWeek").addClass("pointer-none"));$("#frmCompanyPayItems").submit(function(t){var y,p;if(t.preventDefault(),!$("#btnSaveCompanyPayItem").hasClass("disabled")){var u=$("#CompanyPayItemId").val(),f=$("#PayItemDesc").val(),w=$("#ddlPayItemCategory option:selected").text(),e=$("#ddlTypeOfWage option:selected").text(),o=$("#ddlCPFApplicable option:selected").text(),s=$("#ddlIR8ACategory option:selected").text(),b=$("#chkIsUniversalPayItem").prop("checked"),r=$("#rdnVariable").is(":checked"),h=$("#ddlVariableAmountBasedOn option:selected").text(),c=$("#txtFixedAmount").val(),k=$("#PercentageForAmt").val(),l=$("#startDate").val(),i=$("#ddlPayItemEndDate option:selected").text(),a=$("#endDate").val(),v=$("#txtRepeatForTimes").val()===""?0:$("#txtRepeatForTimes").val(),d=r?!1:$("input:radio[name$='rdnProrate']:checked").val();if(!(f.length<=0)&&!(e.length<=0)&&!(o.length<=0)&&!(s.length<=0)&&!(l.length<=0)&&!(i.length<=0)){if(r){if(h.length<=0)return}else if(c.length<=0)return;if(i==="End Date"){if(a.length<=0)return}else if(i==="Repeat for # times"&&v.length<=0)return;y={CompanyPayItemId:u,Description:f,Category:w,TypeOfWage:e,CPFApplicable:o,IR8ACategory:s,IsUniversalForAllEmployees:b,IsVariableAmount:r,VariableAmountBasedOn:h,Amount:c,AmountPercentageInCaseOfVariable:k,StartDate:l,EndsOn:i,EndDate:a,RepeatForTimes:v,IsProrate:d};p=n.SaveCompanyPayItem(y);p==!0?(u>0?ShowAlertBox("Pay item updated successfully"):ShowAlertBox("Pay item added successfully"),$("#AddPayItem").modal("hide"),refreshGrid($("#companyPayItemsGrid"))):ShowAlertBox("Error while saving company pay item")}}});$("#ddlVariableAmountBasedOn").hide();$("#divPercentageForAmt").hide();$("#payItemEndDate").hide();$("#txtRepeatForTimes").hide();$("input[name$='rdnPayItemAmount']").click(function(){var t=$(this).val();n.PayItemAmountSelection(t)});$("#ddlCPFApplicable").change(function(){n.SetTypeOfWageCompany()});$("#ddlPayItemEndDate").change(function(){var t=$(this).find("option:selected").text(),n=$(this).val();n==="End Date"?($("#payItemEndDate").show(),$("#txtRepeatForTimes").val(""),$("#txtRepeatForTimes").hide(),$("#endDate").prop("required",!0),$("#txtRepeatForTimes").removeAttr("required")):n==="Repeat for # times"?($("#payItemEndDate").hide(),$("#txtRepeatForTimes").show(),$("#txtRepeatForTimes").prop("required",!0),$("#endDate").val(""),$("#endDate").removeAttr("required")):($("#endDate").val(""),$("#txtRepeatForTimes").val(""),$("#payItemEndDate").hide(),$("#txtRepeatForTimes").hide(),$("#endDate").removeAttr("required"),$("#txtRepeatForTimes").removeAttr("required"))});$("#ddlPayItemCategory").change(function(){var t=$(this).val();t==="Reimbursement"?n.ReimbursementPayItemCategory():t==="Overtime"?n.OvertimePayItemCategory():n.OtherPayItemCategory();n.SetTypeOfWageCompany()});$("#ddlVariableAmountBasedOn").change(function(){var n=$(this).val();n==="% of present month basic salary"?($("#lblTextInCaseOfVariable").text("%"),$("#divPercentageForAmt").show(),$("#PercentageForAmt").prop("required",!0)):n==="Amount per day for the days actually worked in a month"?($("#lblTextInCaseOfVariable").text("Amount per working day"),$("#divPercentageForAmt").show(),$("#PercentageForAmt").prop("required",!0)):n==="Amount per day for the total working days in a month"?($("#lblTextInCaseOfVariable").text("Amount per working day"),$("#divPercentageForAmt").show(),$("#PercentageForAmt").prop("required",!0)):n==="Other user entered amount (may differ every month)"?($("#lblTextInCaseOfVariable").text(""),$("#divPercentageForAmt").hide(),$("#PercentageForAmt").val(""),$("#PercentageForAmt").removeAttr("required")):n==="Number of times"?$("#lblTextInCaseOfVariable").text("ex: 1, 1.5"):n===""&&$("#lblTextInCaseOfVariable").text("")});t=new Date;r=new Date(t.getFullYear(),t.getMonth(),t.getDate());$("#payItemStartDate").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&AddOrMinusDayFromDate(new Date(n.date.valueOf()),"payItemEndDate",!0,1,"setStartDate")});$("#payItemEndDate").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&AddOrMinusDayFromDate(new Date(n.date.valueOf()),"payItemStartDate",!1,1,"setEndDate")});$("#linkAddPayItem").click(function(t){t.preventDefault();$("#PayItemDesc").prop("disabled",!1);$("#AddPayItem").modal();n.PayItemClearFields()});$("#linkDeletePayItem").click(function(t){var i;if(t.preventDefault(),i=$("#companyPayItemsGrid tbody").find("input:checked").length,i<=0){ShowAlertBox("Please select pay item(s) to delete");return}var r=!0,u=0,f=ShowConfirmationAlertBox("If you delete these pay item(s) then corresponding employee pay items will be deleted.<br>Are you sure about deleting selected pay item(s)?");f.then(function(){$("#companyPayItemsGrid").find("input:checked").each(function(){this.id!="header-chk"&&(r=n.deletePayItem(this.id),r&&(u++,RemoveItemFromGrid("companyPayItemsGrid",this.id)))});i===u?ShowAlertBox("Pay item(s) deleted successfully"):ShowAlertBox("Error while deleting pay item(s)")})});$("#chkIsInterbankGIRO").change(function(){CheckInterbankGIROSetup()});$("#btnSaveBankInfo").click(function(t){var i,r;if(t.preventDefault(),$("#GIROSetup").validator(),i={BankName:$("#ddlBankName").find(":selected").val().trim(),BranchCode:$("#txtBranchCode").val().trim(),AccountNumber:$("#txtAccountNumber").val().trim(),AccountName:$("#txtAccountName").val().trim()},i.BankName===""||i.BranchCode===""||i.AccountNumber===""||i.AccountName===""){ShowAlertBox("Please fill the required fields!");return}if(!/^[0-9]*$/.test(i.AccountNumber)){ShowAlertBox("Please fill valid account number!");return}var f=!1,u=$("#GIROBankDetailsGrid").data("kendoGrid").dataSource.data(),e=u.length;for(r=0;r<e;r++)if(u[r].bankName==i.BankName&&u[r].branchCode==i.BranchCode&&u[r].accountNumber==i.AccountNumber){f=!0;$("#txtBranchCode, #txtAccountNumber, #txtAccountName").val("");$("#ddlBankName").val($("#ddlBankName option:first").val());break}f?ShowAlertBox("GIRO Bank details are already added"):n.SaveGIROBankDetails(i)});$("#btnAddMoreCSNs").click(function(t){var i,r;if(t.preventDefault(),i={CSN:$("#txtCSNNumber").val().trim().replace(/\_/g,"")},i.CSN===""){ShowAlertBox("CPF Submission Number should not be empty!");return}var u=!1,f=$("#CSNNumberGrid").data("kendoGrid").dataSource.data(),e=f.length;for(r=0;r<e;r++)if(f[r].csn==i.CSN){u=!0;$("#txtCSNNumber").val("");break}u?ShowAlertBox("CPF Submission Number is already added"):n.SaveCSNNumber(i)});$("#btnClear").click(function(t){t.preventDefault();n.ClearFields()});$("#AddPayItem").on("hidden.bs.modal",function(){$(this).find("#frmCompanyPayItems .has-error.has-danger").removeClass("has-error has-danger");$("#frmCompanyPayItems #btnSaveCompanyPayItem.disabled").removeClass("disabled")})};CompanyPayrollView.prototype.SetPasswordStructureVisibility=function(n){n?($("#lblPasswordStructure").show(),$("#ddlPasswordStructure").show()):($("#lblPasswordStructure").hide(),$("#ddlPasswordStructure").hide())};CompanyPayrollView.prototype.SetTypeOfWageCompany=function(){var n=$("#ddlCPFApplicable").find("option:selected").val();n==="No"?(($('#ddlTypeOfWage option[value="Not Applicable"]').val()!=undefined||$('#ddlTypeOfWage option[value="Not Applicable"]').val()!="")&&$("#ddlTypeOfWage").append('<option value="Not Applicable">Not Applicable<\/option>'),$("#ddlTypeOfWage").val("Not Applicable"),$("#ddlTypeOfWage").prop("disabled",!0)):($("#ddlTypeOfWage option[value='Not Applicable']").remove(),$("#ddlTypeOfWage").prop("disabled",!1))};CompanyPayrollView.prototype.OvertimePayItemCategory=function(){var n=this;$("#ddlTypeOfWage").prop("disabled",!1);$("#ddlCPFApplicable").prop("disabled",!1);$("#ddlIR8ACategory").prop("disabled",!1);$("#rdnVariable").prop("checked",!0);n.PayItemAmountSelection("variable");$("#rdnFixed").prop("disabled",!0);$("#rdnVariable").prop("disabled",!0);ShowHideDropDownOption("ddlVariableAmountBasedOn","Number of times",!1);$("#ddlVariableAmountBasedOn").val("Number of times");$("#ddlVariableAmountBasedOn").prop("disabled",!0);$("#lblTextInCaseOfVariable").text("ex: 1, 1.5");$("#txtFixedAmount").removeAttr("required");$("#ddlVariableAmountBasedOn").removeAttr("required");$("#PercentageForAmt").prop("required",!0);$("#divPercentageForAmt").css("display")=="none"&&$("#divPercentageForAmt").css("display","block")};CompanyPayrollView.prototype.ReimbursementPayItemCategory=function(){$("#ddlCPFApplicable").val("No");$("#ddlCPFApplicable").prop("disabled",!0);$("#ddlTypeOfWage").val("Not Applicable");$("#ddlTypeOfWage").prop("disabled",!0);$("#ddlIR8ACategory").val("Not Applicable");$("#ddlIR8ACategory").prop("disabled",!0);$("#rdnFixed").prop("disabled",!1);$("#rdnVariable").prop("disabled",!1);$("#ddlVariableAmountBasedOn option:selected").val()=="Number of times"&&$("#ddlVariableAmountBasedOn").val("Select");$("#ddlVariableAmountBasedOn").prop("disabled",!1);ShowHideDropDownOption("ddlVariableAmountBasedOn","Number of times",!0);$("#lblTextInCaseOfVariable").text("");$("input[name$='rdnPayItemAmount']:checked").val()=="variable"&&($("#ddlVariableAmountBasedOn").prop("required",!0),$("#txtFixedAmount").removeAttr("required"))};CompanyPayrollView.prototype.OtherPayItemCategory=function(){$("#ddlTypeOfWage").prop("disabled",!1);$("#ddlCPFApplicable").prop("disabled",!1);$("#ddlIR8ACategory").prop("disabled",!1);$("#rdnFixed").prop("disabled",!1);$("#rdnVariable").prop("disabled",!1);$("#ddlVariableAmountBasedOn option:selected").val()=="Number of times"&&$("#ddlVariableAmountBasedOn").val("Select");$("#ddlVariableAmountBasedOn").prop("disabled",!1);ShowHideDropDownOption("ddlVariableAmountBasedOn","Number of times",!0);$("#lblTextInCaseOfVariable").text("");$("input[name$='rdnPayItemAmount']:checked").val()=="variable"&&($("#ddlVariableAmountBasedOn").prop("required",!0),$("#txtFixedAmount").removeAttr("required"))};CompanyPayrollView.prototype.remove_node=function(n){$(".removeclass"+n).remove()};CompanyPayrollView.prototype.PayItemAmountSelection=function(n){n==="variable"?($("#ddlVariableAmountBasedOn").show(),$("#txtFixedAmount").removeAttr("required"),$("#txtFixedAmount").val(""),$("#divPercentageForAmt").show(),$("#txtFixedAmount").hide(),$("#ddlVariableAmountBasedOn").change(),$("#ddlVariableAmountBasedOn").prop("required",!0),$("#PercentageForAmt").prop("required",!0),$("#rdnProrateNo, #rdnProrateYes").prop("checked",!1).prop("disabled",!0)):($("#txtFixedAmount").show(),$("#ddlVariableAmountBasedOn").hide(),$("#txtFixedAmount").prop("required",!0),$("#ddlVariableAmountBasedOn").removeAttr("required"),$("#divPercentageForAmt").hide(),$("#PercentageForAmt").val(""),$("#PercentageForAmt").removeAttr("required"),$("#rdnProrateNo").prop("checked",!0).prop("disabled",!1),$("#rdnProrateYes").prop("disabled",!1))};CompanyPayrollView.prototype.InterbankGIROSetup=function(){$("#chkIsInterbankGIRO").is(":checked")?$("#ddlBankName, #txtBranchCode, #txtAccountNumber, #txtAccountName, #btnSaveBankInfo").prop("disabled",!1):$("#ddlBankName, #txtBranchCode, #txtAccountNumber, #txtAccountName, #btnSaveBankInfo").prop("disabled",!0)};CompanyPayrollView.prototype.SaveCompanyPayItem=function(n){var t=!1;return $.ajax({url:baseURL+"Company/CompanyPayItems",data:{companyPayItems:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CompanyPayrollView.prototype.SaveGIROBankDetails=function(n){var t=$.post(baseURL+"Company/SaveGIROBankDetails",n),i=$("#GIROBankDetailsGrid");t.done(function(){refreshGrid(i);ShowAlertBox("GIRO Bank details added successfully");$("#ddlBankName, #txtBranchCode, #txtAccountNumber, #txtAccountName").val("")});t.fail(function(){ShowAlertBox("Failed to add GIRO bank details")})};CompanyPayrollView.prototype.LoadGIROBankDetailGrid=function(){var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Company/LoadCompanyGIROBankDetails",dataType:"json"},update:{url:baseURL+"Company/UpdateGIROBankDetails",dataType:"json"},destroy:{url:baseURL+"Company/DeleteGIROBankDetails",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{CompanyGIROBankDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:2,schema:{model:{id:"giroId",fields:{giroId:{editable:!1},bankName:{editable:!1},branchCode:{editable:!0,validation:{required:!0}},accountName:{editable:!0,validation:{required:!0}},accountNumber:{editable:!0,validation:{required:!0,maxlength:25,accNumberValidation:function(n){return n.is("[name='accountNumber']")&&n.val()!=""?(n.attr("data-accNumberValidation-msg","Please enter valid account number."),/^[0-9]*?$/.test(n.val())):!0}}}}}}});$("#GIROBankDetailsGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"bankName",title:"Bank Name",width:"200px"},{field:"branchCode",title:"Branch Code",width:"140px"},{field:"accountName",title:"Account Name",width:"180px"},{field:"accountNumber",title:"Account Number",width:"140px"},{command:[{name:"edit",text:{edit:" ",update:" ",cancel:" "}},{name:"destroy",text:" "}],title:"&nbsp;",width:"100px"}],editable:"inline",edit:onGridDataBound,dataBound:onGridDataBound,cancel:onGridDataBound})};CompanyPayrollView.prototype.SaveCSNNumber=function(n){var t=$.post(baseURL+"Company/SaveCSNDetails",n),i=$("#CSNNumberGrid");t.done(function(){refreshGrid(i);ShowAlertBox("CPF submission number added!");$("#txtCSNNumber").val("")});t.fail(function(){ShowAlertBox("CPF submission number fail to add!")})};CompanyPayrollView.prototype.LoadCSNNumberGrid=function(){function n(){if(setTimeout(function(){$("#CSNNumberGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit CSN number");$("#CSNNumberGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#CSNNumberGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update CSN number");$("#CSNNumberGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-checkbox-label").removeClass("k-checkbox-label").addClass("checkbox");$("#CSNNumberGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete CSN number");$(".k-i-close").removeClass("k-icon k-i-close");KGrdPageSizeDdlPosition("CSNNumberGrid",1)},1),this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Company/LoadCompanyCSNDetails",dataType:"json"},update:{url:baseURL+"Company/UpdateCSNDetails",dataType:"json"},destroy:{url:baseURL+"Company/DeleteCSNDetails",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{CompanyCSNDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:2,schema:{model:{id:"csnId",fields:{csnId:{editable:!1},csn:{editable:!0,validation:{required:!0,maxlength:17,csnValidation:function(n){return n.is("[name='csn']")&&n.val()!=""?(n.attr("data-csnValidation-msg","Please enter valid csn number."),/^\S*$/.test(n.val())):!0}},nullable:!1}}}}});$("#CSNNumberGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(!1),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"csn",title:"CSN Number",width:"200px",editor:function(n,t){var i;i=$("<input id='txtCSNNumber' class='k-input k-textbox kendo-maskedCntl' placeholder='XXXXXXXXXX-XXX-XX' value='"+t.model.csn+"' data-bind='value:"+t.field+"' />").appendTo(n);$(i).kendoMaskedTextBox({mask:"AAAAAAAAAA-AAA-AA"})}},{command:[{name:"edit",text:{edit:"",update:"",cancel:""}},{name:"destroy",text:""}],title:"&nbsp;",width:"100px"}],editable:"inline",edit:n,dataBound:n,cancel:n})};CompanyPayrollView.prototype.LoadCompanyPayItemsGrid=function(){function t(){setTimeout(function(){$("#companyPayItemsGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("companyPayItemsGrid")});KGrdPageSizeDdlPosition("companyPayItemsGrid",1)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Company/CompanyPayItems",dataType:"json"}},pageSize:5,batch:!0,schema:{model:{id:"companyPayItemId",fields:{companyPayItemId:{editable:!1},description:{editable:!1},type:{editable:!1},category:{editable:!1},typeOfWage:{editable:!1},cpfApplicable:{editable:!1},iR8ACategory:{editable:!1},frequency:{editable:!1},amount:{editable:!1},currencySymbol:{editable:!1},currency:{editable:!1}}}}});$("#companyPayItemsGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.companyPayItemId#" class="chk-box"><label class="checkbox-inline" for="#:data.companyPayItemId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:50},{field:"description",title:"Pay Item Description",width:200},{field:"type",hidden:!0},{field:"category",title:"Pay Item Category"},{field:"cpfApplicable",title:"CPF Applicable"},{field:"typeOfWage",title:"Type of Wage"},{field:"iR8ACategory",title:"IR8A Code"},{field:"frequency",title:"Frequency",width:120},{field:"amount",title:"Amount",headerTemplate:'<span id="lblHeaderAmt"><\/span>',template:function(n){if($("#companyPayItemsGrid").find("#lblHeaderAmt").html()==""){var t=n.currency===null?"":n.currency;$("#companyPayItemsGrid").find("#lblHeaderAmt").html("Amount ("+t+")")}return formatAmountWithCurrency(n.amount,n.currency,n.currencySymbol)},width:100},{template:'<a href="javascript: openPayItemModal(#=companyPayItemId#);"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Company pay item" /><\/a>',width:50},{template:'<a href="javascript: deletePayItem(#=companyPayItemId#);"><img src="'+baseURL+'images/delete.png" class="img-responsive" title="Delete Company pay item" /><\/a>',width:50}],dataBound:t,dataBinding:function(){$("#companyPayItemsGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#companyPayItemsGrid tbody input:checkbox").prop("checked",this.checked)})};CompanyPayrollView.prototype.ClearFields=function(){$("#ddlPayDay").val("");$("#ddlNextPayDay").val("");$("#ddlPayrollProcessYear").val("");$("#ddlPayrollProcessMonth").val("");$("#ddlWorkWeek").val("");$("#txtDefaultWorkHours").val("");$("#ddlPayslipEmailDay").val("");$("#chkMon").removeAttr("checked");$("#chkTue").removeAttr("checked");$("#chkWed").removeAttr("checked");$("#chkThu").removeAttr("checked");$("#chkFri").removeAttr("checked");$("#chkSat").removeAttr("checked");$("#chkSun").removeAttr("checked");$("#chkPassProtectedPayslips").removeAttr("checked");this.SetPasswordStructureVisibility($("#chkPassProtectedPayslips").is(":checked"))};CompanyPayrollView.prototype.PayItemClearFields=function(){var t=this,n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate());t.OtherPayItemCategory();$("#CompanyPayItemId").val("");$("#PayItemDesc").val("");$("#ddlPayItemCategory").val("");$("#ddlTypeOfWage").val("");$("#ddlCPFApplicable").val("");$("#ddlIR8ACategory").val("");$("#chkIsUniversalPayItem").removeAttr("checked");$("#rdnFixed").prop("checked",!0);t.PayItemAmountSelection("fixed");$("#ddlVariableAmountBasedOn").val("");$("#ddlVariableAmountBasedOn").removeAttr("required");$("#txtFixedAmount").val("");$("#PercentageForAmt").val("");$("#payItemStartDate").datepicker("setDate",i);$("#payItemStartDate").datepicker("setEndDate","");$("#ddlPayItemEndDate").val("");$("#payItemEndDate").hide();$("#txtRepeatForTimes").hide();$("#endDate").removeAttr("required");$("#txtRepeatForTimes").removeAttr("required");$("#payItemEndDate").datepicker("setDate",i);$("#txtRepeatForTimes").val("")};CompanyPayrollView.prototype.deletePayItem=function(n){var t=!1;return $.ajax({url:baseURL+"Company/DeleteCompanyPayItem",data:{companyPayItemId:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CompanyTimesheetView.prototype.Init=function(){var n=this,t=new Date;$("#ddlFilterByYear").val(t.getFullYear());ValidateAndScrollToEmptyField();this.LoadCompanyLeavesGrid();this.IsAllowToDownloadPayrollTimesheetFormat();this.IsCasualTypeSelected();this.SetLYCFAllowedFields($("#chkIsLYCFAllowed").is(":checked"));$("#ddlIntigrateWithBioMatric").change(function(){n.IsAllowToDownloadPayrollTimesheetFormat()});$("#ddlTimesheetType").change(function(){n.IsCasualTypeSelected()});$("#btnClear").click(function(t){t.preventDefault();n.ClearFields()});$("#ddlLeaveType").change(function(){n.SetDayOrWeek()});$("#chkIncludeLeave").prop("checked",!0);$("#ddlLeaveYear").prop("disabled",!1);$("#ddlLeaveType").prop("disabled",!1);$("#chkIsLYCFAllowed").change(function(){n.SetLYCFAllowedFields($(this).is(":checked"))});$("#ddlFilterByYear").change(function(){var n=$("#ddlFilterByYear").find(":selected").val();doApplyGridFilter("CompanyLeavesGrid","eq","year",n==""?0:n)});$("#linkLeaveAllowed").click(function(t){t.preventDefault();$("#AddLeaveAllowed").modal();n.ClearCompanyLeavesAllowedFields()});$("#frmAddCompanyLeaves").submit(function(t){var a,v,e,y,o,k,f;t.preventDefault();var p=$("#ddlLeaveType").find("option:selected").val(),w=$("#ddlLeaveCategory").find("option:selected").val(),s=$("#ddlLeaveYear").find("option:selected").val(),i=$("#txtLeaveAllowed").val(),h=$("#ddlLeaveAccrualType").val(),d=$("#chkIncludeLeave").is(":checked"),c=$("#hdnLeaveId").val(),b=$("#chkIsLYCFAllowed").is(":checked"),r=$("#txtNoOfDaysLYCFAllowed").val(),u=$("#txtLYCFLapseDay").val(),l=$("#ddlLYCFLapseMonth").find("option:selected").val();if($.isNumeric(i)&&(u=isNaN(parseInt(u))?0:parseInt(u),i=isNaN(parseFloat(i))?0:parseFloat(i),p!=""&&w!=""&&s!=""&&h!=""&&$.isNumeric(i)&&ValidateLeavePattern(i))){if(i<=0){ShowAlertBox("Leave allowed days should be greater than 0.");return}if(b){if(!$.isNumeric(r))return;if(r=isNaN(parseFloat(r))?0:parseFloat(r),u<=0||l==""||!$.isNumeric(r)||!ValidateLeavePattern(r)||!$.isNumeric(u))return;if(r<=0){ShowAlertBox("LYCF allowed days should be greater than 0.");return}if(a=i,h.toLowerCase()=="monthly"&&(a=12*i),r>a){ShowAlertBox("'LYCF Allowed' days should be less than or equal to 'Leave Allowed' days.");return}if(v=daysInMonth(l,s),u>v){ShowAlertBox("LYCF lapse day should be less than or equal to "+v);return}}if(e={LeaveType:p,LeaveCategory:w,Year:s,LeavesAllowed:i,Include:d,IsLYCFAllowed:b,NoOfDaysLYCFAllowed:r,LYCFLapseDay:u,LYCFLapseMonth:l,LeaveId:c,AccrualType:h},y=!1,c==""||c==0)for(o=$("#CompanyLeavesGrid").data("kendoGrid").dataSource.data(),k=o.length,f=0;f<k;f++)if(o[f].year==e.Year&&o[f].leaveType==e.LeaveType){y=!0;break}y?ShowAlertBox("Leave type is already added for the year"):n.AssignCompanyLeaveItem(e)}});$("#linkDeleteCompanyLeave").click(function(t){var r;if(t.preventDefault(),r=$("#CompanyLeavesGrid tbody").find("input[type='checkbox']:checked").length,r<=0){ShowAlertBox("Please select leave type(s) to delete");return}var u=!0,i=[],f=ShowConfirmationAlertBox("Are you sure about deleting selected leave type(s)?");f.then(function(){$("#CompanyLeavesGrid tbody").find("input[type='checkbox']:checked").each(function(){var t=$("#CompanyLeavesGrid").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.isUsed?i.push(t.leaveType+" - Leave type is added for some employee(s), can't delete now."):(u=n.DeleteCompanyLeave(this.id),u?(i.push(t.leaveType+" - Leave type deleted successfully"),RemoveItemFromGrid("CompanyLeavesGrid",this.id)):i.push(t.leaveType+" - Leave type deleted successfully")))});ShowSummaryBox("Bulk Delete Summary",i)})});$("#AddLeaveAllowed").on("hidden.bs.modal",function(){$(this).find("input[type='text'],textarea,select").val("").end().find("input[type=checkbox], input[type=radio]").prop("checked","").end();$(this).find("#frmAddCompanyLeaves .has-error.has-danger").removeClass("has-error has-danger");CompanyTimesheetView.prototype.SetLYCFAllowedFields($("#chkIsLYCFAllowed").is(":checked"));$("#hdnLeaveId").val(0);$("#chkIncludeLeave").prop("checked",!0);$("#ddlLeaveYear").prop("disabled",!1);$("#ddlLeaveType").prop("disabled",!1);$("#btnSaveleaveAllowed").addClass("disabled")});$("#ddlTimesheetRequired").find("option:selected").val()=="No"&&($("#ddlTimesheetType, #ddlIntigrateWithBioMatric, #ddlNoOfInOut").val(""),$("#ddlTimesheetType, #ddlIntigrateWithBioMatric, #ddlNoOfInOut").prop("disabled",!0),$("#ddlTimesheetType, #ddlIntigrateWithBioMatric, #ddlNoOfInOut").prop("required",!1));$("#ddlTimesheetRequired").change(function(){var n=this.value=="Yes"?!1:!0;$("#ddlTimesheetType, #ddlIntigrateWithBioMatric").val("");$("#ddlTimesheetType").prop("disabled",n);$("#ddlIntigrateWithBioMatric").prop("disabled",n);n?$("#ddlNoOfInOut").prop("disabled",n):$("#ddlTimesheetType").find("option:selected").val()=="Multiple In & Out"&&$("#ddlNoOfInOut").prop("disabled",!1);this.value=="No"?($("#ddlNoOfInOut").val(""),$("#ddlTimesheetType, #ddlIntigrateWithBioMatric, #ddlNoOfInOut").prop("required",!1).closest(".form-group").removeClass("has-error has-danger")):$("#ddlTimesheetType, #ddlIntigrateWithBioMatric").prop("required",!0)})};CompanyTimesheetView.prototype.SetDayOrWeek=function(){var n=$("#ddlLeaveType option:selected");n.length>0&&n.val()!=""?(n.attr("attr-IsMaternity")=="True"?($("#ddlLeaveInDaysOrWeeks").val("Weeks"),$("#chkIsLYCFAllowed").prop("disabled",!0)):($("#ddlLeaveInDaysOrWeeks").val("Days"),$("#chkIsLYCFAllowed").prop("disabled",!1)),n.attr("attr-AccrualType")=="Yearly"?$("#ddlLeaveAccrualType").val("Yearly"):$("#ddlLeaveAccrualType").val("Monthly")):($("#ddlLeaveInDaysOrWeeks").val(""),$("#ddlLeaveAccrualType").val(""),$("#chkIsLYCFAllowed").prop("disabled",!1))};CompanyTimesheetView.prototype.DeleteCompanyLeave=function(n){var t=!1;return $.ajax({url:baseURL+"Company/MarkDeleteCompanyLeave",data:{leaveId:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CompanyTimesheetView.prototype.IsAllowToDownloadPayrollTimesheetFormat=function(){var n=$("#ddlIntigrateWithBioMatric").find(":selected").val();n==="With Current System"||n===""?$("#downloadTimsheetFormat").addClass("disabled"):$("#downloadTimsheetFormat").removeClass("disabled")};CompanyTimesheetView.prototype.IsCasualTypeSelected=function(){var n=$("#ddlTimesheetType").find(":selected").val();n==="Casual"||n===""?($("#ddlNoOfInOut").val(""),$("#ddlNoOfInOut").prop("disabled",!0),$("#ddlNoOfInOut").prop("required",!1)):($("#ddlNoOfInOut").prop("disabled",!1),$("#ddlNoOfInOut").prop("required",!0))};CompanyTimesheetView.prototype.SetLYCFAllowedFields=function(n){n?($("#txtNoOfDaysLYCFAllowed, #txtLYCFLapseDay, #ddlLYCFLapseMonth").prop("disabled",!1),$("#txtNoOfDaysLYCFAllowed, #txtLYCFLapseDay, #ddlLYCFLapseMonth").prop("required",!0)):($("#txtNoOfDaysLYCFAllowed, #txtLYCFLapseDay, #ddlLYCFLapseMonth").val(""),$("#txtNoOfDaysLYCFAllowed, #txtLYCFLapseDay, #ddlLYCFLapseMonth").prop("required",!1),$("#txtNoOfDaysLYCFAllowed, #txtLYCFLapseDay, #ddlLYCFLapseMonth").prop("disabled",!0))};CompanyTimesheetView.prototype.ClearFields=function(){$("#ddlTimesheetRequired").val("");$("#ddlTimesheetType").val("");$("#ddlNoOfInOut").val("");$("#ddlIntigrateWithBioMatric").val("");$("#chkLeaveEncashAllowed").removeAttr("checked");$("#chkLYCFAllowed").removeAttr("checked");$("#hdnLeaveId").val(0);$("#ddlLeaveYear").prop("disabled",!1);$("#ddlLeaveType").prop("disabled",!1)};CompanyTimesheetView.prototype.LoadCompanyLeavesGrid=function(){function t(){if(setTimeout(function(){$("#CompanyLeavesGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Leave Type");$("#CompanyLeavesGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#CompanyLeavesGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Leave Type");$("#CompanyLeavesGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$("#CompanyLeavesGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Leave Type");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");$(".k-checkbox-label").removeClass("k-checkbox-label").addClass("checkbox");$('input[type="radio"]:checked').parent().addClass("btn-info");$("#CompanyLeavesGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("CompanyLeavesGrid")});$("#CompanyLeavesGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("CompanyLeavesGrid")},1),this.dataSource.view().length==0){var t=this.dataSource.page();t>1&&this.dataSource.page(t-1)}}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Company/LoadCompanyLeaves",dataType:"json"},destroy:{url:baseURL+"Company/DeleteCompanyLeave",dataType:"jsonp"},parameterMap:function(n,t){if(t!="read"&&n.models)return{CompanyLeaveDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:20,filter:{field:"year",operator:"equals",value:$("#ddlFilterByYear").val()},schema:{model:{id:"leaveId",fields:{leaveId:{editable:!1},leaveType:{editable:!1},year:{editable:!1},leaveCategory:{editable:!1},periodType:{editable:!1},leavesAllowed:{nullable:!1,editable:!0,type:"number",validation:{required:!0,leavesAllowedValidation:function(n){return n.is("[name='leavesAllowed']")&&n.val()!=""?(n.attr("data-leavesAllowedValidation-msg","Please enter valid leave."),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},isLYCFAllowed:{type:"boolean"},noOfDaysLYCFAllowed:{editable:!1},lycfLapseDay:{editable:!1},lycfLapseMonth:{editable:!1},accrualType:{editable:!1},modifiedOn:{editable:!1,type:"date"},modifiedBy:{editable:!1},include:{type:"boolean"},isUsed:{type:"boolean"}}}}});$("#CompanyLeavesGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.leaveId#" class="chk-box"><label class="checkbox-inline" for="#:data.leaveId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-cleave" class="checkAll"><label class="checkbox-inline" for="header-chk-cleave"><\/label>',width:50},{title:"#",attributes:{"sr-no":"Y"},template:function(){return++n},width:40},{field:"leaveId",title:"#",width:"50px",hidden:!0},{field:"leaveType",title:"Leave Type",width:"160px"},{field:"year",width:"60px",headerTemplate:'<span style="display:block !important">Leave<\/span> <span style="display:block !important">Year<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"leaveCategory",title:"Leave Category",width:"80px",headerTemplate:'<span style="display:block !important">Leave<\/span> <span style="display:block !important">Category<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"periodType",title:"Period Type",width:"55px",headerTemplate:'<span style="display:block !important">Period<\/span> <span style="display:block !important">Type<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"accrualType",title:"Accrual Type",width:"55px",headerTemplate:'<span style="display:block !important">Accrual<\/span> <span style="display:block !important">Type<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"leavesAllowed",title:"Leaves Allowed",width:"80px",headerTemplate:'<span style="display:block !important">Leaves<\/span> <span style="display:block !important">Allowed<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"isLYCFAllowed",title:"LYCF Allowed",width:"60px",template:function(n){return n.isLYCFAllowed?"Yes":"No"},headerTemplate:'<span style="display:block !important">LYCF<\/span> <span style="display:block !important">Allowed<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"noOfDaysLYCFAllowed",title:"LYCF Days",width:"70px",template:function(n){return n.noOfDaysLYCFAllowed>0?n.noOfDaysLYCFAllowed:"-"},headerTemplate:'<span style="display:block !important">LYCF<\/span> <span style="display:block !important">Days<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"lycfLapseDay",title:"Lapse Date",width:"70px",template:function(n){return n.lycfLapseDay>0?n.lycfLapseDay+" - "+n.lycfLapseMonth:"-"},headerTemplate:'<span style="display:block !important">Lapse<\/span> <span style="display:block !important">Date<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"}},{field:"modifiedOn",title:"Last Updated",width:"120px",template:"#if(modifiedOn === null){# #}else{# #=kendo.toString(kendo.parseDate(modifiedOn), 'dd MMM yyyy hh:mm')#  #}#"},{field:"modifiedBy",title:"Updated By",width:"120px"},{field:"include",title:"Included",width:"70px",template:function(n){return n.include?"Yes":"No"}},{template:"<div class='pointer' title='Leave Type' onclick='editLeaveType(\"#:leaveId#\")'><img src='"+baseURL+"images/edit.png' class='img-responsive' /><\/div>",width:"40px"},{template:function(n){return n.isUsed==null||!n.isUsed?'<div class="pointer" title="Delete Leave Type" onclick="deleteCompanyLeaveType(\''+n.leaveId+'\')"><img src="'+baseURL+'images/delete.png" class="img-responsive" /><\/div>':""},width:50}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this);$("#CompanyLeavesGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#CompanyLeavesGrid tbody input:checkbox").prop("checked",this.checked)});$(document).on("change","input[type='radio']",function(){$('input[type="radio"]').parent().removeClass("btn-info");$('input[type="radio"]:checked').parent().addClass("btn-info")})};CompanyTimesheetView.prototype.ClearCompanyLeavesAllowedFields=function(){$("#hdnLeaveId,#ddlLeaveType,#ddlLeaveCategory,#txtLeaveAllowed, #ddlLeaveInDaysOrWeeks, #ddlLeaveAccrualType").val("");$("#chkIsLYCFAllowed").prop("disabled",!1);$("#ddlLeaveYear").val((new Date).getFullYear())};CompanyTimesheetView.prototype.AssignCompanyLeaveItem=function(n){var t=$.post(baseURL+"Company/AssignLeaveItem",n);t.done(function(){$("#AddLeaveAllowed").modal("hide");refreshGrid($("#CompanyLeavesGrid"));n.LeaveId>0?ShowAlertBox("Company leave updated successfully!"):ShowAlertBox("Company leave added successfully!")});t.fail(function(){ShowAlertBox("Fail to save leave item!")})};CompanyEmailSetupView.prototype.Init=function(){var n=this,t;$("#password").val($("#hdnCurrentPassword").val());$("#smtpServer").val($("#hdnSMTPServer").val());$("#smtpPort").val($("#hdnSMTPPort").val());$("#ddlAlertType").closest("div.form-group").removeClass("hidden");$("#ddlAlertType").multiselect({buttonWidth:"100%",maxHeight:300,numberDisplayed:1,includeSelectAllOption:!0,buttonClass:"form-control classicSelect multiselect-font-size"});$("#ddlAlertType").attr("attr-selectedVal")!=undefined&&(t=$("#ddlAlertType").attr("attr-selectedVal").split(","),$("#ddlAlertType").val(t),$("#ddlAlertType").multiselect("refresh"));this.SetExpenseThroughVisibility($("#chkExpenseReminderAllowed").is(":checked"));this.SetRequiredMedicalCertificateMinimumDays($("#chkMCReqForMedicalLeave").is(":checked"));this.SetReminderFrequencyVisibility();ValidateAndScrollToEmptyField();$("#emailTemplateEditor").kendoEditor({resizable:{content:!0},imageBrowser:{messages:{dropFilesHere:"Drop files here"},transport:{read:{url:baseURL+"ImageBrowser/Read",dataType:"json"},destroy:{url:baseURL+"ImageBrowser/Destroy",type:"POST"},uploadUrl:baseURL+"ImageBrowser/Upload",imageUrl:window.location.origin+baseURL+"ImageBrowser/Image?path={0}"}},tools:["formatting","bold","italic","underline","strikethrough","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","foreColor","backColor","subscript","superscript","tableWizard","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","cleanFormatting","fontName","fontSize"]});$("#chkExpenseReminderAllowed").change(function(){n.SetExpenseThroughVisibility($(this).is(":checked"))});$("#chkMCReqForMedicalLeave").change(function(){n.SetRequiredMedicalCertificateMinimumDays($(this).is(":checked"))});$("#ddlExpenseReminder").change(function(){n.SetReminderFrequencyVisibility()});$("#ddlFilterByTemplate").change(function(t){t.preventDefault();var u=$(this).find("option:selected").text(),i=$(this).val(),r={operationId:i};n.GetEmailTemplate(r)});$("#frmUpdateEmailTemplate").submit(function(t){var f;t.preventDefault();var i=$("#ddlFilterByTemplate").val(),r=$("#subject").val(),u=$("#emailTemplateEditor").data("kendoEditor").value();i!==""&&r!==""&&u!==""&&(f={operationId:i,subjectTemplate:r,contentTemplate:u},n.SaveEmailTemplate(f))});this.HideDdlOption();$("#chkIsReqFinanceApprover").change(function(){n.HideDdlOption()});($("#AppSettingsId").val()==null||$("#AppSettingsId").val()==0)&&($('#ddlFirstSupervisor option[value="1"]').attr("selected",!0),$('#ddlSecondSupervisor option[value="2"]').attr("selected",!0));$("#btnClear").click(function(t){t.preventDefault();n.ClearFields()});$("ul.k-editor-toolbar li").on("click",function(){$("div.k-animation-container").css("top",$(this).offset().top+$(this).height()+3)})};CompanyEmailSetupView.prototype.HideDdlOption=function(){$("#chkIsReqFinanceApprover").is(":checked")?(ShowHideDropDownOption("ddlFirstSupervisor","3",!1),ShowHideDropDownOption("ddlSecondSupervisor","3",!1)):(ShowHideDropDownOption("ddlFirstSupervisor","3",!0),ShowHideDropDownOption("ddlSecondSupervisor","3",!0))};CompanyEmailSetupView.prototype.ClearFields=function(){$("#smtpServer, #userName,#smtpPort, #password,#txtLeaveAlertCCEmail, #txtPayrollAlertCCEmail, #txtClaimAlertCCEmail, #FirstReminderon, #SecondReminderon, #ddlFirstSupervisor, #ddlSecondSupervisor, #ddlCertificateNotReqForDays").val("");$("#ddlAlertType").val("");$("#ddlAlertType").multiselect("refresh");$("#leaveFromEmailAddress, #payslipFromEmailAddress").val("");$("#chkExpenseReminderAllowed, #chkIsReqFinanceApprover, #chkMCReqForMedicalLeave, #chkIncludeLeaveSummaryInPayslip, #chkIncludeYTDSummaryInPayslip, #chkIncludeOvertimeInPayslip, #chkIncludePaymentDateInPayslip,chkIncludeOvertimePeriodInPayslip").removeAttr("checked");$("#ddlExpenseReminder").val("");CompanyEmailSetupView.prototype.SetExpenseThroughVisibility(!1)};CompanyEmailSetupView.prototype.SetExpenseThroughVisibility=function(n){n?($("#ddlExpenseReminder").prop("disabled",!1),$("#ddlExpenseReminder").prop("required",!0)):($("#FirstReminderon").prop("readonly",!0),$("#SecondReminderon").prop("readonly",!0),$("#ddlExpenseReminder").prop("disabled",!0),$("#ddlExpenseReminder").prop("required",!1),$("#FirstReminderon").prop("required",!1),$("#SecondReminderon").prop("required",!1));n||($("#ddlExpenseReminder").val(""),$("#FirstReminderon").val(""),$("#SecondReminderon").val(""))};CompanyEmailSetupView.prototype.SetRequiredMedicalCertificateMinimumDays=function(n){n?($("#ddlCertificateNotReqForDays").prop("disabled",!1),$("#ddlCertificateNotReqForDays").prop("required",!0)):($("#ddlCertificateNotReqForDays").prop("disabled",!0),$("#ddlCertificateNotReqForDays").prop("required",!1));n||$("#ddlCertificateNotReqForDays").val("")};CompanyEmailSetupView.prototype.SetReminderFrequencyVisibility=function(){var n=$("#ddlExpenseReminder").find(":selected").val();n==""?($("#FirstReminderon").prop("readonly",!0),$("#SecondReminderon").prop("readonly",!0),$("#FirstReminderon").prop("required",!1),$("#SecondReminderon").prop("required",!1),$("#FirstReminderon").val(""),$("#SecondReminderon").val("")):n==1?($("#FirstReminderon").prop("readonly",!1),$("#FirstReminderon").prop("required",!0),$("#SecondReminderon").prop("required",!1),$("#SecondReminderon").prop("readonly",!0),$("#SecondReminderon").val("")):($("#SecondReminderon").prop("readonly",!1),$("#FirstReminderon").prop("readonly",!1),$("#SecondReminderon").prop("required",!0),$("#FirstReminderon").prop("required",!0))};CompanyEmailSetupView.prototype.GetEmailTemplate=function(n){var t=$.get(baseURL+"Company/EmailTemplate",n);t.done(function(n){var t=$("#emailTemplateEditor").data("kendoEditor");t.value(n.contentTemplate);$("#subject").val(n.subjectTemplate)});t.fail(function(){ShowAlertBox("Error while fetching email template")})};CompanyEmailSetupView.prototype.SaveEmailTemplate=function(n){var t=$.post(baseURL+"Company/SaveEmailTemplate",n);t.done(function(){ShowAlertBox("Email template updated successfully")});t.fail(function(){ShowAlertBox("Failed to update the template")})};ManageEmployeeView.prototype.Init=function(){var n=this,i,t;$("#ddlFilterByStatus").multiselect({buttonWidth:"100%",maxHeight:400,numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size",onDropdownHide:function(){n.FilterEmployeeListGrid()}});i=",Probation,Confirmed";$("#ddlFilterByStatus").val(i.split(","));$("#ddlFilterByStatus").multiselect("refresh");window.onunload=function(){};this.LoadEmployeeHeadcounts();this.LoadEmployeeListGird(this);this.SearchResultByEmployeeNameOrNIRC();$("#fileUploadEmpSheet").change(function(){$("#fileUploadEmpSheet").val()!=null&&$("#fileUploadEmpSheet").val()!=""&&n.GetExcelEmployees()});$('#ddlFilterByDepartment option[value=""], #ddlFilterByPassType option[value=""]').attr("selected",!0);$("#ddlFilterByDepartment, #ddlFilterByPassType").change(function(){var n=this.value,t=this.id=="ddlFilterByDepartment"?"department":"passType";DoApplyNestedKGridFilter("EmployeeListGird","eq",t,n.length==0?0:n,"and","or",!1)});$("#btnResetAndSendPassword").click(function(t){var f;if(t.preventDefault(),f=$("#EmployeeListGird tbody").find("input:checked").length,f<=0){ShowAlertBox("Please select employee(s) to send temporary password");return}var i="",u="",o=[],r="";$("#EmployeeListGird tbody").find("input:checked").each(function(){i=i==""?this.id:i+","+this.id;var n=$("#EmployeeListGird").data("kendoGrid").dataSource.get(this.id);n.isActiveUser||(u=u==""?n.employeeId:u+","+n.employeeId,o.push(n.employeeCode+": "+n.employeeName),r==""?r='{"'+this.id+'":'+this.id:r+=', "'+this.id+'":'+this.id)});var s=[],e=[],h=GetEmployeesWithInvalidField(i,"Email");h.length>0?($.each(h,function(n,t){s.push(t.name)}),ShowSummaryBox("Employee(s) Do Not Have Valid Email Address, Either Update or Skip Them To Continue",s)):u!=""?(r!=""&&(r=r+"}",e.push(JSON.parse(r))),ShowKendoDialogConfirmation("DivConfirmKDialog","<span class='flexCenter dialoTitle'>You are about to reinstate below Employee(s) User access.<\/span><span class='flexCenter dialoTitle'>Are you sure you want to proceed?<\/span>",o,"Reinstate user and send the password","Do not reinstate. Just send the password for active users"),$("button#confirmYesBtn").click(function(){n.ReinstateUserAndSendPassword(f,i,!1,e,u)}),$("button#confirmNoBtn").click(function(){n.ReinstateUserAndSendPassword(f-Object.keys(e[0]).length,i,!0,e,u)})):n.ReinstateUserAndSendPassword(f,i)});$("#btnDeleteEmployees").click(function(t){var r;if(t.preventDefault(),r=$("#EmployeeListGird tbody").find("input:checked").length,r<=0){ShowAlertBox("Please select employee(s) to delete");return}var u=!0,i=[],f=ShowConfirmationAlertBox("Do you want to delete selected employee(s)?");f.then(function(){$("#EmployeeListGird tbody").find("input:checked").each(function(){var t=$("#EmployeeListGird").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.lastPayrollMonth==null||t.lastPayrollMonth==""?(u=n.DeleteEmployee(this.id),u?(i.push(t.employeeCode+" - Employee deleted successfully"),RemoveItemFromGrid("EmployeeListGird",this.id)):i.push(t.employeeCode+" - Error while deleting employee")):i.push(t.employeeCode+" - Payroll processed employee can not be deleted"))});ShowSummaryBox("Bulk Delete Summary",i)})});$("#txtEmployeeName").keypress(function(n){if(n.keyCode==13)return!1});t=0;$("#lnkExportEmployeeAll").click(function(n){t==0?t=1:n.preventDefault()});$("#lnkExportEmployeeAll,#lnkExportEmployeeFilter").hover(function(){t=0});$("#lnkExportEmployeeFilter").click(function(n){if(t==0){t=1;var r=$("#txtEmployeeName").val(),u=$("#ddlFilterByDepartment").val(),f=$("#ddlFilterByStatus").val(),e=$("#ddlFilterByPassType").val(),o=baseURL+"Employee/DownloadEmployeeInfo?",i="?";r!=undefined&&r!=""&&(i=i+"eName="+r+"&");u!=undefined&&u!=""&&(i=i+"eDept="+u+"&");f!=undefined&&f!=""&&(i=i+"eStatus="+f+"&");e!=undefined&&e!=""&&(i=i+"ePassType="+e);window.location.href=i=="?"?baseURL+"Employee/DownloadEmployeeInfo":baseURL+"Employee/DownloadEmployeeInfo"+i}n.preventDefault()})};ManageEmployeeView.prototype.ReinstateUser=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Employee/ReinstateUser",data:{empIds:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};ManageEmployeeView.prototype.ReinstateUserAndSendPassword=function(n,t,i,r,u){var f=!1,e;if(i!=undefined&&!i&&u!=undefined&&u!=""&&(f=ManageEmployeeView.prototype.ReinstateUser(u),!f))return ShowAlertBox("Error while reinstate employee user"),!1;if(n==0)return!0;if(i==undefined){e=ShowConfirmationAlertBox("Are you sure you want to reset the password for selected employee(s)?");$("button.alertMsgBtn[ok-btn='Y']").on("mousedown",function(n){n.button==0&&kendo.ui.progress($("div[aria-describedby='DivConfirmationOkCancel']"),!0);setTimeout(function(){$("button.alertMsgBtn[ok-btn='Y']").trigger("click")},0)});e.then(function(){ManageEmployeeView.prototype.SendPasswordBasedOnInactiveList(n,i,r)})}else ManageEmployeeView.prototype.SendPasswordBasedOnInactiveList(n,i,r)};ManageEmployeeView.prototype.SendPasswordBasedOnInactiveList=function(n,t,i){var r=!0,u=0;$("#EmployeeListGird tbody").find("input:checked").each(function(){t!=undefined&&t?t==!0&&i[0][this.id]==undefined&&(r=ManageEmployeeView.prototype.ResetAndSendPassword(this.id),r&&u++):(r=ManageEmployeeView.prototype.ResetAndSendPassword(this.id),r&&u++)});t==undefined&&kendo.ui.progress($("div[aria-describedby='DivConfirmationOkCancel']"),!1);n===u?ShowAlertBox("Password reset and sent successfully"):ShowAlertBox("Error while reset password");refreshGrid($("#EmployeeListGird"))};ManageEmployeeView.prototype.FilterEmployeeListGrid=function(){var n=$("#ddlFilterByStatus").val();n!=null?DoApplyNestedKGridFilter("EmployeeListGird","eq","status",n.length==0?0:n,"and","or",!0):DoApplyNestedKGridFilter("EmployeeListGird","eq","status",[],"and","or",!0)};ManageEmployeeView.prototype.ResetAndSendPassword=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Employee/ResetAndSendPassword",data:{empId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};ManageEmployeeView.prototype.DeleteEmployee=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Employee/MarkDeleteEmployee",data:{empId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};ManageEmployeeView.prototype.GetExcelEmployees=function(){var o=this,r=$("#fileUploadEmpSheet"),u=$("#lblErrorMedia"),f=$("#EmployeeListGird"),n;if(ValidateExcel(r,u)){var e=$("#fileUploadEmpSheet").get(0),t=e.files,i=new FormData;for(n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:baseURL+"Employee/ImportEmployees",contentType:!1,processData:!1,data:i,success:function(n){$("#fileUploadEmpSheet").val("");n.HasError!=undefined&&n.HasError?($("#lblErrorMedia").show(),$("#lblErrorMedia").text(n.errorMessage)):($("#lblCountImportedRecords").html(n.importedEmployees),$("#lblCountFailedToImportRecords").html(n.failToImportEmployees),$("#divValidationErrorMsgEmpImports").html(n.errorMessage),$("#importEmployeeResultPopup").modal(),refreshGrid(f),$("#lblErrorMedia").hide());ManageEmployeeView.prototype.LoadEmployeeHeadcounts()},error:function(){}})}};ManageEmployeeView.prototype.LoadEmployeeHeadcounts=function(){var n=$.get(baseURL+"Employee/LoadEmployeeHeadcounts");n.done(function(n){$("#lblExistingEmp").html("<b>Existing Employees : "+n.existingEmpCount+"<\/b>");$("#lblResigneesEmp").html("<b>Resignees : "+n.resigneesEmpCount+"<\/b>");$("#lblTotalEmp").html("<b>Total : "+n.totalEmpCount+"<\/b>")});n.fail(function(){ShowAlertBox("Error while fetching employee headcounts")})};ManageEmployeeView.prototype.LoadEmployeeListGird=function(){function t(){if(setTimeout(function(){$(".k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Employee");$(".k-i-close").removeClass("k-icon k-i-close");$("#EmployeeListGird tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("EmployeeListGird")});KGrdPageSizeDdlPosition("EmployeeListGird")},1),this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeeList",dataType:"json"},destroy:{url:baseURL+"Employee/DeleteEmployee",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{employeeDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:10,filter:{logic:"and",filters:[{logic:"or",filters:[{field:"status",operator:"eq",value:"Probation"},{field:"status",operator:"eq",value:"Confirmed"},{field:"status",operator:"eq",value:""}]}]},schema:{model:{id:"employeeId",fields:{employeeIdHash:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},jobTitle:{editable:!1},salaryType:{editable:!0},status:{editable:!0},department:{editable:!1},passType:{editable:!1},nationality:{editable:!0},joiningDate:{editable:!1},resignationDate:{editable:!1},lastPayrollMonth:{editable:!1},nricNumber:{editable:!1},finNumber:{editable:!1}}}}});$("#EmployeeListGird").kendoGrid({dataSource:n,sortable:!0,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.employeeId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:50},{field:"employeeIdHash",hidden:!0},{field:"employeeName",title:"Name",width:"150px"},{field:"employeeCode",title:"Employee Code",width:"120px"},{field:"jobTitle",title:"Job Title",width:"150px"},{field:"department",hidden:!0},{field:"passType",hidden:!0},{field:"nricNumber",hidden:!0},{field:"finNumber",hidden:!0},{field:"salaryType",title:"Salary Type",width:"100px"},{field:"status",title:"Status",width:"100px"},{field:"nationality",title:"Citizenship",width:"120px"},{field:"joiningDate",title:"Join Date",width:"100px",template:"#if(joiningDate === null){#  N/A #}else{# #=kendo.toString(kendo.parseDate(joiningDate), 'dd MMM yyyy')#  #}#"},{field:"resignationDate",title:"Resign Date",width:"100px",template:"#if(resignationDate === null){# N/A #}else{# #=kendo.toString(kendo.parseDate(resignationDate), 'dd MMM yyyy')#  #}#"},{field:"lastPayrollMonth",title:"Last Payroll",width:"90px",template:"#if(lastPayrollMonth === null || lastPayrollMonth === ''){# N/A #}else{# #=lastPayrollMonth# #}#"},{field:"isActiveUser",title:"User Status",width:"100px",template:function(n){return n.isActiveUser==!0?"Active":n.isActiveUser==!1?"Inactive":""}},{template:"<div class='pointer' title='Edit Employee' onclick='editEmployee(\"#:employeeIdHash#\")'><img src='"+baseURL+"images/edit.png' class='img-responsive' /><\/div>",width:"40px"},{command:[{name:"destroy",text:"",visible:function(n){return n.lastPayrollMonth===null||n.lastPayrollMonth===""}}],title:"&nbsp;",width:"50px"}],editable:"inline",dataBound:t,dataBinding:function(){$("#EmployeeListGird input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#EmployeeListGird tbody input:checkbox").prop("checked",this.checked)})};ManageEmployeeView.prototype.SearchResultByEmployeeNameOrNIRC=function(){var n=$("#txtEmployeeName").kendoAutoComplete({dataSource:{transport:{read:{dataType:"json",url:baseURL+"Employee/LoadEmployeeNameNRICFINList/"},parameterMap:function(n,t){if(t==="read")return{searchByNameNRICFIN:$("#txtEmployeeName").val()}}}},minLength:1,filter:"startswith",dataTextField:"name",headerTemplate:'<div class="dropdown-header k-widget k-header"><div class="displayInlineBlock" style="width:40%;">NRIC/FIN<\/div><div class="displayInlineBlock" style="width:60%;">Employee Name<\/div><\/div>',template:'<div><div class="k-state-default displayInlineBlock" style="width:40%;text-align: left;"><h3>#: data.description #<\/h3><\/div><div class="k-state-default displayInlineBlock" style="width:60%;text-align: left;"><h3>#: data.name #<\/h3><\/div><\/div>',height:400,change:function(){var n=$("#txtEmployeeName").val();DoApplyNestedKGridFilter("EmployeeListGird","eq","employeeName",n==""?0:n,"and","or",!1)},open:function(n){setTimeout(function(){SetSearchListPosition("txtEmployeeName",n.sender.list)},0)},filtering:function(n){setTimeout(function(){SetSearchListPosition("txtEmployeeName",n.sender.list)},0)}}).data("kendoAutoComplete");$("#txtEmployeeName").closest("span.k-widget.k-autocomplete.k-header.k-autocomplete-clearable").addClass("heightAuto bgcolor-White")};EmployeeBasicInformationView.prototype.Init=function(){var n=this,t=$("#hdnBaseCountry").val().trim(),i=$("#ddlMaritalStatus").css("padding-top");$(".reduceHeight").css("height",$(".reduceHeight").outerHeight()-3);$("#divGender,#divQualification").css("padding-top",i);ValidateAndScrollToEmptyField();$("#datePickerDOB").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#dateOfPR").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#issueDate").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("changeDate",function(n){AddOrMinusDayFromDate(new Date(n.date.valueOf()),"expiryDate",!0,1,"setStartDate")});$("#expiryDate").datepicker({format:"dd/M/yyyy",autoclose:!0,startdate:$("#issueDate").val()}).on("changeDate",function(n){AddOrMinusDayFromDate(new Date(n.date.valueOf()),"issueDate",!1,1,"setEndDate")});$("#IssueDate").on("blur",function(){this.value!=""&&AddOrMinusDayFromDate(new Date(GetFormatedDate(this.value)),"expiryDate",!0,1,"setStartDate")}).blur();$("#dtExpiryDate").on("blur",function(){this.value!=""&&AddOrMinusDayFromDate(new Date(GetFormatedDate(this.value)),"issueDate",!1,1,"setEndDate")}).blur();$("#fileEmployeePhoto").change(function(n){var i=$("#fileEmployeePhoto"),r=$("#lblFileName"),u=$("#lblErrorMedia"),t;ValidateImage(i,r,u,"EmployeePhoto")&&(t=n.target.files[0].name,$("#lblFileName").text(t))});$("#imgEmpPhoto").on("click",function(){$("#fileEmployeePhoto").click()});$("#btnEmpBasicInfoClear").click(function(t){t.preventDefault();n.ClearFields()});$("#txtEmailAddress").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpEmailStatus").html("Checking..."),n=$.get(baseURL+"Employee/CheckEmailExistence",{emailAddress:$(this).val()}),n.done(function(n){n?($("#txtEmailAddress").addClass("error-box"),$("#helpEmailStatus").html("Email is already taken!"),$("#txtEmailAddress").focus(),$("#txtEmailAddress").attr("isAlreadyTaken",!0)):($("#txtEmailAddress").removeClass("error-box"),$("#helpEmailStatus").html(""),$("#txtEmailAddress").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpEmailStatus").html("Error while verifying email address!")}))});$("#txtNRICNumber").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpNRICStatus").html("Checking..."),n=$.get(baseURL+"Employee/CheckNRICNumberExistence",{nricNumber:$(this).val()}),n.done(function(n){n?($("#txtNRICNumber").addClass("error-box"),$("#helpNRICStatus").html("NRIC Number is already exist!"),$("#txtNRICNumber").focus(),$("#txtNRICNumber").attr("isAlreadyTaken",!0)):($("#txtNRICNumber").removeClass("error-box"),$("#helpNRICStatus").html(""),$("#txtNRICNumber").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpNRICStatus").html("Error while verifying NRIC Number!")}))});$("#txtFINNumber").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpFINCStatus").html("Checking..."),n=$.get(baseURL+"Employee/CheckFINNumberExistence",{finNumber:$(this).val()}),n.done(function(n){n?($("#txtFINNumber").addClass("error-box"),$("#helpFINCStatus").html("FIN Number is already exist!"),$("#txtFINNumber").focus(),$("#txtFINNumber").attr("isAlreadyTaken",!0)):($("#txtFINNumber").removeClass("error-box"),$("#helpFINCStatus").html(""),$("#txtFINNumber").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpFINCStatus").html("Error while verifying FIN Number!")}))});$("#txtWorkPermitNumber").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpWorkPermitStatus").html("Checking..."),n=$.get(baseURL+"Employee/CheckWorkPermitExistence",{workPermitNumber:$(this).val()}),n.done(function(n){n?($("#txtWorkPermitNumber").addClass("error-box"),$("#helpWorkPermitStatus").html("Work Permit Number is already exist!"),$("#txtWorkPermitNumber").focus(),$("#txtWorkPermitNumber").attr("isAlreadyTaken",!0)):($("#txtWorkPermitNumber").removeClass("error-box"),$("#helpWorkPermitStatus").html(""),$("#txtWorkPermitNumber").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpWorkPermitStatus").html("Error while verifying Work Permit Number!")}))});$("#btnEmpBasicInfoSave").on("click",function(n){var t,i,r,u,f,e,o;if($("#btnEmpBasicInfoSave").hasClass("XDisabled")){n.preventDefault();return}t=$("#hdnBaseCountry").val().trim();t=="Indonesia"&&$("#txtFullName").val()!=""&&$("#ddlCitizenship").val()!=""&&(i=$("#rdnMale").is(":checked"),r=$("#rdnFemale").is(":checked"),i||r||(ShowAlertBox("Gender is required. Please select gender."),$("#rdnMale").focus(),n.preventDefault()));u=$("#txtEmailAddress").attr("isAlreadyTaken");typeof u!=typeof undefined&&(ShowAlertBox("Email address is already taken. Please enter another email."),$("#txtEmailAddress").focus(),n.preventDefault());f=$("#txtNRICNumber").attr("isAlreadyTaken");typeof f!=typeof undefined&&(ShowAlertBox("NRIC Number is already exists. Please enter valid NRIC Number."),$("#txtNRICNumber").focus(),n.preventDefault());e=$("#txtFINNumber").attr("isAlreadyTaken");typeof e!=typeof undefined&&(ShowAlertBox("FIN Number is already exists. Please enter valid FIN Number."),$("#txtFINNumber").focus(),n.preventDefault());o=$("#txtWorkPermitNumber").attr("isAlreadyTaken");typeof o!=typeof undefined&&(ShowAlertBox("Work Permit Number is already exists. Please enter valid Work Permit Number."),$("#txtWorkPermitNumber").focus(),n.preventDefault());AvoidMultipleSubmit("btnEmpBasicInfoSave","EmpBasicInfo")});$("#btnEmpBasicInfoSave").hover(function(){$(this).removeClass("XDisabled")});n.HandleCountryBasedChangesBasicInfo(t);t=="Singapore"&&($("#ddlCitizenship").find("option:selected").val()=="Foreigner"&&($("#IssueDate").trigger("blur"),$("#dtExpiryDate").trigger("blur")),n.SetApplicableIndentificationDetails(),n.ShowApplicableStatutoryContributions(!0),$("#ddlCountryOfOrigin").change(function(){var t=$("#ddlCountryOfOrigin").val();t=="Singapore"&&$("#ddlCitizenship").val()==""&&($("#ddlCitizenship").val("Singaporean"),n.SetApplicableIndentificationDetails());n.ShowApplicableStatutoryContributions(!1)}),$("#ddlCitizenship").change(function(){$("#ddlPassType option:selected").prop("selected",!1);n.SetApplicableIndentificationDetails();n.ShowApplicableStatutoryContributions(!1)}),$("#ddlPassType").find("option:selected").val()==="Work Permit"?$("#divWorkPermitNumber").show():($("#divWorkPermitNumber").hide(),$("#txtWorkPermitNumber").val("")),$("#ddlPassType").change(function(){var t=$("#ddlPassType").find("option:selected").val(),i=$("#ddlCitizenship").find("option:selected").val(),r=$("#ddlEthnicRace").find("option:selected").val();t==="Work Permit"?$("#divWorkPermitNumber").show():($("#divWorkPermitNumber").hide(),$("#txtWorkPermitNumber").val(""));n.ShowApplicableStatutoryContributions(!1)}),$("#ddlEthnicRace, #ddlReligion").change(function(){n.ShowApplicableStatutoryContributions(!1)}));t=="India"&&($("#divIdDetailsHeaderForIndia").removeClass("hide"),$("#divIndiaDetails").removeClass("hide"),$("#divFieldsForIndia").removeClass("hide"),$("#for-first").css({"margin-top":"15px"}),$("#for-second").css({"margin-top":"15px"}),$("#txtUANNumber").prop("required",!0),$("#txtPANNumber").prop("required",!0),$("#txtCity").prop("required",!0),$("#ddlState").prop("required",!0))};EmployeeBasicInformationView.prototype.SetApplicableIndentificationDetails=function(){var n=$("#ddlCitizenship").find("option:selected").val();n==="Singaporean"?(ShowHideDropDownOption("ddlPassType","Singapore Citizen",!1),ShowHideDropDownOption("ddlPassType","Singapore Permanent Resident",!1),$("#ddlPassType").val("Singapore Citizen").attr("selected","selected"),$("#ddlPassType").parent("div.form-group").removeClass("has-error has-danger"),$("#PassTypeHidden").val($("#ddlPassType").find("option:selected").val()),$("#ddlPassType").prop("disabled",!0),$("#ddlPassType").prop("required",!1),$("#divNRICNumber").show(),$("#txtNRICNumber").prop("required",!0),$("#divFINNumber").hide(),$("#txtFINNumber").val(""),$("#txtFINNumber").prop("required",!1),$("#divDateOfPR").hide(),$("#DateOfPR").val(""),$("#DateOfPR").prop("required",!1),$("#divPRStatus").hide(),$("#ddlPRStatus").val("G/G"),$("#divIssueDate").hide(),$("#IssueDate").val(""),$("#divExpiryDtAndQualification").hide(),$("#dtExpiryDate").val(""),$("#rdnSkilled").val(""),$("#rdnUnskilled").val(""),$("#divWorkPermitNumber").hide(),$("#txtWorkPermitNumber").val("")):n==="Singapore PR"?(ShowHideDropDownOption("ddlPassType","Singapore Citizen",!1),ShowHideDropDownOption("ddlPassType","Singapore Permanent Resident",!1),$("#ddlPassType").val("Singapore Permanent Resident").attr("selected","selected"),$("#ddlPassType").parent("div.form-group").removeClass("has-error has-danger"),$("#ddlPassType").prop("disabled",!0),$("#ddlPassType").prop("required",!1),$("#PassTypeHidden").val($("#ddlPassType").find("option:selected").val()),$("#divNRICNumber").show(),$("#txtNRICNumber").prop("required",!0),$("#divFINNumber").hide(),$("#txtFINNumber").val(""),$("#txtFINNumber").prop("required",!1),$("#divDateOfPR").show(),$("#DateOfPR").prop("required",!0),$("#divPRStatus").show(),$("#divIssueDate").hide(),$("#IssueDate").val(""),$("#divExpiryDtAndQualification").hide(),$("#dtExpiryDate").val(""),$("#rdnSkilled").val(""),$("#rdnUnskilled").val(""),$("#divWorkPermitNumber").hide(),$("#txtWorkPermitNumber").val("")):n==="Foreigner"?($("#ddlPassType").prop("required",!0),$("#divNRICNumber").hide(),$("#txtNRICNumber").val(""),$("#txtNRICNumber").prop("required",!1),$("#divFINNumber").show(),$("#txtFINNumber").prop("required",!0),$("#divIssueDate").show(),$("#divDateOfPR").hide(),$("#DateOfPR").val(""),$("#DateOfPR").prop("required",!1),$("#divPRStatus").hide(),$("#ddlPRStatus").val("G/G"),$("#divExpiryDtAndQualification").show(),$("#ddlPassType").prop("disabled",!1),ShowHideDropDownOption("ddlPassType","Singapore Citizen",!0),ShowHideDropDownOption("ddlPassType","Singapore Permanent Resident",!0)):($("#divNRICNumber").show(),$("#txtNRICNumber").prop("required",!0),$("#divFINNumber").hide(),$("#txtFINNumber").val(""),$("#txtFINNumber").prop("required",!1),$("#divDateOfPR").hide(),$("#DateOfPR").val(""),$("#DateOfPR").prop("required",!1),$("#divPRStatus").hide(),$("#ddlPRStatus").val("G/G"),$("#divIssueDate").hide(),$("#IssueDate").val(""),$("#divExpiryDtAndQualification").hide(),$("#dtExpiryDate").val(""),$("#rdnSkilled").val(""),$("#rdnUnskilled").val(""),$("#divWorkPermitNumber").hide(),$("#txtWorkPermitNumber").val(""),$("#ddlPassType").prop("disabled",!1),ShowHideDropDownOption("ddlPassType","Singapore Citizen",!1),ShowHideDropDownOption("ddlPassType","Singapore Permanent Resident",!1))};EmployeeBasicInformationView.prototype.ShowApplicableStatutoryContributions=function(n){var f=$("#ddlPassType").find("option:selected").val(),r=$("#ddlCitizenship").find("option:selected").val(),i=$("#ddlEthnicRace").find("option:selected").val(),u=$("#ddlReligion").find("option:selected").val(),t=$("#ddlCountryOfOrigin").find("option:selected").val();if(r==="Singaporean"||r==="Singapore PR")$("#divStatutoryContributions").show();else if(r==="Foreigner"){$("#divStatutoryContributions").show();$("#divchkMBMF").hide();$("#divchkCDAC").hide();$("#divchkECF").hide();$("#divchkSINDA").hide();$("#divchkSDL").show();(i==="Malay"||u==="Muslim")&&$("#divchkMBMF").show();(t.toUpperCase()==="INDIA"||t.toUpperCase()==="BANGLADESH"||t.toUpperCase()==="NEPAL"||t.toUpperCase()==="PAKISTAN"||t.toUpperCase()==="SRI LANKA"||i.toUpperCase()==="INDIAN"||i.toUpperCase()==="SIKH")&&f==="Employment Pass"&&$("#divchkSINDA").show();return}$("#divchkMBMF").hide();$("#divchkCDAC").hide();$("#divchkSINDA").hide();$("#divchkECF").hide();n||($("#chkMBMF").prop("checked",!1),$("#chkCDAC").prop("checked",!1),$("#chkSINDA").prop("checked",!1),$("#chkECF").prop("checked",!1));i==="Chinese"&&$("#divchkCDAC").show();(t.toUpperCase()==="INDIA"||t.toUpperCase()==="BANGLADESH"||t.toUpperCase()==="NEPAL"||t.toUpperCase()==="PAKISTAN"||t.toUpperCase()==="SRI LANKA"||i.toUpperCase()==="INDIAN"||i.toUpperCase()==="SIKH")&&$("#divchkSINDA").show();(i==="Malay"||u==="Muslim")&&$("#divchkMBMF").show();i==="Eurasian"&&$("#divchkECF").show()};EmployeeBasicInformationView.prototype.ClearFields=function(){$("#EmpBasicInfo").find("input:text, input:password, input:file, select, textarea").val("");$("#EmpBasicInfo").find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected")};EmployeeBasicInformationView.prototype.HandleCountryBasedChangesBasicInfo=function(n){n=="Indonesia"?($("#ddlEthnicRace, #ddlReligion").prop("required",!1),$("label[for='EthnicRace'], label[for='Religion']").removeClass("required"),$("#txtEmailAddress, #ddlMaritalStatus").prop("required",!0),$("label[for='txtEmailAddress'], label[for='MaritalStatus'], label[for='lblGender']").addClass("required"),$("#divPTKPStatus, #divIdentificationDetailsIndo").removeClass("hide"),$("#ddlPassType, #txtNRICNumber, #txtFINNumber, #DateOfPR, #txtWorkPermitNumber, #IssueDate, #dtExpiryDate").prop("required",!1)):n=="Singapore"?($("#spnNameAsPer").text("(as per NRIC/Passport)"),$("#divStatutoryContributions, #divIdentificationDetailsSG, #divExpiryDtAndQualification").removeClass("hide")):($("#ddlPassType, #txtNRICNumber, #txtFINNumber, #DateOfPR, #txtWorkPermitNumber, #IssueDate, #dtExpiryDate").prop("required",!1),$("#divIdDetailsHeader").addClass("hide"))};LeaveManagmentView.prototype.Init=function(){var n=this;$('#ddlLeaveStatus option[value="Cancelled"]').remove();this.ClearFilterFields();$("#dtFromDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#dtToDate").datepicker({format:"dd/M/yyyy",autoclose:!0});n.LoadManageLeavesGrid();$("#ddlEmployeeLeaveList, #ddlLeaveType, #ddlLeaveStatus, #fromDate, #toDate").change(function(){n.FilterManageLeavesGrid()});$("#btnEmpLeaveDownloadExcel").click(function(n){n.preventDefault();$("#ManageLeavesGrid").getKendoGrid().saveAsExcel()});$("#btnEmpLeaveDownloadPDF").click(function(n){n.preventDefault();$("#ManageLeavesGrid").getKendoGrid().saveAsPDF()});$("#btnApproveLeaveOk").click(function(n){var i;n.preventDefault();var r=$("#hdnLeaveId").val(),u=$("#hdnMaternityTypeId").val(),t="";if((u==1||u==2)&&$.when($.ajax({url:baseURL+"Employee/CheckIfPreMaternityLeaveApproved",data:{leaveId:r},type:"POST",async:!1})).then(function(n){n!=""&&(t=n)}),t=="")i=$.post(baseURL+"Employee/ApproveLeave",{leaveId:r}),i.done(function(){ShowAlertBox("Leave approved successfully");refreshGrid($("#ManageLeavesGrid"));$("#confirmLeaveApprovalPopup").modal("toggle")}),i.fail(function(){ShowAlertBox("Error while approving leave")});else{$("#confirmLeaveApprovalPopup").modal("toggle");ShowAlertBox(t);return}event.stopImmediatePropagation()});$("#frmRejectLeave").submit(function(n){var r,t,u,i,f;if(n.preventDefault(),r=$("#txtRejectionReason").val(),t=$("#hdnLeaveId").val(),r!==""&&t!=="")if(u=$("#hdnMaternityTypeId").val(),i="",(u==1||u==2)&&$.when($.ajax({url:baseURL+"Employee/CheckIfPostMaternityLeaveCancelledOrRejected",data:{leaveId:t,isCancelOrReject:"Reject"},type:"POST",async:!1})).then(function(n){n!=""&&(i=n)}),i=="")f=$.post(baseURL+"Employee/RejectLeave",{leaveId:t,rejectionReason:r}),f.done(function(){ShowAlertBox("Leave rejected successfully");refreshGrid($("#ManageLeavesGrid"));$("#LeaveRejectPopup").modal("toggle")}),f.fail(function(){ShowAlertBox("Error while rejecting leave")});else{$("#LeaveRejectPopup").modal("toggle");ShowAlertBox(i);return}});$("#imgLeaveRequestDocName, #lblLeaveRequestDocName").click(function(n){n.preventDefault();var t=$("#hdnDocAssetId").val();t!=""&&(window.location=baseURL+"Asset/Download/"+t)});$("#fileImportLeaves").click(function(){$(this).val("")});$("#fileImportLeaves").change(function(){$("#fileImportLeaves").val()!=null&&$("#fileImportLeaves").val()!=""&&n.GetExcelLeaves()})};LeaveManagmentView.prototype.GetExcelLeaves=function(){var e=this,r=$("#fileImportLeaves"),u=$("#lblErrorMedia"),n;if(ValidateExcel(r,u)){var f=$("#fileImportLeaves").get(0),t=f.files,i=new FormData;for(n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:baseURL+"Employee/ImportEmployeeLeaves",contentType:!1,processData:!1,data:i,success:function(n){n.length>0?ShowSummaryBox("Warning Message(s) - Resolve first and import again",n):(ShowAlertBox("Employee Leave(s) imported successfully"),refreshGrid($("#ManageLeavesGrid")))},error:function(){ShowAlertBox("Error while importing employee leaves")}})}};LeaveManagmentView.prototype.LoadManageLeavesGrid=function(){function i(){setTimeout(function(){KGrdPageSizeDdlPosition("ManageLeavesGrid")},1)}var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeeLeavesBySupervisor",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{UpdateLeave:kendo.stringify(n.models)}}},batch:!0,pageSize:5,schema:{model:{id:"leaveId",fields:{leaveId:{editable:!1},companyId:{editable:!1},employeeId:{editable:!1},leaveDocAssetId:{editable:!1},employeeName:{editable:!1},appliedOn:{editable:!1,type:"date"},leaveYear:{editable:!1},leaveType:{editable:!1},fromDate:{editable:!1},toDate:{editable:!1},fromDateShow:{editable:!1,type:"date"},toDateShow:{editable:!1,type:"date"},leaveDay:{editable:!1},numberOfDays:{editable:!1},numberOfWeeks:{editable:!1},leaveBalance:{editable:!1},reasonForLeave:{editable:!1},leaveStatus:{editable:!1},maternityTypeId:{editable:!1},isAdmin:{editable:!1},isCancellationRequested:{editable:!1}}}}});$("#ManageLeavesGrid").kendoGrid({excel:{fileName:"EmployeeLeave.xlsx",allPages:!0,filterable:!0},excelExport:function(n){SetKGridExportExcelHeader(n.workbook.sheets[0],$(".lblMyCompany").text()+"\nEmployee Leaves",!1,!1,0,6)},pdf:{title:"Employee Leaves",allPages:!0,avoidLinks:!0,scale:.8,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,date:new Date,fileName:"EmployeeLeave.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Employee Leaves<\/div><\/div>"}},pdfExport:function(n){var i="",t;for($("#ManageLeavesGrid div.k-grid-content").addClass("grdMaxHeightNone"),t=n.sender.columns.length-1;t>=0;t--)n.sender.columns[t].attributes!=undefined&&n.sender.columns[t].attributes.colPdfHide&&(n.sender.hideColumn(t),i=i==""?t:i+","+t);n.promise.done(function(){i.split(",").forEach(function(t){n.sender.showColumn(parseInt(t));$("#ManageLeavesGrid div.k-grid-content").removeClass("grdMaxHeightNone")})})},dataSource:t,pageable:KGridPagableObj(),scrollable:!0,dataBound:i,sortable:!0,resizable:!0,columns:[{title:"",template:function(n){switch(n.leaveStatus){case"Pending":return"<div class='pointer' title='Approve Leave' onclick='ApproveLeave("+n.leaveId+","+n.maternityTypeId+")'><img src='"+baseURL+"images/ok_green.png' class='img-responsive' /><\/div>";default:return""}},attributes:{colPdfHide:!0},width:"35px"},{title:"",template:function(n){if(n.leaveStatus=="Rejected"||n.leaveStatus=="Rejected Approved Leave")return"";if(n.leaveStatus=="Approved"){var i=new Date(n.fromDate),t=new Date;return t.setDate(t.getDate()-90),n.isAdmin&&i>t&&n.leaveYear==i.getFullYear()||n.isCancellationRequested?"<div class='pointer'  title='Reject Leave'  onclick='RejectLeave("+n.leaveId+","+n.maternityTypeId+")'><img src='"+baseURL+"images/cancel_red.png' class='img-responsive' /><\/div>":""}return"<div class='pointer'  title='Reject Leave'  onclick='RejectLeave("+n.leaveId+","+n.maternityTypeId+")'><img src='"+baseURL+"images/cancel_red.png' class='img-responsive' /><\/div>"},attributes:{colPdfHide:!0},width:"35px"},{title:"Sno",template:function(){return++n},width:40},{field:"leaveId",title:"#",hidden:!0},{field:"companyId",hidden:!0},{field:"employeeId",hidden:!0},{field:"maternityTypeId",hidden:!0},{field:"isAdmin",hidden:!0},{field:"employeeName",title:"Employee Name",width:"200px"},{field:"appliedOn",title:"Applied On",width:"90px",template:"#= kendo.toString(kendo.parseDate(appliedOn), 'dd MMM yyyy') #"},{field:"leaveYear",title:"Year",width:"50px"},{field:"leaveType",title:"Leave Type",width:"120px"},{field:"fromDate",title:"From",width:"120px",hidden:!0},{field:"toDate",title:"To",width:"120px",hidden:!0},{field:"fromDateShow",title:"From",width:"120px",template:"#= kendo.toString(kendo.parseDate(fromDate), 'ddd, dd MMM yyyy') #"},{field:"toDateShow",title:"To",width:"120px",template:"#= kendo.toString(kendo.parseDate(toDate), 'ddd, dd MMM yyyy') #"},{field:"leaveDay",title:"Leave",width:"70px"},{field:"numberOfWeeks",title:"Weeks",format:"{0:n1}",width:"70px"},{field:"numberOfDays",title:"Days",format:"{0:n1}",width:"50px"},{field:"leaveBalance",title:"Balance Leaves (days)",format:"{0:n1}",width:"110px",headerAttributes:{style:"padding: 0.3em 0.6em 0.4em 0.6em !important;"},attributes:{style:"text-align:center;"},headerTemplate:'<span style="display:block !important">Balance Leaves<\/span><span style="display:block !important;text-align: center;">(days)<\/span>'},{field:"reasonForLeave",title:"Remarks",width:"150px"},{field:"leaveStatus",title:"Status",width:"120px",template:function(n){return n.isCancellationRequested?"Pending Cancellation":n.leaveStatus}},{template:function(n){return n.leaveDocAssetId!=null&&n.leaveDocAssetId>0?"<div class='pointer'><a href='"+baseURL+"Asset/Download/"+n.leaveDocAssetId+"'><img src='"+baseURL+"images/attached.png' class='img-responsive' /><\/a><\/div>":""},attributes:{colPdfHide:!0},width:"35px",title:""},{template:"<div class='pointer' title='Leave Details' onclick='LoadEmployeeLeaveInfo(\"#:leaveId#\")'><img src='"+baseURL+"images/info_line.png' class='img-responsive' /><\/div>",width:"35px",title:"",attributes:{colPdfHide:!0}},],dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};LeaveManagmentView.prototype.FilterManageLeavesGrid=function(){var i=$("#ddlLeaveType").find(":selected").text(),r=$("#ddlLeaveStatus").find(":selected").text(),n=GetDateInFormat($("#fromDate").val(),"yyyy-MM-ddT00:00:00"),t=GetDateInFormat($("#toDate").val(),"yyyy-MM-ddT00:00:00"),u=$("#ddlEmployeeLeaveList").find(":selected").text();doApplyGridFilter("ManageLeavesGrid","eq","leaveType",i==""?0:i);doApplyGridFilter("ManageLeavesGrid","eq","leaveStatus",r==""?0:r);doApplyGridFilter("ManageLeavesGrid","gte","fromDate",n==""||n==null?0:n);doApplyGridFilter("ManageLeavesGrid","lte","toDate",t==""||t==null?0:t);doApplyGridFilter("ManageLeavesGrid ","eq","employeeName",u=="All"?0:u)};LeaveManagmentView.prototype.ClearFilterFields=function(){$('#ddlLeaveStatus option[value=""], #ddlLeaveType option[value=""], #ddlEmployeeLeaveList option[value=""]').attr("selected",!0);$("#dtFromDate, #dtToDate").datepicker("setDate",null)};MyLeavesView.prototype.Init=function(){var n=this,t;$("#ddlBossLeave").val($("#hdnLeaveBossEmpId").val());this.ClearFilterFields();this.LoadEmployeeLeavesGrid();this.LoadEmployeeLeaveSummaryGrid();$("#ddlFromDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#ddlToDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#ddlExpectedDeliveryDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#ddlBossLeave").change(function(){window.location.href=baseURL+"Employee/ChangeBoss?id="+$("#ddlBossLeave").val()});$("#applyLeave").click(function(n){n.preventDefault();$("#frmApplyLeave").find("#LeaveId, #LeaveDocAssetId, #EmployeeAssetId, #fileLeaveDocument").val("");var t=(new Date).getFullYear();$("#ddlLeaveYear").val(t).attr("selected","selected");$("#ddlLeaveType").prop("readonly",!1);$("#ddlLeaveType").removeClass("pointer-none");$("#ddlLeaveType").removeClass("fieldset-disabled");$("#EmployeeApplyLeave").modal()});$("#ddlLeaveFromDate").datepicker({format:"d/M/yyyy",autoclose:!0,orientation:"auto top"}).on("hide",function(){var t=$("#ddlLeaveFromDate").datepicker("getDate");t==null?$("#leaveToDate").prop("disabled",!0).prop("readonly",!0):($("#ddlLeaveToDate").datepicker("setStartDate",new Date(t.valueOf())),$("#hdnMaternityLeaveType").val()==1||$("#hdnMaternityLeaveType").val()==2?$("#leaveToDate").prop("disabled",!0).prop("readonly",!0):$("#leaveToDate").prop("disabled",!1).prop("readonly",!1));n.calculateLeaveDays()});$("#ddlLeaveToDate").datepicker({format:"d/M/yyyy",autoclose:!0,orientation:"auto top"}).on("hide",function(){n.calculateLeaveDays()});t=$("#ddlLeaveFromDate").datepicker("getDate");t==null?$("#leaveToDate").prop("disabled",!0).prop("readonly",!0):$("#hdnMaternityLeaveType").val()==1||$("#hdnMaternityLeaveType").val()==2?$("#leaveToDate").prop("disabled",!0).prop("readonly",!0):$("#leaveToDate").prop("disabled",!1).prop("readonly",!1);$("#ddlFullHalfDay").change(function(){n.calculateLeaveDays()});$("#ddlLeaveFromDate, #ddlDaysOrWeeks, #txtNumberOfDaysOrWeeks").change(function(t){t.preventDefault();($("#hdnMaternityLeaveType").val()==1||$("#hdnMaternityLeaveType").val()==2)&&n.CalculateMaternityLeaveWorkingDays()});this.ManageMaternityControls();this.SetMedicalCertificateNonMandatory();$("#EmployeeApplyLeave").on("hidden.bs.modal",function(){$(this).find("input[type='text'],textarea,select").val("").end().find("input[type=checkbox], input[type=radio]").prop("checked","").end();$(this).find("#frmApplyLeave .has-error.has-danger").removeClass("has-error has-danger");$("#frmApplyLeave #btnApplyEmployeeLeave.disabled").removeClass("disabled");$("#leaveId").val("");$("#ddlLeaveToDate").datepicker("setDate",null);$("#ddlLeaveFromDate").datepicker("setDate",null);$("#leaveToDate").prop("disabled",!0).prop("readonly",!0);$("#lblFileName").html("No file chosen");$("#hdnOldAppliedDays").val("");$("#hdnOldAppliedInDaysOrWeeks").val("");n.ManageMaternityControls();n.SetMedicalCertificateNonMandatory()});$("#ddlLeaveType, #ddlLeaveYear").change(function(){var t=$("#ddlLeaveType").find("option:selected").text(),i=$("#ddlLeaveYear").find("option:selected").text();t!=""&&i!=""?n.LoadEmployeeLeaveBalance(t,i):$("#txtLeaveBalance").val("");MyLeavesView.prototype.CheckMedicalCertificateReqForMedicalLeave()});$("#txtNumberOfDaysOrWeeks").on("keypress",function(n){var t=n.charCode||n.keyCode;if(t==46)return!1});$("#frmApplyLeave").submit(function(n){var s,p,l,h,y,f,w;n.preventDefault();var a=$("#ddlLeaveYear").val(),v=$("#ddlFullHalfDay").val(),i=$("#ddlLeaveType").val(),e=$("#leaveFromDate").val(),o=$("#leaveToDate").val(),b=$("#txtLeaveReason").val(),u=$("#txtLeaveBalance").val(),r=$("#txtNumberOfDays").val(),t=$("#hdnMaternityLeaveType").val(),c=$("#leaveId").val();if(t==1){if($("#dtExpectedDeliveryDate").val()=="")return}else if(t==2){if(s=$("#txtNumberOfDaysOrWeeks").val(),$("#ddlDaysOrWeeks").val()==""||s==""||s%1!=0||s<0)return;if(s==0){ShowAlertBox("Number Of Days/Weeks should be greater than 0");return}}if(a!==""&&i!==""&&e!==""&&o!==""&&b!==""&&(t==1||v!=="")){if(r==0&&t==0){ShowAlertBox("Leave applied number of days should be greater than 0");return}if(i=="Medical Leave"&&$("#hdnIsReqMedicalCertificate").val()&&$("#hdnCertificateNotReqForDays").val()!=""&&r>$("#hdnCertificateNotReqForDays").val()&&($("#fileLeaveDocument").val()==null||$("#fileLeaveDocument").val()=="")){ShowAlertBox("Please attach medical certificate.");return}if(p=new Date(e),l=new Date(o),(a!=p.getFullYear()||a!=l.getFullYear())&&t!=1&&t!=2){ShowAlertBox("To apply leave for "+l.getFullYear()+", please select Leave Year : "+l.getFullYear());return}if(v=="Half Day"&&e!=o){ShowAlertBox("If leave type is Half-Day then FromDate and ToDate must be same!");return}if(c<=0){if(t==1){if(parseFloat(r)>parseFloat(u)*7){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}}else if(t==2){if(parseFloat(r)>parseFloat(u)*$("#hdnEmployeeWorkingDays").val()){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}}else if(parseFloat(r)>parseFloat(u)){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}}else if(c>0)if(h=parseFloat($("#hdnOldAppliedDays").val()),y=parseFloat($("#hdnEmployeeWorkingDays").val()),t==1){if(parseFloat(r)>(parseFloat(u)+h)*7){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}}else if(t==2){if($("#hdnOldAppliedInDaysOrWeeks").val()=="Weeks"){if(parseFloat(r)>(parseFloat(u)+h)*y){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}}else if(parseFloat(r)>parseFloat(u)*y+h){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}}else if(parseFloat(r)>parseFloat(u)+h){ShowAlertBox("For "+i+", Number of days leave applied should not exceed balance Leave");return}if(t==1&&($("#ddlDaysOrWeeks").prop("disabled",!1),$("#ddlFullHalfDay").val("Full Day")),f="",(t==1||t==2)&&(MyLeavesView.prototype.CalculateMaternityLeaveWorkingDays(),$("#leaveToDate").prop("disabled",!1).prop("readonly",!1),$.when($.ajax({url:baseURL+"Employee/MaternityLeaveValidation",data:{employeeId:$("#EmployeeId").val(),leaveType:i,fromDate:e,toDate:o,expectedDeliveryDate:$("#dtExpectedDeliveryDate").val()},type:"POST",async:!1})).then(function(n){n!=""&&(f=n)})),f==""&&$.when($.ajax({url:baseURL+"Employee/LeaveRequestDateValidation",data:{employeeId:$("#EmployeeId").val(),leaveType:i,fromDate:e,toDate:o,leaveId:c,leaveDay:v},type:"POST",async:!1})).then(function(n){n!=""&&(f=n)}),w=new FormData(this),f=="")$.ajax({url:baseURL+"Employee/ApplyLeave",type:"POST",data:w,success:function(n){if(n=="Fail"&&((t==1||t==2)&&$("#leaveToDate").prop("disabled",!0),t==1&&$("#ddlDaysOrWeeks").prop("disabled",!0)),n=="Fail"){ShowAlertBox("Error while applying leave");return}var i=c,r=i>0?!0:!1;r?ShowAlertBox("Leave updated successfully!"):ShowAlertBox("Leave applied successfully!");refreshGrid($("#EmployeeLeavesGrid"));refreshGrid($("#EmployeeLeaveSummaryGird"));$("#EmployeeApplyLeave").modal("toggle")},cache:!1,contentType:!1,processData:!1});else{(t==1||t==2)&&$("#leaveToDate").prop("disabled",!0).prop("readonly",!0);t==1&&$("#ddlDaysOrWeeks").prop("disabled",!0);ShowAlertBox(f);return}}});$("#ddlFilterLeaveType, #ddlFilterLeaveStatus, #filterFromDt, #filterToDt").change(function(){n.FilterEmployeeLeavesGrid()});$("#fileLeaveDocument").change(function(n){var t=n.target.files[0].name;$("#lblFileName").text(t)});$("#imgLeaveRequestDocName, #lblLeaveRequestDocName").click(function(n){n.preventDefault();var t=$("#hdnDocAssetId").val();t!=""&&(window.location=baseURL+"Asset/Download/"+t)});$("#LeaveCancellationReqPopup").on("hidden.bs.modal",function(){$(this).find("#frmRequestLeaveCancellation .has-error.has-danger").removeClass("has-error has-danger")});$("#frmRequestLeaveCancellation").submit(function(n){var t,i,r;(n.preventDefault(),t=$("#txtCancellationReqReason").val(),i=$("#hdnLeaveId").val(),t!==""&&i!=="")&&(r=$.post(baseURL+"Employee/RequestLeaveCancellation",{leaveId:i,cancellationReason:t}),r.done(function(n){n?(ShowAlertBox("Your request for cancellation of approved leave has been sent to supervisors"),$("#LeaveCancellationReqPopup").modal("toggle"),refreshGrid($("#EmployeeLeavesGrid"))):ShowAlertBox("Error while creating leave cancel request")}),r.fail(function(){ShowAlertBox("Error while creating leave cancel request")}))})};MyLeavesView.prototype.ManageMaternityControls=function(){$("#ddlExpectedDeliveryDate").datepicker("setDate",null);$("#dtExpectedDeliveryDate").prop("required",!1);$("#divFullOrHalfDay").show();$("#divExpectedDeliveryDate").hide();$("#txtNumberOfDaysOrWeeks").prop("required",!1);$("#txtNumberOfDaysOrWeeks").val("");$("#ddlDaysOrWeeks").prop("required",!1);$("#ddlDaysOrWeeks").val("");$("#divNumberOfDaysOrWeeks").hide();$("#txtNumberOfDays").prop("required",!0);$("#divNumberOfDays").show();$("#divFullOrHalfDay").show();$("#divExpectedDeliveryDate").hide();$("#hdnMaternityLeaveType").val(0)};MyLeavesView.prototype.calculateLeaveDays=function(){var i;if($("#hdnMaternityLeaveType").val()!=1&&$("#hdnMaternityLeaveType").val()!=2){var n=kendo.toString(kendo.parseDate($("#ddlLeaveFromDate").datepicker("getDate")),"MM-dd-yyyy"),t=kendo.toString(kendo.parseDate($("#ddlLeaveToDate").datepicker("getDate")),"MM-dd-yyyy"),r=$("#ddlFullHalfDay").val();n!=null&&t!=null&&(i=$.get(baseURL+"Employee/GetWorkingDays",{fromDate:n,toDate:t}),i.done(function(n){var t=n;r=="Half Day"&&(t=t/2);$("#txtNumberOfDays").val(t);MyLeavesView.prototype.CheckMedicalCertificateReqForMedicalLeave()}))}};MyLeavesView.prototype.CheckMedicalCertificateReqForMedicalLeave=function(){if($("#ddlLeaveType").val()=="Medical Leave"){$("#lblLeaveDocuments").text("Medical Certificate");var i=$("#hdnIsReqMedicalCertificate").val(),n=$("#txtNumberOfDays").val(),t=$("#hdnCertificateNotReqForDays").val();i&&n>0&&t!=""&&n>t?($("#fileLeaveDocument").prop("required",!0),$("#lblLeaveDocuments").prop("class","alignright-lbl padding-top10 required")):($("#fileLeaveDocument").prop("required",!1),$("#lblLeaveDocuments").removeClass("required"))}else MyLeavesView.prototype.SetMedicalCertificateNonMandatory()};MyLeavesView.prototype.SetMedicalCertificateNonMandatory=function(){$("#lblLeaveDocuments").text("Documents");$("#fileLeaveDocument").prop("required",!1);$("#lblLeaveDocuments").removeClass("required")};MyLeavesView.prototype.CalculateMaternityLeaveWorkingDays=function(){var o=$("#hdnMaternityLeaveType").val(),u=$("#ddlDaysOrWeeks").val(),t=$("#txtNumberOfDaysOrWeeks").val(),n=kendo.parseDate($("#ddlLeaveFromDate").datepicker("getDate")),i,f,r,e,s,h;o==1?n!=null&&u=="Weeks"&&t>0&&(i=new Date(n),f=parseInt(t)*7,isNaN(i.getTime())||(i.setDate(i.getDate()+(f-1)),$("#ddlLeaveToDate").datepicker("setStartDate",new Date(n.valueOf())),$("#ddlLeaveToDate").datepicker("setDate",new Date(i.valueOf()))),$("#txtNumberOfDays").val(f)):o==2&&n!=null&&t>0&&u!=""&&(r=0,u=="Weeks"?r=parseInt(t)*$("#hdnEmployeeWorkingDays").val():u=="Days"&&(r=parseInt(t)),e=$("#EmployeeId").val(),s=kendo.toString(kendo.parseDate(n),"MM-dd-yyyy"),e>0&&(h=$.get(baseURL+"Employee/GetMaternityLeaveEndDate",{employeeId:e,totalDays:r,fromDate:s}),h.done(function(t){$("#ddlLeaveToDate").datepicker("setStartDate",new Date(n.valueOf()));$("#ddlLeaveToDate").datepicker("setDate",new Date(t.valueOf()))}),$("#txtNumberOfDays").val(r)))};MyLeavesView.prototype.LoadEmployeeLeaveBalance=function(n,t){var i=$.get(baseURL+"Employee/LoadEmployeeLeaveBalance",{leaveType:n,leaveYear:t});i.done(function(n){$("#txtLeaveBalance").val(n.balance);n.periodType=="Weeks"?$("#lblLeaveBalance").text("Leave Balance(Weeks)"):$("#lblLeaveBalance").text("Leave Balance(Days)");n.leaveType=="1"?($("#ddlFullHalfDay").prop("required",!1),$("#ddlFullHalfDay").val(""),$("#divFullOrHalfDay").hide(),$("#dtExpectedDeliveryDate").prop("required",!0),$("#divExpectedDeliveryDate").show()):($("#divFullOrHalfDay").show(),$("#ddlFullHalfDay").prop("required",!0),$("#ddlExpectedDeliveryDate").datepicker("setDate",null),$("#dtExpectedDeliveryDate").prop("required",!1),$("#divExpectedDeliveryDate").hide());n.leaveType=="2"||n.leaveType=="1"?($("#txtNumberOfDays").prop("required",!1),$("#txtNumberOfDays").val(""),$("#divNumberOfDays").hide(),$("#txtNumberOfDaysOrWeeks").prop("required",!0),$("#ddlDaysOrWeeks").prop("required",!0),$("#divNumberOfDaysOrWeeks").show(),$("#leaveToDate").prop("disabled",!0).prop("readonly",!0)):($("#txtNumberOfDaysOrWeeks").prop("required",!1),$("#txtNumberOfDaysOrWeeks").val(""),$("#ddlDaysOrWeeks").prop("required",!1),$("#ddlDaysOrWeeks").val(""),$("#divNumberOfDaysOrWeeks").hide(),$("#txtNumberOfDays").prop("required",!0),$("#divNumberOfDays").show(),$("#ddlDaysOrWeeks").prop("readonly",!1),$("#txtNumberOfDaysOrWeeks").prop("readonly",!1),$("#hdnMaternityLeaveType").val(0));n.leaveType=="1"?($("#ddlDaysOrWeeks").val("Weeks"),$("#ddlDaysOrWeeks").prop("disabled",!0),$("#leaveId").val()<=0&&$("#txtNumberOfDaysOrWeeks").val($("#txtLeaveBalance").val()),$("#txtNumberOfDaysOrWeeks").prop("readonly",!0),$("#hdnMaternityLeaveType").val(1),MyLeavesView.prototype.CalculateMaternityLeaveWorkingDays()):n.leaveType=="2"&&($("#ddlDaysOrWeeks").prop("disabled",!1),$("#txtNumberOfDaysOrWeeks").prop("readonly",!1),$("#hdnMaternityLeaveType").val(2))})};MyLeavesView.prototype.LoadEmployeeLeavesGrid=function(){function i(){setTimeout(function(){KGrdPageSizeDdlPosition("EmployeeLeavesGrid",1)},1)}var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeeLeavesByEmployee",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{UpdateLeave:kendo.stringify(n.models)}}},batch:!0,pageSize:5,schema:{model:{id:"leaveId",fields:{leaveId:{editable:!1},appliedOn:{editable:!1},leaveYear:{editable:!1},leaveType:{editable:!1},fromDate:{editable:!1},toDate:{editable:!1},leaveDay:{editable:!1},numberOfWeeks:{editable:!1},numberOfDays:{editable:!1},reasonForLeave:{editable:!1},leaveStatus:{editable:!1},expectedDeliveryDate:{editable:!1},maternityTypeId:{editable:!1},isCancellationRequested:{editable:!1}}}}});$("#EmployeeLeavesGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),scrollable:!0,dataBound:i,sortable:!0,resizable:!0,columns:[{title:"Sno",template:function(){return++n},width:45},{field:"leaveId",hidden:!0},{field:"isCancellationRequested",hidden:!0},{field:"expectedDeliveryDate",hidden:!0},{field:"maternityTypeId",hidden:!0},{field:"appliedOn",title:"Applied On",width:"90px",template:"#= kendo.toString(kendo.parseDate(appliedOn), 'dd MMM yyyy') #"},{field:"leaveYear",title:"Year",width:"60px"},{field:"leaveType",title:"Leave Type",width:"150px"},{field:"fromDate",title:"From",width:"150px",template:"#= kendo.toString(kendo.parseDate(fromDate), 'ddd, dd MMM yyyy') #"},{field:"toDate",title:"To",width:"150px",template:"#= kendo.toString(kendo.parseDate(toDate), 'ddd, dd MMM yyyy') #"},{field:"leaveDay",title:"Leave",width:"60px"},{field:"numberOfWeeks",title:"Weeks",format:"{0:n1}",width:"80px"},{field:"numberOfDays",title:"Days",format:"{0:n1}",width:"80px"},{field:"reasonForLeave",title:"Remarks",width:"200px"},{field:"leaveStatus",title:"Status",width:"100px",template:function(n){return n.isCancellationRequested?"Pending Cancellation":n.leaveStatus}},{template:function(n){switch(n.leaveStatus){case"Pending":return"<div class='pointer' title='Edit Leave' onclick='EditEmployeeLeaveInfo("+n.leaveId+")'><img src='"+baseURL+"images/edit.png' class='img-responsive' /><\/div>";default:return""}},width:"40px"},{template:function(n){if(n.isCancellationRequested&&n.leaveStatus!="Pending")return"";switch(n.leaveStatus){case"Pending":return"<div class='pointer'  title='Cancel Leave'  onclick='CancelLeave("+n.leaveId+","+n.maternityTypeId+")'><img src='"+baseURL+"images/cancel_red.png' class='img-responsive' /><\/div>";case"Approved":return'<div class="pointer" title="Request for Cancellation" onclick="RequestCancellation(\''+n.leaveId+"','"+n.leaveStatus+'\')"><img src="'+baseURL+'images/cancel_red.png" class="img-responsive" /><\/div>';case"Approved But Not Taken":return'<div class="pointer" title="Request for Cancellation" onclick="RequestCancellation(\''+n.leaveId+"','"+n.leaveStatus+'\')"><img src="'+baseURL+'images/cancel_red.png" class="img-responsive" /><\/div>';default:return""}},width:"40px"},{template:"<div class='pointer' title='Leave Details' onclick='LoadEmployeeLeaveInfo(\"#:leaveId#\")'><img src='"+baseURL+"images/info_line.png' class='img-responsive' /><\/div>",width:"40px"},],dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};MyLeavesView.prototype.FilterEmployeeLeavesGrid=function(){var i=$("#ddlFilterLeaveType").find(":selected").text(),r=$("#ddlFilterLeaveStatus").find(":selected").text(),n=GetDateInFormat($("#filterFromDt").val(),"yyyy-MM-ddT00:00:00"),t=GetDateInFormat($("#filterToDt").val(),"yyyy-MM-ddT00:00:00");doApplyGridFilter("EmployeeLeavesGrid","eq","leaveType",i==""?0:i);doApplyGridFilter("EmployeeLeavesGrid","eq","leaveStatus",r==""?0:r);doApplyGridFilter("EmployeeLeavesGrid","gte","fromDate",n==""||n==null?0:n);doApplyGridFilter("EmployeeLeavesGrid","lte","toDate",t==""||t==null?0:t)};MyLeavesView.prototype.ClearFilterFields=function(){$('#ddlFilterLeaveType option[value=""], #ddlFilterLeaveStatus option[value=""]').attr("selected",!0);$("#ddlFromDate, #ddlToDate").datepicker("setDate",null)};MyLeavesView.prototype.LoadEmployeeLeaveSummaryGrid=function(){function i(){setTimeout(function(){KGrdPageSizeDdlPosition("EmployeeLeaveSummaryGird",1)},1)}var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeeLeaveSummary",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{employeeId:$("#ddlBossLeave").val(),isMyLeavePage:!0}}},batch:!0,pageSize:10,schema:{model:{id:"employeeLeaveSummaryId",fields:{employeeLeaveSummaryId:{editable:!1},leaveType:{editable:!1},periodType:{editable:!1},cyl:{editable:!1},lycf:{editable:!1},lycfTaken:{editable:!1},lycfLapsed:{editable:!1},encash:{editable:!1},overdrawn:{editable:!1},paid:{editable:!1},unpaid:{editable:!1},taken:{editable:!1},pending:{editable:!1},balance:{editable:!1}}}}});$("#EmployeeLeaveSummaryGird").kendoGrid({dataSource:t,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,dataBound:i,columns:[{title:"Sno",template:function(){return++n},width:45},{field:"employeeLeaveSummaryId",title:"#",hidden:!0},{field:"leaveType",title:"Leave Type",width:"140px"},{field:"periodType",title:"Period Type",width:"90px"},{field:"cyl",title:"CYL",width:"50px"},{field:"lycf",title:"LYCF",width:"50px",template:function(n){return n.lycfLapseDate!=""?'<span style="width:100%;height:100%; cursor:pointer" title="Lapse Date: '+n.lycfLapseDate+'">'+n.lycf+"<\/span>":'<span style="width:100%;height:100%">'+n.lycf+"<\/span>"}},{field:"lycfTaken",title:"LYCF Taken",width:"80px"},{field:"lycfLapsed",title:"LYCF Lapsed",width:"80px"},{field:"encash",title:"Encashment",width:"80px",hidden:$("#hdnLeaveEncashmentAllowed").val()=="TRUE"?!1:!0},{field:"overdrawn",title:"Overdrawn",width:"80px"},{field:"paid",title:"Paid",width:"60px"},{field:"unpaid",title:"Un Paid",width:"60px"},{field:"taken",title:"Taken",width:"60px"},{field:"pending",title:"Pending",width:"60px"},{field:"balance",title:"Balance Leave",width:"90px"}],dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};ApproveLeaveRequestView.prototype.Init=function(){var n=this;$("#btnValidateAndApproveLeave").click(function(){var t=$("#hdnLeaveId").val().trim(),n;if(t==0){ShowAlertBox("Invalid leave request id, Please try again.");return}n=$.post(baseURL+"Employee/ValidateAndApproveLeave",{leaveId:t});n.done(function(n){n!=""?$.when(showConfirmationWindow(n)).then(function(n){n&&(window.location.href=baseURL+"Dashboard/Index")}):$.when(showConfirmationWindow("Error while approving leave")).then(function(n){n&&(window.location.href=baseURL+"Dashboard/Index")})});n.fail(function(){$.when(showConfirmationWindow("Error while approving leave")).then(function(n){n&&(window.location.href=baseURL+"Dashboard/Index")})})});$("#btnValidateAndRejectLeave").click(function(){var n=$("#hdnLeaveId").val().trim();if(n==0){ShowAlertBox("Invalid leave request id, Please try again.");return}$("#txtLeaveRejectionReason").val("");$("#RejectLeaveModal").modal()});$("#btnRejectleave").click(function(){var i=$("#hdnLeaveId").val().trim(),n,t;if(i==0){ShowAlertBox("Invalid leave request id, Please try again.");return}if(n=$("#txtLeaveRejectionReason").val().trim(),n==""){ShowAlertBox("Please enter rejection reason.");return}t=$.post(baseURL+"Employee/ValidateAndRejectLeave",{leaveId:i,rejectionReason:n});t.done(function(n){n!=""?$.when(showConfirmationWindow(n)).then(function(n){n&&(window.location.href=baseURL+"Dashboard/Index")}):$.when(showConfirmationWindow("Error while rejecting leave")).then(function(n){n&&(window.location.href=baseURL+"Dashboard/Index")})});t.fail(function(){$.when(showConfirmationWindow("Error while rejecting leave")).then(function(n){n&&(window.location.href=baseURL+"Dashboard/Index")})})})};EmployeeEmployeementSalaryView.prototype.Init=function(){var t=this,s=$("#hdnBaseCountry").val().trim(),h=5,u=$(".input_fields_wrap"),c=$(".add_field_button"),n=1,r,l,f,e,o;t.HandleCountryBasedChangesEmploymentInfo(s);ValidateAndScrollToEmptyField();this.SetBasicSalAmountHelptext();this.SetDatesBasedOnEmployeeStatus(!0);this.SetPositionOfControls();this.LoadLeaveSummaryGrid();this.LoadEmployeePayItemGrid();this.LoadEmployeeDocumentGrid();$("#ddlWorkWeek").val()!="Custom"&&$("#divCustomWeek").hide();$("#ddlWorkWeek").change(function(){$(this).val()=="Custom"?$("#divCustomWeek").show():($("#divCustomWeek").hide(),$(".error-WorkWeek-day").hide())});r=new Date(kendo.parseDate($("#dtBirthDate").val(),"dd/MM/yyyy"));l=new Date(r.getFullYear(),r.getMonth(),r.getDate());$("#dtJoiningDiv").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("changeDate",function(n){var t;n.date!=undefined&&($("#dtProbationEnd").is(":disabled")?$("#dtConfirmation").is(":disabled")?$("#dtResignation").is(":disabled")||(t=$("#dtResignationDiv")):t=$("#dtConfirmationDiv"):t=$("#dtProbationEndDiv"),t!=undefined&&t!=null&&t.datepicker("getDate")!=null&&t.datepicker("getDate")<n.date&&t.datepicker("setDate",null),AddOrMinusDayFromDate(new Date(n.date.valueOf()),"dtProbationEndDiv",!0,0,"setStartDate"),AddOrMinusDayFromDate(new Date(n.date.valueOf()),"dtConfirmationDiv",!0,0,"setStartDate"),AddOrMinusDayFromDate(new Date(n.date.valueOf()),"dtResignationDiv",!0,0,"setStartDate"))});$("#dtProbationEndDiv").datepicker({format:"dd/M/yyyy",autoclose:!0,orientation:"bottom"}).on("changeDate",function(n){n.date!=undefined&&EmployeeEmployeementSalaryView.prototype.SetJoiningDtPickerDt(n.date,n.date.valueOf())});$("#dtConfirmationDiv").datepicker({format:"dd/M/yyyy",autoclose:!0,orientation:"bottom"}).on("changeDate",function(n){n.date!=undefined&&EmployeeEmployeementSalaryView.prototype.SetJoiningDtPickerDt(n.date,n.date.valueOf())});$("#dtResignationDiv").datepicker({format:"dd/M/yyyy",autoclose:!0,orientation:"bottom"}).on("changeDate",function(n){n.date!=undefined&&EmployeeEmployeementSalaryView.prototype.SetJoiningDtPickerDt(n.date,n.date.valueOf())});f=$("#ddlCompanyCurrency > option").length;f==2&&($("#ddlCompanyBaseCurrency").val($("#ddlCompanyBaseCurrency option:eq(1)").val()).attr("selected","selected"),$("#ddlCompanyCurrency").val($("#ddlCompanyCurrency option:eq(1)").val()).attr("selected","selected"),$("#ddlReimburseCurrency").val($("#ddlCompanyCurrency").val()),$("#lblSalaryCurrency").text($("#ddlCompanyCurrency option:selected").text()));$("#lblSalaryCurrency").text($("#ddlCompanyCurrency option:selected").text());e=$("#ddlCPFAccountNum > option").length;e==2&&$("#ddlCPFAccountNum").val($("#ddlCPFAccountNum option:eq(1)").val()).attr("selected","selected");$("#ddlCompanyBaseCurrency").change(function(){var n=$("#ddlCompanyBaseCurrency").val();n!=""&&($("#ddlCompanyCurrency").val(n).attr("selected","selected"),$("#ddlReimburseCurrency").val(n).attr("selected","selected"),$("#lblSalaryCurrency").text($("#ddlCompanyCurrency option:selected").text()))});$("#ddlCompanyCurrency").change(function(){var n=$("#ddlCompanyCurrency").val();n!=""&&$("#ddlReimburseCurrency").val(n).attr("selected","selected")});$("#ddlReimburseCurrency").change(function(){var t=$("#PaymentDetail_PaymentDetailId").val(),n;t!=""&&(n=ShowConfirmationAlertBox("This change in reimbursement currency will affect the future expense reports. <br> Click OK to continue."),n.then(function(){return $("#ddlReimburseCurrency").attr("prevVal",$("#ddlReimburseCurrency").val()),!0},function(){return $("#ddlReimburseCurrency").val($("#ddlReimburseCurrency").attr("prevVal")),$("#ddlReimburseCurrency").parent(".form-group").hasClass("has-error has-danger")&&$("#ddlReimburseCurrency").parent(".form-group").removeClass("has-error has-danger"),!1}))});$("#hdnReimburseInPayroll").val()=="TRUE";$("#ddlCompanyCurrency").change(function(){$("#hdnReimburseInPayroll").val()=="TRUE"?($("#ddlReimburseCurrency").val($("#ddlCompanyCurrency").val()),$("#lblSalaryCurrency").text($("#ddlCompanyCurrency option:selected").text())):$("#lblSalaryCurrency").text($("#ddlCompanyCurrency option:selected").text())});$("#ddlBasicSalaryType").change(function(){t.SetBasicSalAmountHelptext()});o=$("#dtJoining").val();o==""?$("#ddlEmployeeStatus").prop("disabled",!0):$("#ddlEmployeeStatus").prop("disabled",!1);$("#dtJoining").on("change",function(){var n=$("#dtJoining").val();n==""?$("#ddlEmployeeStatus").prop("disabled",!0):$("#ddlEmployeeStatus").prop("disabled",!1)});$("#ddlEmployeeStatus").find("option:selected").val()=="Probation"&&AddOrMinusDayFromDate(new Date($("#dtJoining").val()),"dtProbationEndDiv",!0,0,"setStartDate");$("#ddlEmployeeStatus").on("change",function(){t.SetDatesBasedOnEmployeeStatus(!1)});$("#linkUploadEmpDocument").click(function(t){t.preventDefault();$("#ddlEmpDocumentType").val("");$("#lblFileName").html("No file chosen");$(".xAddedItems").remove();n=1;for(var i=2;i<=n;i++)$("#ddlEmpDocumentType"+i).val(""),$("#lblFileName"+i).html("No file chosen"),$("#lblErrorMedia"+i).html("");$("#lblErrorMedia").html("");$("#uploadEmpDocumentPopup").modal()});$(c).click(function(i){var o,r,s,f,e;i.preventDefault();i.stopImmediatePropagation();n<h&&(n++,$(u).append('<div class="row xAddedItems" id="div'+n+'"><div class="col-md-5"><div class="form-group"><div class="packageOfListDocType'+n+'"><\/div><\/div><\/div><div class="col-md-6"><div class="form-group"><div id="divUploadEmpDocument"><div class="packageOfUploadDoc'+n+'"><\/div><\/div><\/div><\/div><div class="col-md-1 displayInlineBlock"><div class="sm-padding-top10"><label class="addMore displayInlineBlock remove_row"><img src="'+baseURL+'images/delete_blue.png" class="img-responsive" /><button id="'+n+'" type="button" class="remove_field"><\/button><\/label><\/div><\/div><\/div>'),o=$(".listDocType").clone().prop("id","ddlEmpDocumentType"+n),o.removeClass("listDocType"),$(".packageOfListDocType"+n).html(o),r=$(".uploadEmpDoc").clone().prop("id","fileUploadEmpDocument"+n),r.removeClass("uploadEmpDoc"),r.val(""),s=$(".lbluploadEmpDoc").clone().prop("for","fileUploadEmpDocument"+n),s.removeClass("lbluploadEmpDoc"),f=$(".lblFileName").clone().prop("id","lblFileName"+n),f.removeClass("lblFileName"),f.html("No file chosen"),e=$(".lblErrorMedia").clone().prop("id","lblErrorMedia"+n),e.removeClass("lblErrorMedia"),e.html(""),$(".packageOfUploadDoc"+n).html(r),$(".packageOfUploadDoc"+n).append(s),$(".packageOfUploadDoc"+n).append(f),$(".packageOfUploadDoc"+n).append(e),t.RegisterFileUploadChangeEvents(n))});$(u).on("click",".remove_row",function(t){var i=$(t.target).closest(".row").find(".remove_field").attr("id");t.preventDefault();t.stopImmediatePropagation();$("#div"+i).remove();n--});$("#fileUploadEmpDocument").change(function(n){var i=$("#fileUploadEmpDocument"),r=$("#lblFileName"),u=$("#lblErrorMedia"),t;ValidateDocument(i,r,u)&&(t=n.target.files[0].name,$("#lblFileName").text(t))});$("#btnEmpUploadDocument").click(function(i){var e,r,u,o,f;for(i.preventDefault(),o=0,f=1;f<=n;f++)e="",r=null,u=null,f==1?(r=$("#fileUploadEmpDocument").get(0),e=$("#ddlEmpDocumentType option:selected").text()):(r=$("#fileUploadEmpDocument"+f).get(0),e=$("#ddlEmpDocumentType"+f+" option:selected").text()),u=r.files,e!=""&&(u[0]!=null||u[0]!=undefined)&&(empDocumentData=new FormData,r.files.length>0&&(empDocumentData.append(u[0].name,u[0]),empDocumentData.append("parameterDocumentType",e),empDocumentData.append("parameterEmployeeId",$("#EmployeeId").val()),t.UploadEmpDocument(empDocumentData),o++,r.value=""));if(o==0){ShowAlertBox("Please select document type(s) and upload a valid file(s)");return}$("#uploadEmpDocumentPopup").modal("toggle");ShowAlertBox("Employee document(s) uploaded successfully");refreshGrid($("#EmployeeDocumentGrid"));event.stopImmediatePropagation()});$("#btnEmploymentInfoClear").click(function(n){n.preventDefault();$("#EmpEmploymentInfo").find("input:text, input:password, input:file, select, textarea").val("");$("#EmpEmploymentInfo").find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected")});$("#EmpEmploymentInfo").submit(function(){if($("#ddlWorkWeek").val()=="Custom"){var n=$("#divCustomWeek input[type=checkbox]:checked");return n.length==0?($(".error-WorkWeek-day").show(),!1):!0}});$("#btnAddEmployeePayItem").click(function(n){var u;n.preventDefault();var f=$("#EmployeeId").val(),e=$("#ddlEmployeePayItems").val(),r=[];if(f===undefined||e==null){ShowAlertBox("Please select pay item(s) to add");return}u=$("#EmployeePayItemGrid").data("kendoGrid").dataSource._data;$.each($("#ddlEmployeePayItems option:selected"),function(){var o=$("#ddlEmployeePayItems"),n=!1,e={CompanyPayItemId:$(this).val(),EmployeeId:f};if(u.length>0)for(i=0;i<u.length;i++)if(u[i].companyPayItemId==$(this).val()){n=!0;r.push($(this).text()+" - Pay Item already Exists");break}else u.length-1==i&&n==!1&&(t.AddEmployeePayItem(e)?r.push($(this).text()+" - Pay Item added successfully"):r.push($(this).text()+" - Error occured while adding"));else t.AddEmployeePayItem(e)?r.push($(this).text()+" - Pay Item added successfully"):r.push($(this).text()+" - Error occured while adding")});ShowSummaryBox("Bulk Add Employee Pay Items Summary",r);$("#ddlEmployeePayItems").multiselect("clearSelection");refreshGrid($("#EmployeePayItemGrid"));event.stopImmediatePropagation()});$("#btnDeleteEmployeePayItem").click(function(n){var i;if(n.preventDefault(),i=$("#EmployeePayItemGrid tbody").find("input:checked").length,i<=0){ShowAlertBox("Please select pay item(s) to delete");return}var r=!0,u=0,f=ShowConfirmationAlertBox("Are you sure about deleting selected pay item(s)?");f.then(function(){$("#EmployeePayItemGrid").find("input:checked").each(function(){this.id!="header-chk"&&(r=t.DeleteEmployeePayItem(this.id),r&&(RemoveItemFromGrid("EmployeePayItemGrid",this.id),u++))});i===u?ShowAlertBox("Pay item(s) deleted successfully"):ShowAlertBox("Error while deleting pay item(s)")})});$("#ddlLeaveType").multiselect({buttonWidth:"100%",maxHeight:300,numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size"});$("#ddlEmployeePayItems").multiselect({buttonWidth:"100%",maxHeight:200,numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size"});$("#btnAddEmployeeLeave").click(function(n){var o,r,f,e,u,s;if(n.preventDefault(),o=$("#EmployeeId").val(),r=$("#ddlLeaveType").val(),o===undefined||r==null){ShowAlertBox("Please select leave type to add");return}for(f=[],e=$("#LeaveSummaryGrid").data("kendoGrid").dataSource._data,u=0;u<r.length;u++)if(s=!1,e.length>0)for(i=0;i<e.length;i++)if(e[i].leaveType==r[u]&&e[i].year==(new Date).getFullYear()){s=!0;f.push(r[u]+" - Already Exists");break}else e.length-1==i&&s==!1&&(t.AddEmployeeLeaveSummary(o,r[u])?f.push(r[u]+" - Added successfully"):f.push(r[u]+" - Error occured while adding"));else t.AddEmployeeLeaveSummary(o,r[u])?f.push(r[u]+" - Added successfully"):f.push(r[u]+" - Error occured while adding");ShowSummaryBox("Bulk Add Employee Leaves Summary",f);$("#ddlLeaveType").multiselect("clearSelection");refreshGrid($("#LeaveSummaryGrid"));event.stopImmediatePropagation()});$("#btnDeleteEmployeeLeave").click(function(n){var r;if(n.preventDefault(),r=$("#LeaveSummaryGrid tbody").find("input:checked").length,r<=0){ShowAlertBox("Please select leave type(s) to delete");return}var u=!0,i=[],f=ShowConfirmationAlertBox("Are you sure about deleting selected leave type(s)?");f.then(function(){$("#LeaveSummaryGrid tbody").find("input:checked").each(function(){var n=$("#LeaveSummaryGrid").data("kendoGrid").dataSource.get(this.id);n!=null&&n!=undefined&&(n.pending===0&&n.taken===0&&n.lycfTaken===0?(u=t.DeleteEmployeeLeaveSummary(this.id),u?(i.push(n.leaveType+" - Leave type deleted successfully"),RemoveItemFromGrid("LeaveSummaryGrid",this.id)):i.push(n.leaveType+" - Error while deleting leave type")):i.push(n.leaveType+" - Leave(s) already applied for this leave type, can't delete now"))});ShowSummaryBox("Bulk Delete Summary",i)})});$("#hdnHasPayrollModuleAccess").val()=="FALSE"&&($("#ddlBankName, #txtAccountName, #txtBranchCode, #txtAccountNumber").prop("required",!1),$("label[for='ddlBankName'], label[for='txtAccountName'], label[for='txtBranchCode'], label[for='txtAccountNumber']").removeClass("required"),$("#ddlPaymentMode, #ddlCompanyCurrency, #ddlReimburseCurrency, #ddlCompanyBaseCurrency").prop("required",!1),$("label[for='ddlPaymentMode'], label[for='ddlCompanyCurrency'], label[for='ddlReimburseCurrency'], label[for='ddlCompanyBaseCurrency']").removeClass("required"));t.MakeBankInformationRequired();$("#ddlPaymentMode").change(function(){t.MakeBankInformationRequired()});$("#linkAddJobTitle").click(function(n){n.preventDefault();$("#txtListItemName").val("");$("#hdnListName").val("JobTitle");$("#AddListItem").modal()});$("#linkAddDepartment").click(function(n){n.preventDefault();$("#txtListItemName").val("");$("#hdnListName").val("Department");$("#AddListItem").modal()});$("#frmListItemName").submit(function(n){var t,r,u,f,e;if(n.preventDefault(),t=$("#txtListItemName").val(),r=$("#hdnListName").val(),!(t.length<=0)&&!(r.length<=0)){for(r=="JobTitle"&&(u=$("#ddlJobTitle>option").map(function(){return $(this).val()})),r=="Department"&&(u=$("#ddlDepartment>option").map(function(){return $(this).val()})),f=!1,i=0;i<u.length;i++)u[i].trim().toLowerCase()==t.trim().toLowerCase()&&(f=!0);if(f){ShowAlertBox("List item already exists.");return}e=$.post(baseURL+"Settings/AddListItemName",{listName:$("#hdnListName").val(),listItemName:t});e.done(function(n){n?($("#AddListItem").modal("hide"),ShowAlertBox("List item added successfully."),r=="JobTitle"&&($("#ddlJobTitle").append($("<option>",{value:t,text:t})),SortDropDownListByText("ddlJobTitle")),r=="Department"&&($("#ddlDepartment").append($("<option>",{value:t,text:t})),SortDropDownListByText("ddlDepartment")),$("#txtListItemName").val("")):ShowAlertBox("Error while adding list item.")});e.fail(function(){ShowAlertBox("Error while adding list item.")})}});$("#AddListItem").on("hidden.bs.modal",function(){$(this).find("#frmListItemName .has-error.has-danger").removeClass("has-error has-danger")});$("#txtEmpCode").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpEmpCode").html("Checking..."),n=$.get(baseURL+"Employee/CheckEmployeeCodeExistence",{empCode:$(this).val()}),n.done(function(n){n?($("#txtEmpCode").addClass("error-box"),$("#helpEmpCode").html("Employee code already taken!"),$("#txtEmpCode").focus(),$("#txtEmpCode").attr("isCodeAlreadyTaken",!0)):($("#txtEmpCode").removeClass("error-box"),$("#helpEmpCode").html(""),$("#txtEmpCode").removeAttr("isCodeAlreadyTaken"))}),n.fail(function(){$("#helpEmpCode").html("Error while verifying Employee Code!")}))});$("#btnEmploymentInfoSave").on("click",function(n){if($("#btnEmploymentInfoSave").hasClass("XDisabled")){n.preventDefault();return}var t=$("#txtEmpCode").attr("isCodeAlreadyTaken");typeof t!=typeof undefined&&(ShowAlertBox("Employee Code is already taken. Please enter another employee code."),$("#txtEmpCode").focus(),n.preventDefault());AvoidMultipleSubmit("btnEmploymentInfoSave","EmpEmploymentInfo")});$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#btnEmpBasicInfoSave").hover(function(){$(this).removeClass("XDisabled")})};EmployeeEmployeementSalaryView.prototype.HandleCountryBasedChangesEmploymentInfo=function(n){n=="Indonesia"&&($("#dtJoining, #ddlPaymentMode").prop("required",!1),$("label[for='dtJoining'], label[for='ddlPaymentMode']").removeClass("required"))};EmployeeEmployeementSalaryView.prototype.MakeBankInformationRequired=function(){var n=$("#ddlPaymentMode").val();n.toUpperCase()=="INTERBANK GIRO"?($("#ddlBankName, #txtAccountName, #txtBranchCode, #txtAccountNumber").prop("required",!0),$("label[for='ddlBankName'], label[for='txtAccountName'], label[for='txtBranchCode'], label[for='txtAccountNumber']").addClass("required")):n.toUpperCase()=="INTERNET BANKING"?($("#ddlBankName, #txtAccountName, #txtAccountNumber").prop("required",!0),$("#txtBranchCode").prop("required",!1),$("label[for='ddlBankName'], label[for='txtAccountName'], label[for='txtAccountNumber']").addClass("required"),$("label[for='txtBranchCode']").removeClass("required")):($("#ddlBankName, #txtAccountName, #txtBranchCode, #txtAccountNumber").prop("required",!1),$("label[for='ddlBankName'], label[for='txtAccountName'], label[for='txtBranchCode'], label[for='txtAccountNumber']").removeClass("required"))};EmployeeEmployeementSalaryView.prototype.SetJoiningDtPickerDt=function(n,t){var i=$("#dtJoiningDiv").datepicker("getDate");i!=null&&n<i&&$("#dtJoiningDiv").datepicker("setDate",null);AddOrMinusDayFromDate(new Date(t),"dtJoiningDiv",!0,0,"setEndDate")};EmployeeEmployeementSalaryView.prototype.AddEmployeeLeaveSummary=function(n,t){var i=!1;return $.ajax({url:baseURL+"Employee/AddEmployeeLeaveSummary",data:{companyLeaveType:t,employeeId:n},type:"POST",async:!1,success:function(){i=!0},error:function(){i=!1}}),i};EmployeeEmployeementSalaryView.prototype.DeleteEmployeeLeaveSummary=function(n){var i=$("#EmployeeId").val(),r={EmployeeLeaveSummaryId:n,employeeId:i},t=!1;return $.ajax({url:baseURL+"Employee/DeleteEmployeeLeaveSummary",data:r,type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};EmployeeEmployeementSalaryView.prototype.RegisterFileUploadChangeEvents=function(n){$("#fileUploadEmpDocument"+n).change(function(t){var r=$("#fileUploadEmpDocument"+n),u=$("#lblFileName"+n),f=$("#lblErrorMedia"+n),i;ValidateDocument(r,u,f)&&(i=t.target.files[0].name,$("#lblFileName"+n).text(i))})};EmployeeEmployeementSalaryView.prototype.UploadEmpDocument=function(n){$.ajax({type:"POST",url:baseURL+"Employee/UploadEmployeeDocument",async:!1,contentType:!1,processData:!1,data:n,success:function(){return},error:function(){ShowAlertBox("Error while uploading employee document")}})};EmployeeEmployeementSalaryView.prototype.AddEmployeePayItem=function(n){var t=!1;return $.ajax({url:baseURL+"Employee/AddEmployeePayItem",data:n,type:"POST",async:!1,success:function(){t=!0},error:function(){t=!1}}),t};EmployeeEmployeementSalaryView.prototype.DeleteEmployeePayItem=function(n){var i=$("#EmployeeId").val(),r={employeePayItemId:n,employeeId:i},t=!1;return $.ajax({url:baseURL+"Employee/DeleteEmployeePayItem",data:r,type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};EmployeeEmployeementSalaryView.prototype.SetDatesBasedOnEmployeeStatus=function(n){var t=$("#ddlEmployeeStatus").find("option:selected").val();t==="Probation"?($("#dtConfirmation").prop("disabled",!0),$("#dtResignation").prop("disabled",!0),$("#dtProbationEnd").prop("disabled",!1),n||$("#dtProbationEndDiv").datepicker("setStartDate",kendo.toString(new Date($("#dtJoiningDiv").datepicker("getDate")),"dd/MMM/yyyy"))):t==="Confirmed"?($("#dtConfirmation").prop("disabled",!1),$("#dtResignation").prop("disabled",!0),$("#dtProbationEnd").prop("disabled",!0),n||$("#dtConfirmationDiv").datepicker("setStartDate",kendo.toString(new Date($("#dtJoiningDiv").datepicker("getDate")),"dd/MMM/yyyy"))):t==="Resigned"?($("#dtConfirmation").prop("disabled",!0),$("#dtResignation").prop("disabled",!1),$("#dtProbationEnd").prop("disabled",!0),n||$("#dtResignationDiv").datepicker("setStartDate",kendo.toString(new Date($("#dtJoiningDiv").datepicker("getDate")),"dd/MMM/yyyy"))):$("#dtConfirmation, #dtResignation, #dtProbationEnd").prop("disabled",!0)};EmployeeEmployeementSalaryView.prototype.SetBasicSalAmountHelptext=function(){var n=$("#ddlBasicSalaryType").find(":selected").val();n==""&&$("#ddlBasicSalaryType").val("Monthly");n==="Monthly"?$("#lblAmountUnit").html("Per Month"):n==="Weekly"?$("#lblAmountUnit").html("Per Week"):n==="Daily"?$("#lblAmountUnit").html("Per Day"):n==="Hourly"?$("#lblAmountUnit").html("Per Hour"):n==="Bi-Monthly"&&$("#lblAmountUnit").html("Per Semi-Month")};EmployeeEmployeementSalaryView.prototype.SetPositionOfControls=function(){var n=$("#ddlBankName").css("padding-top"),t=$("#ddlBankName").css("padding-bottom");$("#btnGroupAddDelete, #divPerMonth").css("padding-top",n);$(".reduceHeight").css("height",$(".reduceHeight").outerHeight()-3)};EmployeeEmployeementSalaryView.prototype.LoadLeaveSummaryGrid=function(){function n(){if(this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}setTimeout(function(){$("#LeaveSummaryGrid a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");$("#LeaveSummaryGrid div.k-grouping-header").css("display","none");$("#LeaveSummaryGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Leave Summary");$("#LeaveSummaryGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#LeaveSummaryGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Leave Summary");$("#LeaveSummaryGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$("#LeaveSummaryGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Leave Summary");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");KGrdPageSizeDdlPosition("LeaveSummaryGrid",0);$("#LeaveSummaryGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("LeaveSummaryGrid")});$("#LeaveSummaryGrid tbody tr.k-grouping-row").find("a.k-icon").on("click",function(){$(this).hasClass("k-i-expand")&&$("#LeaveSummaryGrid tbody tr.k-grouping-row").find("a.k-icon.k-i-collapse").trigger("click")})},1)}var i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeeLeaveSummary",dataType:"json"},update:{url:baseURL+"Employee/UpdateEmployeeLeaveSummary",dataType:"json"},destroy:{url:baseURL+"Employee/DeleteEmployeeLeaveSummary",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models){if(t=="destroy"){var i=$("#LeaveSummaryGrid").data("kendoGrid").dataSource.data();if(i)for(idx=0;idx<i.length;idx++)i[idx].year==n.models[0].year&&i[idx].employeeLeaveSummaryId!=n.models[0].employeeLeaveSummaryId&&i[idx].srNo>n.models[0].srNo&&(i[idx].srNo=i[idx].srNo-1)}return{empLeaveSummary:kendo.stringify(n.models)}}if(t==="read")return{employeeId:$("#EmployeeId").val()}}},batch:!0,pageSize:10,group:{field:"year",dir:"desc"},schema:{model:{id:"employeeLeaveSummaryId",fields:{srNo:{editable:!1},employeeLeaveSummaryId:{editable:!1},leaveType:{editable:!1},periodType:{editable:!1},year:{editable:!1},cyl:{editable:!0,type:"number",validation:{required:!0,cylValidation:function(n){return n.is("[name='cyl']")&&n.val()!=""?(n.attr("data-cylValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},lycf:{editable:!0,type:"number",validation:{required:!0,lycfValidation:function(n){return n.is("[name='lycf']")&&n.val()!=""?(n.attr("data-lycfValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},lycfTaken:{editable:!1},lycfLapsed:{editable:!1},encash:{editable:!1,type:"number",validation:{required:!0,encashValidation:function(n){return n.is("[name='encash']")&&n.val()!=""?(n.attr("data-encashValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},overdrawn:{editable:!1,type:"number",validation:{required:!0,overdrawnValidation:function(n){return n.is("[name='overdrawn']")&&n.val()!=""?(n.attr("data-overdrawnValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},paid:{editable:!1,type:"number",validation:{required:!0,paidValidation:function(n){return n.is("[name='paid']")&&n.val()!=""?(n.attr("data-paidValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},unpaid:{editable:!1,type:"number",validation:{required:!0,unpaidValidation:function(n){return n.is("[name='unpaid']")&&n.val()!=""?(n.attr("data-unpaidValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},taken:{editable:!1,type:"number",validation:{required:!0,takenValidation:function(n){return n.is("[name='taken']")&&n.val()!=""?(n.attr("data-takenValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},pending:{editable:!1,type:"number",validation:{required:!0,pendingValidation:function(n){return n.is("[name='pending']")&&n.val()!=""?(n.attr("data-pendingValidation-msg","Invalid"),/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},balance:{editable:!1,type:"number"}}}}}),t;$("#LeaveSummaryGrid").kendoGrid({dataSource:i,groupable:!0,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.employeeLeaveSummaryId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeLeaveSummaryId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-leave" class="checkAll"><label class="checkbox-inline" for="header-chk-leave"><\/label>',width:"40px"},{field:"srNo",title:"#",width:30},{field:"employeeLeaveSummaryId",hidden:!0},{field:"year",attributes:{data_year:"#:data.year#"},title:"Year",width:"50px"},{field:"leaveType",title:"Leave Type",width:"130px"},{field:"periodType",title:"Period Type",width:"85px"},{field:"cyl",title:"CYL",width:"50px"},{field:"lycf",title:"LYCF",width:"50px",template:function(n){return n.lycfLapseDate!=""?'<span style="width:100%;height:100%; cursor:pointer" title="Lapse Date: '+n.lycfLapseDate+'">'+n.lycf+"<\/span>":'<span style="width:100%;height:100%">'+n.lycf+"<\/span>"}},{field:"lycfTaken",title:"LYCF Taken",width:"85px"},{field:"lycfLapsed",title:"LYCF Lapsed",width:"95px"},{field:"encash",title:"Encashment",width:"90px",hidden:$("#hdnLeaveEncashmentAllowed").val()=="TRUE"?!1:!0},{field:"overdrawn",title:"Overdrawn",width:"80px"},{field:"paid",title:"Paid",width:"50px"},{field:"unpaid",title:"Un Paid",width:"65px"},{field:"taken",title:"Taken",width:"55px"},{field:"pending",title:"Pending",width:"70px"},{field:"balance",title:"Balance",width:"70px"},{command:[{name:"edit",text:{edit:" ",update:" ",cancel:" "},className:"ob-update"},{name:"destroy",text:"",visible:function(n){return n.pending===0&&n.taken===0&&n.lycfTaken===0}}],title:"&nbsp;",width:"80px"}],editable:"inline",edit:n,dataBound:n,cancel:n,dataBinding:function(){$("#LeaveSummaryGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk-leave",function(){$("#LeaveSummaryGrid tbody input:checkbox").prop("checked",this.checked)});t=$("#LeaveSummaryGrid").data("kendoGrid");t.dataSource.bind("change",function(n){if(n.action==="itemchange"){n.items[0].balance=0;var t=parseFloat(n.items[0].cyl),i=parseFloat(n.items[0].lycf),r=parseFloat(n.items[0].lycfLapsed),e=parseFloat(n.items[0].encash),o=parseFloat(n.items[0].overdrawn),u=parseFloat(n.items[0].paid),s=parseFloat(n.items[0].unpaid),h=parseFloat(n.items[0].taken),f=parseFloat(n.items[0].pending);n.items[0].balance=t+i-r-u-f}})};EmployeeEmployeementSalaryView.prototype.LoadEmployeePayItemGrid=function(){function n(){if(this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}setTimeout(function(){$("#EmployeePayItemGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Pay Item");$("#EmployeePayItemGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#EmployeePayItemGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Pay Item");$("#EmployeePayItemGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$("#EmployeePayItemGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Pay Item");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");KGrdPageSizeDdlPosition("EmployeePayItemGrid",1);$("#EmployeePayItemGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("EmployeePayItemGrid")});$("#EmployeePayItemGrid a.k-grid-update.grid-update").on("click",function(){var n=$(this).closest("tr"),t=n.find("#pickerStartDate"),i=n.find("#pickerEndDate"),u=n.find("#txtAmountBasedOn"),r=n.find("#txtValue"),e=n.find("#txtHours"),o=n.find("#pickerPeriodFrom"),s=n.find("#pickerPeriodTo"),f=$("#EmployeePayItemGrid").data("kendoGrid").dataItem(n);f.frequency==="Fixed"?(r.val().trim()!=""&&r.attr("attr-value")!=r.val().trim()||t.val().toLowerCase()!=t.attr("start-dt").toLowerCase()||i.val().toLowerCase()!=i.attr("end-dt").toLowerCase())&&(t.attr("start-dt",t.val()),i.attr("end-dt",i.val()),r.attr("attr-value",r.val()),f.dirty||HandleUpdateEvent("#EmployeePayItemGrid",baseURL+"Employee/UpdateEmployeePayItem",{payItemData:JSON.stringify([f])})):(u.val().trim()!=""&&u.attr("attr-amountBasedOn")!=u.val().trim()||t.val().toLowerCase()!=t.attr("start-dt").toLowerCase()||i.val().toLowerCase()!=i.attr("end-dt").toLowerCase())&&(t.attr("start-dt",t.val()),i.attr("end-dt",i.val()),u.attr("attr-amountBasedOn",u.val()),r.attr("attr-value",r.val()),f.dirty||HandleUpdateEvent("#EmployeePayItemGrid",baseURL+"Employee/UpdateEmployeePayItem",{payItemData:JSON.stringify([f])}))})},1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeePayItems",dataType:"json"},update:{url:baseURL+"Employee/UpdateEmployeePayItem",dataType:"json"},destroy:{url:baseURL+"Employee/DeleteEmployeePayItem",dataType:"json"},parameterMap:function(n,t){if(t!=="read"&&n.models)return{payItemData:kendo.stringify(n.models)};if(t==="read"){var i=$("#EmployeeId").val();return{employeeId:i}}}},batch:!0,pageSize:4,schema:{model:{id:"employeePayItemId",fields:{employeeId:{editable:!1},employeePayItemId:{editable:!1},description:{editable:!1},category:{editable:!1},cpfApplicable:{editable:!1},frequency:{editable:!1},hours:{editable:!0},periodFrom:{editable:!0},periodTo:{editable:!0},variableType:{editable:!1},amountBasedOn:{editable:!0,type:"number"},value:{editable:!0,type:"number",validation:{required:!0}},startDate:{editable:!0},endDate:{editable:!0},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#EmployeePayItemGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{template:'<input type="checkbox" id="#:data.employeePayItemId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeePayItemId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:"50px"},{field:"description",title:"Description",width:"140px",template:function(n){return n.endDate!=""&&n.endDate!=null&&CompareDate(kendo.toString(kendo.parseDate(new Date(n.endDate)),"dd/MM/yyyy"))?"<font title='Expired' color='#bb2121'>"+n.description+"<\/font>":n.description}},{field:"category",title:"Category",width:"100px"},{field:"cpfApplicable",title:"CPF?",width:"50px"},{field:"frequency",title:"Frequency",width:"90px"},{field:"hours",title:"OT Hours",width:"60px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:'<span style="display:block !important">OT<\/span> <span style="display:block !important">Hours<\/span>',editor:function(n,t){var i=$("<input id='txtHours' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$' class='k-input k-textbox' attr-hours='"+t.model.hours+"' value='"+t.model.hours+"' data-bind='value:"+t.field+"' />").appendTo(n)}},{field:"periodFrom",title:"OT Period From",width:"90px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:'<span style="display:block !important">OT Period<\/span> <span style="display:block !important">From<\/span>',editor:function(n,t){var i=$("<input id='pickerPeriodFrom' class='k-input k-textbox' start-dt='"+t.model.periodFrom+"' value='"+t.model.periodFrom+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerPeriodFrom").change(function(){$(this).attr("value",$("#pickerPeriodFrom").val());t.model.startDate=$("#pickerPeriodFrom").val()})}},{field:"periodTo",title:"OT Period To",width:"90px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:'<span style="display:block !important">OT Period<\/span> <span style="display:block !important">To<\/span>',editor:function(n,t){var i=$("<input id='pickerPeriodTo' class='k-input k-textbox' end-dt='"+t.model.periodTo+"' value='"+t.model.periodTo+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerPeriodTo").change(function(){$(this).attr("value",$("#pickerPeriodTo").val());t.model.endDate=$("#pickerPeriodTo").val()})}},{field:"variableType",title:"Variable Type",width:"140px"},{field:"amountBasedOn",title:"Amount Based On",width:"100px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:'<span style="display:block !important">Amount<\/span> <span style="display:block !important">Based On<\/span>',editor:function(n,t){var i;i=t.model.frequency=="Variable"&&t.model.variableType!="Other user entered amount (may differ every month)"?$("<input id='txtAmountBasedOn' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$' class='k-input k-textbox' attr-amountBasedOn='"+t.model.amountBasedOn+"' value='"+t.model.amountBasedOn+"' data-bind='value:"+t.field+"' />").appendTo(n):$("<input id='txtAmountBasedOn' pattern='^[0-9]*(?:.[0-9]{1,2})?$' maxlength='10' class='k-input k-textbox disabledBackGround' attr-amountBasedOn='"+t.model.amountBasedOn+"' value='"+t.model.amountBasedOn+"' data-bind='value:"+t.field+"' disabled />").appendTo(n);$("#txtAmountBasedOn").change(function(){this.value=parseFloat(this.value).toFixed(2);$(this).attr("value",$("#txtAmountBasedOn").val());t.model.amountBasedOn=$("#txtAmountBasedOn").val()})}},{field:"value",title:"Amount",width:"100px",headerTemplate:'<span id="lblHeaderAmt"><\/span>',template:function(n){if($("#EmployeePayItemGrid").find("#lblHeaderAmt").html()==""){var t=n.currency===null?"":n.currency;$("#EmployeePayItemGrid").find("#lblHeaderAmt").html("Amount ("+t+")")}return formatAmountWithCurrency(n.value,n.currency,n.currencySymbol)},editor:function(n,t){t.model.frequency=="Variable"&&(t.model.variableType=="Amount per day for the total working days in a month"||t.model.variableType=="Amount per day for the days actually worked in a month"||t.model.variableType=="% of present month basic salary"||t.model.variableType=="Number of times")?$("<input id='txtValue' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$'  class='k-input k-textbox disabledBackGround' disabled attr-value='"+t.model.value+"' value='"+t.model.value+"' data-bind='value:"+t.field+"' />").appendTo(n):$("<input id='txtValue' maxlength='10' pattern='^[0-9]*(?:.[0-9]{1,2})?$'  class='k-input k-textbox' attr-value='"+t.model.value+"' value='"+t.model.value+"' data-bind='value:"+t.field+"' />").appendTo(n);$("#txtValue").change(function(){this.value=parseFloat(this.value).toFixed(2);$(this).attr("value",$("#txtValue").val());t.model.value=$("#txtValue").val()})}},{field:"startDate",title:"Effective Date",width:"120px",editor:function(n,t){var i=$("<input id='pickerStartDate' class='k-input k-textbox' start-dt='"+t.model.startDate+"' value='"+t.model.startDate+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerStartDate").change(function(){$(this).attr("value",$("#pickerStartDate").val());t.model.startDate=$("#pickerStartDate").val()})}},{field:"endDate",title:"End Date",width:"120px",editor:function(n,t){var i=$("<input id='pickerEndDate' class='k-input k-textbox' end-dt='"+t.model.endDate+"' value='"+t.model.endDate+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerEndDate").change(function(){$(this).attr("value",$("#pickerEndDate").val());t.model.endDate=$("#pickerEndDate").val()})}},{command:[{name:"edit",text:{edit:" ",update:" ",cancel:" "}},{name:"destroy",text:""}],title:"&nbsp;",width:"90px"}],editable:"inline",edit:n,dataBound:n,cancel:n,dataBinding:function(){$("#EmployeePayItemGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk",function(){$("#EmployeePayItemGrid tbody input:checkbox").prop("checked",this.checked)})};EmployeeEmployeementSalaryView.prototype.LoadEmployeeDocumentGrid=function(){function r(){setTimeout(function(){KGrdPageSizeDdlPosition("EmployeeDocumentGrid",2)},1)}var n=0,t=$("#EmployeeId").val(),i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadEmployeeDocuments",dataType:"json",data:{employeeId:t}}},batch:!0,pageSize:4,schema:{model:{id:"employeeAssetId",fields:{employeeAssetId:{editable:!1},documentType:{editable:!1},fileName:{editable:!1},modifiedByUserName:{editable:!1},modifiedOn:{editable:!1}}}}});$("#EmployeeDocumentGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,dataBound:r,sortable:!0,resizable:!0,columns:[{field:"assetId",hidden:!0},{title:"#",template:function(){return++n},width:45},{field:"employeeAssetId",title:"#",width:"50px",hidden:!0},{field:"documentType",title:"Document Name",width:"200px"},{field:"fileName",title:"File Name",width:"200px"},{field:"modifiedByUserName",title:"Update User",width:"100px"},{field:"modifiedOn",title:"Update Date",width:"150px"},{template:'<a href="'+baseURL+'Asset/Download/#=assetId#"><img src="'+baseURL+'images/doc.png" class="img-responsive" title="Download Employee Document" /><\/a>',width:"25px"},{template:'<a title="Delete Employee Document" href="javascript: deleteEmpDocument(#=employeeAssetId#);"><img src="'+baseURL+'images/delete.png" class="img-responsive" /><\/a>',width:"25px"}],dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};EmployeeSalaryHistoryView.prototype.Init=function(){var n=this;$("#customYear, #customFrom, #customTo").hide();$('#ddlFilterDuration option[value="Current Month"]').attr("selected",!0);n.LoadSalaryHistoryGrid();n.ResetSalaryHistoryGridFilter();n.FilterSalaryHistoryGrid("Current Month");$("#ddlFilterDuration").change(function(){var t=$(this).find(":selected").val(),i=new Date;t===""&&n.ResetSalaryHistoryGridFilter();t==="Current Month"&&(n.ResetSalaryHistoryGridFilter(),n.FilterSalaryHistoryGrid("Current Month"));t==="Last Month"&&(n.ResetSalaryHistoryGridFilter(),n.FilterSalaryHistoryGrid("Last Month"));t==="Past 3 Months"&&(n.ResetSalaryHistoryGridFilter(),n.FilterSalaryHistoryGrid("Past 3 Months"));t==="Past 6 Months"&&(n.ResetSalaryHistoryGridFilter(),n.FilterSalaryHistoryGrid("Past 6 Months"));t==="Custom"?(n.ResetSalaryHistoryGridFilter(),$("#customYear, #customFrom, #customTo").show()):$("#customYear, #customFrom, #customTo").hide()});$("#ddlFilterYear, #ddlFilterFrom, #ddlFilterTo").change(function(){n.FilterSalaryHistoryGrid("Custom")});$("#btnConsolidatedEmpPayslip").click(function(t){t.preventDefault();n.CosolidatedPayslipPdf("SalaryHistoryGrid",!1)});$("#btnYTDConsolidatedEmpPayslip").click(function(t){t.preventDefault();n.YTDCosolidatedPayslipPdf("SalaryHistoryGrid",!1)})};EmployeeSalaryHistoryView.prototype.CosolidatedPayslipPdf=function(n,t){var i="",r=0;if($("#"+n).find("input:checked").each(function(){if(this.id!="header-chk"&&this.id!="header-chk1"){var t=$("#"+n).data("kendoGrid").dataItem($(this).closest("tr"));i=i==""?t.employeeId+","+t.year+","+t.monthNo:i+"!"+t.employeeId+","+t.year+","+t.monthNo;r++}}),r==0){ShowAlertBox("Please select at least one payslip");return}window.location.href=baseURL+"Payslip/ConcolidatedViewPayslip?eIdYearMonth="+i+"&isBonusPayslip="+t};EmployeeSalaryHistoryView.prototype.YTDCosolidatedPayslipPdf=function(n,t){var i="",e=0;const r=[],u=[],f=[];$("#"+n).find("input:checked").each(function(){if(this.id!="header-chk"&&this.id!="header-chk1"){var t=$("#"+n).data("kendoGrid").dataItem($(this).closest("tr"));i==""?(i=t.employeeId+","+t.year+","+t.monthNo,r.push(t.employeeId),f.push(t.year),u.push(t.monthNo)):(i=i+"!"+t.employeeId+","+t.year+","+t.monthNo,r.push(t.employeeId),f.push(t.year),u.push(t.monthNo));e++}});const s=(n,t,i)=>i.indexOf(n)===t,h=(n,t,i)=>i.indexOf(n)===t,c=(n,t,i)=>i.indexOf(n)===t,l=r.filter(s),a=u.filter(h),o=f.filter(c);if(o.length>1){ShowAlertBox("Please select at only one payslip year");return}var v=l.toString(),y=a.toString(),p=o.toString();if(e==0){ShowAlertBox("Please select at least one payslip");return}window.location.href=baseURL+"Payslip/YTDConcolidatedViewPayslip?employees="+v+"&y="+p+"&m="+y+"&isBonusPayslip="+t};EmployeeSalaryHistoryView.prototype.ResetSalaryHistoryGridFilter=function(){doApplyGridFilter("SalaryHistoryGrid","eq","year",0);doApplyGridFilter("SalaryHistoryGrid","eq","month",0);doApplyGridFilter("SalaryHistoryGrid","eq","monthNo",0)};EmployeeSalaryHistoryView.prototype.FilterSalaryHistoryGrid=function(n){var o,s,a;$("#SalaryHistoryGrid").data("kendoGrid").dataSource.filter([]);var u=new Date,i,t,r,f=u.getFullYear(),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=[{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12}];if(n==="Current Month"){var e="Jan",f=u.getFullYear(),v=u.getMonth();e=c[v];doApplyGridFilter("SalaryHistoryGrid","eq","year",f==""?0:f);doApplyGridFilter("SalaryHistoryGrid","eq","month",e==""?0:e);return}if(n==="Last Month"){var e="Jan",f=u.getFullYear(),h=u.getMonth()-1;h<0&&(h=11,f=f-1);e=c[h];doApplyGridFilter("SalaryHistoryGrid","eq","year",f==""?0:f);doApplyGridFilter("SalaryHistoryGrid","eq","month",e==""?0:e);return}if(n==="Custom"){i=$("#ddlFilterYear").find(":selected").val();doApplyGridFilter("SalaryHistoryGrid","eq","year",i==""?0:i);t=$("#ddlFilterFrom").find(":selected").val()==""?"":l[0][$("#ddlFilterFrom").find(":selected").val()];r=$("#ddlFilterTo").find(":selected").val()==""?"":l[0][$("#ddlFilterTo").find(":selected").val()];t!=""&&!isNaN(t)&&r!=""&&!isNaN(r)&&r>=t&&(doApplyGridFilter("SalaryHistoryGrid","gte","monthNo",t),doApplyGridFilter("SalaryHistoryGrid","lte","monthNo",r));return}if(n==="Past 3 Months"){i=f;t=u.getMonth()+1-3;r=u.getMonth();switch(t){case 0:t=12;i--;break;case-1:t=11;i--;break;case-2:t=10;i--;break;case-3:t=9;i--}}else if(n==="Past 6 Months"){i=f;t=u.getMonth()+1-6;r=u.getMonth();switch(t){case-1:t=11;i--;break;case-2:t=10;i--;break;case-3:t=9;i--;break;case-4:t=8;i--;break;case-5:t=7;i--;break;case-6:t=6;i--}}if(t!=""&&r!=""){r<t?(o=[],s=[],o.push({field:"monthNo",operator:"gte",value:t}),o.push({field:"monthNo",operator:"lte",value:12}),o.push({field:"year",operator:"eq",value:i}),s.push({field:"year",operator:"eq",value:i+1}),s.push({field:"monthNo",operator:"gte",value:1}),s.push({field:"monthNo",operator:"lte",value:r}),a={logic:"or",filters:[{logic:"and",filters:s},{logic:"and",filters:o}]},$("#SalaryHistoryGrid").data("kendoGrid").dataSource.filter(a)):(doApplyGridFilter("SalaryHistoryGrid","eq","year",i==""?0:i),doApplyGridFilter("SalaryHistoryGrid","gte","monthNo",t),doApplyGridFilter("SalaryHistoryGrid","lte","monthNo",r));return}};EmployeeSalaryHistoryView.prototype.LoadSalaryHistoryGrid=function(){function t(){setTimeout(function(){$("#SalaryHistoryGrid input:checkbox").not(".checkAll").on("change",function(){SetHeaderChkBoxCheckUnCheck("SalaryHistoryGrid")});$("#SalaryHistoryGrid #header-chk").on("change",function(){$("#SalaryHistoryGrid tbody input:checkbox").prop("checked",this.checked)});KGrdPageSizeDdlPosition("SalaryHistoryGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Employee/LoadSalaryHistoryList",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{SalaryHistoryList:kendo.stringify(n.models)}:t==="read"?{employeeId:$("#EmployeeId").val()}:void 0}},batch:!0,pageSize:5,schema:{model:{id:"employeeIdHash",fields:{employeeIdHash:{editable:!1},year:{editable:!1},month:{editable:!1},salaryType:{editable:!1},netPay:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#SalaryHistoryGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,dataBound:t,dataBinding:function(){$("#SalaryHistoryGrid input[type=checkbox].checkAll").prop("checked",!1)},sortable:!0,columns:[{field:"employeeIdHash",hidden:!0},{template:'<input type="checkbox" id="#:data.year##:data.month#" class="chk-box" ><label class="checkbox-inline" style="padding-left: 5px !important;" for="#:data.year##:data.month#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:50},{field:"monthNo",hidden:!0},{field:"year",title:"Year",width:"250px"},{field:"month",title:"Month",width:"270px"},{field:"salaryType",title:"Salary Type",width:"270px"},{field:"netPay",title:"Net Pay",width:"200px",headerTemplate:'<span id="lblHeaderAmt"><\/span>',template:function(n){if($("#SalaryHistoryGrid").find("#lblHeaderAmt").html()==""){var t=n.currency===null?"":n.currency;$("#SalaryHistoryGrid").find("#lblHeaderAmt").html("Net Pay ("+t+")")}return formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)}},{template:"<div class='pointer' title='Open Employee Payslip' onclick='openPayslip(\"#:employeeIdHash#\",\"#:monthNo#\",\"#:year#\")'><img src='"+baseURL+"images/doc.png' class='img-responsive' /><\/div>",width:"70px"}]})};EmployeePayslipView.prototype.Init=function(){var n=this;$("#btnDownloadEmpPayslip").click(function(n){n.preventDefault();window.location=baseURL+"Asset/Download/7"})};ManageTimesheetView.prototype.Init=function(){var n=this,t=new Date,i=kendo.toString(kendo.parseDate(t),"dd/MMM/yyyy").split("/")[1];$("#ddlFilterByYear").val(t.getFullYear());$("#ddlFilterByMonth").val(i);$("#ddlFilterByActionReq").multiselect({buttonWidth:"100%",numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size",onDropdownHide:function(){var n=$("#ddlFilterByActionReq").val();n!=null&&doApplyKendoGridFilter("TimesheetListGird","eq","isActionRequired",n.length==0?0:n,!0,!0)}});this.LoadTimesheetDetailsGrid();$("#ddlFilterByMonth, #ddlFilterByYear").on("change",function(){setGridWeekDayHeader(new Date($("#ddlFilterByMonth").val()+"/1/"+$("#ddlFilterByYear").val()),"TimesheetListGird");refreshGrid($("#TimesheetListGird"))});$("#ddlFilterByStatus").on("change",function(){var n=$("#ddlFilterByStatus").find(":selected").val();doApplyGridFilter("TimesheetListGird","eq","status",n==""?0:n)});$("#txtFilterEmployeeName").focusout(function(){var n=$("#txtFilterEmployeeName").val();doApplyGridFilter("TimesheetListGird","contains","employeeName",n==""?0:n)});$("#txtFilterEmployeeName").keypress(function(n){if(n.keyCode==13){var t=$("#txtFilterEmployeeName").val();return doApplyGridFilter("TimesheetListGird","contains","employeeName",t==""?0:t),!1}});$("#ddlOffsetBy").on("change",function(){var n=$("#lblhrLess").html(),t=$("#hdnDailyWorkingHrs").val();this.value==0?($("#lblPerDayHours").html("Hours"),$("#txtOffset").val(n)):this.value==1&&($("#lblPerDayHours").html("Days"),$("#txtOffset").val(n/t))});$("#frmOffsetLeave").submit(function(n){if(n.preventDefault(),$("#txtOffset").val()!==""&&$.isNumeric($("#txtOffset").val())){var t=$("#hdnActiveEmployeeId").val(),i=$("#ddlFilterByMonth").val(),r=$("#ddlFilterByYear").val();OffsetEmployeeLeaves(t,i,r,"TimesheetListGird")}});$("#fileUploadTimeSheet").change(function(){$("#fileUploadTimeSheet").val()!=null&&$("#fileUploadTimeSheet").val()!=""&&n.GetExcelEmployeesTimesheet()});$("#btnBulkApproveTimesheet").click(function(t){var r;if(t.preventDefault(),r=$("#TimesheetListGird tbody").find("input:checked").length,r<=0){ShowAlertBox("Please select timesheet(s) to approve");return}var u=!1,i=[],f=ShowConfirmationAlertBox("Do you want to approve selected timesheet(s)?");f.then(function(){$("#TimesheetListGird tbody").find("input:checked").each(function(){var t=$("#TimesheetListGird").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.status.toUpperCase()=="PENDING"?(u=n.ApproveMonthlyTimesheet(this.id),u?i.push(t.employeeName+" - timesheet approved successfully"):i.push(t.employeeName+" - Error while approving timesheet")):i.push(t.employeeName+" - Only pending timesheet can be approved"))});ShowSummaryBox("Bulk Approve Summary",i);refreshGrid($("#TimesheetListGird"))})})};ManageTimesheetView.prototype.GetExcelEmployeesTimesheet=function(){var o=this,r=$("#fileUploadTimeSheet"),u=$("#lblErrorMedia"),f=$("#TimesheetListGird"),n;if(ValidateExcel(r,u)){var e=$("#fileUploadTimeSheet").get(0),t=e.files,i=new FormData;for(n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({async:!0,type:"POST",url:baseURL+"Timesheet/GetExcelFileTimesheet",contentType:!1,processData:!1,data:i,success:function(n){$("#fileUploadTimeSheet").val("");n.HasError!=undefined&&n.HasError?($("#lblErrorMedia").show(),$("#lblErrorMedia").text(n.ErrorMessage)):($("#lblCountImportedRecords").html(n.importedTimesheets),$("#lblCountFailedToImportRecords").html(n.failToImportTimesheets),$("#lblCountDuplicateRecords").html(n.duplicateTimesheetsFound),$("#importTimesheetResultPopup").modal(),refreshGrid(f),$("#lblErrorMedia").hide())},error:function(){}});ShowAlertBox("File will be imported after some time")}};ManageTimesheetView.prototype.LoadTimesheetDetailsGrid=function(){function o(){var i=[],f;for(i.push({template:'<input type="checkbox" id="#:data.employeeId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-tmsheet-chk" class="checkAll"><label class="checkbox-inline" for="header-tmsheet-chk"><\/label>',locked:!0,lockable:!1,width:40}),i.push({field:"employeeId",hidden:!0}),i.push({field:"employeeIdHash",hidden:!0}),i.push({field:"status",hidden:!0}),i.push({field:"dailyWorkingHrs",hidden:!0}),i.push({field:"isActionRequired",hidden:!0}),i.push({field:"employeeName",locked:!0,lockable:!1,title:"Employee Name",width:200,template:"<div  class='pointer colNameWrap-txt' title='#:employeeName#' onclick='openTimesheetApproval(\"#:employeeIdHash#\")'>#:employeeName#<\/div>"}),dCol=1;dCol<=31;dCol++)f=!1,f=dCol>u?!0:!1,i.push({field:"day"+dCol,width:65,template:function(t){n=n+1;var i=n;return n==31&&(n=0),h(t.dailyWorkingHrs,t["day"+i],t["day"+i+"Approved"],t.finalStatus,t.monthlyAttendanceId,i)},headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},hidden:f,headerTemplate:'<span style="display:block !important" day="day">'+c(u,dCol,r)+'<\/span> <span style="display:block !important">'+dCol+"<\/span>"});for(wCol=1;wCol<=5;wCol++)i.push({field:"week"+wCol,title:"W"+wCol,width:50,template:function(n){t=t+1;var i=t;return t==5&&(t=0),s(n["requiredWeek"+i],n["week"+i])}});return i.push({field:"totalHrs",title:"Total",width:80}),i.push({field:"requiredHrs",title:"Required",width:80}),i.push({field:"lessHrs",title:"Less",width:70}),i.push({field:"extraHrs",title:"Extra",width:70}),i.push({field:"offsetHrs",title:"Offset",width:70}),i.push({field:"",title:"Approve",width:80,template:function(n){return n.finalStatus?"":"<div class='pointer' title='Confirm Timesheet Approval' onclick='ConfirmMonthApproval("+n.employeeId+")'><img src='"+baseURL+"images/ok_green.png' class='img-responsive' /><\/div>"}}),i.push({field:"",title:"Offset",width:80,template:function(n){return n.finalStatus?"":'<div class="pointer" title="Offset leave" onclick="OffsetLeaves(\''+n.totalHrs+"','"+n.requiredHrs+"','"+n.lessHrs+"','"+n.dailyWorkingHrs+"','"+n.employeeName+"','"+n.employeeId+'\')"><img src="'+baseURL+'images/offsetIcon.png" class="img-responsive" /><\/div>'}}),i}function s(n,t){return t<parseFloat(n)&&t!=""?'<font color="red">'+t+"<\/font>":t}function h(n,t,i,r,u,f){if(t.indexOf("-")>0){var o,c=t.split("-")[0].toUpperCase(),e,h=t.split("-")[1],s=h.split("|")[0].toUpperCase();switch(c){case"PL":o="blue";e="Pending ";break;case"L":o="green";e="Approved ";break;case"R":o="red";e="Rejected ";break;case"PHL":o="blue";e="Pending Half Day ";break;case"AHL":o="green";e="Approved Half Day ";break;case"RHL":o="red";e="Rejected Half Day ";break;case"RAL":o="red";e="Rejected Approved ";break;default:return s}return e+=h.split("|")[1],i||r?"<font title='"+e+"' color="+o+">"+s+"<\/font>":'<button type="button" title="'+e+'" class="btn btn-GridView" style="color:red;" onclick="ConfirmDayApproval(\''+u+"','"+f+'\')"><span class="glyphicon glyphicon-ok" style="color:#46bb46;"><\/span> '+s+"<\/button>"}return t<parseFloat(n)&&t!=""?i||r?t:'<button type="button" class="btn btn-GridView" style="color:red;" onclick="ConfirmDayApproval(\''+u+"','"+f+'\')"><span class="glyphicon glyphicon-ok" style="color:#46bb46;"><\/span> '+t+"<\/button>":t==="TNR"?"<font title='Timesheet Not Required' color='green'>"+t+"<\/font>":t==""||r||i?t:'<button type="button" class="btn btn-GridView" style="color:red;" onclick="ConfirmDayApproval(\''+u+"','"+f+'\')"><span class="glyphicon glyphicon-ok" style="color:#46bb46;"><\/span> '+t+"<\/button>"}function c(n,t,i){if(t<=n){if(i<6)return r=r+1,f[i];if(i>=6)return r=0,f[i]}else return"-"}function l(){setTimeout(function(){$("#TimesheetListGird tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("TimesheetListGird")});KGrdPageSizeDdlPosition("TimesheetListGird")},1)}var n=0,t=0,f=["Su","Mo","Tu","We","Th","Fr","Sa"],i=new Date($("#ddlFilterByMonth").val()+"/1/"+$("#ddlFilterByYear").val()),r=i.getDay(),u=new Date(i.getYear(),i.getMonth()+1,0).getDate(),e=new kendo.data.DataSource({transport:{read:{url:baseURL+"Timesheet/LoadManageTimesheetGridData",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{month:$("#ddlFilterByMonth").val(),year:$("#ddlFilterByYear").val()}}},pageSize:10,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},dailyWorkingHrs:{editable:!1}}}}});$("#TimesheetListGird").kendoGrid({dataSource:e,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,columns:o(),dataBound:l,dataBinding:function(){$("#TimesheetListGird input[type=checkbox].checkAll").prop("checked",!1)},dataBinding:function(){n=0;t=0;i=new Date($("#ddlFilterByMonth").val()+"/1/"+$("#ddlFilterByYear").val());u=new Date(i.getYear(),i.getMonth()+1,0).getDate()}});$(document).on("change",".checkAll",function(){$("#TimesheetListGird tbody input:checkbox").prop("checked",this.checked)})};ManageTimesheetView.prototype.ApproveMonthlyTimesheet=function(n){var t=!1,i=$("#ddlFilterByYear").val(),r=$("#ddlFilterByMonth").val();return $.when($.ajax({url:baseURL+"Timesheet/ApproveMonthTimesheet",data:{employeeId:n,month:r,year:i},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};MyTimesheetView.prototype.Init=function(){var n=new Date,t=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1];$("#ddlFilterByYear").val(n.getFullYear());$("#ddlFilterByMonth").val(t);this.LoadMyTimesheetDetailsGrid();$("#ddlFilterByMonth, #ddlFilterByYear").on("change",function(){refreshGrid($("#MyTimesheetListGird"))})};MyTimesheetView.prototype.LoadMyTimesheetDetailsGrid=function(){function i(){var t=[];for(t.push({title:"Sno",template:function(){return++n},width:45}),t.push({field:"attendanceId",title:"",width:45,hidden:!0}),t.push({field:"date",title:"Date",width:90,template:"#= kendo.toString(kendo.parseDate(date), 'dd MMM yyyy') #"}),t.push({field:"weekDayName",title:"Days",width:80}),inOut=1;inOut<=5;inOut++)t.push({field:"in"+inOut,title:"In"+inOut,width:70,template:"#if(in"+inOut+" === null){# - #}else{# #=kendo.toString(kendo.parseDate(in"+inOut+"), 't')#  #}#"}),inOut==5?t.push({field:"out"+inOut,title:"Out"+inOut,footerTemplate:"<label>Total<\/label>",width:70,template:"#if(out"+inOut+" === null){# - #}else{# #=kendo.toString(kendo.parseDate(out"+inOut+"), 't')#  #}#"}):t.push({field:"out"+inOut,title:"Out"+inOut,width:70,template:"#if(out"+inOut+" === null){# - #}else{# #=kendo.toString(kendo.parseDate(out"+inOut+"), 't')#  #}#"});return t.push({field:"totalHrs",title:"Total",footerTemplate:"<label id='lblTotalHrs'><\/label>",width:60}),t.push({field:"lessHrs",width:55,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:"<label id='lblLessHrs'><\/label>",headerTemplate:'<span style="display:block !important">Less<\/span> <span style="display:block !important">Hours<\/span>'}),t.push({field:"extraHrs",width:55,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:"<label id='lblExtraHrs'><\/label>",headerTemplate:'<span style="display:block !important">Extra<\/span> <span style="display:block !important">Hours<\/span>'}),t.push({field:"weekTotal",width:55,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:"<label id='lblWeekTotal'><\/label>",headerTemplate:'<span style="display:block !important">Week<\/span> <span style="display:block !important">Total<\/span>'}),t.push({field:"status",title:"Status",width:80}),t.push({field:"leave",title:"Leave",width:70}),t}function r(){var n=$("#MyTimesheetListGird").data("kendoGrid").dataSource._data;$("#MyTimesheetListGird .k-footer-template #lblTotalHrs").text(CalculateTotalTime(n,"attendanceId","totalHrs"));$("#MyTimesheetListGird .k-footer-template #lblLessHrs").text(CalculateTotalTime(n,"attendanceId","lessHrs"));$("#MyTimesheetListGird .k-footer-template #lblExtraHrs").text(CalculateTotalTime(n,"attendanceId","extraHrs"));$("#MyTimesheetListGird .k-footer-template #lblWeekTotal").text(CalculateTotalTime(n,"attendanceId","weekTotal"))}var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Timesheet/LoadMyTimesheetDetails",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{month:$("#ddlFilterByMonth").val(),year:$("#ddlFilterByYear").val()}}},batch:!0,sort:{field:"date",dir:"asc"},pageSize:31,schema:{model:{id:"attendanceId",fields:{attendanceId:{editable:!1},date:{editable:!1},weekDayName:{editable:!1},in1:{editable:!1},out1:{editable:!1},in2:{editable:!1},out2:{editable:!1},in3:{editable:!1},out3:{editable:!1},in4:{editable:!1},out4:{editable:!1},in5:{editable:!1},out5:{editable:!1},totalHrs:{editable:!1},lessHrs:{editable:!1},extraHrs:{editable:!1},status:{editable:!1},weekTotal:{editable:!1},leave:{editable:!1}}}},aggregate:[{field:"totalHrs",aggregate:"sum"},{field:"lessHrs",aggregate:"sum"},{field:"extraHrs",aggregate:"sum"},{field:"weekTotal",aggregate:"sum"}]});$("#MyTimesheetListGird").kendoGrid({dataSource:t,scrollable:!0,resizable:!0,columns:i(),dataBound:r,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};TimesheetApprovalView.prototype.Init=function(){this.LoadTimesheetApprovalGrid();var n=$("#lblAttendanceStatus").text();n=="Approved"&&($("#btnOffset").prop("disabled",!0),$("#btnApproveTimesheet").prop("disabled",!0));$("#btnOffset").click(function(n){n.preventDefault();var i=$("#ddlOffsetBy").css("padding-top"),t=$("#hdnLessHrs").val(),r=$("#hdnTotalHrs").val(),u=$("#hdnRequiredHrs").val(),f=$("#lblNoOfWorkingHours").html();$("#divOffset").css("padding-top",i.split("px")[0]-1+"px");$("#ddlOffsetBy").prop("selectedIndex",0);$("#ddlOffsetBy").change();$("#lblhrLess").html(t);$("#txtOffset").val(t);$("#hdnDailyWorkingHrs").val(f);r<u?$("#offsetLeaves").modal("show"):(ShowAlertBox("No offset is required!"),$("#offsetLeaves").modal("hide"))});$("#ddlOffsetBy").on("change",function(){var n=$("#hdnLessHrs").val(),t=$("#hdnDailyWorkingHrs").val();this.value==0?($("#lblPerDayHours").html("Hours"),$("#txtOffset").val(n)):this.value==1&&($("#lblPerDayHours").html("Days"),$("#txtOffset").val(n/t))});$("#frmOffsetLeave").submit(function(n){if(n.preventDefault(),$("#txtOffset").val()!==""&&$.isNumeric($("#txtOffset").val())){var t=$("#hdnEmployeeId").val(),i=$("#hdnMonth").val(),r=$("#hdnYear").val();OffsetEmployeeLeaves(t,i,r,"")}});$("#btnApproveTimesheet").click(function(n){n.preventDefault();InitializeConfirmationPopup("Confirm Timesheet Approval","Are you sure you want to approve the timesheet for this month?","","ApproveTimesheet")})};TimesheetApprovalView.prototype.LoadTimesheetApprovalGrid=function(){function i(){var t=[];for(t.push({title:"Sno",locked:!0,lockable:!1,template:function(){return++n},width:45}),t.push({field:"attendanceId",title:"",hidden:!0}),t.push({field:"date",locked:!0,lockable:!1,title:"Date",width:90,template:"#= kendo.toString(kendo.parseDate(date), 'dd MMM yyyy') #"}),t.push({field:"weekDayName",title:"Days",width:80}),inOut=1;inOut<=5;inOut++)t.push({field:"in"+inOut,title:"In"+inOut,width:70,template:"#if(in"+inOut+" === null){# - #}else{# #=kendo.toString(kendo.parseDate(in"+inOut+"), 't')#  #}#"}),inOut==5?t.push({field:"out"+inOut,title:"Out"+inOut,footerTemplate:"<label>Total<\/label>",width:70,template:"#if(out"+inOut+" === null){# - #}else{# #=kendo.toString(kendo.parseDate(out"+inOut+"), 't')#  #}#"}):t.push({field:"out"+inOut,title:"Out"+inOut,width:70,template:"#if(out"+inOut+" === null){# - #}else{# #=kendo.toString(kendo.parseDate(out"+inOut+"), 't')#  #}#"});return t.push({field:"totalHrs",title:"Total",footerTemplate:"<label id='lblTotalHrs'><\/label>",width:60}),t.push({field:"lessHrs",width:55,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:"<label id='lblLessHrs'><\/label>",headerTemplate:'<span style="display:block !important">Less<\/span> <span style="display:block !important">Hours<\/span>'}),t.push({field:"extraHrs",width:55,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:"<label id='lblExtraHrs'><\/label>",headerTemplate:'<span style="display:block !important">Extra<\/span> <span style="display:block !important">Hours<\/span>'}),t.push({field:"weekTotal",template:"#if(weekTotal === '00.00' || weekTotal === '00:00'){#  #}else{# #=weekTotal# #}#",width:55,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:"<label id='lblWeekTotal'><\/label>",headerTemplate:'<span style="display:block !important">Week<\/span> <span style="display:block !important">Total<\/span>'}),t.push({field:"status",title:"Status",width:80,template:function(n){return n.finalStatus?n.status:n.status=="Pending"?"<font color='red'>"+n.status+"<\/font>":n.status}}),t.push({field:"leave",title:"Leave",width:70}),t.push({width:40,template:function(n){if(n.finalStatus)return"";switch(n.status){case"Approved":case"National Holiday":case"Holiday":return"";default:return"<div class='pointer' onclick='ApproveTimesheetForDay("+n.attendanceId+")'><img src='"+baseURL+"images/ok_green.png' class='img-responsive' /><\/div>"}}}),t}function r(){var n=$("#TimesheetApprovalGrid").data("kendoGrid").dataSource._data;$("#TimesheetApprovalGrid .k-footer-template #lblTotalHrs").text(CalculateTotalTime(n,"attendanceId","totalHrs"));$("#TimesheetApprovalGrid .k-footer-template #lblLessHrs").text(CalculateTotalTime(n,"attendanceId","lessHrs"));$("#TimesheetApprovalGrid .k-footer-template #lblExtraHrs").text(CalculateTotalTime(n,"attendanceId","extraHrs"));$("#TimesheetApprovalGrid .k-footer-template #lblWeekTotal").text(CalculateTotalTime(n,"attendanceId","weekTotal"))}var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Timesheet/LoadTimesheetApprovalDetails",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{employeeId:$("#hdnEmployeeId").val(),month:$("#hdnMonth").val(),year:$("#hdnYear").val()}}},batch:!0,sort:{field:"date",dir:"asc"},pageSize:31,schema:{model:{id:"attendanceId",fields:{attendanceId:{editable:!1},date:{editable:!1},weekDayName:{editable:!1},in1:{editable:!1},out1:{editable:!1},in2:{editable:!1},out2:{editable:!1},in3:{editable:!1},out3:{editable:!1},in4:{editable:!1},out4:{editable:!1},in5:{editable:!1},out5:{editable:!1},totalHrs:{editable:!1},lessHrs:{editable:!1},extraHrs:{editable:!1},status:{editable:!1},finalStatus:{editable:!1},weekTotal:{editable:!1},leave:{editable:!1}}}},aggregate:[{field:"totalHrs",aggregate:"sum"},{field:"lessHrs",aggregate:"sum"},{field:"extraHrs",aggregate:"sum"},{field:"weekTotal",aggregate:"sum"}]});$("#TimesheetApprovalGrid").kendoGrid({dataSource:t,scrollable:!0,resizable:!0,columns:i(),dataBound:r,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};ProcessPayrollView.prototype.Init=function(){var t=this,n=new Date;$("#ddlFilterYear").val(n.getFullYear());n.getMonth()>=6?$("#ddlFromMonth").val(kendo.toString(kendo.parseDate(addMonths(new Date,-5)),"dd/MMM/yyyy").split("/")[1]):$("#ddlFromMonth").val("Jan");$("#ddlToMonth").val(kendo.toString(n,"dd/MMM/yyyy").split("/")[1]);this.LoadProcessPayrollGrid();t.FilterProcessPayrollListGrid();$("#ddlFilterYear, #ddlFromMonth, #ddlToMonth").change(function(){t.FilterProcessPayrollListGrid();refreshGrid($("#ProcessPayrollGrid"))});$("#btnApprovePayrollOK").click(function(n){n.preventDefault();var t=$("#payrollIdHash").val();window.location.href=baseURL+"Payroll/ReviewEmployees?payrollId="+t});$("#btnImportPayItems").click(function(n){n.preventDefault();var t=kendo.toString(kendo.parseDate(new Date),"dd/MMM/yyyy").split("/")[1];$("#ddlImportYear").val((new Date).getFullYear());$("#ddlImportMonth").val(t);$("#filePayItemImportSheet").val("");$("#lblErrorMedia").text("");$("#lblFileName").html("No file chosen");$("#ImportPayItemsPopup").modal()});$("#ImportPayItemsPopup").on("hidden.bs.modal",function(){$(this).find("#frmImportPayItems .has-error.has-danger").removeClass("has-error has-danger")});$("#filePayItemImportSheet").change(function(n){var i=$("#lblErrorMedia"),r=$("#filePayItemImportSheet"),t;$("#lblFileName").html("");ValidateExcel(r,i)&&(t=n.target.files[0].name,$("#lblFileName").text(t))});$("#frmImportPayItems").submit(function(n){var f;n.preventDefault();var t=$("#ddlImportYear").val(),i=$("#ddlImportMonth").val(),r=$("#filePayItemImportSheet").val();if(t!=""&&i!=""&&r!=""&&r!=null){var e=getMonthFromString(i),o=new Date(t,e-1,01),u=new Date,s=new Date(u.getFullYear(),u.getMonth()+3,01);if(o>s){ShowAlertBox("Invalid payroll year and month.");return}f=new FormData(this);$("#ImportPayItemsPopup").modal("hide");$.ajax({url:baseURL+"Payroll/ImportPayItems",type:"POST",data:f,success:function(n){n.length>0?ShowSummaryBox("Warning Message(s)",n):ShowAlertBox("Pay Item(s) imported successfully")},error:function(){ShowAlertBox("Error while importing pay items")},cache:!1,contentType:!1,processData:!1})}})};ProcessPayrollView.prototype.FilterProcessPayrollListGrid=function(){var n=$("#ddlFilterYear").find(":selected").val(),r=$("#ddlFromMonth").find(":selected").val(),u=$("#ddlToMonth").find(":selected").val(),t,i;doApplyGridFilter("ProcessPayrollGrid","eq","payrollYear",n==""?0:n);r!=""?(t=new Date("1 "+r+" "+n),doApplyGridFilter("ProcessPayrollGrid","gte","monthNo",t.getMonth()==undefined||t.getMonth()==null?0:t.getMonth()+1)):doApplyGridFilter("ProcessPayrollGrid","gte","monthNo",0);u!=""?(i=new Date("1 "+u+" "+n),doApplyGridFilter("ProcessPayrollGrid","lte","monthNo",i.getMonth()==undefined||i.getMonth()==null?0:i.getMonth()+1)):doApplyGridFilter("ProcessPayrollGrid","lte","monthNo",0)};ProcessPayrollView.prototype.LoadProcessPayrollGrid=function(){function n(){setTimeout(function(){$(".k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit");$(".k-i-edit").removeClass("k-icon k-i-edit");$(".k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update");$(".k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete");$(".k-i-close").removeClass("k-icon k-i-close");var n=new Date,t=new Date(n.getFullYear(),n.getMonth(),n.getDate());$("#ProcessPayrollGrid #DivPayslipDt").datepicker({format:"dd/M/yyyy",startDate:t,todayHighlight:!0,autoclose:!0,orientation:"auto bottom"}).on("show",function(){$("div.datepicker.datepicker-dropdown.dropdown-menu").css("z-index","9999")});$("#ProcessPayrollGrid #PaySlipDate").change(function(){$(this).attr("value",this.value)});$("#ProcessPayrollGrid #SavePaySlipDate").click(function(n){var i,t,r;n.preventDefault();i=$(this).closest("tr");t=$(i).find("#PaySlipDate");t.val().trim()!=""&&t.val().trim().toLowerCase()!=t.attr("ps-date").toLowerCase()&&(r=$("#ProcessPayrollGrid").data("kendoGrid").dataItem(i),r._set("emailPaySlipDate",t.val().trim()),t.attr("ps-date",t.val().trim()),HandleUpdateEvent("#ProcessPayrollGrid",baseURL+"Payroll/UpdatePayrollItem",{payrollDetails:JSON.stringify([r])}))});KGrdPageSizeDdlPosition("ProcessPayrollGrid")},1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/GetPayrollList",dataType:"json"},update:{url:baseURL+"Payroll/UpdatePayrollItem",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{payrollDetails:kendo.stringify(n.models)};if(t=="read"){var i=$("#ddlFilterYear option:selected").val();return{payrollYear:i}}}},batch:!0,pageSize:10,schema:{model:{id:"payrollId",fields:{payrollId:{editable:!1},payrollIdHash:{editable:!1},payrollYear:{editable:!1},payrollMonth:{editable:!1},status:{editable:!1},emailPaySlipDate:{type:"date"},headcountProcessed:{editable:!1},headcountTotal:{editable:!1}}}}});$("#ProcessPayrollGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"payrollId",hidden:!0},{field:"payrollIdHash",hidden:!0},{field:"payrollYear",hidden:!0},{field:"monthNo",hidden:!0},{title:"",width:"20px"},{title:"Payroll Month",width:"80px",template:function(n){return n.payrollMonth+" "+n.payrollYear}},{template:function(n){return n.status==="Processed"?"<div><img src='"+baseURL+"images/ok_green.png' class='img-responsive' /><\/div>":n.status==="Adjustment Required"?"<div><img src='"+baseURL+"images/adjustment.png' class='img-responsive' /><\/div>":n.status==="Partially Processed"?"<div><img src='"+baseURL+"images/Partially.png' class='img-responsive' /><\/div>":n.status==="Pending"?"<div><img src='"+baseURL+"images/pending.png' class='img-responsive' /><\/div>":void 0},width:"38px"},{field:"status",title:"Status",width:"130px"},{field:"emailPaySlipDate",title:"Email Payslips",width:"180px",template:function(n){if(n.status==="Partially Processed"||n.status==="Pending"){var t=kendo.toString(kendo.parseDate(n.emailPaySlipDate),"dd/MMM/yyyy");return'<div style="display:flex;"><div id="DivPayslipDt" class="input-group input-append date custom-grid-date"><input type="text" id="PaySlipDate" style="font-size:11px !important;" ps-date="'+t+'" value="'+t+'" class="form-control"/><span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"><\/span><\/div><input type="button" id="SavePaySlipDate" value="SAVE" class="btn btn-primary custom-grid-button" /><\/div>'}return kendo.toString(kendo.parseDate(n.emailPaySlipDate),"dd MMMM yyyy")}},{field:"headcountProcessed",title:"Headcount (Processed)",width:"150px"},{field:"headcountTotal",title:"Headcount (Total)",width:"150px"},{title:"Action",template:function(n){return n.status==="Processed"||n.status==="Adjustment Required"?'<input type="button" onclick="rerunPayroll(\''+n.payrollIdHash+"','"+n.payrollMonth+"','"+n.payrollYear+'\')" value="RERUN" class="btn btn-primary custom-grid-button" />':n.status==="Partially Processed"||n.status==="Pending"?'<input type="button" onclick="redirectToProcessPayroll(\''+n.payrollIdHash+"','"+n.payrollMonth+"','"+n.payrollYear+'\')" value="NEXT" class="btn btn-primary custom-grid-button" />':void 0},width:"100px"},{title:"",width:"30px"}],editable:"inline",edit:n,dataBound:n,cancel:n})};ReviewEmployeesView.prototype.Init=function(){var n=this,t;$("#ddlPayrollStatus").multiselect({buttonWidth:"100%",numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size",onDropdownHide:function(){var n=$("#ddlPayrollStatus").val();n!=null?doApplyKendoGridFilter("EmployeesForMonthGrid","eq","payrollStatus",n.length==0?0:n,!0,!0):doApplyKendoGridFilter("EmployeesForMonthGrid","eq","payrollStatus",[],!0,!0)}});$("#ddlPayrollStatus").closest("div.form-group").removeClass("hidden");t=$("#txtEmployeeName").kendoAutoComplete({dataSource:{transport:{read:{dataType:"json",url:baseURL+"Payroll/LoadActiveEmployeeList/"},parameterMap:function(n,t){if(t==="read")return{searchByName:$("#txtEmployeeName").val()}}}},minLength:1,filter:"contains",dataTextField:"name",template:function(n){return'<div class="k-state-default displayInlineBlock" e-id="'+n.id+'" style="width:100%;text-align: left;"><h3>'+n.name+"<\/h3><\/div><\/div>"},height:400,open:function(n){setTimeout(function(){SetSearchListPosition("txtEmployeeName",n.sender.list)},0)},filtering:function(n){setTimeout(function(){SetSearchListPosition("txtEmployeeName",n.sender.list)},0)},select:function(n){var t=this.dataItem(n.item.index());$("#txtEmployeeName").attr("e-id",t.id)}}).data("kendoAutoComplete");n.LoadResigneesForMonthGrid();n.LoadAddResigneesGrid();n.LoadEmployeesForMonthGrid();$("#btnAddResignees").click(function(n){n.preventDefault();$("#txtEmployeeName").removeAttr("e-id").val("");$("#AddResigneesPopup").modal("toggle")});$("#btnAddResigneesToGrid").click(function(n){n.preventDefault();AddEmployeeResigneesToGrid();$("#txtEmployeeName").removeAttr("e-id").val("")});$("#btnSaveResignees").click(function(n){n.preventDefault();UpdateEmployeesReginees()});$("#btnDeleteResigneesFromGrid").click(function(n){n.preventDefault();DeleteEmployeeRegineeFromGrid()});$("#frmPayrollEntry").submit(function(n){var i;if(n.preventDefault(),$("#hdnPayItemUpdated").val()=="true")$("#hdnPayItemUpdated").val(!1);else if($("#rdnUnpaidNo").is(":checked")){$("#AddPayrollEntryPopup").modal("toggle");return}var t=$("#txtUnpaidLeaveCnt").val(),r=$("#EmployeeId").val(),u=$("#EmployeePayrollId").val();t!==""&&$.isNumeric(t)&&r!==""&&u!==""&&(i=$.post(baseURL+"Payroll/UpdatePayrollEntry",{empId:r,empPayrollId:u,unpaidLeaveCount:t}),i.done(function(){$("#AddPayrollEntryPopup").modal("toggle");ShowAlertBox("Payroll entry updated successfully");refreshGrid($("#EmployeesForMonthGrid"))}),i.fail(function(){ShowAlertBox("Failed to update payroll entry");refreshGrid($("#EmployeesForMonthGrid"))}))});$("#btnAddPayItem").click(function(t){var o,u;t.preventDefault();var f=$("#EmployeeId").val(),r=$("#ddlAvailablePayItems").val(),e=!1;if(f===undefined||r.length<=0){ShowAlertBox("Please select pay item to add");return}for(o={CompanyPayItemId:r,EmployeeId:f},u=$("#PayrollPayItemGrid").data("kendoGrid").dataSource._data,i=0;i<u.length;i++)u[i].companyPayItemId==r&&(e=!0);e?ShowAlertBox("Pay Item already exists"):(n.AddEmployeePayItem(o),$("#hdnPayItemUpdated").val(!0));event.stopImmediatePropagation()});$("#btnDeletePayItem").click(function(t){var i;if(t.preventDefault(),i=$("#PayrollPayItemGrid tbody").find("input:checked").length,i<=0){ShowAlertBox("Please select pay item(s) to delete");return}var r=!0,u=0,f=ShowConfirmationAlertBox("Are you sure about deleting selected pay item(s)?");f.then(function(){$("#PayrollPayItemGrid").find("input:checked").each(function(){this.id!="header-chk"&&(r=n.DeletePayrollPayItem(this.id),r&&(u++,RemoveItemFromGrid("PayrollPayItemGrid",this.id)))});i===u?($("#hdnPayItemUpdated").val(!0),ShowAlertBox("Pay item(s) deleted successfully")):ShowAlertBox("Error while deleting pay item(s)")})});$("#confirmPayrollCalc").click(function(t){var i,r,u;t.preventDefault();i=0;$("#EmployeesForMonthGrid").find("input:checked").each(function(){this.id!="header-chk"&&($("#lblConfirmMsg").html("Are you sure you want to calculate the payroll for selected employees?"),$("#hdnProcessAll").val(!1),i++)});i===0&&($("#hdnProcessAll").val(!0),$("#lblConfirmMsg").html("Are you sure you want to calculate the payroll for all the employees?"));r=$("#hdnPayrollYear").val();u=$("#hdnPayrollMonth").val();n.GetPayrollValidation(r,u)});$("#btnOkCalculatePayroll").click(function(n){n.preventDefault();$("#processingPayrollCalculation").modal({backdrop:"static",keyboard:!1});$("#lblProcessingDoneCount").hide();$("#confirmPayrollCalculations").modal("hide");$("#processingPayrollCalculation").modal("show")});$("#btnProcessingOK").click(function(n){n.preventDefault();var t=$("#hdnEmployeeCnt").val();t>0?window.location.href=baseURL+"Payroll/ConfirmPayroll?payrollId="+encodeURIComponent($("#hdnPayrollIdHash").val()):$("#processingPayrollCalculation").modal("toggle")});$("#processingPayrollCalculation").on("shown.bs.modal",function(){var f=$("#hdnProcessAll").val(),e=$("#hdnPayrollId").val(),i=!1,t=0,u,r;if(f=="true")for(u=$("#EmployeesForMonthGrid").data("kendoGrid").dataSource.data(),r=0;r<u.length;r++)i=n.CalculateMonthlyPayroll(u[r].employeePayrollId),i&&t++;else $("#EmployeesForMonthGrid").find("input:checked").each(function(){this.id!="header-chk-payroll"&&(i=n.CalculateMonthlyPayroll(this.id),i&&t++)});$("#lblProcessingProgress").hide();t>0?$("#lblProcessingDoneCount").text("Payroll calculation done for "+t+" employees."):$("#lblProcessingDoneCount").text("No employees pending for payroll calculation.");$("#hdnEmployeeCnt").val(t);$("#lblProcessingDoneCount").show();setTimeout(function(){$("#btnProcessingOK").removeClass("disabled");$("#btnProcessingOK").removeClass("btn-eventNot")},10)});$("#AddPayrollEntryPopup").on("hidden.bs.modal",function(){$("#hdnPayItemUpdated").val()=="true"&&n.ChangePayrollStatus()})};ReviewEmployeesView.prototype.CalculateMonthlyPayroll=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Payroll/CalculatePayroll",data:{empPayrollId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};ReviewEmployeesView.prototype.AddEmployeePayItem=function(n){var t=$.post(baseURL+"Employee/AddEmployeePayItem",n);t.done(function(){ShowAlertBox("Pay Item Added!");$("#ddlAvailablePayItems").val("");refreshGrid($("#PayrollPayItemGrid"))});t.fail(function(){ShowAlertBox("Fail to add employee pay item!")})};ReviewEmployeesView.prototype.LoadResigneesForMonthGrid=function(){function n(){CalculateResigneesCountForMonth();KGrdPageSizeDdlPosition("ResigneesForMonthGrid",1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadResigneesForMonth",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{PayrollId:$("#hdnPayrollId").val()}}},batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},salaryType:{editable:!1},employeeStatus:{editable:!1},nationality:{editable:!1},resignationDate:{editable:!1,type:"date"},lastProcessed:{editable:!1}}}}});$("#ResigneesForMonthGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{field:"employeeName",title:"Employee Name",width:"150px"},{field:"employeeCode",title:"Employee Code",width:"150px"},{field:"salaryType",title:"Salary Type",width:"170px"},{field:"employeeStatus",title:"Status",width:"170px"},{field:"nationality",title:"Citizenship",width:"150px"},{field:"resignationDate",title:"Resignation Date",width:"200px",template:"#= kendo.toString(kendo.parseDate(resignationDate), 'dd MMM yyyy') #"},{field:"lastProcessed",title:"Last Processed",width:"130px"},],editable:"inline",edit:n,dataBound:n,cancel:n})};ReviewEmployeesView.prototype.GetPayrollValidation=function(n,t){var i=$.post(baseURL+"Payroll/GetPayrollValidation",{payrollYear:n,payrollMonth:t});i.done(function(n){n.length>0?ShowSummaryBox("Warning Message(s) - Please resolve below error(s)",n):$("#confirmPayrollCalculations").modal("toggle")});i.fail(function(n){ShowAlertBox(n+" Fail to get payroll validations !")})};ReviewEmployeesView.prototype.LoadAddResigneesGrid=function(){function n(){setTimeout(function(){$("#AddResigneesGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Resignee");$("#AddResigneesGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#AddResigneesGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Resignee");$("#AddResigneesGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close")},1)}var t=new kendo.data.DataSource({batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeName:{editable:!1},resignationDate:{editable:!0,type:"date"}}}}});$("#AddResigneesGrid").kendoGrid({dataSource:t,pageable:!0,sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{template:'<input type="checkbox" id="#:data.employeeId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-res" class="checkAll"><label class="checkbox-inline" for="header-chk-res"><\/label>',width:40},{field:"employeeName",title:"Employee Name",width:"250px"},{field:"resignationDate",title:"Resignation Date",width:"250px",template:"#if(resignationDate == ''||resignationDate == null){# - #}else{# #=kendo.toString(kendo.parseDate(resignationDate), 'dd MMM yyyy')#  #}#",editor:resignationDateEditor},{command:[{name:"edit",text:{edit:" ",update:" ",cancel:" "}},],title:"&nbsp;",width:"70px"}],editable:"inline",edit:n,dataBound:n,cancel:n});$(document).on("change","#header-chk-res",function(){$("#AddResigneesGrid tbody input:checkbox").prop("checked",this.checked)})};ReviewEmployeesView.prototype.LoadEmployeesForMonthGrid=function(){function n(){setTimeout(function(){$("#EmployeesForMonthGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("EmployeesForMonthGrid")});KGrdPageSizeDdlPosition("EmployeesForMonthGrid",2)},1);CalculateEmployeesCountForMonth()}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/GetEmployeesForPayrollProcessing",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{PayrollId:$("#hdnPayrollId").val()}}},batch:!0,pageSize:10,schema:{model:{id:"employeePayrollId",fields:{employeeId:{editable:!1},employeePayrollId:{editable:!1},companyId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},salaryType:{editable:!1},employeeStatus:{editable:!1},nationality:{editable:!1},joiningDate:{editable:!1,type:"date"},payrollStatus:{editable:!1}}}}});$("#EmployeesForMonthGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.employeePayrollId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeePayrollId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-payroll" class="checkAll"><label class="checkbox-inline" for="header-chk-payroll"><\/label>',width:50},{field:"employeePayrollId",hidden:!0},{field:"employeeId",hidden:!0},{field:"companyId",hidden:!0},{field:"employeeName",title:"Employee Name",width:"140px"},{field:"employeeCode",title:"Employee Code",width:"120px"},{field:"salaryType",title:"Salary Type",width:"120px"},{field:"employeeStatus",title:"Status",width:"120px"},{field:"nationality",title:"Nationality",width:"120px"},{field:"joiningDate",title:"Join Date",width:"110px",template:"#if(joiningDate === null){#  N/A #}else{# #=kendo.toString(kendo.parseDate(joiningDate), 'dd MMM yyyy')#  #}#"},{template:function(n){return n.payrollStatus==="Completed"?"<div><img src='"+baseURL+"images/ok_green.png' class='img-responsive' /><\/div>":n.payrollStatus==="Adjustment Needed"?"<div><img src='"+baseURL+"images/adjustment.png' class='img-responsive' /><\/div>":n.payrollStatus==="Partially Processed"?"<div><img src='"+baseURL+"images/Partially.png' class='img-responsive' /><\/div>":n.payrollStatus==="Pending"?"<div><img src='"+baseURL+"images/pending.png' class='img-responsive' /><\/div>":void 0},width:"30px"},{field:"payrollStatus",title:"Payroll Status",width:"130px"},{template:"<div class='pointer' title='Open Payroll Entry' onclick='OpenPayrollEntryPopup(\"#:employeeId#\",\"#:employeePayrollId#\")'><img src='"+baseURL+"images/info.png' class='img-responsive' /><\/div>",width:"40px"},],editable:"inline",edit:n,dataBound:n,cancel:n,dataBinding:function(){$("#EmployeesForMonthGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk-payroll",function(){$("#EmployeesForMonthGrid tbody input:checkbox").prop("checked",this.checked)})};ReviewEmployeesView.prototype.DeletePayrollPayItem=function(n){var i=$("#EmployeeId").val(),r={employeePayItemId:n,employeeId:i},t=!1;return $.ajax({url:baseURL+"Employee/DeleteEmployeePayItem",data:r,type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};ReviewEmployeesView.prototype.ChangePayrollStatus=function(){var n=$.post(baseURL+"Payroll/UpdatePayrollPayItem",{empPayrollId:$("#EmployeePayrollId").val()});n.done(function(){$("#hdnPayItemUpdated").val(!1);refreshGrid($("#EmployeesForMonthGrid"))});n.fail(function(){$("#hdnPayItemUpdated").val(!1);refreshGrid($("#EmployeesForMonthGrid"))})};ConfirmPayrollView.prototype.Init=function(){var i=this,n,t;$("#ddlEmployeeList").multiselect({buttonWidth:"100%",numberDisplayed:1,includeSelectAllOption:!0,maxHeight:400,buttonClass:"form-control classicSelect multiselect-font-size"});n=new Date;t=new Date(n.getFullYear(),n.getMonth(),n.getDate());$("#dtEmailPayslipDiv").datepicker({format:"dd/M/yyyy",startDate:t,todayHighlight:!0,autoclose:!0,orientation:"auto top"}).on("hide",function(n){n.date==undefined?$("#btnOkUpdatePayslipdt").addClass("disabled"):$("#btnOkUpdatePayslipdt").removeClass("disabled")});this.LoadConfirmPayrollProcessingGrid();$("#linkAddPayslipNotes").click(function(n){n.preventDefault();$("#AddPayslipNotesPopup").modal("toggle")});$("#AddPayslipNotesPopup").on("hidden.bs.modal",function(){$(this).find("#frmAddPayslipNote .has-error.has-danger").removeClass("has-error has-danger")});$("#btnConfirmPayrollProcessing").click(function(n){n.preventDefault();$("#payrollIdHash").val($("#hdnPayrollIdHash").val());$("#emailPayslipDt").val($("#hdnEmailPayslipDt").val());$("#payrollConfirmationDialog").modal("toggle")});$("#btnOkPayrollProcessing").click(function(n){n.preventDefault();var t=$("#payrollIdHash").val(),i=$("#emailPayslipDt").val(),r=$.post(baseURL+"Payroll/ApprovePayroll",{payrollId:t});r.done(function(){$("#payrollConfirmationDialog").modal("toggle");$("#encPayrollId").val(t);var n=new Date,r=new Date(n.getFullYear(),n.getMonth(),n.getDate());kendo.parseDate(i)<kendo.parseDate(r)?$("#dtEmailPayslip").val(""):$("#dtEmailPayslip").val(kendo.toString(kendo.parseDate(i),"dd/MMM/yyyy"));$("#payrollProcessedDialog").modal({backdrop:"static",keyboard:!1});$("#payrollProcessedDialog").modal("show")});r.fail(function(){ShowAlertBox("Error while processing payroll")})});$("#btnOkUpdatePayslipdt").click(function(n){var t;n.preventDefault();var r=$("#encPayrollId").val(),i=$("#dtEmailPayslip").val(),u=$("#ddlNotificationType").val();if(i.length<=0){$("#dtEmailPayslip").focus();return}t=$.post(baseURL+"Payroll/UpdatePayslipEmailDate",{payrollId:r,emailType:u,emailDt:i});t.done(function(){$("#payrollProcessedDialog").modal("toggle");window.location.href=baseURL+"Dashboard/PayrollProcess"});t.fail(function(){ShowAlertBox("Error while updating email payslip date")})});$("#frmAddPayslipNote").submit(function(n){n.preventDefault();var t=$("#ddlEmployeeList").val(),r=$("#txtNote").val().trim(),u=$("#hdnPayrollId").val();if(t==null||t==""||r==""||u=="")return!1;i.AddPayslipNote(u,t.toString(),r)});$("#btnClearAddPayslipNote").click(function(n){n.preventDefault();$("#ddlEmployeeList").multiselect("clearSelection");$("#txtNote").val("")})};ConfirmPayrollView.prototype.AddPayslipNote=function(n,t,i){var r=$.post(baseURL+"Payroll/AddPayslipNote",{payrollId:n,employeeIds:t,note:i});r.done(function(){ShowAlertBox("Payslip note added successfully!");$("#AddPayslipNotesPopup").modal("hide")});r.fail(function(){ShowAlertBox("Fail to add payslip note!")})};ConfirmPayrollView.prototype.LoadConfirmPayrollProcessingGrid=function(){function t(){setTimeout(function(){for(var r=$("#PayrollDetailsGrid").data("kendoGrid"),t=r.dataSource.view(),n=0;n<t.length;n++){var i=r.table.find("tr[data-uid='"+t[n].uid+"']"),u=$(i).find(".clsWithCPF"),f=$(i).find(".clsWithoutCPF"),e=$(i).find(".clsTotalDeduction");t[n].payItemsWithCPF>0?u.show():u.hide();t[n].payItemsWithoutCPF>0?f.show():f.hide();t[n].totalDeductions>0?e.show():e.hide()}KGrdPageSizeDdlPosition("PayrollDetailsGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadPayrollDetailGridData",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{ConfirmPayrollProcessingDetails:kendo.stringify(n.models)}:t=="read"?{PayrollId:$("#hdnPayrollId").val()}:void 0}},batch:!0,pageSize:10,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},jobTitle:{editable:!1},joiningDate:{editable:!1},paymentMode:{editable:!1},salaryType:{editable:!1},totalGrossSalary:{editable:!1},payItemsWithCPF:{editable:!1},payItemsWithoutCPF:{editable:!1},totalDeductions:{editable:!1},netPay:{editable:!1},basicSalary:{editable:!1},additions:{editable:!1},bonus:{editable:!1},deductions:{editable:!1},overtime:{editable:!1},unpaidLeavesAmt:{editable:!1},unpaidDaysAmt:{editable:!1},employeeCPF:{editable:!1},contributionToCDAC:{editable:!1},contributionToSINDA:{editable:!1},contributionToMBMF:{editable:!1},contributionToCPF:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#PayrollDetailsGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{field:"employeeName",title:"Name",width:"100px"},{field:"employeeCode",title:"Employee Code",width:"100px"},{field:"",title:"Employment Details",width:"180px",template:"<div class=''><span class='grid-row-title'>Job Title : #: jobTitle #<\/span><span class='grid-row-title'>Join Date : #if(joiningDate === null){#  N/A #}else{# #=kendo.toString(kendo.parseDate(joiningDate), 'dd MMM yyyy')#  #}# <\/span><span class='grid-row-title'>Payment Mode : #:paymentMode # <\/span><span class='grid-row-title'>Salary Type : #:salaryType # <\/span><\/div>"},{field:"description",title:"Description (Indicates prorated)",width:"195px",headerAttributes:{style:"text-align: right; font-size: 14px"},template:"<div style='text-align: right;'><span class='grid-row-title'>Total Gross Salary<\/span><span class='grid-row-title #:payItemsWithCPF > 0 ? 'show-span' : 'hide-span' #'>Pay Items with CPF<\/span><span class='grid-row-title #:payItemsWithoutCPF > 0 ? 'show-span' : 'hide-span' #'>'#:payItemsWithCPF > 0 ? 'Pay Items without CPF' : 'Total Additions' #'<\/span><span class='grid-row-title #:totalDeductions > 0 ? 'show-span' : 'hide-span' #'>Total Deductions<\/span><span class='grid-row-title'>Net Pay<\/span><\/div>"},{field:"amount",title:"Amount",width:"100px",headerTemplate:'<span id="lblHeaderAmt"><\/span>',template:function(n){if($("#PayrollDetailsGrid").find("#lblHeaderAmt").html()==""){var t=n.currency===null?"":n.currency;$("#PayrollDetailsGrid").find("#lblHeaderAmt").html("Amount ("+t+")")}return"<div style='text-align: left;' ><span class='grid-row-title'> "+n.currencySymbol+" "+kendo.toString(n.totalGrossSalary,"n2")+" <\/span><span class='grid-row-title clsWithCPF'> "+n.currencySymbol+" "+kendo.toString(n.payItemsWithCPF,"n2")+" <\/span><span class='grid-row-title clsWithoutCPF'> "+n.currencySymbol+" "+kendo.toString(n.payItemsWithoutCPF,"n2")+" <\/span><span class='grid-row-title clsTotalDeduction'> "+n.currencySymbol+" "+kendo.toString(n.totalDeductions,"n2")+" <\/span><span class='grid-row-title'> "+n.currencySymbol+" "+kendo.toString(n.netPay,"n2")+"<\/span><\/div>"}},],detailTemplate:"<div class='row col-md-10' style='text-align: right;'><span class='grid-row-title #:basicSalary > 0 ? 'show-span' : 'hide-span' #'>Basic Salary<\/span><span class='grid-row-title #:additions > 0 ? 'show-span' : 'hide-span' #'>Additions<\/span><span class='grid-row-title #:overtime > 0 ? 'show-span' : 'hide-span' #'>Overtime<\/span><span class='grid-row-title #:bonus > 0 ? 'show-span' : 'hide-span' #'>Bonus<\/span><span class='grid-row-title #:deductions > 0 ? 'show-span' : 'hide-span' #'>Deductions<\/span><span class='grid-row-title #:unpaidLeavesAmt > 0 ? 'show-span' : 'hide-span' #'>Unpaid Leaves Amount<\/span><span class='grid-row-title #:unpaidDaysAmt > 0 ? 'show-span' : 'hide-span' #'>Unpaid Days Amount<\/span><span class='grid-row-title #:employeeCPF > 0 ? 'show-span' : 'hide-span' #'>Employee CPF<\/span><span class='grid-row-title #:contributionToCDAC > 0 ? 'show-span' : 'hide-span' #'>Contribution to CDAC<\/span><span class='grid-row-title #:contributionToSINDA > 0 ? 'show-span' : 'hide-span' #'>Contribution to SINDA<\/span><span class='grid-row-title #:contributionToMBMF > 0 ? 'show-span' : 'hide-span' #'>Contribution to MBMF<\/span><span class='grid-row-title #:contributionToECF > 0 ? 'show-span' : 'hide-span' #'>Contribution to ECF<\/span><\/div><div class=''><span class='grid-row-title #:basicSalary > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #:kendo.toString(basicSalary, 'n2') #<\/span><span class='grid-row-title #:additions > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(additions, 'n2') #<\/span><span class='grid-row-title #:overtime > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(overtime, 'n') #<\/span><span class='grid-row-title #:bonus > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(bonus, 'n') #<\/span><span class='grid-row-title #:deductions > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(deductions, 'n') #<\/span><span class='grid-row-title #:unpaidLeavesAmt > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(unpaidLeavesAmt, 'n') #<\/span><span class='grid-row-title #:unpaidDaysAmt > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(unpaidDaysAmt, 'n') #<\/span><span class='grid-row-title #:employeeCPF > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(employeeCPF, 'n') #<\/span><span class='grid-row-title #:contributionToCDAC > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(contributionToCDAC, 'n') #<\/span><span class='grid-row-title #:contributionToSINDA > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(contributionToSINDA, 'n') #<\/span><span class='grid-row-title #:contributionToMBMF > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(contributionToMBMF, 'n') #<\/span><span class='grid-row-title #:contributionToECF > 0 ? 'show-span' : 'hide-span' #'>#: currencySymbol # #: kendo.toString(contributionToECF, 'n') #<\/span><\/div>",dataBound:t})};BonusListView.prototype.Init=function(){var n=this;this.LoadBonusListGrid();$("#ddlFilterBonusYear").val((new Date).getFullYear());$("#ddlFilterBonusYear, #ddlFilterBonusStatus").change(function(){n.FilterBonusListGrid();refreshGrid($("#BonusListGrid"))});$("#btnDeleteBonusItem").click(function(t){var r;if(t.preventDefault(),r=$("#BonusListGrid tbody").find("input[type='checkbox']:checked").length,r<=0){ShowAlertBox("Please select bonus item(s) to delete");return}var i=[],u=!0,f=ShowConfirmationAlertBox("Are you sure about deleting selected bonus item(s)?");f.then(function(){$("#BonusListGrid tbody").find("input:checked").each(function(){var t=$("#BonusListGrid").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.status!="Processed"?(u=n.DeleteBonusItem(this.id),u?(i.push(" - Bonus item(s) deleted successfully"),RemoveItemFromGrid("BonusListGrid",this.id)):i.push(t.year+" - Error while deleting bonus item(s)")):i.push(t.month+"  "+t.year+" - Payroll processed bonus item(s) can not be deleted"))});ShowSummaryBox("Bulk Delete Summary",i)})})};BonusListView.prototype.DeleteBonusItem=function(n){var t=$.post(baseURL+"Payroll/DeleteBonus",{bonusId:n});return t.done(function(){return!0}),t.fail(function(){return!1}),!0};BonusListView.prototype.FilterBonusListGrid=function(){var n=$("#ddlFilterBonusYear").find(":selected").val(),t=$("#ddlFilterBonusStatus").find(":selected").val();doApplyGridFilter("BonusListGrid","eq","year",n==""?0:n);doApplyGridFilter("BonusListGrid","eq","status",t==""?0:t)};BonusListView.prototype.LoadBonusListGrid=function(){function t(){setTimeout(function(){$("#BonusListGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("BonusListGrid")});KGrdPageSizeDdlPosition("BonusListGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/GetBonusSummary",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{year:$("#ddlFilterBonusYear").val()}}},batch:!0,pageSize:5,schema:{model:{id:"bonusSummaryId",fields:{bonusSummaryId:{editable:!1},bonusIdHash:{editable:!1},companyId:{editable:!1},year:{editable:!1},month:{editable:!1},paymentDate:{editable:!1},shortDescription:{editable:!1},bonusFactor:{editable:!1},status:{editable:!1}}}}});$("#BonusListGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.bonusSummaryId#" class="chk-box"><label class="checkbox-inline" for="#:data.bonusSummaryId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-bns" class="checkAll"><label class="checkbox-inline" for="header-chk-bns"><\/label>',width:40},{field:"bonusSummaryId",hidden:!0},{field:"bonusIdHash",hidden:!0},{field:"companyId",hidden:!0},{field:"year",title:"Year",width:"100px"},{field:"month",title:"Payroll Month",width:"120px"},{field:"paymentDate",title:"Payment Date",width:"160px",template:"#= kendo.toString(kendo.parseDate(paymentDate), 'dd MMM yyyy') #"},{field:"shortDescription",title:"Short Description",width:"200px"},{field:"bonusFactor",title:"Bonus Factor",width:"120px"},{field:"status",title:"Status",width:"120px"},{template:function(n){return n.status==="Processed"?"":'<div class="pointer" title="Edit Bonus" onclick="EditBonus(\''+n.bonusIdHash+'\')"><img src="'+baseURL+'images/info.png" class="img-responsive" /><\/div>'},width:"50px"}],editable:"inline",dataBound:t});$(document).on("change","#header-chk-bns",function(){$("#BonusListGrid tbody input:checkbox").prop("checked",this.checked)})};AddBonusView.prototype.Init=function(){var n=this;ValidateAndScrollToEmptyField();$("#dtpBonusPayDate").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0,orientation:"bottom"});n.ChangeOnBasedOnMonthSelection();n.LoadReviewAndAdjustBonusGrid();$("#ddlBonusBasedOnMonth").change(function(){n.ChangeOnBasedOnMonthSelection()});$("#btnProceed").click(function(t){t.preventDefault();var i=n.CheckIfBonusAlreadyProcessedForSomeEmployees($("#hdnBonusId").val());i?n.ProceedToFinalizeBonus($("#hdnBonusId").val(),"Bonus for the month is already processed for few of the employee's.<br>They will be excluded from this bonus."):n.ProceedToFinalizeBonus($("#hdnBonusId").val(),"")});$("#frmAddBonus").submit(function(n){var r;n.preventDefault();var u=$("#ddlCalenderYearForPayout").val(),f=$("#txtShortDescription").val(),t=$("#txtNumberOfMonthToBePaid").val(),e=$("#bonusPayDate").val(),o=$("#ddlBonusPaymentType").val(),i=$("#ddlBonusBasedOnMonth").val(),s=$("#txtNumberOfCompletedMonths").val();if(u!==""&&f!==""&&t!==""&&$.isNumeric(t)&&e!==""&&o!==""&&i!==""&&/^[0-9]{1,3}(?:\.[0-9]{1,2})?$/.test(t)){if(i==="Yes"&&s==="")return}else return;r=new FormData(this);$.ajax({url:baseURL+"Payroll/AddBonus",type:"POST",data:r,success:function(n){n===!0?(ShowAlertBox("Bonus added successfully. Please review the below list of employees."),refreshGrid($("#ReviewAndAdjustBonusGrid")),$("#btnProceed").removeAttr("disabled")):ShowAlertBox("Error while adding bonus. Please try again")},cache:!1,contentType:!1,processData:!1})});$("#btnBonusItemsInclude").click(function(){n.CustomBonusIncludeExclude(!0)});$("#btnBonusItemsExclude").click(function(){n.CustomBonusIncludeExclude(!1)})};AddBonusView.prototype.CheckIfBonusAlreadyProcessedForSomeEmployees=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Payroll/CheckBonusBonusExistsForMonth",data:{bonusId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};AddBonusView.prototype.ProceedToFinalizeBonus=function(n,t){if(t!=""){var i=ShowConfirmationAlertBox(t);i.then(function(){window.location.href=baseURL+"Payroll/ProceedToFinalizeBonus?bonusId="+n})}else window.location.href=baseURL+"Payroll/ProceedToFinalizeBonus?bonusId="+n};AddBonusView.prototype.ChangeOnBasedOnMonthSelection=function(){var n=$("#ddlBonusBasedOnMonth option:selected").text();n=="No"?($("#txtNumberOfCompletedMonths").prop("required",!1),$("#txtNumberOfCompletedMonths").val(""),$("#divShowIfBonusBasedOnMonth").hide()):n=="Yes"&&($("#divShowIfBonusBasedOnMonth").show(),$("#txtNumberOfCompletedMonths").prop("required",!0))};AddBonusView.prototype.LoadReviewAndAdjustBonusGrid=function(){function n(){setTimeout(function(){$("#ReviewAndAdjustBonusGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Reivew and Adjust Bonus");$("#ReviewAndAdjustBonusGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#ReviewAndAdjustBonusGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Adjust Bonus");$("#ReviewAndAdjustBonusGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-checkbox-label").removeClass("k-checkbox-label").addClass("checkbox");$('input[type="radio"]:checked').parent().addClass("btn-info");$("#ReviewAndAdjustBonusGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("ReviewAndAdjustBonusGrid")});$("#ReviewAndAdjustBonusGrid .k-grid-header table thead").on("change",".checkAll",function(){$("#ReviewAndAdjustBonusGrid tbody input:checkbox").prop("checked",this.checked)});$("#ReviewAndAdjustBonusGrid input.k-input.k-textbox").blur(function(){var t=this.closest("tr"),n=$("#ReviewAndAdjustBonusGrid").data("kendoGrid").dataItem(t),u=this.name=="factor"?/^[0-9]{1,2}(?:\.[0-9]{1,2})?$/.test(this.value):/^[0-9]*(?:\.[0-9]{1,2})?$/.test(this.value),i,r;if(u)switch(this.name){case"amount":i=(this.value/n.basicSalary).toFixed(2);$(t).find('input.k-input.k-textbox[name="factor"]').val(i);n.factor=i;break;case"factor":r=this.value*n.basicSalary;$(t).find('input.k-input.k-textbox[name="amount"]').val(r);n.amount=r}});KGrdPageSizeDdlPosition("ReviewAndAdjustBonusGrid",0)},1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadBonusDetailsBeforeFinalize",dataType:"json"},update:{url:baseURL+"Payroll/UpdateReviewAndAdjustBonusDetails",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{bonusDetails:kendo.stringify(n.models)}:t=="read"?{bonusId:$("#hdnBonusId").val()}:void 0}},batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},jobTitle:{editable:!1},joiningDate:{editable:!1,type:"date"},resignationDate:{editable:!1,type:"date"},salaryType:{editable:!1},lastProcessedDate:{editable:!1,type:"date"},basicSalary:{editable:!1},currencySymbol:{editable:!1},currency:{editable:!1},factor:{editable:!0,validation:{required:!0,factorValidation:function(n){return n.is("[name='factor']")&&n.val()!=""?(n.attr("data-factorValidation-msg","Factor should be in format {00.00}"),/^[0-9]{1,2}(?:\.[0-9]{1,2})?$/.test(n.val())):!0}}},amount:{editable:!0,type:"Number",validation:{required:!0}},include:{type:"boolean"}}}}});$("#ReviewAndAdjustBonusGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{template:'<input type="checkbox" id="#:data.employeeId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-ChkrviewAdjust" class="checkAll"><label class="checkbox-inline" for="header-ChkrviewAdjust"><\/label>',width:50},{field:"employeeName",title:"Name",width:"150px"},{field:"employeeCode",title:"Emp Code",width:"90px"},{field:"jobTitle",title:"Job Title",width:"150px"},{field:"joiningDate",title:"Join Date",width:"100px",template:"#if(joiningDate === ''|| joiningDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(joiningDate), 'dd MMM yyyy')#  #}#"},{field:"resignationDate",title:"Resignation Date",width:"130px",template:"#if(resignationDate === ''||resignationDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(resignationDate), 'dd MMM yyyy')#  #}#"},{field:"salaryType",title:"Salary Type",width:"95px"},{field:"lastProcessedDate",title:"Last Processed",width:"110px",template:"#if(lastProcessedDate === null || lastProcessedDate === ''){# - #}else{# #=kendo.toString(kendo.parseDate(lastProcessedDate), 'dd MMM yyyy')# #}#"},{field:"basicSalary",title:"Basic Salary",width:"130px",headerTemplate:'<span id="lblHeaderSalary"><\/span>',template:function(n){if($("#ReviewAndAdjustBonusGrid").find("#lblHeaderSalary").html()==""){var t=n.currency===null?"":n.currency;$("#ReviewAndAdjustBonusGrid").find("#lblHeaderSalary").html("Basic Salary")}return formatAmountWithCurrency(n.basicSalary,n.currency,n.currencySymbol)}},{field:"factor",title:"Factor",width:"60px",template:"#if(factor === null || factor === ''){# - #}else{# #= kendo.toString(factor, 'n2')# #}#"},{field:"amount",title:"Amount",width:"100px",type:"Number",headerTemplate:'<span id="lblHeaderAmt"><\/span>',template:function(n){if($("#ReviewAndAdjustBonusGrid").find("#lblHeaderAmt").html()==""){var t=n.currency===null?"":n.currency;$("#ReviewAndAdjustBonusGrid").find("#lblHeaderAmt").html("Amount")}return formatAmountWithCurrency(n.amount,n.currency,n.currencySymbol)}},{field:"include",title:"Include ?",width:"107px",template:"<label class='btn btn-default'><input hidden disabled type='radio' value='#: include #' #= include=== true ? 'checked' : ''# >Yes<\/label><label class='btn btn-default'><input hidden disabled type='radio' value='#: include #' #= include=== false ? 'checked' : ''# >No<\/label>",editor:bonusIncludeEditor},{command:[{name:"edit",text:{edit:" ",update:" ",cancel:" "}}],title:"&nbsp;",width:"70px"}],editable:"inline",edit:n,dataBound:n,cancel:n,dataBinding:function(){$("#ReviewAndAdjustBonusGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","input[type='radio']",function(){$('input[type="radio"]').parent().removeClass("btn-info");$('input[type="radio"]:checked').parent().addClass("btn-info")})};AddBonusView.prototype.CustomBonusIncludeExclude=function(n){var t,i;if(n=n?!0:!1,t=$("#ReviewAndAdjustBonusGrid tbody input[type='checkbox']:checked").length,t<=0){ShowAlertBox("Please select at least one employee");return}i=ShowConfirmationAlertBox("Are you sure about "+(n?"including":"excluding")+" selected employee(s)  "+(n?"for":"from")+" Bonus Processing?");i.then(function(){var t="",i;$("#ReviewAndAdjustBonusGrid tbody input[type='checkbox']:checked").each(function(){var n=$("#ReviewAndAdjustBonusGrid").data("kendoGrid").dataSource.get(this.id);t=t==""?n.bonusDetailId:t+","+n.bonusDetailId});t!=""&&(i=AddBonusView.prototype.BonusItemsIncludeExclude(t,n),i?(ShowAlertBox("Employee(s) "+(n?"included":"excluded")+" successfully "+(n?"for":"from")+" bonus processing."),refreshGrid($("#ReviewAndAdjustBonusGrid"))):ShowAlertBox("Error while "+(n?"including":"excluding")+" employee(s)"))})};AddBonusView.prototype.BonusItemsIncludeExclude=function(n,t){var i=!1;return $.when($.ajax({url:baseURL+"Payroll/BonusDetailsIncludeExclude",data:{detailIds:n,isInclude:t},type:"POST",async:!1})).then(function(n){i=n=="Success"?!0:!1}),i};FinalizePaymentView.prototype.Init=function(){var n=this;this.LoadFinalizeBonusPaymentGrid();$("#btnConfirmForProcessBonus").click(function(n){n.preventDefault();var t=$("#hdnBonusPaymentType").val();t==="Include with Monthly Payroll"?$("#confirmProcessBonusPopup").modal("toggle"):$("#bonusConfirmationDialog").modal("toggle")});$("#btnProcessBonusOK , #btnOkBonusProcessing").click(function(n){n.preventDefault();$("#processingBonusCalculation").modal({backdrop:"static",keyboard:!1});$("#lblProcessingDoneCount").hide();$("#confirmProcessBonusPopup").modal("hide");$("#bonusConfirmationDialog").modal("hide");$("#processingBonusCalculation").modal("show")});$("#btnProcessingOK").click(function(t){t.preventDefault();var r=$("#hdnEmployeeCnt").val(),u=$("#hdnBonusId").val(),i=!1;i=n.ApproveBonus(u);r>0&&i?($("#processingBonusCalculation").modal("toggle"),$("#bonusProcessedDialog").modal("toggle")):$("#processingBonusCalculation").modal("toggle")});$("#btnOkBonusProcessed").click(function(n){n.preventDefault();$("#bonusProcessedDialog").modal("toggle");window.location.href=baseURL+"DashBoard/PayrollProcess"});$("#btnGoToMonthlyPayroll").click(function(n){n.preventDefault();$("#bonusProcessedDialog").modal("toggle");window.location.href=baseURL+"Payroll/ProcessPayroll"});$("#processingBonusCalculation").on("shown.bs.modal",function(){for(var r=!1,t=0,u=$("#FinalizeBonusPaymentGrid").data("kendoGrid").dataSource.data(),i=0;i<u.length;i++)r=n.CalculateBonus(u[i].bonusDetailId),r&&t++;$("#lblProcessingProgress").hide();t>0?$("#lblProcessingDoneCount").text("Bonus calculation done for "+t+" employees."):$("#lblProcessingDoneCount").text("No employees pending for bonus calculation.");$("#hdnEmployeeCnt").val(t);$("#lblProcessingDoneCount").show();setTimeout(function(){$("#btnProcessingOK").removeClass("disabled");$("#btnProcessingOK").removeClass("btn-eventNot")},10)})};FinalizePaymentView.prototype.ApproveBonus=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Payroll/ApproveBonus",data:{bonusId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};FinalizePaymentView.prototype.CalculateBonus=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Payroll/CalculateBonus",data:{bonusDetailId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};FinalizePaymentView.prototype.LoadFinalizeBonusPaymentGrid=function(){function n(){setTimeout(function(){$(".k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit");$(".k-i-edit").removeClass("k-icon k-i-edit");$(".k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update");$(".k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");KGrdPageSizeDdlPosition("FinalizeBonusPaymentGrid",0)},1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadEmployeeBonusDetailsForReview",dataType:"json"},update:{url:"//",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{bonusDetails:kendo.stringify(n.models)}:t=="read"?{bonusId:$("#hdnBonusId").val()}:void 0}},batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},bonusDetailId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},jobTitle:{editable:!1},joiningDate:{editable:!1,type:"date"},resignationDate:{editable:!1,type:"date"},salaryType:{editable:!1},lastProcessedDate:{editable:!1,type:"date"},basicSalary:{editable:!1},factor:{editable:!0},amount:{editable:!0,type:"Number"},include:{type:"boolean"},currency:{editable:!1},currencySymbol:{editable:!1}}}},aggregate:[{field:"amount",aggregate:"sum"}]});$("#FinalizeBonusPaymentGrid").kendoGrid({dataSource:t,pageable:KGridPagableObj(),sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{field:"bonusDetailId",hidden:!0},{field:"employeeName",title:"Name",width:"120px"},{field:"employeeCode",title:"Employee Code",width:"115px"},{field:"jobTitle",title:"Job Title",width:"150px"},{field:"joiningDate",title:"Join Date",width:"90px",template:"#if(joiningDate === ''|| joiningDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(joiningDate), 'dd MMM yyyy')#  #}#"},{field:"resignationDate",title:"Resignation Date",width:"120px",template:"#if(resignationDate === ''||resignationDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(resignationDate), 'dd MMM yyyy')#  #}#"},{field:"salaryType",title:"Salary Type",width:"95px"},{field:"lastProcessedDate",title:"Last Processed Date",width:"140px",template:"#if(lastProcessedDate === ''|| lastProcessedDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(lastProcessedDate), 'dd MMM yyyy')#  #}#"},{field:"basicSalary",title:"Basic Salary",width:"100px",template:function(n){return formatAmountWithCurrency(n.basicSalary,n.currency,n.currencySymbol)}},{field:"factor",title:"Bonus Factor",width:"100px",template:"#if(factor === ''|| factor === null){# - #}else{# #=kendo.toString(factor, 'n2')#  #}#",footerTemplate:"<div class='pull-right' style='font-weight:bold;'>Total :<\/div>"},{field:"amount",title:"Bonus Amount",width:"105px",type:"Number",template:function(n){return formatAmountWithCurrency(n.amount,n.currency,n.currencySymbol)},footerTemplate:"<div style='font-weight:bold;'>#= kendo.toString(sum, 'C') #<\/div>"},],editable:"inline",edit:n,dataBound:n,cancel:n})};PayslipsView.prototype.Init=function(){var n=this;$('#ddlFilterPayslipType option[value="Monthly Payroll"], #ddlFilterDuration option[value="Current Month"]').attr("selected",!0);this.DurationTypeSelected();this.LoadPayslipsGrid();$("#ddlFilterDuration").change(function(){n.DurationTypeSelected();n.PayslipsGridApplyFilter()});$("#ddlFilterPayslipType").change(function(){n.PayslipsGridApplyFilter()});$("#ddlFilterYear, #ddlFilterFromMonth, #ddlFilterToMonth").change(function(){n.PayslipsGridApplyFilter()});$("#txtFilterEmpName").focusout(function(){var t=$("#txtFilterEmpName").val();n.PayslipsGridApplyFilter()});$("#txtFilterEmpName").keypress(function(t){if(t.keyCode==13){var i=$("#txtFilterEmpName").val();return n.PayslipsGridApplyFilter(),!1}});$("#btnConsolidatedPayslip").click(function(t){t.preventDefault();n.ExportCosolidatedPayslipPdf()});$("#btnYTDConsolidatedPayslip").click(function(t){t.preventDefault();n.YTDExportCosolidatedPayslipPdf()});$("#btnEmailPayslip").click(function(t){var i,r;if(t.preventDefault(),i=$("#PayslipsGrid tbody").find("input:checked").length,i<=0){ShowAlertBox("Please select at least one employee to email payslip");return}r=ShowConfirmationAlertBox("Are you sure you want to email pay slips for selected employee(s)?");r.then(function(){var u=!1,t="",i,r;$("#PayslipsGrid").find("input:checked").not('[grp-header-chk="Y"]').each(function(){if(this.id!="header-chk-payslip"){var n=$("#PayslipsGrid").data("kendoGrid").dataSource.get(this.id).employeeId;t=t==""?n:t+","+n}});i=GetEmployeesWithInvalidField(t,"Email");r=[];i.length>0?($.each(i,function(n,t){r.push(t.name)}),ShowSummaryBox("Employee(s) do not have a valid email address, either update or skip them to continue",r)):($("#PayslipsGrid").find("input:checked").not('[grp-header-chk="Y"]').each(function(){this.id!="header-chk-payslip"&&(u=n.EmailPayslipToEmployee(this.id))}),u?(ShowAlertBox("Email queued. Will be sent in some time."),$("#PayslipsGrid input[type=checkbox]").prop("checked",!1)):ShowAlertBox("Fail to queue payslip email."))})});$("#btnEmailPayslipReadyNotification").click(function(t){var i,r;if(t.preventDefault(),i=$("#PayslipsGrid tbody").find("input:checked").length,i<=0){ShowAlertBox("Please select at least one employee to send payslip ready notification");return}r=ShowConfirmationAlertBox("Are you sure you want to send payslip ready notification for selected employee(s)?");r.then(function(){var u=!1,t="",i,r;$("#PayslipsGrid").find("input:checked").not('[grp-header-chk="Y"]').each(function(){if(this.id!="header-chk-payslip"){var n=$("#PayslipsGrid").data("kendoGrid").dataSource.get(this.id).employeeId;t=t==""?n:t+","+n}});i=GetEmployeesWithInvalidField(t,"Email");r=[];i.length>0?($.each(i,function(n,t){r.push(t.name)}),ShowSummaryBox("Employee(s) do not have a valid email address, either update or skip them to continue",r)):($("#PayslipsGrid").find("input:checked").not('[grp-header-chk="Y"]').each(function(){this.id!="header-chk-payslip"&&(u=n.QueuePayslipReadyNotification(this.id))}),u?(ShowAlertBox("Payslip ready notification queued. Will be sent in some time."),$("#PayslipsGrid input[type=checkbox]").prop("checked",!1)):ShowAlertBox("Fail to queue payslip ready notification email."))})})};PayslipsView.prototype.EmailPayslipToEmployee=function(n){var t=!1,i=$("#PayslipsGrid").data("kendoGrid").dataSource.get(n);return n===""||i.employeeId===""?!1:($.when($.ajax({url:baseURL+"Payslip/QueuePayslipEmail",data:{rowId:n,employeeId:i.employeeId,isBonusPayslip:i.isBonusPayslip},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t)};PayslipsView.prototype.QueuePayslipReadyNotification=function(n){var t=!1,i=$("#PayslipsGrid").data("kendoGrid").dataSource.get(n);return n===""||i.employeeId===""?!1:($.when($.ajax({url:baseURL+"Payslip/QueuePayslipReadyNotification",data:{rowId:n,employeeId:i.employeeId,isBonusPayslip:i.isBonusPayslip},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t)};PayslipsView.prototype.DurationTypeSelected=function(){var n=$("#ddlFilterDuration").find("option:selected").val();n=="Custom"?$("#divFilterYear, #divToMonth, #divFromMonth").show():($("#ddlFilterFromMonth, #ddlFilterToMonth, #ddlFilterYear").val(""),$("#divFilterYear, #divToMonth, #divFromMonth").hide())};PayslipsView.prototype.PayslipsGridApplyFilter=function(){var e,i,n,r,u,f,t;if((e=$("#txtFilterEmpName").val(),i=$("#ddlFilterPayslipType option:selected").text(),n=$("#ddlFilterDuration option:selected").text(),r=$("#ddlFilterYear option:selected").text(),u=$("#ddlFilterFromMonth option:selected").text(),f=$("#ddlFilterToMonth option:selected").text(),i==""||n=="")||n=="Custom"&&(r==""||u==""||f==""))return!1;refreshGrid($("#PayslipsGrid"));t=$("#PayslipsGrid").data("kendoGrid");n!="Last Month"&&n!="Current Month"?t!=undefined&&t.dataSource.group([{field:"employeeCode"}]):t!=undefined&&t.dataSource.group([])};PayslipsView.prototype.LoadPayslipsGrid=function(){function t(){setTimeout(function(){var t=$("#ddlFilterPayslipType option:selected").text(),n=$("#PayslipsGrid").data("kendoGrid");$("#PayslipsGrid tbody input:checkbox").not('[grp-header-chk="Y"]').on("change",function(){PayslipsView.prototype.SetGroupHeaderChkBoxCheckUncheck(!1,this);SetHeaderChkBoxCheckUnCheck("PayslipsGrid")});$('#PayslipsGrid input[type="checkbox"][grp-header-chk="Y"]').on("change",function(){PayslipsView.prototype.SetGroupHeaderChkBoxCheckUncheck(!0,this);SetHeaderChkBoxCheckUnCheck("PayslipsGrid")});t==="Bonus"?(n.showColumn("bonusPaymentDate"),n.hideColumn("payrollMonthYear")):(n.hideColumn("bonusPaymentDate"),n.showColumn("payrollMonthYear"));KGrdPageSizeDdlPosition("PayslipsGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payslip/LoadEmployeePayslipsDetailList",dataType:"json"},pageSize:10,parameterMap:function(n,t){if(t=="read"){var i=$("#txtFilterEmpName").val(),r=$("#ddlFilterPayslipType option:selected").text(),u=$("#ddlFilterDuration option:selected").text(),f=$("#ddlFilterYear option:selected").text(),e=$("#ddlFilterFromMonth option:selected").text(),o=$("#ddlFilterToMonth option:selected").text();return{employeeName:i,payslipType:r,duration:u,year:f,fromMonth:e,toMonth:o}}}},batch:!0,pageSize:10,schema:{model:{id:"rowId",fields:{rowId:{editable:!1},isOldPayslip:{editable:!1},employeeId:{editable:!1},employeeName:{editable:!1},basicSalaryType:{editable:!1},citizenship:{editable:!1}}}}});$("#PayslipsGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.rowId#" class="chk-box" ><label class="checkbox-inline" style="padding-left: 15px !important;" for="#:data.rowId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-payslip" class="checkAll"><label class="checkbox-inline" for="header-chk-payslip"><\/label>',width:50},{field:"rowId",title:"",hidden:!0},{field:"isOldPayslip",title:"",hidden:!0},{field:"companyId",title:"",hidden:!0},{field:"payslipMonth",title:"Month",hidden:!0},{field:"payslipYear",title:"Year",hidden:!0},{field:"employeeId",title:"EmpId",hidden:!0},{field:"employeeCode",title:"Employee Code",width:"120px",groupHeaderTemplate:function(n){return"<input type='checkbox' grp-header-chk='Y' emp-code='"+n.items[0].employeeCode+"' id='"+n.items[0].employeeCode+"' class='checkGroupAll'><label class='checkbox-inline' for='"+n.items[0].employeeCode+"'><\/label><span style='padding-left:2px;font-weight:bold'>"+n.items[0].employeeCode+"<\/span><span style='padding-left:5px;font-weight:bold'>"+n.items[0].employeeName+"<\/span>"}},{field:"employeeName",title:"Name",width:"200px"},{field:"basicSalaryType",title:"Salary Type",width:"100px"},{field:"citizenship",title:"Nationality",width:"150px"},{field:"joiningDate",title:"Join Date",width:"150px",template:"#if(joiningDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(joiningDate), 'ddd, dd MMM yyyy')#  #}#"},{field:"resignationDate",title:"Resignation Date",width:"150px",template:"#if(resignationDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(resignationDate), 'ddd, dd MMM yyyy')#  #}#"},{field:"payrollMonthYear",title:"Payroll"},{field:"bonusPaymentDate",title:"Bonus Payment Date",template:"#if(bonusPaymentDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(bonusPaymentDate), 'dd MMM yyyy')#  #}#"},{template:'<div class=\'pointer\' onclick=\'OpenPayslipViewer("#:employeeIdHash#","#:payslipYear#","#:payslipMonth#","#:isBonusPayslip#")\'><img src=\''+baseURL+"images/doc.png' class='img-responsive' title='Open Payslip' /><\/div>",width:"40px"},{template:"<div class='pointer'><a href='"+baseURL+"Payslip/DownloadPayslip/#:companyId#-#:employeeId#-#:payslipYear#-#:payslipMonth#-#:isOldPayslip#.#:isBonusPayslip#'><img src='"+baseURL+"images/attached.png' class='img-responsive'  title='Download Payslip' /><\/a><\/div>",width:"40px"}],dataBound:t,dataBinding:function(){$("#PayslipsGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk-payslip",function(){$("#PayslipsGrid tbody input:checkbox").prop("checked",this.checked)})};PayslipsView.prototype.SetGroupHeaderChkBoxCheckUncheck=function(n,t){var u=$("#PayslipsGrid").data("kendoGrid"),o,i,r,f,e;if(o=n?$(t).attr("emp-code"):u.dataItem($(t).closest("tr")).employeeCode,i=u._groupRows,i!=undefined&&i.length>0)for(indx=0;indx<i.length;indx++)if(i[indx].value==o)for(r=i[indx].items,f=0,idx=0;idx<r.length;idx++)e=u.tbody.find("tr[data-uid='"+r[idx].uid+"']").find("input:checkbox.chk-box"),n?e.prop("checked",$(t).prop("checked")):(e.prop("checked")==!0?f=f+1:u.tbody.find("#"+r[idx].employeeCode).prop("checked",!1),f==r.length&&u.tbody.find("#"+r[idx].employeeCode).prop("checked",!0))};PayslipsView.prototype.ExportCosolidatedPayslipPdf=function(){var n="",t=0;if($("#PayslipsGrid").find("input:checked").not('[grp-header-chk="Y"]').each(function(){if(this.id!="header-chk-payslip"){var i=$("#PayslipsGrid").data("kendoGrid").dataSource.get(this.id);n=n==""?i.employeeId+","+i.payslipYear+","+i.payslipMonth:n+"!"+i.employeeId+","+i.payslipYear+","+i.payslipMonth;t++}}),t==0){ShowAlertBox("Please select at least one payslip");return}window.location.href=baseURL+"Payslip/ConcolidatedViewPayslip?eIdYearMonth="+n+"&isBonusPayslip="+($("#ddlFilterPayslipType").val()=="Monthly Payroll"?!1:!0)};PayslipsView.prototype.YTDExportCosolidatedPayslipPdf=function(){var n="",u=0,e="";const t=[],i=[],r=[];$("#PayslipsGrid").find("input:checked").not('[grp-header-chk="Y"]').each(function(){if(this.id!="header-chk-payslip"){var f=$("#PayslipsGrid").data("kendoGrid").dataSource.get(this.id);n==""?(n=f.employeeId+","+f.payslipMonth,t.push(f.employeeId),r.push(f.payslipYear),i.push(f.payslipMonth)):(n=n+"!"+f.employeeId+","+f.payslipMonth,t.push(f.employeeId),r.push(f.payslipYear),i.push(f.payslipMonth));u++}});const o=(n,t,i)=>i.indexOf(n)===t,s=(n,t,i)=>i.indexOf(n)===t,h=(n,t,i)=>i.indexOf(n)===t,c=t.filter(o),l=i.filter(s),f=r.filter(h);if(f.length>1){ShowAlertBox("Please select at only one payslip year");return}var a=c.toString(),v=l.toString(),e=f.toString();if(u==0){ShowAlertBox("Please select at least one payslip");return}window.location.href=baseURL+"Payslip/YTDConcolidatedViewPayslip?employees="+a+"&y="+e+"&m="+v+"&isBonusPayslip="+($("#ddlFilterPayslipType").val()=="Monthly Payroll"?!1:!0)+"&employeeIdMonths="+n};MyPayslipsView.prototype.Init=function(){var n=this;$('#ddlFilterByDuration option[value="Current Month"]').attr("selected",!0);this.LoadMonthlyPayRollSalaryHistoryGrid();this.LoadBonusSalaryHistoryGrid();$("#ddlFilterByDuration").change(function(){this.value=="Custom"?$("#divFilterYear, #divToMonth, #divFromMonth").show():($("#ddlFilterByFromMonth, #ddlFilterByToMonth, #ddlFilterByYear").val(""),$("#divFilterYear, #divToMonth, #divFromMonth").hide());n.MyPayslipsGridsApplyFilter()});$("#ddlFilterByYear, #ddlFilterByFromMonth, #ddlFilterByToMonth").change(function(){n.MyPayslipsGridsApplyFilter()});$("#btnConsolidatedPayslip").click(function(t){t.preventDefault();n.CosolidatedPayslipPdf("MonthlyPayslipHistoryGrid",!1)});$("#btnConsolidatedBonusPayslip").click(function(t){t.preventDefault();n.CosolidatedPayslipPdf("BonusPayslipHistoryGrid",!0)});$("#btnYTDConsolidatedPayslip").click(function(t){t.preventDefault();n.YTDCosolidatedPayslipPdf("MonthlyPayslipHistoryGrid",!1)})};MyPayslipsView.prototype.CosolidatedPayslipPdf=function(n,t){var i="",r=0;if($("#"+n).find("input:checked").each(function(){if(this.id!="header-chk"&&this.id!="header-chk1"){var t=$("#"+n).data("kendoGrid").dataItem($(this).closest("tr"));i=i==""?t.employeeId+","+t.year+","+t.monthNo+","+t.isOldPayslip:i+"!"+t.employeeId+","+t.year+","+t.monthNo+","+t.isOldPayslip;r++}}),r==0){ShowAlertBox("Please select at least one payslip");return}window.location.href=baseURL+"Payslip/ConcolidatedViewPayslip?eIdYearMonth="+i+"&isBonusPayslip="+t};MyPayslipsView.prototype.YTDCosolidatedPayslipPdf=function(n,t){var i="",e=0,s="";const r=[],u=[],f=[];$("#"+n).find("input:checked").each(function(){if(this.id!="header-chk"&&this.id!="header-chk1"){var t=$("#"+n).data("kendoGrid").dataItem($(this).closest("tr"));i==""?(i=t.employeeId+","+t.year+","+t.monthNo+","+t.isOldPayslip,r.push(t.employeeId),f.push(t.year),u.push(t.monthNo)):(i=i+"!"+t.employeeId+","+t.year+","+t.monthNo+","+t.isOldPayslip,r.push(t.employeeId),f.push(t.year),u.push(t.monthNo));e++}});const h=(n,t,i)=>i.indexOf(n)===t,c=(n,t,i)=>i.indexOf(n)===t,l=(n,t,i)=>i.indexOf(n)===t,a=r.filter(h),v=u.filter(c),o=f.filter(l);if(o.length>1){ShowAlertBox("Please select at only one payslip year");return}var y=a.toString(),p=v.toString(),s=o.toString();if(e==0){ShowAlertBox("Please select at least one payslip");return}window.location.href=baseURL+"Payslip/YTDConcolidatedViewPayslip?employees="+y+"&y="+s+"&m="+p+"&isBonusPayslip="+t};MyPayslipsView.prototype.LoadMonthlyPayRollSalaryHistoryGrid=function(){function t(){setTimeout(function(){KGrdPageSizeDdlPosition("MonthlyPayslipHistoryGrid",0);$("#MonthlyPayslipHistoryGrid input:checkbox").not(".checkAll").on("change",function(){SetHeaderChkBoxCheckUnCheck("MonthlyPayslipHistoryGrid")});$("#MonthlyPayslipHistoryGrid #header-chk1").on("change",function(){$("#MonthlyPayslipHistoryGrid tbody input:checkbox").prop("checked",this.checked)})},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payslip/LoadPayslipHistory",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#ddlFilterByDuration option:selected").text(),r=$("#ddlFilterByYear option:selected").text(),u=$("#ddlFilterByFromMonth option:selected").text(),f=$("#ddlFilterByToMonth option:selected").text();return{employeeId:$("#EmployeeId").val(),duration:i,year:r,fromMonth:u,toMonth:f}}}},batch:!0,pageSize:5,schema:{model:{id:"employeeIdHash",fields:{employeeId:{editable:!1},employeeIdHash:{editable:!1},isOldPayslip:{editable:!1},year:{editable:!1},month:{editable:!1},salaryType:{editable:!1},netPay:{editable:!1},currencySymbol:{editable:!1},currency:{editable:!1}}}}});$("#MonthlyPayslipHistoryGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,dataBound:t,dataBinding:function(){$("#MonthlyPayslipHistoryGrid input[type=checkbox].checkAll").prop("checked",!1)},columns:[{field:"employeeIdHash",hidden:!0},{field:"isOldPayslip",hidden:!0},{template:'<input type="checkbox" id="#:data.year##:data.month#" class="chk-box" ><label class="checkbox-inline" style="padding-left: 5px !important;" for="#:data.year##:data.month#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk1" class="checkAll"><label class="checkbox-inline" for="header-chk1"><\/label>',width:50},{field:"monthNo",hidden:!0},{field:"year",title:"Year",width:"250px"},{field:"month",title:"Month",width:"270px"},{field:"salaryType",title:"Salary Type",width:"270px"},{field:"netPay",title:"Net Pay",width:"200px",headerTemplate:'<span id="lblHeaderNetPay"><\/span>',template:function(n){if($("#MonthlyPayslipHistoryGrid").find("#lblHeaderNetPay").html()==""){var t=n.currency===null?"":n.currency;$("#MonthlyPayslipHistoryGrid").find("#lblHeaderNetPay").html("Net Pay ("+t+")")}return formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)}},{template:"<div class='pointer' title='Open Payslip' onclick='OpenPayslipViewer(\"#:employeeIdHash#\",\"#:year#\",\"#:monthNo#\",false)'><img src='"+baseURL+"images/doc.png' class='img-responsive' /><\/div>",width:"40px"},{template:"<div class='pointer'><a href='"+baseURL+"Payslip/DownloadPayslip/#:companyId#-#:employeeId#-#:year#-#:monthNo#-#:isOldPayslip#'><img src='"+baseURL+"images/attached.png' class='img-responsive'  title='Download Payslip' /><\/a><\/div>",width:"40px"}]})};MyPayslipsView.prototype.LoadBonusSalaryHistoryGrid=function(){function t(){setTimeout(function(){KGrdPageSizeDdlPosition("BonusPayslipHistoryGrid",1);$("#BonusPayslipHistoryGrid input:checkbox").not(".checkAll").on("change",function(){SetHeaderChkBoxCheckUnCheck("BonusPayslipHistoryGrid")});$("#BonusPayslipHistoryGrid #header-chk").on("change",function(){$("#BonusPayslipHistoryGrid tbody input:checkbox").prop("checked",this.checked)})},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payslip/LoadBonusPayslipHistory",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#ddlFilterByDuration option:selected").text(),r=$("#ddlFilterByYear option:selected").text(),u=$("#ddlFilterByFromMonth option:selected").text(),f=$("#ddlFilterByToMonth option:selected").text();return{employeeId:$("#EmployeeId").val(),duration:i,year:r,fromMonth:u,toMonth:f}}}},batch:!0,pageSize:5,schema:{model:{id:"employeeIdHash",fields:{employeeIdHash:{editable:!1},year:{editable:!1},month:{editable:!1},paymentBy:{editable:!1},bonusAmount:{editable:!1},currencySymbol:{editable:!1},currency:{editable:!1},isOldPayslip:{editable:!1}}}}});$("#BonusPayslipHistoryGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,dataBound:t,dataBinding:function(){$("#BonusPayslipHistoryGrid input[type=checkbox].checkAll").prop("checked",!1)},sortable:!0,columns:[{field:"employeeIdHash",hidden:!0},{template:'<input type="checkbox" id="#:data.year##:data.month#" class="chk-box" ><label class="checkbox-inline" style="padding-left: 5px !important;" for="#:data.year##:data.month#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:50},{field:"monthNo",hidden:!0},{field:"isOldPayslip",hidden:!0},{field:"year",title:"Year",hidden:!0},{field:"month",title:"Month",hidden:!0},{field:"description",title:"Description",width:"270px"},{field:"bonusAmount",title:"Bonus Amount",width:"200px",headerTemplate:'<span id="lblHeaderAmount"><\/span>',template:function(n){if($("#BonusPayslipHistoryGrid").find("#lblHeaderAmount").html()==""){var t=n.currency===null?"":n.currency;$("#BonusPayslipHistoryGrid").find("#lblHeaderAmount").html("Bonus Amount ("+t+")")}return formatAmountWithCurrency(n.bonusAmount,n.currency,n.currencySymbol)}},{field:"paymentBy",title:"Payment By",width:"270px"},{field:"paymentDate",title:"Paid On",width:"270px",template:"#= kendo.toString(kendo.parseDate(paymentDate), 'dd MMM yyyy') #"},{template:"<div class='pointer' title='Open Bonus Payslip' onclick='OpenPayslipViewer(\"#:employeeIdHash#\",\"#:year#\",\"#:monthNo#\",true)'><img src='"+baseURL+"images/doc.png' class='img-responsive' /><\/div>",width:"40px"},{template:"<div class='pointer'><a href='"+baseURL+"Payslip/DownloadPayslip/#:companyId#-#:employeeId#-#:year#-#:monthNo#.true'><img src='"+baseURL+"images/attached.png' class='img-responsive'  title='Download Bonus Payslip' /><\/a><\/div>",width:"40px"}]})};MyPayslipsView.prototype.MyPayslipsGridsApplyFilter=function(){var n,t,i,r;if((n=$("#ddlFilterByDuration option:selected").text(),t=$("#ddlFilterByYear option:selected").text(),i=$("#ddlFilterByFromMonth option:selected").text(),r=$("#ddlFilterByToMonth option:selected").text(),n=="")||n=="Custom"&&(t==""||i==""||r==""))return!1;refreshGrid($("#MonthlyPayslipHistoryGrid"));refreshGrid($("#BonusPayslipHistoryGrid"))};IR8AView.prototype.Init=function(){var n=this,t;$("#ddlIR8AAssesmentYear").val((new Date).getFullYear());this.SetAuthorisedPersonDetailControls(!0);t=$("#ddlIRASTaxRefNumber > option").length;t==2&&$("#ddlIRASTaxRefNumber").val($("#ddlIRASTaxRefNumber option:eq(1)").val()).attr("selected","selected");n.LoadIR8ADetailGrid();$("#ddlIR8AAssesmentYear, #ddlIR8ACurrency").change(function(){$("#ddlIR8AAssesmentYear").val()!=""&&refreshGrid($("#IR8ADetailGrid"))});$("#btnGenerateIR8AFile").click(function(t){t.preventDefault();n.GenerateIR8AFileClick()});$("#btnGenerateIR8AForm").click(function(t){t.preventDefault();n.GenerateIR8AFormClick()});$("#btnGenerateIR21Form").click(function(t){t.preventDefault();n.GenerateIR21FormClick()});$("#ddlAuthorisedPerson").change(function(){n.SetAuthorisedPersonDetailControls()})};IR8AView.prototype.GenerateIR8AFileClick=function(){var n=$("#ddlIR8AAssesmentYear").val(),t=$("#ddlIRASTaxRefNumber").val(),i=$("#ddlAuthorisedPerson").val();n!=""&&t!=""&&i!=""?window.location.href=baseURL+"Payroll/GenerateIR8AFile?assesmentYear="+n+"&irasTaxRefNumber="+t+"&authorizedPersonId="+i+"&currencyCode=SGD":ShowAlertBox("Please select Tax Reference Number and Authorized Person to continue.")};IR8AView.prototype.GenerateIR8AFormClick=function(){var t=$("#ddlIR8AAssesmentYear").val(),f=$("#ddlIRASTaxRefNumber").val(),i=$("#ddlAuthorisedPerson").val();if(t===""||i===""){ShowAlertBox("Please select Assesment Year and Authorized Person to continue");return}var u=!1,r=0,n="";if($("#IR8ADetailGrid").find("input:checked").each(function(){this.id!="header-chk-ira"&&(n=n==""?this.id:n+","+this.id,u=!0,r++)}),r===0){ShowAlertBox("Please select at least one employee to generate the IR8A Form!");return}window.location.href=baseURL+"Payroll/GenerateIR8AForm?assesmentYear="+t+"&employeeIds="+n+"&authorizedPersonId="+i+"&currencyCode=SGD"};IR8AView.prototype.GenerateIR21FormClick=function(){var t=$("#ddlIR8AAssesmentYear").val(),u=$("#ddlIRASTaxRefNumber").val(),i=$("#ddlAuthorisedPerson").val(),e=$("#txtEmailAddress").val();if(t===""||u===""||i===""){ShowAlertBox("Please select Tax Reference Number and Authorized Person to continue");return}var f=!1,r=0,n="";if($("#IR8ADetailGrid").find("input:checked").each(function(){this.id!="header-chk-ira"&&(n=n==""?this.id:n+","+this.id,f=!0,r++)}),r===0){ShowAlertBox("Please select at least one employee to generate the IR21 Form!");return}window.location.href=baseURL+"Payroll/GenerateIR21Form?assesmentYear="+t+"&employeeIds="+n+"&authorizedPersonId="+i+"&currencyCode=SGD"};IR8AView.prototype.LoadIR8ADetailGrid=function(){function t(){setTimeout(function(){$("#IR8ADetailGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("IR8ADetailGrid")});KGrdPageSizeDdlPosition("IR8ADetailGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadPayrollDetailsForIR8A",dataType:"json"},pageSize:10,parameterMap:function(n,t){if(t=="read")return{assesmentYear:$("#ddlIR8AAssesmentYear").val(),CurrencyCode:$("#ddlIR8ACurrency option:selected").text()}}},aggregate:[{field:"grossSalary",aggregate:"sum"},{field:"basicSalary",aggregate:"sum"},{field:"bonus",aggregate:"sum"},{field:"totalAllowances",aggregate:"sum"},{field:"employeeCPF",aggregate:"sum"},{field:"mbmf",aggregate:"sum"},{field:"sinda",aggregate:"sum"},{field:"ecf",aggregate:"sum"},{field:"cdac",aggregate:"sum"},{field:"iR8ANotApplicableAllow",aggregate:"sum"},{field:"netPay",aggregate:"sum"}],batch:!0,sort:{field:"joiningDate",dir:"asc"},pageSize:7,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},passType:{editable:!1},joiningDate:{editable:!1,type:"date"},resignationDate:{editable:!1,type:"date"},grossSalary:{editable:!1,type:"number"},basicSalary:{editable:!1,type:"number"},bonus:{editable:!1,type:"number"},totalAllowances:{editable:!1,type:"number"},employeeCPF:{editable:!1,type:"number"},mbmf:{editable:!1,type:"number"},sinda:{editable:!1,type:"number"},ecf:{editable:!1,type:"number"},cdac:{editable:!1,type:"number"},iR8ANotApplicableAllow:{editable:!1,type:"number"},netPay:{editable:!1,type:"number"},payrollYear:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#IR8ADetailGrid").kendoGrid({dataSource:n,resizable:!0,pageable:KGridPagableObj(),columns:[{template:'<input type="checkbox" id="#:data.employeeId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-ira" class="checkAll"><label class="checkbox-inline" for="header-chk-ira"><\/label>',width:50},{field:"employeeId",title:"",hidden:!0},{field:"employeeCode",title:"Emp Code",width:"100px"},{field:"employeeName",title:"Name",width:"150px"},{field:"passType",title:"Pass Type",width:"200px"},{field:"resignationDate",width:"100px",title:"Cess. Date",template:"#if(resignationDate === null){# - #}else{# #=kendo.toString(kendo.parseDate(resignationDate), 'dd MMM yyyy')#  #}#",footerTemplate:"Total"},{field:"grossSalary",title:"Gross Salary",width:"110px",format:"{0:n2}",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.grossSalary.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))},template:function(n){return $("#IR8ADetailGrid").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.grossSalary,n.currency,n.currencySymbol)}},{field:"basicSalary",title:"Salary",width:"110px",format:"{0:n2}",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.basicSalary.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))},template:function(n){return formatAmountWithCurrency(n.basicSalary,n.currency,n.currencySymbol)}},{field:"bonus",title:"Bonus",width:"110px",format:"{0:n2}",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.bonus.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))},template:function(n){return formatAmountWithCurrency(n.bonus,n.currency,n.currencySymbol)}},{field:"totalAllowances",title:"Allow/Others",width:"110px",format:"{0:n2}",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.totalAllowances.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))},template:function(n){return formatAmountWithCurrency(n.totalAllowances,n.currency,n.currencySymbol)}},{field:"employeeCPF",title:"Employee CPF",width:"110px",template:function(n){return formatAmountWithCurrency(n.employeeCPF,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.employeeCPF.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"mbmf",title:"MBMF",width:"80px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.mbmf,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.mbmf.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"sinda",title:"SINDA",width:"80px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.sinda,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.sinda.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"ecf",title:"ECF",width:"70px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.ecf,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.ecf.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"cdac",title:"CDAC",width:"70px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.cdac,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.cdac.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"iR8ANotApplicableAllow",title:"Not Applicable",width:"120px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.iR8ANotApplicableAllow,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.iR8ANotApplicableAllow.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"netPay",title:"Net Pay",width:"110px",template:function(n){return formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.netPay.sum,"n2"),"",$("#IR8ADetailGrid").attr("currency"))}},{field:"payrollYear",title:"IR8A Year",width:"80px"},],dataBound:t,dataBinding:function(){$("#IR8ADetailGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk-ira",function(){$("#IR8ADetailGrid tbody input:checkbox").prop("checked",this.checked)})};IR8AView.prototype.SetAuthorisedPersonDetailControls=function(n){var t;t=n?$('#ddlAuthorisedPerson option[value="-1"]'):$("#ddlAuthorisedPerson option:selected");t.length>0&&($("#ddlAuthorisedPerson").val(t.val()),$("#txtEmailAddress").val(t.attr("attr-Email")),$("#ddlDesignation").val(t.attr("attr-Designation")))};EmployeeLeaveReportView.prototype.Init=function(){var n=this;$("#ddlEmployeeLeaveYear").val((new Date).getFullYear());n.LoadEmployeeLeaveReportGrid();n.FilterEmployeeLeaveReportGrid();$("#ddlEmployeeLeaveYear, #ddlEmployeeLeaveList").change(function(){n.FilterEmployeeLeaveReportGrid()});$("#btnEmployeeLeaveReportExcel").click(function(n){n.preventDefault();$("#EmployeeLeaveReportGrid").getKendoGrid().saveAsExcel()});$("#btnEmployeeLeaveReportPDF").click(function(n){n.preventDefault();$("#EmployeeLeaveReportGrid").getKendoGrid().saveAsPDF()});GridConfigurationClick("EmployeeLeaveReportGrid")};EmployeeLeaveReportView.prototype.LoadEmployeeLeaveReportGrid=function(){function i(){setTimeout(function(){$("#EmployeeLeaveReportGrid div.k-grouping-header,#EmployeeLeaveReportGrid div.k-grid-footer").css("display","none");$("#EmployeeLeaveReportGrid div.k-grid-header thead tr").find('th:not([data-title="Sno"])').find("a.k-header-column-menu").remove();$("#EmployeeLeaveReportGrid div.k-grid-header thead tr").find('th[data-title="Sno"]').find("a.k-header-column-menu").attr("title","Customize Columns");KGrdPageSizeDdlPosition("EmployeeLeaveReportGrid",undefined,!0)},1)}function r(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="employeeId"||t=="default")&&i.push({field:"employeeId",hidden:n!=null&&n!=""?n[0].employeeId:!0,groupHeaderTemplate:function(n){return n.items[0].employeeName}});(this=="Sno"||t=="default")&&i.push({title:"Sno",field:"srNo",reorderable:!1,hidden:!1,width:45});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee Name",width:"100px",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="leaveYear"||t=="default")&&i.push({field:"leaveYear",title:"Year",hidden:n!=null&&n!=""?n[0].leaveYear:!0});(this=="leaveType"||t=="default")&&i.push({field:"leaveType",title:"Leave Type",width:"100px",hidden:n!=null&&n!=""?n[0].leaveType:!1});(this=="fromDate"||t=="default")&&i.push({field:"fromDate",title:"FromDate",width:"90px",hidden:n!=null&&n!=""?n[0].fromDate:!0});(this=="toDate"||t=="default")&&i.push({field:"toDate",title:"ToDate",width:"90px",hidden:n!=null&&n!=""?n[0].toDate:!0});(this=="fromDateShow"||t=="default")&&i.push({field:"fromDateShow",title:"From Date",width:"90px",template:"#= kendo.toString(kendo.parseDate(fromDate), 'ddd, dd MMM yyyy') #",hidden:n!=null&&n!=""?n[0].fromDateShow:!1});(this=="toDateShow"||t=="default")&&i.push({field:"toDateShow",title:"To Date",width:"90px",template:"#= kendo.toString(kendo.parseDate(toDate), 'ddd, dd MMM yyyy') #",groupFooterTemplate:function(){return"<b>Total :<\/b>"},hidden:n!=null&&n!=""?n[0].toDateShow:!1});(this=="numberOfDays"||t=="default")&&i.push({field:"numberOfDays",title:"No of Days",width:"90px",template:"#if(numberOfDays === null || numberOfDays === ''){# - #}else{# #= kendo.toString(numberOfDays, 'n2')# #}#",groupFooterTemplate:function(n){return"<b>"+kendo.toString(n.numberOfDays.sum,"n2")+"<\/b>"},hidden:n!=null&&n!=""?n[0].numberOfDays:!1})}),i}var n=RestoreKGridState("EmployeeLeaveReportGrid",[{field:"employeeId",aggregates:[{field:"numberOfDays",aggregate:"sum",dir:"desc"}]}]),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadEmployeeLeaveReportDetails",dataType:"json"}},batch:!0,pageSize:n.gSize!=null?n.gSize:10,group:n.gGroup,sort:n.gSort,aggregate:[{field:"numberOfDays",aggregate:"sum"}],schema:{model:{id:"employeeId",fields:{leaveType:{editable:!1},employeeName:{editable:!1},leaveYear:{editable:!1},fromDate:{editable:!1},toDate:{editable:!1},fromDateShow:{editable:!1,type:"date"},toDateShow:{editable:!1,type:"date"},numberOfDays:{editable:!1}}}}});$("#EmployeeLeaveReportGrid ").kendoGrid({excel:{fileName:"EmployeeLeaveReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nEmployee Leave Report : "+$("#ddlEmployeeLeaveYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!0,!0,1,1)},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"2cm",bottom:"1cm"},landscape:!0,scale:.8,date:new Date,fileName:"EmployeeLeaveReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Employee Leave Report - "+$("#ddlEmployeeLeaveYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#EmployeeLeaveReportGrid").data("kendoGrid").dataSource;$("#EmployeeLeaveReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#EmployeeLeaveReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},dataSource:t,dataBound:i,reorderable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Sno",[JSON.parse('{"Employee Name":true, "Leave Type":true, "From Date":true, "To Date":true,"No of Days":true}')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,groupable:!0,resizable:!0,columnReorder:function(n){PreventClmReorder(n,"EmployeeLeaveReportGrid",1)},columns:r(n.clmnState,n.gColOrder)})};EmployeeLeaveReportView.prototype.FilterEmployeeLeaveReportGrid=function(){var n=$("#ddlEmployeeLeaveYear").find(":selected").text(),t=$("#ddlEmployeeLeaveList").find(":selected").text();doApplyGridFilter("EmployeeLeaveReportGrid ","eq","leaveYear",n==""?0:n);doApplyGridFilter("EmployeeLeaveReportGrid ","eq","employeeName",t=="All"?0:t)};PayrollClaimReportView.prototype.Init=function(){var t=this,n,i;GridConfigurationClick("PayrollClaimReportGrid");n=new Date;i=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1];$("#ddlClaimReportYear").val(n.getFullYear());$("#ddlClaimReportMonth").val(i);t.LoadClaimReportsGrid();$("#ddlClaimReportYear, #ddlClaimReportMonth, #ddlEmployeeListClaims").change(function(){t.FilterPayrollClaimReportGrid()});$("#btnClaimReportExcel").click(function(n){n.preventDefault();$("#PayrollClaimReportGrid").getKendoGrid().saveAsExcel()});$("#btnClaimReportPDF").click(function(n){n.preventDefault();$("#PayrollClaimReportGrid").getKendoGrid().saveAsPDF()})};PayrollClaimReportView.prototype.LoadClaimReportsGrid=function(){function i(){setTimeout(function(){$("#PayrollClaimReportGrid div.k-grouping-header,#PayrollClaimReportGrid div.k-grid-footer").css("display","none");$("#PayrollClaimReportGrid div.k-grid-header thead tr").find('th:not([data-title="Date"])').find("a.k-header-column-menu").remove();$("#PayrollClaimReportGrid div.k-grid-header thead tr").find('th[data-title="Date"]').find("a.k-header-column-menu").attr("title","Customize Columns");KGrdPageSizeDdlPosition("PayrollClaimReportGrid",undefined,!0)},0)}var n=RestoreKGridState("PayrollClaimReportGrid",[{field:"employeeId",aggregates:[{field:"reimburseAmount",aggregate:"sum"}]}]),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadClaimReports",dataType:"json"},parameterMap:function(n,t){if(t=="read"){var i=$("#ddlClaimReportYear option:selected").text(),r=$("#ddlClaimReportMonth option:selected").text();return{year:i,month:r}}}},batch:!0,aggregate:[{field:"reimburseAmount",aggregate:"sum"}],pageSize:n.gSize!=null?n.gSize:10,group:n.gGroup,sort:n.gSort,schema:{model:{id:"employeeId",fields:{employeeName:{editable:!1},reimburseAmount:{editable:!1},claimType:{editable:!1},dateIncurred:{editable:!1,type:"date"},year:{editable:!1},month:{editable:!1}}}}});$("#PayrollClaimReportGrid ").kendoGrid({excel:{fileName:"ClaimReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nClaim Report : "+$("#ddlClaimReportMonth option:selected").text()+" "+$("#ddlClaimReportYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!0,!1,0,undefined,"PayrollClaimReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"2cm",bottom:"1cm"},landscape:!0,scale:.8,date:new Date,fileName:"ClaimReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Claim Report - "+$("#ddlClaimReportMonth option:selected").text()+" "+$("#ddlClaimReportYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#PayrollClaimReportGrid").data("kendoGrid").dataSource;t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(7)})},dataSource:t,dataBound:i,reorderable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Date",[JSON.parse('{"Employee Name":true, "Claim Type":true, "Reimburse Amount":true}')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,groupable:!0,resizable:!0,columnReorder:function(n){PreventClmReorder(n,"PayrollClaimReportGrid",1)},columns:PayrollClaimReportView.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};PayrollClaimReportView.prototype.FilterPayrollClaimReportGrid=function(){var n=$("#ddlClaimReportYear").find(":selected").text(),t=$("#ddlClaimReportMonth").find(":selected").text(),i=$("#ddlEmployeeListClaims").find(":selected").text();doApplyGridFilter("PayrollClaimReportGrid ","eq","year",n==""?0:n);doApplyGridFilter("PayrollClaimReportGrid ","eq","month",t==""?0:t);doApplyGridFilter("PayrollClaimReportGrid ","eq","employeeName",i=="All"?0:i);refreshGrid($("#PayrollClaimReportGrid"))};PayrollClaimReportView.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="employeeId"||t=="default")&&i.push({field:"employeeId",hidden:n!=null&&n!=""?n[0].employeeId:!0,groupHeaderTemplate:function(n){return n.items[0].employeeName}});(this=="dateIncurred"||t=="default")&&i.push({field:"dateIncurred",title:"Date",width:"85px",reorderable:!1,hidden:n!=null&&n!=""?n[0].dateIncurred:!1,template:"#if(dateIncurred === null){# - #}else{# #=kendo.toString(kendo.parseDate(dateIncurred), 'dd MMM yyyy')#  #}#"});(this=="year"||t=="default")&&i.push({field:"year",title:"Year",width:"80px",hidden:n!=null&&n!=""?n[0].year:!0});(this=="month"||t=="default")&&i.push({field:"month",title:"Month",width:"80px",hidden:n!=null&&n!=""?n[0].month:!0});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee Name",width:"100px",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="claimType"||t=="default")&&i.push({field:"claimType",title:"Claim Type",width:"90px",hidden:n!=null&&n!=""?n[0].claimType:!1,groupFooterTemplate:function(){return"<b>Total :<\/b>"}});(this=="reimburseAmount"||t=="default")&&i.push({field:"reimburseAmount",title:"Reimbursement Amount",width:"110px",template:"#= reimburseCurrency + ' ' + kendo.toString(reimburseAmount, 'n2') #",format:"{0:n2}",hidden:n!=null&&n!=""?n[0].reimburseAmount:!1,groupFooterTemplate:function(n){return"<b>"+(n.group!=undefined?n.group.items[0].reimburseCurrency:n.reimburseAmount.group.items[0].reimburseCurrency)+" "+kendo.toString(n.reimburseAmount.sum,"n2")+"<\/b>"}})}),i};GeneralLedgerView.prototype.Init=function(){var t=this,n=new Date,i=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1];$("#ddlGeneralLedgerYear").val(n.getFullYear());$("#ddlGeneralLedgerMonth").val(i);this.LoadGeneralLedgerGrid();$("#ddlGeneralLedgerYear, #ddlGeneralLedgerMonth, #ddlLedgerCurrency").change(function(){t.FilterGeneralLedgerViewGrid()});$("#btnGeneralLedgerReportExcel").click(function(n){n.preventDefault();$("#GeneralLedgerReportGrid").getKendoGrid().saveAsExcel()});$("#btnGeneralLedgerReportPDF").click(function(n){n.preventDefault();$("#GeneralLedgerReportGrid").getKendoGrid().saveAsPDF()});GridConfigurationClick("GeneralLedgerReportGrid")};GeneralLedgerView.prototype.LoadGeneralLedgerGrid=function(){function r(){setTimeout(function(){$("#GeneralLedgerReportGrid div.k-grid-header thead tr").find('th:not([data-title="Sno"])').find("a.k-header-column-menu").remove();$("#GeneralLedgerReportGrid div.k-grid-header thead tr").find('th[data-title="Sno"]').find("a.k-header-column-menu").attr("title","Customize Columns");KGrdPageSizeDdlPosition("GeneralLedgerReportGrid",undefined,!0)},1)}function u(n,i){var r=[];return(i==""||i==undefined)&&(i=["default"]),$(i).each(function(){(this=="Sno"||i=="default")&&r.push({title:"Sno",field:"Sno",reorderable:!1,template:function(){return++t},width:45,hidden:!1});(this=="payrollYear"||i=="default")&&r.push({field:"payrollYear",title:"Year",width:"70px",hidden:n!=null&&n!=""?n[0].payrollYear:!0});(this=="payrollMonth"||i=="default")&&r.push({field:"payrollMonth",title:"Month",width:"70px",hidden:n!=null&&n!=""?n[0].payrollMonth:!0});(this=="description"||i=="default")&&r.push({field:"description",title:"Description",width:"150px",footerTemplate:"Total",hidden:n!=null&&n!=""?n[0].description:!1});(this=="amount"||i=="default")&&r.push({field:"amount",title:"Amount",width:"350px",format:"{0:n2}",template:function(n){return $("#GeneralLedgerReportGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.amount,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.amount.sum,"n2"),"",$("#GeneralLedgerReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].amount:!1})}),r}GridIdForColReSize="GeneralLedgerReportGrid";var t=0,n=RestoreKGridState("GeneralLedgerReportGrid",[]),i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadGeneralLedger",dataType:"json"},parameterMap:function(n,t){if(t=="read"){var i=$("#ddlGeneralLedgerYear option:selected").text(),r=$("#ddlGeneralLedgerMonth option:selected").text(),u=$("#ddlLedgerCurrency option:selected").text();return{payrollYear:i,payrollMonth:r,currencyCode:u}}}},batch:!0,pageSize:n.gSize!=null?n.gSize:10,sort:n.gSort,aggregate:[{field:"amount",aggregate:"sum"}],schema:{model:{fields:{description:{editable:!1},amount:{editable:!1},payrollYear:{editable:!1},payrollMonth:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#GeneralLedgerReportGrid ").kendoGrid({excel:{fileName:"GeneralLedgerReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nGeneral Ledger Report  - "+$("#ddlGeneralLedgerMonth option:selected").text()+" "+$("#ddlGeneralLedgerYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!1,!0,0,undefined,"GeneralLedgerReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"2cm",bottom:"1cm"},landscape:!0,scale:.8,date:new Date,fileName:"GeneralLedgerReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>General Ledger Report - "+$("#ddlGeneralLedgerMonth option:selected").text()+" "+$("#ddlGeneralLedgerYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#GeneralLedgerReportGrid").data("kendoGrid").dataSource;$("#GeneralLedgerReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#GeneralLedgerReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},dataSource:i,dataBound:r,reorderable:!0,resizable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Sno",[JSON.parse('{"Description":true, "Amount":true}')])},columnReorder:function(n){PreventClmReorder(n,"GeneralLedgerReportGrid",0)},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,columns:u(n.clmnState,n.gColOrder),dataBinding:function(){t=SetSerialNumberToKGrid(this)}})};GeneralLedgerView.prototype.FilterGeneralLedgerViewGrid=function(){var n=$("#ddlGeneralLedgerYear option:selected").text(),t=$("#ddlGeneralLedgerMonth option:selected").text();if(t==""||n=="")return!1;refreshGrid($("#GeneralLedgerReportGrid"))};PayslipSendReportView.prototype.Init=function(){var n=this,t,i;$("#ddlPayslipMonths").multiselect({buttonWidth:"100%",maxHeight:400,numberDisplayed:1,buttonClass:"form-control classicSelect multiselect-font-size",onDropdownHide:function(){n.FilterPayslipSendReportGrid()}});t=new Date;i=kendo.toString(kendo.parseDate(t),"dd/MMM/yyyy").split("/")[1];$("#ddlPayslipYear").val((new Date).getFullYear());$("#ddlPayslipMonths").val(i.split(","));$("#ddlPayslipMonths").multiselect("refresh");n.LoadPayslipSendReportGrid();$("#ddlPayslipYear, #ddlPayslipMonth").change(function(){n.FilterPayslipSendReportGrid()});$("#btnPayslipSendReportExcel").click(function(n){n.preventDefault();$("#PayslipSendReportGrid").getKendoGrid().saveAsExcel()});$("#btnPayslipSendReportPDF").click(function(n){n.preventDefault();$("#PayslipSendReportGrid").getKendoGrid().saveAsPDF()});GridConfigurationClick("PayslipSendReportGrid")};PayslipSendReportView.prototype.LoadPayslipSendReportGrid=function(){function i(){setTimeout(function(){$("#PayslipSendReportGrid div.k-grid-header thead tr").find('th:not([data-title="#"])').find("a.k-header-column-menu").remove();$("#PayslipSendReportGrid div.k-grid-header thead tr").find('th[data-title="#"]').find("a.k-header-column-menu").attr("title","Customize Columns");$("#PayslipSendReportGrid div.k-grid-header thead tr").find('th[data-title="#"]').find("a.k-link").removeClass("k-link").addClass("sno-link");KGrdPageSizeDdlPosition("PayslipSendReportGrid",undefined,!0)},1)}var n=RestoreKGridState("PayslipSendReportGrid",[]),t;GridIdForColReSize="PayslipSendReportGrid";t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadPayslipSendReportDetails",dataType:"json"},parameterMap:function(n,t){if(t=="read"){var r=$("#ddlPayslipYear option:selected").text(),i="";return $("#ddlPayslipMonths").val()!=null&&$("#ddlPayslipMonths").val()!=undefined&&(i=$("#ddlPayslipMonths").val().toString()),{year:r,month:i}}}},batch:!0,pageSize:10,schema:{model:{id:"employeeId",fields:{srNo:{editable:!1},employeeCode:{editable:!1},employeeName:{editable:!1},emailAddress:{editable:!1},payslipMonth:{editable:!1},payrollMonth:{editable:!1},payrollYear:{editable:!1},deliveryStatus:{editable:!1},scheduledDateTime:{type:"date",editable:!1},deliveryDateTime:{type:"date",editable:!1},errorMessage:{editable:!1}}}}});$("#PayslipSendReportGrid").kendoGrid({excel:{fileName:"PayslipSentReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nPayslips Sent Report : "+$("#ddlPayslipMonth option:selected").text()+" "+$("#ddlPayslipYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!1,!1,0,3,"PayslipSendReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",scale:.8,margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,date:new Date,fileName:"PayslipSentReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Payslips Sent Report - "+$("#ddlPayslipMonth option:selected").text()+" "+$("#ddlPayslipYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#PayslipSendReportGrid").data("kendoGrid").dataSource;$("#PayslipSendReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#PayslipSendReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},columnReorder:function(n){PreventClmReorder(n,"PayslipSendReportGrid",1)},dataSource:t,dataBound:i,reorderable:!0,resizable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"#",[JSON.parse('{"#":true, "Employee Code":true, "Employee Name":true, "Email Address":true, "Payroll Month":true, "Scheduled Run On":true, "Delivery Status":true, "Delivery Date & Time":true, "Error Message":false }')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:PayslipSendReportView.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};PayslipSendReportView.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="employeeId"||t=="default")&&i.push({field:"employeeId",width:"70px",hidden:!0});(this=="srNo"||t=="default")&&i.push({field:"srNo",title:"#",width:"20px",reorderable:!1,hidden:n!=null&&n!=""?n[0].srNo:!1});(this=="employeeCode"||t=="default")&&i.push({field:"employeeCode",title:"Employee Code",width:"60px",hidden:n!=null&&n!=""?n[0].employeeCode:!1});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee Name",width:"100px",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="emailAddress"||t=="default")&&i.push({field:"emailAddress",title:"Email Address",width:"100px",hidden:n!=null&&n!=""?n[0].emailAddress:!1});(this=="payslipMonth"||t=="default")&&i.push({field:"payslipMonth",title:"Payroll Month",width:"50px",hidden:n!=null&&n!=""?n[0].payslipMonth:!1});(this=="scheduledDateTime"||t=="default")&&i.push({field:"scheduledDateTime",title:"Scheduled Run On",template:"#if(scheduledDateTime === null){# #}else{# #=kendo.toString(kendo.parseDate(scheduledDateTime), 'dd MMM yyyy')#  #}#",width:"70px",hidden:n!=null&&n!=""?n[0].scheduledDateTime:!1});(this=="deliveryStatus"||t=="default")&&i.push({field:"deliveryStatus",title:"Delivery Status",width:"80px",hidden:n!=null&&n!=""?n[0].deliveryStatus:!1});(this=="deliveryDateTime"||t=="default")&&i.push({field:"deliveryDateTime",title:"Delivery Date & Time",template:"#if(deliveryDateTime === null){# #}else{# #=kendo.toString(kendo.parseDate(deliveryDateTime), 'dd MMM yyyy hh:mm')#  #}#",width:"90px",hidden:n!=null&&n!=""?n[0].deliveryDateTime:!1});(this=="errorMessage"||t=="default")&&i.push({field:"errorMessage",title:"Error Message",width:"90px",hidden:n!=null&&n!=""?n[0].errorMessage:!0})}),i};PayslipSendReportView.prototype.FilterPayslipSendReportGrid=function(){refreshGrid($("#PayslipSendReportGrid"))};LeaveBalanceReportView.prototype.Init=function(){var n=this;$("#ddlLeaveBalanceYear").val((new Date).getFullYear());n.LoadLeaveBalanceReportGrid();$("#ddlLeaveBalanceYear, #ddlLeaveBalanceEmployees").change(function(){refreshGrid($("#LeaveBalanceReportGrid"))});$("#btnLeaveBalanceExportExcel").click(function(n){n.preventDefault();$("#LeaveBalanceReportGrid").getKendoGrid().saveAsExcel()});$("#btnLeaveBalanceExportPDF").click(function(n){n.preventDefault();$("#LeaveBalanceReportGrid").getKendoGrid().saveAsPDF()});GridConfigurationClick("LeaveBalanceReportGrid")};LeaveBalanceReportView.prototype.LoadLeaveBalanceReportGrid=function(){function i(){setTimeout(function(){$("#LeaveBalanceReportGrid div.k-grouping-header,#LeaveBalanceReportGrid div.k-grid-footer").css("display","none");$("#LeaveBalanceReportGrid div.k-grid-header thead tr").find('th:not([data-title="#"])').find("a.k-header-column-menu").remove();$("#LeaveBalanceReportGrid div.k-grid-header thead tr").find('th[data-title="#"]').find("a.k-header-column-menu").attr("title","Customize Columns");$("#LeaveBalanceReportGrid div.k-grid-header thead tr").find('th[data-title="#"]').find("a.k-link").removeClass("k-link").addClass("sno-link");KGrdPageSizeDdlPosition("LeaveBalanceReportGrid",undefined,!0)},1)}var n=RestoreKGridState("LeaveBalanceReportGrid",[{field:"employeeName"}]),t;GridIdForColReSize="LeaveBalanceReportGrid";t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/GetLeaveBalanceReportDetails",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{year:$("#ddlLeaveBalanceYear").val(),employeeId:$("#ddlLeaveBalanceEmployees").val()}}},batch:!0,pageSize:n.gSize!=null?n.gSize:10,group:n.gGroup,sort:n.gSort,schema:{model:{id:"employeeLeaveSummaryId",fields:{employeeLeaveSummaryId:{editable:!1},srNo:{editable:!1},employeeName:{editable:!1},leaveType:{editable:!1},periodType:{editable:!1},year:{editable:!1},cyl:{editable:!1},lycf:{editable:!1},lycfTaken:{editable:!1},lycfLapsed:{editable:!1},encash:{editable:!1},overdrawn:{editable:!1},paid:{editable:!1},unpaid:{editable:!1},taken:{editable:!1},pending:{editable:!1},balance:{editable:!1}}}}});$("#LeaveBalanceReportGrid").kendoGrid({excel:{fileName:"LeaveBalanceReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nLeave Balance Report : "+$("#ddlLeaveBalanceYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!1,!1,0,3,"LeaveBalanceReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",scale:.8,margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,date:new Date,fileName:"LeaveBalanceReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Leave Balance Report - "+$("#ddlLeaveBalanceYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#LeaveBalanceReportGrid").data("kendoGrid").dataSource;$("#LeaveBalanceReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#LeaveBalanceReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},columnReorder:function(n){PreventClmReorder(n,"LeaveBalanceReportGrid",1)},dataSource:t,dataBound:i,reorderable:!0,resizable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"#",[JSON.parse('{"#":true, "Leave Type":true, "Year":true, "Period":true, "CYL":true, "LYCF":true, "LYCF Taken": true, "LYCF Lapsed": true, "Encashment":true, "Overdrawn":true, "Paid":true, "Un Paid":true, "Taken":true, "Pending":true, "Balance":true }')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,sortable:!0,groupable:!0,columns:LeaveBalanceReportView.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};LeaveBalanceReportView.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="employeeLeaveSummaryId"||t=="default")&&i.push({field:"employeeLeaveSummaryId",hidden:!0});(this=="srNo"||t=="default")&&i.push({field:"srNo",title:"#",width:"30px",reorderable:!1,hidden:n!=null&&n!=""?n[0].srNo:!1});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee Name",width:"1px",reorderable:!1,hidden:!0});(this=="leaveType"||t=="default")&&i.push({field:"leaveType",title:"Leave Type",width:"120px",hidden:n!=null&&n!=""?n[0].leaveType:!1});(this=="periodType"||t=="default")&&i.push({field:"periodType",title:"Period",width:"58px",hidden:n!=null&&n!=""?n[0].periodType:!1});(this=="year"||t=="default")&&i.push({field:"year",title:"Year",width:"50px",hidden:n!=null&&n!=""?n[0].year:!1});(this=="cyl"||t=="default")&&i.push({field:"cyl",title:"CYL",width:"50px",hidden:n!=null&&n!=""?n[0].cyl:!1});(this=="lycf"||t=="default")&&i.push({field:"lycf",title:"LYCF",width:"55px",hidden:n!=null&&n!=""?n[0].lycf:!1});(this=="lycfTaken"||t=="default")&&i.push({field:"lycfTaken",title:"LYCF Taken",width:"80px",hidden:n!=null&&n!=""?n[0].lycfTaken:!1});(this=="lycfLapsed"||t=="default")&&i.push({field:"lycfLapsed",title:"LYCF Lapsed",width:"83px",hidden:n!=null&&n!=""?n[0].lycfLapsed:!1});(this=="encash"||t=="default")&&i.push({field:"encash",title:"Encashment",width:"80px",hidden:$("#hdnLeaveEncashmentAllowed").val()=="TRUE"&&!n[0].encash?!1:!0});(this=="overdrawn"||t=="default")&&i.push({field:"overdrawn",title:"Overdrawn",width:"80px",hidden:n!=null&&n!=""?n[0].overdrawn:!1});(this=="paid"||t=="default")&&i.push({field:"paid",title:"Paid",width:"55px",hidden:n!=null&&n!=""?n[0].paid:!1});(this=="unpaid"||t=="default")&&i.push({field:"unpaid",title:"Un Paid",width:"60px",hidden:n!=null&&n!=""?n[0].unpaid:!1});(this=="taken"||t=="default")&&i.push({field:"taken",title:"Taken",width:"60px",hidden:n!=null&&n!=""?n[0].taken:!1});(this=="pending"||t=="default")&&i.push({field:"pending",title:"Pending",width:"60px",hidden:n!=null&&n!=""?n[0].pending:!1});(this=="balance"||t=="default")&&i.push({field:"balance",title:"Balance",width:"60px",hidden:n!=null&&n!=""?n[0].balance:!1})}),i};EmployeePayReportView.prototype.Init=function(){var n=this,t=new Date,i=kendo.toString(kendo.parseDate(t),"dd/MMM/yyyy").split("/")[1];$("#ddlEmployeePayYear").val((new Date).getFullYear());$("#ddlEmployeePayMonth").val(i);this.LoadEmployeePayReportGrid();$("#ddlEmployeePayList, #ddlEmployeePayYear, #ddlEmployeePayMonth, #ddlPayRptCurrency").change(function(){n.FilterEmployeePayReportGrid()});$("#btnEmployeePayReportExcel").click(function(n){n.preventDefault();$("#EmployeePayReportGrid").getKendoGrid().saveAsExcel()});$("#btnEmployeePayReportPDF").click(function(n){n.preventDefault();$("#EmployeePayReportGrid").getKendoGrid().saveAsPDF()});GridConfigurationClick("EmployeePayReportGrid")};EmployeePayReportView.prototype.LoadEmployeePayReportGrid=function(){function i(){setTimeout(function(){$("#EmployeePayReportGrid div.k-grouping-header,#EmployeePayReportGrid div.k-grid-footer").css("display","none");$("#EmployeePayReportGrid div.k-grid-header thead tr").find('th:not([data-title="Employee Code"])').find("a.k-header-column-menu").remove();$("#EmployeePayReportGrid div.k-grid-header thead tr").find('th[data-title="Employee Code"]').find("a.k-header-column-menu").attr("title","Customize Columns");$("#EmployeePayReportGrid div.k-grid-header thead tr").find('th[data-title="Employee Code"]').find("a.k-link").removeClass("k-link").addClass("sno-link");KGrdPageSizeDdlPosition("EmployeePayReportGrid",undefined,!0)},1)}var n=RestoreKGridState("EmployeePayReportGrid",[{field:"employeeName"}]),t;GridIdForColReSize="EmployeePayReportGrid";t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadEmployeePayReportDetails",dataType:"json"},parameterMap:function(n,t){if(t=="read"){var i=$("#ddlEmployeePayList option:selected").val()==""?null:$("#ddlEmployeePayList option:selected").val(),r=$("#ddlEmployeePayYear option:selected").text(),u=$("#ddlEmployeePayMonth option:selected").text(),f=$("#ddlPayRptCurrency option:selected").text();return{employeeId:i,year:r,month:u,currencyCode:f}}}},batch:!0,pageSize:10,group:n.gGroup,sort:n.gSort,schema:{model:{id:"employeeId",fields:{employeeCode:{editable:!1},employeeName:{editable:!1},year:{editable:!1},month:{editable:!1},description:{editable:!1},amount:{editable:!1},category:{editable:!1},wageType:{editable:!1},cpfApplicable:{editable:!1},iR8ACategory:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1},periodFrom:{editable:!0},periodTo:{editable:!0},hours:{editable:!0,type:"number"}}}}});$("#EmployeePayReportGrid ").kendoGrid({excel:{fileName:"EmployeePayReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nEmployee Pay Report : "+$("#ddlEmployeePayMonth option:selected").text()+" "+$("#ddlEmployeePayYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!1,!1,0,3,"EmployeePayReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",scale:.8,margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,date:new Date,fileName:"EmployeePayReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Employee Pay Report - "+$("#ddlEmployeePayMonth option:selected").text()+" "+$("#ddlEmployeePayYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#EmployeePayReportGrid").data("kendoGrid").dataSource;$("#EmployeePayReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#EmployeePayReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},columnReorder:function(n){PreventClmReorder(n,"EmployeePayReportGrid",1)},dataSource:t,dataBound:i,reorderable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Employee Code",[JSON.parse('{"Payroll Year":true,"Payroll Month":true,"Category":true,"Type of Wage":true,"CPF Applicable":true, "IR8A Category":true, "Pay Item Name":true,"Amount":true}')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,groupable:!0,columns:EmployeePayReportView.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};EmployeePayReportView.prototype.FilterEmployeePayReportGrid=function(){var n=$("#ddlEmployeePayList option:selected").text(),t=$("#ddlEmployeePayYear option:selected").text(),i=$("#ddlEmployeePayMonth option:selected").text();if(n==""||t==""||i=="")return!1;refreshGrid($("#EmployeePayReportGrid"))};EmployeePayReportView.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="employeeId"||t=="default")&&i.push({field:"employeeId",width:"70px",hidden:!0});(this=="employeeCode"||t=="default")&&i.push({field:"employeeCode",title:"Employee Code",width:"80px",reorderable:!1,hidden:n!=null&&n!=""?n[0].employeeCode:!1});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee Name",width:"1px",reorderable:!1,hidden:!0});(this=="year"||t=="default")&&i.push({field:"year",title:"Payroll Year",width:"75px",hidden:n!=null&&n!=""?n[0].year:!1});(this=="month"||t=="default")&&i.push({field:"month",title:"Payroll Month",width:"75px",hidden:n!=null&&n!=""?n[0].month:!1});(this=="description"||t=="default")&&i.push({field:"description",title:"Pay Item Name",width:"120px",hidden:n!=null&&n!=""?n[0].description:!1});(this=="category"||t=="default")&&i.push({field:"category",title:"Category",width:"70px",hidden:n!=null&&n!=""?n[0].category:!1});(this=="cpfApplicable"||t=="default")&&i.push({field:"cpfApplicable",title:"CPF Applicable",width:"85px",hidden:n!=null&&n!=""?n[0].cpfApplicable:!1});(this=="wageType"||t=="default")&&i.push({field:"wageType",title:"Type of Wage",width:"90px",hidden:n!=null&&n!=""?n[0].wageType:!1});(this=="iR8ACategory"||t=="default")&&i.push({field:"iR8ACategory",title:"IR8A Category",width:"90px",hidden:n!=null&&n!=""?n[0].iR8ACategory:!1});(this=="amount"||t=="default")&&i.push({field:"amount",width:"90px",format:"{0:n2}",title:"Amount",template:function(n){return $("#EmployeePayReportGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.amount,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].amount:!1})}),i};CPFView.prototype.Init=function(){var n=this,t=new Date,i=kendo.toString(kendo.parseDate(t),"dd/MMM/yyyy").split("/")[1];$("#ddlCPFYear").val(t.getFullYear());$("#ddlCPFMonth").val(i);$("#ddlCSNNumber").val($("#ddlCSNNumber option:eq(1)").val());this.LoadCPFPayrollDetailsGrid();this.LoadEmployeeCPFSummary($("#ddlCPFMonth").val(),$("#ddlCPFYear").val(),$("#ddlCPFCurrency option:selected").text());$("#ddlCPFMonth, #ddlCPFYear, #ddlCPFCurrency").change(function(){n.LoadEmployeeCPFSummary($("#ddlCPFMonth").val(),$("#ddlCPFYear").val(),$("#ddlCPFCurrency option:selected").text());refreshGrid($("#CPFPayrollDetailsGrid"))});$("#txtCPFLatePaymentInterest").focusout(function(){var n=$("#txtCPFLatePaymentInterest").val(),t=$("#hdnGrandTotal").val(),i;if(!/^[0-9]*(?:\.[0-9]{1,2})?$/.test(n)){$("#lblGrandTotal").text(kendo.toString(t,"n2"));return}parseFloat(n)>0?(i=parseFloat(t)+parseFloat(n),$("#lblGrandTotal").text(kendo.toString(i,"n2"))):$("#lblGrandTotal").text(kendo.toString(t,"n2"))});$("#btnGenerateCPFFile").click(function(t){t.preventDefault();n.GenerateCPFFileClick()});$("#btnGroupDdl ul li.dropdown-item").click(function(){var i=$(this).text().trim(),n=$("#ddlCPFMonth").val(),t=$("#ddlCPFYear").val(),u=$("#ddlCSNNumber").val(),f=$("#txtCPFLatePaymentInterest").val(),r="SGD";if(i=="CPF Submission Report"){if(t==""||n==""||u=="")return ShowAlertBox("Please select payroll year, month and CSN number"),!1}else if(t==""||n=="")return ShowAlertBox("Please select payroll year and msonth"),!1;if(!/^[0-9]*(?:\.[0-9]{1,2})?$/.test(f)){ShowAlertBox("Please enter valid CPF late payment interest amount or keep it blank");return}i=="CPF Submission Report"?window.location.href=baseURL+"Payroll/DownloadCPFSubmissionReport?year="+t+"&month="+n+"&CSNNumber="+u+"&interestAmt="+f+"&currencyCode="+r:i=="SINDA Contribution Report"?window.location.href=baseURL+"Payroll/DownloadStatutoryContributionReport?year="+t+"&month="+n+"&CSNNumber="+u+"&contType=1&currencyCode="+r:i=="MBMF Contribution Report"?window.location.href=baseURL+"Payroll/DownloadStatutoryContributionReport?year="+t+"&month="+n+"&CSNNumber="+u+"&contType=2&currencyCode="+r:i=="SDL Payment Advice (PDF)"?window.location.href=baseURL+"Payroll/GenerateSDLReturnForm?year="+t+"&month="+n+"&fileType=PDF&currencyCode="+r:i=="SDL Payment Advice (DOC)"&&(window.location.href=baseURL+"Payroll/GenerateSDLReturnForm?year="+t+"&month="+n+"&fileType=DOC&currencyCode="+r)});$("#ddlBtnDownArrow").click(function(){var n=$(this).offset().top+$(this).outerHeight()+$(".btnDropdownItems").outerHeight()+$("footer div.navbar-fixed-bottom.footerImage").height(),t=$(window).innerHeight()+$(window).scrollTop(),i=-($(".btnDropdownItems").innerHeight()+4)+"px";n>t?$("ul.btnDropdownItems").css({position:"absolute",transform:"translate3d(0px,"+i+", 0px)",top:"0px",left:"0px","will-change":"transform"}):$("ul.btnDropdownItems").removeAttr("style")})};CPFView.prototype.GenerateCPFFileClick=function(){var n=$("#ddlCPFYear").val(),t=$("#ddlCPFMonth").val(),i=$("#ddlCSNNumber").val(),r=$("#txtCPFLatePaymentInterest").val(),r=$("#txtCPFLatePaymentInterest").val(),u=$("#ddlCPFCurrency option:selected").text();if(n==""||t==""||i=="")return ShowAlertBox("Please select Year, Month and CSN Number"),!1;if(!/^[0-9]*(?:\.[0-9]{1,2})?$/.test(r)){ShowAlertBox("Please enter valid CPF late payment interest amount or keep it blank");return}GenerateCPFFile(n,t,i,r,"SGD")};CPFView.prototype.LoadCPFPayrollDetailsGrid=function(){function t(){setTimeout(function(){$("a.k-header-column-menu").on("click",function(){setTimeout(function(){$("div.k-column-menu").parent().css("top",$("a.k-header-column-menu").offset().top+30)},0)});KGrdPageSizeDdlPosition("CPFPayrollDetailsGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadPayrollDetailsForCPF",dataType:"json"},pageSize:10,parameterMap:function(n,t){if(t=="read")return{payrollYear:$("#ddlCPFYear").val(),payrollMonth:$("#ddlCPFMonth").val(),CurrencyCode:$("#ddlCPFCurrency option:selected").text()}}},aggregate:[{field:"basicSalary",aggregate:"sum"},{field:"additions",aggregate:"sum"},{field:"deductions",aggregate:"sum"},{field:"owPaid",aggregate:"sum"},{field:"owSubjectToCPF",aggregate:"sum"},{field:"awPaid",aggregate:"sum"},{field:"awSubjectToCPF",aggregate:"sum"},{field:"employeeCPF",aggregate:"sum"},{field:"employerCPF",aggregate:"sum"},{field:"totalCPF",aggregate:"sum"},{field:"sdl",aggregate:"sum"},{field:"mbmf",aggregate:"sum"},{field:"sinda",aggregate:"sum"},{field:"ecf",aggregate:"sum"},{field:"cdac",aggregate:"sum"},{field:"netPay",aggregate:"sum"}],batch:!0,sort:{field:"joiningDate",dir:"asc"},pageSize:10,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},basicSalary:{editable:!1,type:"number"},additions:{editable:!1,type:"number"},deductions:{editable:!1,type:"number"},owPaid:{editable:!1,type:"number"},owSubjectToCPF:{editable:!1,type:"number"},awPaid:{editable:!1,type:"number"},awSubjectToCPF:{editable:!1,type:"number"},employeeCPF:{editable:!1,type:"number"},employerCPF:{editable:!1,type:"number"},totalCPF:{editable:!1,type:"number"},sdl:{editable:!1,type:"number"},mbmf:{editable:!1,type:"number"},sinda:{editable:!1,type:"number"},ecf:{editable:!1,type:"number"},cdac:{editable:!1,type:"number"},netPay:{editable:!1,type:"number"},payrollYear:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#CPFPayrollDetailsGrid").kendoGrid({dataSource:n,dataBound:t,pageable:KGridPagableObj(),resizable:!0,resizable:!0,columns:[{title:"Sno",field:"Sno",template:function(){return++srNo},width:55,reorderable:!1},{field:"employeeId",title:"",hidden:!0},{field:"employeeName",title:"Name",width:"110px",footerTemplate:"Total"},{field:"employeeCode",title:"Emp ID",width:"90px"},{field:"basicSalary",title:"Basic",width:"110px",template:function(n){return $("#CPFPayrollDetailsGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.basicSalary,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.basicSalary.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"additions",title:"Additions",width:"100px",template:function(n){return formatAmountWithCurrency(n.additions,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.additions.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"deductions",title:"Deductions",width:"100px",template:function(n){return formatAmountWithCurrency(n.deductions,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.deductions.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"owPaid",title:"Total OW Paid",width:"100px",template:function(n){return formatAmountWithCurrency(n.owPaid,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.owPaid.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"owSubjectToCPF",title:"OW subject to CPF ",width:"150px",template:function(n){return formatAmountWithCurrency(n.owSubjectToCPF,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.owSubjectToCPF.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"awPaid",title:"Total AW Paid",width:"100px",template:function(n){return formatAmountWithCurrency(n.awPaid,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.awPaid.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"awSubjectToCPF",title:"AW subject to CPF",width:"150px",template:function(n){return formatAmountWithCurrency(n.awSubjectToCPF,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.awSubjectToCPF.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"employeeCPF",title:"Employee CPF",width:"100px",template:function(n){return formatAmountWithCurrency(n.employeeCPF,n.currency,n.currencySymbol)},headerTemplate:'<span style="display:block !important">Employee<\/span> <span style="display:block !important">CPF<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.employeeCPF.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"employerCPF",title:"Employer CPF",width:"100px",template:function(n){return formatAmountWithCurrency(n.employerCPF,n.currency,n.currencySymbol)},headerTemplate:'<span style="display:block !important">Employer<\/span> <span style="display:block !important">CPF<\/span>',headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.employerCPF.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"totalCPF",title:"Total CPF",width:"110px",template:function(n){return formatAmountWithCurrency(n.totalCPF,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.totalCPF.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"sdl",title:"SDL",width:"70px",template:function(n){return formatAmountWithCurrency(n.sdl,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(Math.floor(n.sdl.sum),"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"mbmf",title:"MBMF",width:"80px",template:function(n){return formatAmountWithCurrency(n.mbmf,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.mbmf.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"sinda",title:"SINDA",width:"80px",template:function(n){return formatAmountWithCurrency(n.sinda,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.sinda.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"ecf",title:"ECF",width:"70px",template:function(n){return formatAmountWithCurrency(n.ecf,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.ecf.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"cdac",title:"CDAC",width:"70px",template:function(n){return formatAmountWithCurrency(n.cdac,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.cdac.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"netPay",title:"Net Pay",width:"100px",template:function(n){return formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.netPay.sum,"n2"),"",$("#CPFPayrollDetailsGrid ").attr("currency"))}},{field:"payrollYear",title:"Payroll",width:"80px"},],dataBinding:function(){srNo=SetSerialNumberToKGrid(this)}})};CPFView.prototype.LoadEmployeeCPFSummary=function(n,t,i){if(n!=""&&t!=""){var r=$.get(baseURL+"Payroll/LoadEmployeeCPFSummary",{PayrollYear:t,PayrollMonth:n,CurrencyCode:i});r.done(function(n){$("#lblTotalMBMFContribution").text(n.currencySymbol+" "+(n.mbmf===""||n.mbmf==null?"0":kendo.toString(n.mbmf,"n2")));$("#lblTotalSINDAContribution").text(n.currencySymbol+" "+(n.sinda===""||n.sinda==null?"0":kendo.toString(n.sinda,"n2")));$("#lblTotalCDACContribution").text(n.currencySymbol+" "+(n.cdac===""||n.cdac==null?"0":kendo.toString(n.cdac,"n2")));$("#lblTotalECFContribution").text(n.currencySymbol+" "+(n.ecf===""||n.ecf==null?"0":kendo.toString(n.ecf,"n2")));$("#lblTotalCPFContribution").text(n.currencySymbol+" "+(n.totalCPF===""||n.totalCPF==null?"0":kendo.toString(n.totalCPF,"n2")));$("#lblSDL").text(n.currencySymbol+" "+(n.sdl===""||n.sdl==null?"0":kendo.toString(n.sdl,"n2")));$("#lblTotalCurrency").text(n.currencySymbol);$("#lblGrandTotal").text(n.grandTotal===""||n.grandTotal==null?"0":kendo.toString(n.grandTotal,"n2"));$("#hdnGrandTotal").val(n.grandTotal===""||n.grandTotal==null?0:n.grandTotal);$("#lblMBMFDonorCount").text(n.mbmfCount===""||n.mbmfCount==null?"0":n.mbmfCount);$("#lblSINDADonorCount").text(n.sindaCount===""||n.sindaCount==null?"0":n.sindaCount);$("#lblCDACDonorCount").text(n.cdacCount===""||n.cdacCount==null?"0":n.cdacCount);$("#lblECFDonorCount").text(n.ecfCount===""||n.ecfCount==null?"0":n.ecfCount);$("#txtCPFLatePaymentInterest").val(n.cpfLatePaymentInterest===""||n.cpfLatePaymentInterest==null?"0":n.cpfLatePaymentInterest);$("#lblFWLLatePaymentInterest").text(n.fwlLatePaymentInterest===""||n.fwlLatePaymentInterest==null?"0":n.fwlLatePaymentInterest);$("#lblFWL").text(n.foreignWorkerLavy===""||n.foreignWorkerLavy==null?"0":n.foreignWorkerLavy)});r.fail(function(){ShowAlertBox("Fail to get CPF information!")})}};PayrollReports.prototype.Init=function(){var n=this,t=kendo.toString(kendo.parseDate(new Date),"dd/MMM/yyyy").split("/")[1];$("#ddlYear").val((new Date).getFullYear());$("#ddlMonth").val(t);$("#ddlFilterEmpName").multiselect({buttonWidth:"100%",maxHeight:400,numberDisplayed:1,includeSelectAllOption:!0,buttonClass:"form-control classicSelect multiselect-font-size"});$("#ddlFilterDept").multiselect({buttonWidth:"100%",maxHeight:400,numberDisplayed:1,includeSelectAllOption:!0,buttonClass:"form-control classicSelect multiselect-font-size"});$("#ddlMonth").multiselect({buttonWidth:"100%",maxHeight:400,numberDisplayed:1,includeSelectAllOption:!0,buttonClass:"form-control classicSelect multiselect-font-size",onDropdownHide:function(){n.FilterDeptOnUIPayrollReportsGrid()}});this.LoadMonthlyPayrollReportsGrid();$("#ddlProcessType").change(function(){n.FilterPayrollReportsGrid();n.FilterOnUIPayrollReportsGrid()});$("#ddlYear, #ddlMonth, #ddlCurrency").change(function(){n.FilterPayrollReportsGrid()});$("#ddlFilterEmpName").change(function(){n.FilterOnUIPayrollReportsGrid()});$("#ddlFilterDept").change(function(){n.FilterDeptOnUIPayrollReportsGrid()});$("#btnPayrollReportExcel").click(function(n){n.preventDefault();$("#"+($("#ddlProcessType").val()=="Monthly Payroll"?"PayrollReportsGrid":"BonusReportGrid")).getKendoGrid().saveAsExcel()});$("#btnPayrollReportPDF").click(function(n){n.preventDefault();$("#"+($("#ddlProcessType").val()=="Monthly Payroll"?"PayrollReportsGrid":"BonusReportGrid")).getKendoGrid().saveAsPDF()});GridConfigurationClick("PayrollReportsGrid");GridConfigurationClick("BonusReportGrid")};PayrollReports.prototype.FilterPayrollReportsGrid=function(){var n=$("#ddlProcessType option:selected").text(),t=n=="Monthly Payroll"?"PayrollReportsGrid":n=="Bonus"?"BonusReportGrid":"",r=$("#ddlYear option:selected").text(),u=$("#ddlMonth option:selected").text(),i;if(n==""||r=="")return!1;PayrollReports.prototype.ShowHideGridDiv();i=$("#"+t).data("kendoGrid");i==undefined?n=="Monthly Payroll"?PayrollReports.prototype.LoadMonthlyPayrollReportsGrid():PayrollReports.prototype.LoadBonusPayrollReportGrid():refreshGrid($("#"+t))};PayrollReports.prototype.FilterOnUIPayrollReportsGrid=function(){var t=$("#ddlProcessType option:selected").text(),i=t=="Monthly Payroll"?"PayrollReportsGrid":t=="Bonus"?"BonusReportGrid":"PayrollReportsGrid",n=$("#ddlFilterEmpName").val();n!=null?DoApplyNestedKGridFilter(i,"eq","employeeName",n.length==0?0:n,"and","or",!0):DoApplyNestedKGridFilter(i,"eq","employeeName",[],"and","or",!0)};PayrollReports.prototype.FilterDeptOnUIPayrollReportsGrid=function(){var t=$("#ddlProcessType option:selected").text(),i=t=="Monthly Payroll"?"PayrollReportsGrid":t=="Bonus"?"BonusReportGrid":"PayrollReportsGrid",n=$("#ddlFilterDept").val();n!=null?DoApplyNestedKGridFilter(i,"eq","department",n.length==0?0:n,"and","or",!0):DoApplyNestedKGridFilter(i,"eq","department",[],"and","or",!0)};PayrollReports.prototype.ShowHideGridDiv=function(){var n=$("#ddlProcessType").val();n=="Monthly Payroll"?($("#divMonthlyPayrollGrdRow").removeClass("hidden"),$("#divBonusGrdRow").addClass("hidden")):n=="Bonus"&&($("#divMonthlyPayrollGrdRow").addClass("hidden"),$("#divBonusGrdRow").removeClass("hidden"))};PayrollReports.prototype.LoadMonthlyPayrollReportsGrid=function(){function r(n,i){var r=[];return(i==""||i==undefined)&&(i=["default"]),$(i).each(function(){(this=="Sno"||i=="default")&&r.push({title:"Sno",field:"Sno",reorderable:!1,template:function(){return++t},width:"60px",hidden:!1});(this=="employeeName"||i=="default")&&r.push({field:"employeeName",title:"Employee",width:"170px",footerTemplate:"Grand Total",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="employeeCode"||i=="default")&&r.push({field:"employeeCode",title:"Emp Code",width:"100px",hidden:n!=null&&n!=""?n[0].employeeCode:!1});(this=="department"||i=="default")&&r.push({field:"department",title:"Department",width:"140px",hidden:n!=null&&n!=""?n[0].department:!1});(this=="payrollMonth"||i=="default")&&r.push({field:"payrollMonth",title:"Payroll Month",width:"140px",hidden:n!=null&&n!=""?n[0].payrollMonth:!1});(this=="basicSalary"||i=="default")&&r.push({field:"basicSalary",format:"{0:n2}",title:"Basic Salary",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.basicSalary.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return $("#PayrollReportsGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.basicSalary,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].basicSalary:!1});(this=="bonus"||i=="default")&&r.push({field:"bonus",format:"{0:n2}",title:"Bonus",width:"90px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.bonus.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.bonus,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].bonus:!1});(this=="overtime"||i=="default")&&r.push({field:"overtime",format:"{0:n2}",title:"Overtime",width:"95px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.overtime.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.overtime,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].overtime:!1});(this=="allowance"||i=="default")&&r.push({field:"allowance",format:"{0:n2}",title:"Allowance",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.allowance.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.allowance,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].allowance:!1});(this=="commission"||i=="default")&&r.push({field:"commission",format:"{0:n2}",title:"Commission",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.commission.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.commission,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].commission:!1});(this=="others"||i=="default")&&r.push({field:"others",format:"{0:n2}",title:"Others",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.others.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.others,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].others:!1});(this=="noticePay"||i=="default")&&r.push({field:"noticePay",format:"{0:n2}",title:"Notice Pay",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.noticePay.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.noticePay,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].noticePay:!1});(this=="unpaidLeave"||i=="default")&&r.push({field:"unpaidLeave",format:"{0:n2}",title:"Unpaid Leave",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.unpaidLeave.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.unpaidLeave,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].unpaidLeave:!1});(this=="grossSalary"||i=="default")&&r.push({field:"grossSalary",format:"{0:n2}",title:"Gross Salary",width:"120px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.grossSalary.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.grossSalary,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].grossSalary:!1});(this=="employeeCPF"||i=="default")&&r.push({field:"employeeCPF",format:"{0:n2}",title:"Employee CPF",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.employeeCPF.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.employeeCPF,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].employeeCPF:!1});(this=="statutoryContributions"||i=="default")&&r.push({field:"statutoryContributions",format:"{0:n2}",title:"Statutory Contributions",width:"100px",headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.statutoryContributions.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},headerTemplate:'<span style="display:block !important">Statutory<\/span> <span style="display:block !important">Contributions<\/span>',template:function(n){return formatAmountWithCurrency(n.statutoryContributions,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].statutoryContributions:!1});(this=="advance"||i=="default")&&r.push({field:"advance",format:"{0:n2}",title:"Advance",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.advance.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.advance,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].advance:!1});(this=="expenses"||i=="default")&&r.push({field:"expenses",format:"{0:n2}",title:"Expenses",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.expenses.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.expenses,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].expenses:!1});(this=="netPay"||i=="default")&&r.push({field:"netPay",format:"{0:n2}",title:"Net Pay",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.netPay.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].netPay:!1});(this=="employerCPF"||i=="default")&&r.push({field:"employerCPF",format:"{0:n2}",title:"Employer CPF",width:"110px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.employerCPF.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.employerCPF,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].employerCPF:!1});(this=="sdlContribution"||i=="default")&&r.push({field:"sdlContribution",format:"{0:n2}",title:"SDL",width:"80px",footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.sdlContribution.sum,"n2"),"",$("#PayrollReportsGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.sdlContribution,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].sdlContribution:!1})}),r}function u(){$("#PayrollReportsGrid a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");var n=$("#PayrollReportsGrid div.k-grid-header thead tr");n.find('th:not([data-title="Sno"])').find("a.k-header-column-menu").remove();n.find('th[data-title="Sno"]').find("a.k-header-column-menu").attr("title","Customize Columns");n.find('th[data-title="Sno"]').find("a.k-link").removeClass("k-link").addClass("sno-link");KGrdPageSizeDdlPosition("PayrollReportsGrid",undefined,!0)}var t=0,n,i;GridIdForColReSize="PayrollReportsGrid";n=RestoreKGridState("PayrollReportsGrid",[{field:"employeeName",aggregates:[{field:"employeeName",aggregate:"sum",dir:"desc"},{field:"bonus",aggregate:"sum"},{field:"overtime",aggregate:"sum"},{field:"allowance",aggregate:"sum"},{field:"commission",aggregate:"sum"},{field:"others",aggregate:"sum"},{field:"noticePay",aggregate:"sum"},{field:"unpaidLeave",aggregate:"sum"},{field:"grossSalary",aggregate:"sum"},{field:"employeeCPF",aggregate:"sum"},{field:"statutoryContributions",aggregate:"sum"},{field:"expenses",aggregate:"sum"},{field:"advance",aggregate:"sum"},{field:"netPay",aggregate:"sum"},{field:"employerCPF",aggregate:"sum"},{field:"sdlContribution",aggregate:"sum"},]}]);i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadPayrollReport",dataType:"json"},parameterMap:function(n,t){var r;if(t=="read"){var u=$("#ddlProcessType option:selected").text(),f=$("#ddlYear option:selected").text(),i="";return $("#ddlMonth").val()!=null&&$("#ddlMonth").val()!=undefined&&(i=$("#ddlMonth").val().toString()),r=$("#ddlCurrency option:selected").text(),{processType:u,year:f,month:i,currency:r}}}},batch:!0,pageSize:n.gSize!=null?n.gSize:10,aggregate:[{field:"basicSalary",aggregate:"sum"},{field:"bonus",aggregate:"sum"},{field:"overtime",aggregate:"sum"},{field:"allowance",aggregate:"sum"},{field:"commission",aggregate:"sum"},{field:"others",aggregate:"sum"},{field:"noticePay",aggregate:"sum"},{field:"unpaidLeave",aggregate:"sum"},{field:"grossSalary",aggregate:"sum"},{field:"employeeCPF",aggregate:"sum"},{field:"statutoryContributions",aggregate:"sum"},{field:"expenses",aggregate:"sum"},{field:"advance",aggregate:"sum"},{field:"netPay",aggregate:"sum"},{field:"employerCPF",aggregate:"sum"},{field:"sdlContribution",aggregate:"sum"}],schema:{model:{id:"employeeIdHash",fields:{employeeName:{editable:!1},employeeCode:{editable:!1},department:{editable:!1},basicSalary:{editable:!1},payrollMonth:{editable:!1},bonus:{editable:!1},overtime:{editable:!1},allowance:{editable:!1},commission:{editable:!1},others:{editable:!1},noticePay:{editable:!1},unpaidLeave:{editable:!1},grossSalary:{editable:!1},employeeCPF:{editable:!1},statutoryContributions:{editable:!1},expenses:{editable:!1},advance:{editable:!1},netPay:{editable:!1},employerCPF:{editable:!1},sdlContribution:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#PayrollReportsGrid").kendoGrid({excel:{fileName:"PayrollReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t="",i;$("#ddlMonth").val()!=null&&$("#ddlMonth").val()!=undefined&&(t=$("#ddlMonth").val().toString());i=$(".lblMyCompany").text()+"\nPayroll Report : "+t+" "+$("#ddlYear option:selected").text()+" | Currency: ("+$("#ddlCurrency option:selected").text()+")";SetKGridExportExcelHeader(n.workbook.sheets[0],i,!0,!0,0,1,"PayrollReportsGrid")},reorderable:!0,resizable:!0,columnMenuInit:function(n){var t=[JSON.parse('{"Employee":true,"Emp Code":true,"Department":true, "Payroll Month":true, "Basic Salary":true,"Bonus":true,"Overtime":true,"Allowance":true, "Commission":true, "Others":true, "Notice Pay":true, "Unpaid Leave":true, "Gross Salary":true,"Employee CPF":true,"Statutory Contributions":true,"Advance":true, "Expenses":true,"Net Pay":true, "Employer CPF":true, "SDL":true}')];KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Sno",t)},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:".4cm",right:".4cm",bottom:"1cm"},landscape:!0,scale:.6,date:new Date,fileName:"PayrollReport.pdf",template:function(){var n="";return $("#ddlMonth").val()!=null&&$("#ddlMonth").val()!=undefined&&(n=$("#ddlMonth").val().toString()),'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Payroll Report - "+n+" "+$("#ddlYear option:selected").text()+" | Currency: ("+$("#ddlCurrency option:selected").text()+")<\/div><\/div>"}},pdfExport:function(n){var t=$("#PayrollReportsGrid").data("kendoGrid").dataSource;$("#PayrollReportsGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#PayrollReportsGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},dataSource:i,columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,dataBound:u,dataBinding:function(){t=SetSerialNumberToKGrid(this)},columnReorder:function(n){PreventClmReorder(n,"PayrollReportsGrid",0)},columns:r(n.clmnState,n.gColOrder)})};PayrollReports.prototype.LoadBonusPayrollReportGrid=function(){function r(){$("#BonusReportGrid a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");var n=$("#BonusReportGrid div.k-grid-header thead tr");n.find('th:not([data-title="Sno"])').find("a.k-header-column-menu").remove();n.find('th[data-title="Sno"]').find("a.k-header-column-menu").attr("title","Customize Columns");n.find('th[data-title="Sno"]').find("a.k-link").removeClass("k-link").addClass("sno-link");KGrdPageSizeDdlPosition("BonusReportGrid",undefined,!0)}function u(n,i){var r=[];return(i==""||i==undefined)&&(i=["default"]),$(i).each(function(){(this=="Sno"||i=="default")&&r.push({title:"Sno",field:"Sno",reorderable:!1,template:function(){return++t},width:"60px",hidden:!1});(this=="employeeName"||i=="default")&&r.push({field:"employeeName",title:"Employee",width:"170px",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="employeeCode"||i=="default")&&r.push({field:"employeeCode",title:"Emp Code",width:"110px",hidden:n!=null&&n!=""?n[0].employeeCode:!1});(this=="department"||i=="default")&&r.push({field:"department",title:"Department",width:"150px",hidden:n!=null&&n!=""?n[0].department:!1});(this=="payrollMonth"||i=="default")&&r.push({field:"payrollMonth",title:"Bonus Month",width:"140px",hidden:n!=null&&n!=""?n[0].payrollMonth:!1});(this=="bonusDescription"||i=="default")&&r.push({field:"bonusDescription",title:"Bonus Description",width:"170px",groupFooterTemplate:"<b>Sub Total<b>",hidden:$("#ddlProcessType option:selected").val()=="Bonus"?n!=null&&n!=""?n[0].bonusDescription:!1:!0,footerTemplate:"Grand Total"});(this=="bonus"||i=="default")&&r.push({field:"bonus",format:"{0:n2}",title:"Bonus",width:"120px",groupFooterTemplate:function(n){return"<b>"+(n.group!=undefined?n.group.items[0].currencySymbol:n.bonus.group.items[0].currencySymbol)+" "+kendo.toString(n.bonus.sum,"n2")+"<\/b>"},footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.bonus.sum,"n2"),"",$("#BonusReportGrid").attr("currency"))+"<\/b>"},template:function(n){return $("#BonusReportGrid").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.bonus,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].bonus:!1});(this=="employeeCPF"||i=="default")&&r.push({field:"employeeCPF",format:"{0:n2}",title:"Employee CPF",width:"130px",groupFooterTemplate:function(n){return"<b>"+(n.group!=undefined?n.group.items[0].currencySymbol:n.employeeCPF.group.items[0].currencySymbol)+" "+kendo.toString(n.employeeCPF.sum,"n2")+"<\/b>"},footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.employeeCPF.sum,"n2"),"",$("#BonusReportGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.employeeCPF,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].employeeCPF:!1});(this=="netPay"||i=="default")&&r.push({field:"netPay",format:"{0:n2}",title:"Net Pay",width:"120px",groupFooterTemplate:function(n){return"<b>"+(n.group!=undefined?n.group.items[0].currencySymbol:n.netPay.group.items[0].currencySymbol)+" "+kendo.toString(n.netPay.sum,"n2")+"<\/b>"},footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.netPay.sum,"n2"),"",$("#BonusReportGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].netPay:!1});(this=="employerCPF"||i=="default")&&r.push({field:"employerCPF",format:"{0:n2}",title:"Employer CPF",width:"130px",groupFooterTemplate:function(n){return"<b>"+(n.group!=undefined?n.group.items[0].currencySymbol:n.employerCPF.group.items[0].currencySymbol)+" "+kendo.toString(n.employerCPF.sum,"n2")+"<\/b>"},footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.employerCPF.sum,"n2"),"",$("#BonusReportGrid").attr("currency"))+"<\/b>"},template:function(n){return formatAmountWithCurrency(n.employerCPF,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].employerCPF:!1})}),r}var t=0,n,i;GridIdForColReSize="BonusReportGrid";n=RestoreKGridState("BonusReportGrid",[{field:"department",aggregates:[{field:"bonus",aggregate:"sum"},{field:"employeeCPF",aggregate:"sum"},{field:"netPay",aggregate:"sum"},{field:"employerCPF",aggregate:"sum"}]}]);i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadPayrollReport",dataType:"json"},parameterMap:function(n,t){var r,i,u;if(t=="read")return r=$("#ddlYear option:selected").text(),i="",$("#ddlMonth").val()!=null&&$("#ddlMonth").val()!=undefined&&(i=$("#ddlMonth").val().toString()),u=$("#ddlCurrency option:selected").text(),{processType:"Bonus",year:r,month:i,currency:u}}},batch:!0,pageSize:n.gSize!=null?n.gSize:10,sort:n.gSort,group:n.gGroup,aggregate:[{field:"bonus",aggregate:"sum"},{field:"employeeCPF",aggregate:"sum"},{field:"netPay",aggregate:"sum"},{field:"employerCPF",aggregate:"sum"},],schema:{model:{id:"employeeIdHash",fields:{employeeName:{editable:!1},employeeCode:{editable:!1},department:{editable:!1},payrollMonth:{editable:!1},bonus:{editable:!1},employeeCPF:{editable:!1},netPay:{editable:!1},employerCPF:{editable:!1},bonusDescription:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#BonusReportGrid").kendoGrid({excel:{fileName:"BonusReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t="",i;$("#ddlMonth").val()!=null&&$("#ddlMonth").val()!=undefined&&(t=$("#ddlMonth").val().toString());i=$(".lblMyCompany").text()+"\nBonus Report : "+t+" "+$("#ddlYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],i,!0,!0,0,1,"BonusReportGrid")},reorderable:!0,resizable:!0,columnMenuInit:function(n){var t=[JSON.parse('{"Employee":true,"Emp Code":true,"Department":true,"Bonus Month":true,"Bonus Description":true,"Bonus":true,"Employee CPF":true,"Net Pay":true, "Employer CPF":true}')];KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Sno",t)},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,scale:.6,date:new Date,fileName:"BonusReport.pdf",template:function(){var n="";return $("#ddlMonth").val()!=null&&$("#ddlMonth").val()!=undefined&&(n=$("#ddlMonth").val().toString()),'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Bonus Report - "+n+" "+$("#ddlYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#BonusReportGrid").data("kendoGrid").dataSource;$("#BonusReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(10);$("#BonusReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},dataSource:i,columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,dataBound:r,dataBinding:function(){t=SetSerialNumberToKGrid(this)},columnReorder:function(n){PreventClmReorder(n,"BonusReportGrid",0)},columns:u(n.clmnState,n.gColOrder)})};PaymentListingReport.prototype.Init=function(){var t=this,n=new Date,i=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1];$("#ddlYear").val(n.getFullYear());$("#ddlMonth").val(i);this.LoadPaymentListingReport();$("#btnPmtListReportExcel").click(function(n){n.preventDefault();$("#PaymentListingReportGrid").getKendoGrid().saveAsExcel()});$("#btnPmtListReportPDF").click(function(n){n.preventDefault();$("#PaymentListingReportGrid").getKendoGrid().saveAsPDF()});$("#ddlProcessType, #ddlYear, #ddlMonth, #ddlPayItemCurrency").change(function(){t.FilterPaymentListingReportGrid()});GridConfigurationClick("PaymentListingReportGrid")};PaymentListingReport.prototype.LoadPaymentListingReport=function(){function i(){setTimeout(function(){$("#PaymentListingReportGrid a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");$("#PaymentListingReportGrid div.k-grid-header thead tr").find('th:not([data-title="Payment Mode"])').find("a.k-header-column-menu").remove();$("#PaymentListingReportGrid div.k-grid-header thead tr").find('th[data-title="Payment Mode"]').find("a.k-header-column-menu").attr("title","Customize Columns");KGrdPageSizeDdlPosition("PaymentListingReportGrid",undefined,!0)},1)}var n=RestoreKGridState("PaymentListingReportGrid",[{field:"paymentMode",aggregates:[{field:"employeeName",aggregate:"count"},{field:"netPay",aggregate:"sum"}]}]),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadPayrollListingReport",dataType:"json"},parameterMap:function(n,t){if(t=="read"){var i=$("#ddlProcessType option:selected").text(),r=$("#ddlYear option:selected").text(),u=$("#ddlMonth option:selected").text(),f=$("#ddlPayItemCurrency option:selected").text();return{processType:i,year:r,month:u,currencyCode:f}}}},batch:!0,aggregate:[{field:"employeeName",aggregate:"count"},{field:"netPay",aggregate:"sum"}],pageSize:n.gSize!=null?n.gSize:10,group:n.gGroup,sort:n.gSort,schema:{model:{id:"employeeIdHash",fields:{paymentMode:{editable:!1},employeeName:{editable:!1},department:{editable:!1},bankName:{editable:!1},branchCode:{editable:!1},accountNumber:{editable:!1},netPay:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#PaymentListingReportGrid").kendoGrid({excel:{fileName:"PaymentListingReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nPayment Listing Report : "+$("#ddlMonth option:selected").text()+" "+$("#ddlYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!0,!1,0,1,"PaymentListingReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"2cm",bottom:"1cm"},landscape:!0,scale:.8,date:new Date,fileName:"PaymentListingReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Payment Listing Report - "+$("#ddlMonth option:selected").text()+" "+$("#ddlYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#PaymentListingReportGrid").data("kendoGrid").dataSource;$("#PaymentListingReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(7);$("#PaymentListingReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},columnReorder:function(n){PreventClmReorder(n,"PaymentListingReportGrid",0)},dataSource:t,reorderable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Payment Mode",[JSON.parse('{"Department":true, "Employee":true, "Bank Name":true, "Branch Code":true, "Bank Account No.":true, "Net Pay":true}')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,resizable:!0,groupable:!0,dataBound:i,columns:PaymentListingReport.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};PaymentListingReport.prototype.FilterPaymentListingReportGrid=function(){var n=$("#ddlProcessType option:selected").text(),t=$("#ddlYear option:selected").text(),i=$("#ddlMonth option:selected").text();if(n==""||t==""||i=="")return!1;refreshGrid($("#PaymentListingReportGrid"))};PaymentListingReport.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="paymentMode"||t=="default")&&i.push({field:"paymentMode",title:"Payment Mode",width:"140px",hidden:!1,reorderable:!1,groupFooterTemplate:function(n){var t=n.employeeName.group!=undefined?n.employeeName.group.items.length:n.paymentMode.group.items.length;return"<b>No. of Employees ("+t+")<\/b>"}});(this=="department"||t=="default")&&i.push({field:"department",title:"Department",width:"130px",hidden:n!=null&&n!=""?n[0].department:!1});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee",width:"170px",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="bankName"||t=="default")&&i.push({field:"bankName",title:"Bank Name",width:"120px",hidden:n!=null&&n!=""?n[0].bankName:!1});(this=="branchCode"||t=="default")&&i.push({field:"branchCode",title:"Branch Code",width:"95px",hidden:n!=null&&n!=""?n[0].branchCode:!1});(this=="accountNumber"||t=="default")&&i.push({field:"accountNumber",title:"Bank Account No.",width:"150px",groupFooterTemplate:function(n){var t=n.employeeName.group!=undefined?n.employeeName.group.value:n.paymentMode.group.value;return"<b>Total for "+t+"<\/b>"},footerTemplate:"<b>Grand Total<\/b>",hidden:n!=null&&n!=""?n[0].accountNumber:!1});(this=="netPay"||t=="default")&&i.push({field:"netPay",title:"Net Pay",width:"95px",format:"{0:n2}",template:function(n){return $("#PaymentListingReportGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)},footerTemplate:function(n){return"<b>"+formatAmountWithCurrency(kendo.toString(n.netPay.sum,"n2"),"",$("#PaymentListingReportGrid").attr("currency"))+"<\/b>"},groupFooterTemplate:function(n){return"<b>"+(n.group!=undefined?n.group.items[0].currencySymbol:n.netPay.group.items[0].currencySymbol)+" "+kendo.toString(n.netPay.sum,"n2")+"<\/b>"},hidden:n!=null&&n!=""?n[0].netPay:!1})}),i};CPFReport.prototype.Init=function(){var t=this,n=new Date,i=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1];$("#ddlYear").val(n.getFullYear());$("#ddlMonth").val(i);this.LoadCPFReportGrid();$("#btnCPFReportExcel").click(function(n){n.preventDefault();$("#CPFReportGrid").getKendoGrid().saveAsExcel()});$("#btnCPFReportPDF").click(function(n){n.preventDefault();$("#CPFReportGrid").getKendoGrid().saveAsPDF()});$("#ddlYear, #ddlMonth, #ddlCPFRptProcessType, #ddlCPFCurrency").change(function(){t.FilterCPFReportsGrid()});GridConfigurationClick("CPFReportGrid")};CPFReport.prototype.LoadCPFReportGrid=function(){function i(){setTimeout(function(){$("#CPFReportGrid div.k-grid-header thead tr").find('th:not([data-title="Employee"])').find("a.k-header-column-menu").remove();$("#CPFReportGrid div.k-grid-header thead tr").find('th[data-title="Employee"]').find("a.k-header-column-menu").attr("title","Customize Columns");KGrdPageSizeDdlPosition("CPFReportGrid",undefined,!0)},1)}GridIdForColReSize="CPFReportGrid";var n=RestoreKGridState("CPFReportGrid",[]),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadCPFReport",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#ddlYear option:selected").text(),r=$("#ddlMonth option:selected").text(),u=$("#ddlCPFRptProcessType option:selected").val(),f=$("#ddlCPFCurrency option:selected").text();return{processType:u,year:i,month:r,currencyCode:f}}}},batch:!0,pageSize:n.gSize!=null?n.gSize:5,sort:n.gSort,aggregate:[{field:"ordinaryWages",aggregate:"sum"},{field:"additionalWages",aggregate:"sum"},{field:"owSubjectToCPF",aggregate:"sum"},{field:"awSubjectToCPF",aggregate:"sum"},{field:"totalWages",aggregate:"sum"},{field:"cpfContribution",aggregate:"sum"},{field:"cdac",aggregate:"sum"},{field:"mbmf",aggregate:"sum"},{field:"sinda",aggregate:"sum"},{field:"ecf",aggregate:"sum"},{field:"sdl",aggregate:"sum"}],schema:{model:{id:"employeeIdHash",fields:{joiningDate:{editable:!1,type:"date"},resignationDate:{editable:!1,type:"date"},ordinaryWages:{editable:!1},additionalWages:{editable:!1},owSubjectToCPF:{editable:!1},awSubjectToCPF:{editable:!1},totalWages:{editable:!1},cpfContribution:{editable:!1},cdac:{editable:!1},mbmf:{editable:!1},sinda:{editable:!1},ecf:{editable:!1},sdl:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#CPFReportGrid").kendoGrid({excel:{fileName:"CPFReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nCPF Report : "+$("#ddlMonth option:selected").text()+" "+$("#ddlYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!1,!1,0,4,"CPFReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"2cm",bottom:"1cm"},landscape:!0,scale:.8,date:new Date,fileName:"CPFReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>CPF Report - "+$("#ddlMonth option:selected").text()+" "+$("#ddlYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#CPFReportGrid").data("kendoGrid").dataSource;$("#CPFReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(5);$("#CPFReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},dataSource:t,columnMenu:{messages:{columns:"Customize Columns"}},reorderable:!0,columnMenuInit:function(n){var t=[JSON.parse('{"CPF Ref":true, "Join Date":true, "Resign Date":true, "Ordinary Wages":true, "OW subject to CPF":true, "Additional Wages":true, "AW subject to CPF":true, "Total Wages":true, "CPF Contribution":true, "CDAC":true, "MBMF":true, "SINDA":true, "ECF":true, "SDL":true}')];KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Employee",t)},dataBound:i,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columnReorder:function(n){PreventClmReorder(n,"CPFReportGrid",0)},columns:CPFReport.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};CPFReport.prototype.FilterCPFReportsGrid=function(){var n=$("#ddlCPFRptProcessType option:selected").val(),t=$("#ddlYear option:selected").text(),i=$("#ddlMonth option:selected").text();if(n==""||t==""||i=="")return!1;refreshGrid($("#CPFReportGrid"))};CPFReport.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="employeeName"||t=="default")&&i.push({field:"employeeName",title:"Employee",width:"200px",reorderable:!1,hidden:!1,footerTemplate:"Total"});(this=="cpfref"||t=="default")&&i.push({field:"cpfref",title:"Tax Ref No",width:"130px",hidden:n!=null&&n!=""?n[0].cpfref:!1});(this=="ordinaryWages"||t=="default")&&i.push({field:"ordinaryWages",title:"Ordinary Wages",width:"150px",format:"{0:n2}",template:function(n){return $("#CPFReportGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.ordinaryWages,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.ordinaryWages.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].ordinaryWages:!1});(this=="owSubjectToCPF"||t=="default")&&i.push({field:"owSubjectToCPF",title:"OW subject to CPF",width:"160px",format:"{0:n2}",template:function(n){return $("#CPFReportGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.owSubjectToCPF,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.owSubjectToCPF.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].owSubjectToCPF:!1});(this=="additionalWages"||t=="default")&&i.push({field:"additionalWages",title:"Additional Wages",format:"{0:n2}",width:"150px",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.additionalWages.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},template:function(n){return formatAmountWithCurrency(n.additionalWages,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].additionalWages:!1});(this=="awSubjectToCPF"||t=="default")&&i.push({field:"awSubjectToCPF",title:"AW subject to CPF",width:"160px",format:"{0:n2}",template:function(n){return $("#CPFReportGrid ").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.awSubjectToCPF,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.awSubjectToCPF.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].awSubjectToCPF:!1});(this=="totalWages"||t=="default")&&i.push({field:"totalWages",title:"Total Wages",format:"{0:n2}",width:"150px",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.totalWages.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},template:function(n){return formatAmountWithCurrency(n.totalWages,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].totalWages:!1});(this=="cpfContribution"||t=="default")&&i.push({field:"cpfContribution",title:"CPF Contribution",format:"{0:n2}",width:"150px",template:function(n){return formatAmountWithCurrency(n.cpfContribution,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.cpfContribution.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].cpfContribution:!1});(this=="cdac"||t=="default")&&i.push({field:"cdac",width:"90px",format:"{0:n2}",title:"CDAC",template:function(n){return formatAmountWithCurrency(n.cdac,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.cdac.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].cdac:!1});(this=="mbmf"||t=="default")&&i.push({field:"mbmf",width:"90px",format:"{0:n2}",title:"MBMF",template:function(n){return formatAmountWithCurrency(n.mbmf,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.mbmf.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].mbmf:!1});(this=="sinda"||t=="default")&&i.push({field:"sinda",width:"90px",format:"{0:n2}",title:"SINDA",template:function(n){return formatAmountWithCurrency(n.sinda,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.sinda.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].sinda:!1});(this=="ecf"||t=="default")&&i.push({field:"ecf",width:"90px",format:"{0:n2}",title:"ECF",template:function(n){return formatAmountWithCurrency(n.ecf,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.ecf.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].ecf:!1});(this=="sdl"||t=="default")&&i.push({field:"sdl",width:"90px",format:"{0:n2}",title:"SDL",template:function(n){return formatAmountWithCurrency(n.sdl,n.currency,n.currencySymbol)},footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.sdl.sum,"n2"),"",$("#CPFReportGrid").attr("currency"))},hidden:n!=null&&n!=""?n[0].sdl:!1})}),i};PayItemsDetailReport.prototype.Init=function(){var t=this,n=new Date,i=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1];$("#ddlYear").val(n.getFullYear());$("#ddlMonth").val(i);this.LoadPayItemsDetailReportGrid();$("#btnPayItemDtlReportExcel").click(function(n){n.preventDefault();$("#PayItemsDetailReportGrid").getKendoGrid().saveAsExcel()});$("#btnPayItemDtlReportPDF").click(function(n){n.preventDefault();$("#PayItemsDetailReportGrid").getKendoGrid().saveAsPDF()});$("#ddlEmployeeName, #ddlYear, #ddlMonth, #ddlRptCPFCurrency").change(function(){t.FilterPayItemDetailsReportsGrid()});GridConfigurationClick("PayItemsDetailReportGrid")};PayItemsDetailReport.prototype.LoadPayItemsDetailReportGrid=function(){function i(){setTimeout(function(){$("#PayItemsDetailReportGrid a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");$("#PayItemsDetailReportGrid div.k-grid-header thead tr").find('th:not([data-title="Department"])').find("a.k-header-column-menu").remove();$("#PayItemsDetailReportGrid div.k-grid-header thead tr").find('th[data-title="Department"]').find("a.k-header-column-menu").attr("title","Customize Columns");var n="";$("#PayItemsDetailReportGrid .k-grid-content tbody tr").each(function(){n!=""&&this.className.indexOf("k-grouping-row")>-1&&(n="");this.className.indexOf("k-grouping-row")>-1&&this.className.indexOf("k-group-footer")||(n==""?n=$(this).find('td[emp-name="empName"]').html():n==$(this).find('td[emp-name="empName"]').html()?$(this).find('td[emp-name="empName"]').html(""):n!=""&&$(this).find('td[emp-name="empName"]').html()!=n&&(n=$(this).find('td[emp-name="empName"]').html()),$(this).find('td[dept-name="deptName"]').html(""))});KGrdPageSizeDdlPosition("PayItemsDetailReportGrid",undefined,!0)},1)}var n=RestoreKGridState("PayItemsDetailReportGrid",[{field:"department",aggregates:[{field:"cpfPayItem",aggregate:"sum"},{field:"nonCPFPayItem",aggregate:"sum"}]}]),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/LoadPayItemDetailReport",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#ddlEmployeeName option:selected").val()==""?null:$("#ddlEmployeeName option:selected").val(),r=$("#ddlYear option:selected").text(),u=$("#ddlMonth option:selected").text(),f=$("#ddlRptCPFCurrency option:selected").text();return{employeeId:i,year:r,month:u,currencyCode:f}}}},batch:!0,aggregate:[{field:"cpfPayItem",aggregate:"sum"},{field:"nonCPFPayItem",aggregate:"sum"}],pageSize:n.gSize!=null?n.gSize:5,group:n.gGroup,sort:n.gSort,schema:{model:{id:"employeeIdHash",fields:{department:{editable:!1},employeeName:{editable:!1},cpfPayItem:{editable:!1},nonCPFPayItem:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#PayItemsDetailReportGrid").kendoGrid({excel:{fileName:"PayItemDetailsReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nPay Items Details Report : "+$("#ddlMonth option:selected").text()+" "+$("#ddlYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!0,!1,0,1,"PayItemsDetailReportGrid")},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"2cm",bottom:"1cm"},landscape:!0,scale:.8,date:new Date,fileName:"PayItemDetailsReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Pay Items Details Report - "+$("#ddlMonth option:selected").text()+" "+$("#ddlYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#PayItemsDetailReportGrid").data("kendoGrid").dataSource;$("#PayItemsDetailReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(7);$("#PayItemsDetailReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},dataSource:t,reorderable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Department",[JSON.parse('{"Employee":true, "Non CPF Pay Items":true,"Item Description":true, "CPF Pay Items":true}')])},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,groupable:!0,resizable:!0,dataBound:i,columnReorder:function(n){PreventClmReorder(n,"PayItemsDetailReportGrid",0)},columns:PayItemsDetailReport.prototype.AddGridColumns(n.clmnState,n.gColOrder)})};PayItemsDetailReport.prototype.FilterPayItemDetailsReportsGrid=function(){var n=$("#ddlYear option:selected").text(),t=$("#ddlMonth option:selected").text();if(t==""||n=="")return!1;refreshGrid($("#PayItemsDetailReportGrid"))};PayItemsDetailReport.prototype.AddGridColumns=function(n,t){var i=[];return(t==""||t==undefined)&&(t=["default"]),$(t).each(function(){(this=="department"||t=="default")&&i.push({field:"department",attributes:{"dept-name":"deptName"},reorderable:!1,hidden:!1,title:"Department",width:"100px"});(this=="employeeName"||t=="default")&&i.push({field:"employeeName",attributes:{"emp-name":"empName"},title:"Employee",width:"150px",hidden:n!=null&&n!=""?n[0].employeeName:!1});(this=="itemDescription"||t=="default")&&i.push({field:"itemDescription",title:"Item Description",width:"140px",hidden:n!=null&&n!=""?n[0].itemDescription:!1});(this=="cpfPayItem"||t=="default")&&i.push({field:"cpfPayItem",title:"CPF Pay Items",width:"95px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.cpfPayItem,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].cpfPayItem:!1});(this=="nonCPFPayItem"||t=="default")&&i.push({field:"nonCPFPayItem",title:"Non CPF Pay Items",width:"95px",format:"{0:n2}",template:function(n){return formatAmountWithCurrency(n.nonCPFPayItem,n.currency,n.currencySymbol)},hidden:n!=null&&n!=""?n[0].nonCPFPayItem:!1})}),i};ManageUserView.prototype.Init=function(){var n=this;this.LoadUserListGrid(this);$("#txtEmployeeNameCode").keypress(function(n){if(n.keyCode==13)return!1});$("#txtUserName").focusout(function(){n.UserListGridApplyFilter()});$("#txtUserName").keypress(function(t){if(t.keyCode==13)return n.UserListGridApplyFilter(),!1});$("#btnDeleteUsers").click(function(t){var r;if(t.preventDefault(),r=$("#UserListGrid tbody").find("input:checked").length,r<=0){ShowAlertBox("Please select user(s) to delete");return}var u=!0,i=[],f=ShowConfirmationAlertBox("Are you sure about deleting selected user(s)?");f.then(function(){$("#UserListGrid tbody").find("input:checked").each(function(){var t=$("#UserListGrid").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.lastPayrollMonth==null||t.lastPayrollMonth==""?(u=n.DeleteUser(this.id),u?(RemoveItemFromGrid("UserListGrid",this.id),i.push(t.employeeCode+" - User deleted successfully")):i.push(t.employeeCode+" - Error while deleting user")):i.push(t.employeeCode+" - Payroll processed user can not be deleted"))});ShowSummaryBox("Bulk Delete Summary",i)})});$("#frmUserEdit").submit(function(t){var o,s;if(t.preventDefault(),!$("#btnSaveUser").hasClass("disabled")){var r=$("#UserId").val(),i=$("#txtEmailAddress").val(),u=$("#txtEmployeeCode").val(),f=$("#txtFullName").val(),h=$("#txtPhoneNumber").val(),e=$("#ddlRoleList option:selected").text();i.length<=0||u.length<=0||e.length<=0||f.length<=0||(o={UserId:r,FirstName:f,LastName:"",EmailAddress:i,UserName:i,EmployeeCode:u,RoleName:e,MobileNumber:h},s=n.SaveUser(o),s==!0?(r>0?ShowAlertBox("User updated successfully"):ShowAlertBox("User added successfully"),$("#userEditPopup").modal("hide"),refreshGrid($("#UserListGrid"))):ShowAlertBox("Error while updating user"))}})};ManageUserView.prototype.SaveUser=function(n){var t=!1;return $.ajax({url:baseURL+"Settings/SaveUser",data:{userData:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};ManageUserView.prototype.SearchResultByEmployeeNameOrCode=function(){var n=$("#txtEmployeeName").kendoAutoComplete({dataSource:{transport:{read:{dataType:"json",url:baseURL+"Settings/LoadEmployeeNameCodeList/"},parameterMap:function(n,t){if(t==="read")return{searchByNameCode:$("#txtEmployeeName").val()}}}},minLength:1,filter:"startswith",dataTextField:"name",headerTemplate:'<div class="dropdown-header k-widget k-header"><div class="displayInlineBlock" style="width:50%;">Employee Code<\/div><div class="displayInlineBlock" style="width:50%;">Employee Name<\/div><\/div>',template:'<div><div class="k-state-default displayInlineBlock" style="width:40%;text-align: left;"><h3>#: data.description #<\/h3><\/div><div class="k-state-default displayInlineBlock" style="width:60%;text-align: left;"><h3>#: data.name #<\/h3><\/div><\/div>',height:400,change:function(){var n=$("#txtEmployeeName").val()},filtering:function(n){!n.filter.value}}).data("kendoAutoComplete");$("#txtEmployeeName").closest("span.k-widget.k-autocomplete.k-header.k-autocomplete-clearable").addClass("heightAuto")};ManageUserView.prototype.LoadUserListGrid=function(){function t(){if(setTimeout(function(){$(".k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete User");$(".k-i-close").removeClass("k-icon k-i-close");$("#UserListGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("UserListGrid")});KGrdPageSizeDdlPosition("UserListGrid")},1),this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadUserList",dataType:"json"}},batch:!0,pageSize:5,schema:{model:{id:"userId",fields:{userId:{editable:!1},userIdHash:{editable:!1},firstName:{editable:!1},lastName:{editable:!1},emailAddr:{editable:!1},userName:{editable:!1},password:{editable:!1},employeeCode:{editable:!1},employeeName:{editable:!1},roleName:{editable:!1},modifiedBy:{editable:!1},modifiedDate:{editable:!1},lastPayrollMonth:{editable:!1}}}}});$("#UserListGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.userId#" class="chk-box"><label class="checkbox-inline" for="#:data.userId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:50},{field:"UserId",hidden:!0},{field:"UserIdHash",hidden:!0},{field:"emailAddress",hidden:!0},{field:"employeeCode",title:"Employee Code",width:"120px"},{field:"employeeName",title:"Employee Name",width:"160px"},{field:"userName",title:"Login ID",width:"240px"},{field:"roleName",title:"Role Name",width:"180px"},{field:"modifiedBy",title:"Modified By",width:"140px"},{field:"modifiedDate",title:"Modified On",width:"100px",template:"#if(modifiedDate === null){#  N/A #}else{# #=kendo.toString(kendo.parseDate(modifiedDate), 'dd MMM yyyy')#  #}#"},{template:"<div class='pointer' title='Edit User' onclick='EditUser(\"#:userId#\")'><img src='"+baseURL+"images/edit.png' class='img-responsive' /><\/div>",width:"50px"},{template:function(n){return n.lastPayrollMonth===null||n.lastPayrollMonth===""?'<a  href="javascript: ManageUserView.prototype.DeleteUserFromGrid('+n.userId+');"><img src="'+baseURL+'images/delete.png" class="img-responsive" title="Delete User" /><\/a>':""},width:50}],editable:"inline",dataBound:t,dataBinding:function(){$("#UserListGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#UserListGrid tbody input:checkbox").prop("checked",this.checked)})};ManageUserView.prototype.EditUserClearFields=function(){$("#txtEmailAddress").val("");$("#txtEmployeeCode").val("");$("#txtFullName").val("");$("#txtPhoneNumber").val("");$("#ddlRoleList").val("")};ManageUserView.prototype.DeleteUser=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Settings/MarkDeleteUser",data:{userId:n},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};ManageUserView.prototype.DeleteUserFromGrid=function(n){var t=ShowConfirmationAlertBox("Please note, deleting a user's access would not automatically delete this Employee.<br />Please visit the Manage Employee page to delete this Employee permanently from your Payroll.<br /> Are you sure about deleting this user?");t.then(function(){var t=ManageUserView.prototype.DeleteUser(n);t?(ShowAlertBox("User deleted successfully"),RemoveItemFromGrid("UserListGrid",n)):ShowAlertBox("Error while deleting user")})};ManageUserView.prototype.UserListGridApplyFilter=function(){var n=$("#txtUserName").val();doApplyGridFilter("UserListGrid","contains","firstName",n==""?0:n)};ManageSystemAdminsView.prototype.Init=function(){var n=this;n.LoadSystemAdminUsersGrid();n.LoadCompanyAccessTreeView();$("#chkIsActiveUser").prop("checked",!0);$("#SystemAdminUsersGrid").on("click","tbody td",function(t){t.preventDefault();ManageSystemAdminsView.prototype.ResetToDefault();var r=$("#SystemAdminUsersGrid").data("kendoGrid"),i=r.dataItem(r.select());i!=null&&i!=undefined&&($("#hdnUserId").val(i.userId),$("#txtFullName").val(i.fullName),$("#txtEmailAddr").val(i.emailAddress),$("#txtLoginId").val(i.loginId),$("#chkIsActiveUser").prop("checked",i.isActive),$("#hdnUserId").val()==""?($("#txtPassword, #txtConfirmPassword").prop("required",!0),$("label[for='txtPassword'], label[for='txtConfirmPassword']").addClass("required"),$("label[for='txtPassword']").html("Password"),$("#btnSaveAdmin").val("SAVE")):($("#txtPassword, #txtConfirmPassword").prop("required",!1),$("label[for='txtPassword'], label[for='txtConfirmPassword']").removeClass("required"),$("label[for='txtPassword']").html("New Password"),$("#btnSaveAdmin").val("UPDATE")),$("#txtFullName").focusout(),n.ReloadCompanyAccessTreeView())});$("#CompanyAccessTreeView").on("click",".k-in",function(n){n.preventDefault();$(this).parent().find("input[type='checkbox']").click();$(this).removeClass("k-state-selected").removeClass("k-state-focused")});$("#frmAddSystemAdmin").submit(function(t){var s,h;t.preventDefault();var u=$("#hdnUserId").val(),f=$("#txtFullName").val().trim(),i=$("#txtEmailAddr").val().trim(),e=$("#txtLoginId").val().trim(),c=$("#chkIsActiveUser").is(":checked"),r=$("#txtPassword").val().trim(),o=$("#txtConfirmPassword").val().trim(),l=GetTreeViewCheckedNodeIds("CompanyAccessTreeView");if(f!=""&&e!=""&&(u!=""||r!=""&&o!="")&&r==o&&(i==""||/(?:.+)@(?:.+)/.test(i))){if(s=$("#txtLoginId").attr("isAlreadyTaken"),typeof s!=typeof undefined){ShowAlertBox("Login ID is already taken. Please enter another login id.");$("#txtLoginId").focus();return}h={UserId:u,FullName:f,EmailAddress:i,LoginId:e,IsActive:c,Password:r,AccessibleCompanies:l};n.SaveSystemAdmin(h)}});$("#btnCancelAdmin").click(function(){n.ResetToDefault();var t=$("#SystemAdminUsersGrid").getKendoGrid();t.select().hasClass("k-state-selected")&&t.select().removeClass("k-state-selected")});$("#btnAddAdmin").click(function(){n.ResetToDefault();var t=$("#SystemAdminUsersGrid").getKendoGrid();t.select().hasClass("k-state-selected")&&t.select().removeClass("k-state-selected");$("#txtFullName").focus()});$("#txtLoginId").change(function(){var t=$(this).closest(".form-group").hasClass("has-error"),n;t||($("#helpLoginId").html("Checking..."),n=$.get(baseURL+"GlobalSettings/CheckDataExistence",{field:"LoginId",value:$(this).val().trim()}),n.done(function(n){n?($("#txtLoginId").addClass("error-box"),$("#helpLoginId").html("Login Id is already taken"),$("#txtLoginId").focus(),$("#txtLoginId").attr("isAlreadyTaken",!0)):($("#txtLoginId").removeClass("error-box"),$("#helpLoginId").html(""),$("#txtLoginId").removeAttr("isAlreadyTaken"))}),n.fail(function(){$("#helpLoginId").html("Error while verifying login id")}))})};ManageSystemAdminsView.prototype.ResetToDefault=function(){$("#hdnUserId, #txtFullName, #txtEmailAddr, #txtLoginId, #txtPassword, #txtConfirmPassword").val("");$("#chkIsActiveUser").prop("checked",!0);ManageSystemAdminsView.prototype.ReloadCompanyAccessTreeView();$("#btnSaveAdmin").val("SAVE");$("#txtPassword, #txtConfirmPassword").prop("required",!0);$("label[for='txtPassword'], label[for='txtConfirmPassword']").addClass("required");$("label[for='txtPassword']").html("Password");$(".help-block.with-errors").html("");$("#txtLoginId").removeClass("error-box");$("#helpLoginId").html("");$("#txtLoginId").removeAttr("isAlreadyTaken");$("#frmAddSystemAdmin div.has-error.has-danger").removeClass("has-error has-danger")};ManageSystemAdminsView.prototype.LoadSystemAdminUsersGrid=function(){var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"GlobalSettings/LoadSystemAdmins",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{roleDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:5,schema:{model:{id:"userId",fields:{userId:{editable:!1},fullName:{editable:!1},loginId:{editable:!1},emailAddress:{editable:!1},password:{editable:!1},isActive:{editable:!1}}}}});$("#SystemAdminUsersGrid").kendoGrid({dataSource:t,pageable:!0,sortable:!0,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,selectable:!0,columns:[{title:"Sno",template:function(){return++n},width:45},{field:"fullName",title:"Full Name",width:"150px"},{field:"loginId",title:"Login Id",width:"150px"},{field:"emailAddress",title:"Email Address",width:"180px"},{field:"password",hidden:!0},{field:"isActive",title:"Is Active?",width:"80px",template:function(n){return n.isActive==!0?"<span style='color:green'>Yes<\/span>":"<span style='color:red'>No<\/span>"}}],dataBinding:function(){n=SetSerialNumberToKGrid(this)},dataBound:function(){$("#CompanyAccessTreeView").height($("#SystemAdminUsersGrid").outerHeight()+$("#frmAddSystemAdmin").outerHeight()-29);KGrdPageSizeDdlPosition("SystemAdminUsersGrid")}})};ManageSystemAdminsView.prototype.LoadCompanyAccessTreeView=function(){$("#CompanyAccessTreeView").html("").removeAttr("class").attr("class","divAdminTreeView");$("#CompanyAccessTreeView").kendoTreeView({checkboxes:{checkChildren:!0}});ManageSystemAdminsView.prototype.ReloadCompanyAccessTreeView()};ManageSystemAdminsView.prototype.ReloadCompanyAccessTreeView=function(){var n=$("#hdnUserId").val()==""?null:$("#hdnUserId").val();$.ajax({type:"GET",url:baseURL+"GlobalSettings/LoadAccessibleCompanies",data:{userId:n},async:!1,success:function(n){n?$("#CompanyAccessTreeView").data("kendoTreeView").dataSource.data(n):$("#CompanyAccessTreeView").data("kendoTreeView").dataSource.data([])},error:function(){ShowAlertBox("Error while Loading permissions")}})};ManageSystemAdminsView.prototype.SaveSystemAdmin=function(n){$.ajax({type:"POST",url:baseURL+"GlobalSettings/SaveSystemAdmin",async:!1,datatype:"json",data:{admin:n},success:function(t){t<0?(n.UserId==null||n.UserId==""?ShowAlertBox("System Admin added successfully."):ShowAlertBox("System Admin updated successfully."),$("#hdnUserId").val(t),$("#btnSaveAdmin").val("UPDATE"),refreshGrid($("#SystemAdminUsersGrid"))):ShowAlertBox("Error while adding System Admin.")},error:function(){ShowAlertBox("Error while adding System Admin.");refreshGrid($("#SystemAdminUsersGrid"))}})};ManageRolesView.prototype.Init=function(){var n=this;n.LoadSecurityRolesGrid();n.SetControlVisibility("InitialLoad");n.LoadSecurityRolesTreeView();$("#ManageRoleTreeView").on("click",".k-in",function(n){n.preventDefault();$(this).parent().find("input[type='checkbox']").click();$(this).removeClass("k-state-selected").removeClass("k-state-focused")});$("#btnAddRole").click(function(t){t.preventDefault();n.SetControlVisibility("Add");n.ReLoadSecurityRolesTreeView()});$("#btnDeleteRole").click(function(t){t.preventDefault();var u=$("#SecurityRolesGrid"),i=u.data("kendoGrid"),r=i.dataItem(i.select()),f=ShowConfirmationAlertBox("Are you sure about deleting selected role? <br>On deleting, that role will be automatically removed from <br> the employees having that role assigned.");f.then(function(){var t=$.post(baseURL+"Settings/DeleteSecurityRole",{roleId:r.roleId});t.done(function(t){t?(RemoveItemFromGrid("SecurityRolesGrid",r.roleId),n.SetControlVisibility("InitialLoad"),n.ReLoadSecurityRolesTreeView(),ShowAlertBox("Role deleted successfully")):ShowAlertBox("Error while deleting the role")});t.fail(function(){n.SetControlVisibility("InitialLoad");ShowAlertBox("Error while deleting the role")})})});$("#btnSave").click(function(t){if(t.preventDefault(),$("#txtRoleName").val().trim()==""){ShowAlertBox("Please enter the role name");return}n.SavePermissions();refreshGrid($("#SecurityRolesGrid"));n.SetControlVisibility("InitialLoad");n.ReLoadSecurityRolesTreeView()});$("#btnCancel").click(function(t){t.preventDefault();n.SetControlVisibility("Cancel");n.ReLoadSecurityRolesTreeView()});$("#SecurityRolesGrid").on("click","tbody td",function(t){t.preventDefault();$("#txtRoleName").prop("disabled",!0);$("#btnCancel").prop("disabled",!1);$("#btnSave").prop("disabled",!1).attr("value","UPDATE PERMISSIONS");var r=$("#SecurityRolesGrid").data("kendoGrid"),i=r.dataItem(r.select());i!=null&&i!=undefined&&(i.companyId===-1?$("#btnDeleteRole").prop("disabled",!0):$("#btnDeleteRole").prop("disabled",!1),$("#txtRoleId").val(i.roleId),$("#txtRoleName").val(i.roleName),n.ReLoadSecurityRolesTreeView())})};ManageRolesView.prototype.LoadSecurityRolesGrid=function(){var n=0,t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadSecurityRoles",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{roleDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:10,schema:{model:{id:"roleId",fields:{roleId:{editable:!1},roleName:{editable:!1},roleDescription:{editable:!1}}}}});$("#SecurityRolesGrid").kendoGrid({dataSource:t,pageable:!0,sortable:!0,pageable:KGridPagableObj(),scrollable:!0,selectable:!0,resizable:!0,columns:[{title:"Sno",template:function(){return++n},width:45},{field:"roleId",hidden:!0},{field:"companyId",hidden:!0},{field:"roleName",title:"Role Name",width:"100px"},{field:"roleDescription",title:"Description",width:"150px"}],dataBinding:function(){n=SetSerialNumberToKGrid(this)},dataBound:function(){$("#ManageRoleTreeView").height($("#SecurityRolesGrid").outerHeight()-22);KGrdPageSizeDdlPosition("SecurityRolesGrid")}})};ManageRolesView.prototype.SavePermissions=function(){var n=$("#txtRoleName").val(),t=$("#txtRoleName").val(),i=$("#txtRoleId").val(),r=GetTreeViewCheckedNodes("ManageRoleTreeView");$.ajax({type:"POST",url:baseURL+"Settings/ManageRolePermissions",async:!1,data:{roleId:i,roleName:n,roleDesc:t,permissions:r},success:function(n){n?ShowAlertBox("Permissions added/updated successfully"):ShowAlertBox("Error while updating permissions")},error:function(){ShowAlertBox("Error while updating permissions")}})};ManageRolesView.prototype.SetControlVisibility=function(n){var t;n==="Cancel"||n==="InitialLoad"?($("#txtRoleName").val(""),$("#txtRoleId").val("0"),$("#txtRoleName").prop("disabled",!0),$("#btnDeleteRole").prop("disabled",!0),$("#btnCancel").prop("disabled",!0),$("#btnSave").prop("disabled",!0).attr("value","SAVE"),t=$("#SecurityRolesGrid").getKendoGrid(),t.select().hasClass("k-state-selected")&&t.select().removeClass("k-state-selected")):n==="Add"&&($("#txtRoleName").val(""),$("#txtRoleId").val("0"),$("#txtRoleName").prop("disabled",!1),$("#btnDeleteRole").prop("disabled",!0),$("#btnCancel").prop("disabled",!1),$("#btnSave").prop("disabled",!1).attr("value","SAVE"),t=$("#SecurityRolesGrid").getKendoGrid(),t.select().hasClass("k-state-selected")&&t.select().removeClass("k-state-selected"))};ManageRolesView.prototype.LoadSecurityRolesTreeView=function(){$("#ManageRoleTreeView").html("").removeAttr("class").attr("class","divKTreeView");$("#ManageRoleTreeView").kendoTreeView({checkboxes:{checkChildren:!0}});ManageRolesView.prototype.ReLoadSecurityRolesTreeView()};ManageRolesView.prototype.ReLoadSecurityRolesTreeView=function(){var n=$("#txtRoleId").val()==""?null:$("#txtRoleId").val();$.ajax({type:"GET",url:baseURL+"Settings/LoadRoles",data:{roleId:n},async:!0,success:function(n){n?$("#ManageRoleTreeView").data("kendoTreeView").dataSource.data(n):$("#ManageRoleTreeView").data("kendoTreeView").dataSource.data([])},error:function(){ShowAlertBox("Error while Loading permissions")}})};DisplayFields.prototype.Init=function(){var t=this,n=$("#hdnInitialListName").val(),r=$("#hdnInitialListId").val();if($("#lblDisplayFieldHeader").text(n),$("#hdnActiveListName").val(n),$("#hdnActiveListId").val(r),n=="National Holiday"&&r==0)$("#divDisplayFieldsPartialPage, #divLeaveTypesPartialPage").hide(),$("#divNationalHolidayPartialPage").show(),LoadNationalHolidayDetails();else{if(n=="Leave Types"&&r==0){$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#divDisplayFieldsPartialPage, #divNationalHolidayPartialPage").hide();$("#divLeaveTypesPartialPage").show();this.LoadLeaveTypesGrid();return}$("#divDisplayFieldsPartialPage").show();$("#divNationalHolidayPartialPage, #divLeaveTypesPartialPage").hide()}$("#chkMaternityLeave").prop("checked")==!0?($("#ddlMaternityLeaveType").prop("required",!0),$("#ddlMaternityLeaveType").prop("disabled",!1)):($("#ddlMaternityLeaveType").prop("required",!1),$("#ddlMaternityLeaveType").prop("disabled",!0),$("#ddlMaternityLeaveType").val(""));$("#chkMaternityLeave").change(function(){$("#chkMaternityLeave").prop("checked")==!0?($("#ddlMaternityLeaveType").prop("required",!0),$("#ddlMaternityLeaveType").prop("disabled",!1)):($("#ddlMaternityLeaveType").prop("required",!1),$("#ddlMaternityLeaveType").prop("disabled",!0),$("#ddlMaternityLeaveType").val(""))});$("#frmLeaveType").submit(function(n){var i;n.preventDefault();var o=$("#txtLeaveType").val().trim(),s=$("#ddlLeaveCategory").find("option:selected").val(),f=$("#txtShortCode").val().trim(),h=$("#ddlLeaveAccrualType").find("option:selected").val(),a=$("#txtDescription").val(),v=$("#hdnLeaveTypeId").val()!=""&&$("#hdnLeaveTypeId").val()!=undefined?$("#hdnLeaveTypeId").val():null,c=$("#ddlMaternityLeaveType").val(),e=!1;if(o!=""&&s!=""&&f!=""&&/^[A-Za-z0-9]+$/.test(f)&&h!=""&&($("#chkMaternityLeave").prop("checked")==!0&&(e=!0),e!=!0||c!="")){var r={leaveTypeId:v,LeaveType:o,LeaveCategory:s,ShortCode:f,TypeDescription:a,IsMaternityLeave:e,MaternityLeaveType:c,AccrualType:h},l=!1,u=$("#CompanyLeaveTypesGrid").data("kendoGrid").dataSource.data(),y=u.length;for(i=0;i<y;i++)if((u[i].shortCode.trim().toLowerCase()==r.ShortCode.trim().toLowerCase()||u[i].leaveType.trim().toLowerCase()==r.LeaveType.toLowerCase())&&u[i].leaveTypeId!=r.leaveTypeId){l=!0;break}l?ShowAlertBox("Leave type or code is already added for the company"):t.AssignCompanyLeaveType(r)}});$("#nav-tabs-wrapper li a").click(function(n){n.preventDefault();$(this).parent().addClass("active").siblings().removeClass("active")});t.LoadDisplayFieldDetailGrid();$("#ddlHolidayYear").val((new Date).getFullYear());$("#ddlHolidayYear").change(function(){$("#ddlHolidayYear").val()!=""&&refreshGrid($("#NationalHolidayGrid"))});$("#linkAddDisplayField").click(function(n){n.preventDefault();$("#popupHdr").text($("#lblDisplayFieldHeader").text());$("#AddCompanyListItem").modal()});$("#AddCompanyListItem").on("hidden.bs.modal",function(){$(this).find("#frmCompanyListItems .has-error.has-danger").removeClass("has-error has-danger")});$("#frmCompanyListItems").submit(function(n){var t,r,u,f;if(n.preventDefault(),t=$("#txtListItemName").val().trim(),!(t.length<=0)){for(r=!1,u=$("#DisplayFieldDetailGrid").data("kendoGrid").dataSource._data,i=0;i<u.length;i++)u[i].listItemName.trim()==t.trim()&&(r=!0);if(r){ShowAlertBox("List item already exists.");return}f=$.post(baseURL+"Settings/AddCompanyListItem",{companyListId:$("#hdnActiveListId").val(),listItemName:t});f.done(function(n){n?($("#AddCompanyListItem").modal("hide"),ShowAlertBox("List item added successfully."),$("#txtListItemName").val(""),refreshGrid($("#DisplayFieldDetailGrid"))):ShowAlertBox("Error while adding list item.")});f.fail(function(){ShowAlertBox("Error while adding list item.")})}});$("#linkAddNationalHoliday").click(function(n){n.preventDefault();$("#AddNationalHoliday").modal()});$("#AddNationalHoliday").on("hidden.bs.modal",function(){$(this).find("#frmNationalHoliday .has-error.has-danger").removeClass("has-error has-danger")});$("#linkAddLeaveType").click(function(n){n.preventDefault();$("#lblEditAddHeader").text("Add New Leave Type");t.ClearLeaveTypeFields();$("#AddCompanyLeaveTypesModal").modal()});$("#datePickerHolidayDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#frmNationalHoliday").submit(function(n){var t,r,u,f,e;if(n.preventDefault(),t=$("#dtHolidayDate").val().trim(),r=$("#txtHolidayName").val().trim(),!(t.trim().length<=0)&&!(r.trim().length<=0)){for(u=!1,f=$("#NationalHolidayGrid").data("kendoGrid").dataSource._data,i=0;i<f.length;i++)Date.parse(f[i].holidayDate)==Date.parse(t)&&(u=!0);if(u){ShowAlertBox("National holiday for the date is already added.");return}e=$.post(baseURL+"Settings/AddNationalHoliday",{holidayDate:t,holidayName:r});e.done(function(n){n?($("#AddNationalHoliday").modal("hide"),ShowAlertBox("Holiday added successfully."),$("#txtHolidayName, #dtHolidayDate").val(""),refreshGrid($("#NationalHolidayGrid"))):ShowAlertBox("Error while adding national holiday.")});e.fail(function(){ShowAlertBox("Error while adding national holiday.")})}})};DisplayFields.prototype.AssignCompanyLeaveType=function(n){var t=$.post(baseURL+"Settings/AddEditLeaveType",n);t.done(function(){$("#AddCompanyLeaveTypesModal").modal("hide");refreshGrid($("#CompanyLeaveTypesGrid"));var t="Leave type "+(n.leaveTypeId!=null&&n.leaveTypeId!=""&&n.leaveTypeId!=undefined?"updated":"added")+" successfully!";ShowAlertBox(t)});t.fail(function(){ShowAlertBox("Fail to save leave type!")})};DisplayFields.prototype.LoadDisplayFieldDetailGrid=function(){function t(){if(setTimeout(function(){$("#DisplayFieldDetailGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit display field");$("#DisplayFieldDetailGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#DisplayFieldDetailGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update display field");$("#DisplayFieldDetailGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$("#DisplayFieldDetailGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete display field");$(".k-i-close").removeClass("k-icon k-i-close");$("#DisplayFieldDetailGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("DisplayFieldDetailGrid",0)},1),this.dataSource.view().length==0){var t=this.dataSource.page();t>1&&this.dataSource.page(t-1)}}function u(n){var t=$("#DisplayFieldDetailGrid").data("kendoGrid").dataSource._data,r=!1;for(i=0;i<t.length;i++)t[i].dirty&&(r=!0);if(!r)return!0;for(i=0;i<t.length;i++)if(t[i].listItemName==n&&t[i].dirty==!1)return!1;return!0}var n=0,r=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/GetCompanyListItems",dataType:"json"},update:{url:baseURL+"Settings/UpdateCompanyListItem",dataType:"json"},destroy:{url:baseURL+"Settings/DeleteCompanyListItem",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{companyListItem:kendo.stringify(n.models)}:t==="read"?{companyListItemId:$("#hdnActiveListId").val()}:void 0}},batch:!0,pageSize:5,schema:{model:{id:"companyListItemId",fields:{companyListItemId:{editable:!1},listItemName:{editable:!0,validation:{required:!0,maxlength:450,listItemValidation:function(n){return n.is("[name='listItemName']")&&n.val()!=""?(n.attr("data-listItemValidation-msg","List item already exists"),u(n.val())):!0}},nullable:!1},updatedByUserId:{editable:!1},isUsed:{editable:!1},updatedOnDate:{editable:!1}}}}});$("#DisplayFieldDetailGrid").kendoGrid({dataSource:r,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"companyListItemId",hidden:!0},{title:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:45},{field:"listItemName",width:"300px",title:"List Item Name"},{field:"updatedByUserId",title:"Update User",width:"150px",template:"#if(updatedByUserId === null || updatedByUserId === ''){#-#}else{# #=updatedByUserId#  #}#"},{field:"updatedOnDate",title:"Update date",width:"150px",template:"#if(updatedOnDate === null || updatedOnDate === ''){#-#}else{# #=kendo.toString(kendo.parseDate(updatedOnDate), 'dd MMM yyyy')#  #}#"},{command:[{name:"edit",text:{edit:"",update:"",cancel:""}},{name:"destroy",text:"",visible:function(n){return n.isUsed===!1}},],title:"&nbsp;",width:"100px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};DisplayFields.prototype.LoadLeaveType=function(n){if(DisplayFields.prototype.ClearLeaveTypeFields(),n!=""&&n!=undefined){var t=$.post(baseURL+"Settings/LoadLeaveType",{leveTypeId:n});t.done(function(t){t!=""&&t!=null&&t!=undefined&&($("#lblEditAddHeader").text("Edit Leave Type"),$("#hdnLeaveTypeId").val(n),$("#txtLeaveType").val(t.leaveType),$("#txtShortCode").val(t.shortCode),$("#ddlLeaveAccrualType").val(t.accrualType),$("#txtDescription").val(t.typeDescription),$("#ddlLeaveCategory").val(t.leaveCategory),t.isMaternityLeave==!0?($("#chkMaternityLeave").prop("checked",!0),$("#ddlMaternityLeaveType").prop("required",!0),$("#ddlMaternityLeaveType").prop("disabled",!1),$("#ddlMaternityLeaveType").val(t.maternityLeaveType)):($("#ddlMaternityLeaveType").prop("required",!1),$("#ddlMaternityLeaveType").prop("disabled",!0),$("#chkMaternityLeave").prop("checked",!1),$("#ddlMaternityLeaveType").val("")),$("#txtLeaveType").focusout(),$("#AddCompanyLeaveTypesModal").modal("show"))});t.fail(function(){ShowAlertBox("Fail to load leave type!")})}};DisplayFields.prototype.ClearLeaveTypeFields=function(){$("#txtLeaveType, #txtShortCode, #txtDescription, #ddlLeaveCategory, #hdnLeaveTypeId").val("");$("#chkMaternityLeave").prop("checked",!1);$("#ddlMaternityLeaveType").prop("required",!1);$("#ddlMaternityLeaveType").val("");$("#ddlMaternityLeaveType").prop("disabled",!0);$("#ddlLeaveAccrualType").val("Yearly");$("#frmLeaveType div.form-group.has-error.has-danger").removeClass("has-error has-danger")};DisplayFields.prototype.LoadLeaveTypesGrid=function(){function t(){if(setTimeout(function(){$("#CompanyLeaveTypesGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Leave Type");$("#CompanyLeaveTypesGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#CompanyLeaveTypesGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Leave Type");$(".k-i-close").removeClass("k-icon k-i-close");$("#CompanyLeaveTypesGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("CompanyLeaveTypesGrid",$(".k-list-scroller").length-1)}),this.dataSource.view().length==0){var t=this.dataSource.page();t>1&&this.dataSource.page(t-1)}}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadLeaveTypes",dataType:"json"},destroy:{url:baseURL+"Settings/DeleteLeaveType",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{leaveTypesDetails:kendo.stringify(n.models)};t==="read"}},batch:!0,pageSize:5,schema:{model:{id:"leaveTypeId",fields:{leaveTypeId:{editable:!1},leaveType:{editable:!1},shortCode:{editable:!0},leaveCategory:{editable:!1},isUsed:{editable:!1},updatedByUserId:{editable:!1},updatedOnDate:{editable:!1},accrualType:{editable:!1}}}}});$("#CompanyLeaveTypesGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"leaveTypeId",hidden:!0},{title:"Sno",template:function(){return++n},width:45},{field:"leaveType",width:"200px",title:"Leave Type"},{field:"shortCode",width:"90px",title:"Short Code"},{field:"leaveCategory",width:"120px",title:"Leave Category"},{field:"accrualType",width:"100px",title:"Accrual Type"},{field:"updatedByUserId",title:"Update User",width:"150px",template:"#if(updatedByUserId === null || updatedByUserId === ''){#-#}else{# #=updatedByUserId#  #}#"},{field:"updatedOnDate",title:"Update date",width:"100px",template:"#if(updatedOnDate === null || updatedOnDate === ''){#-#}else{# #=kendo.toString(kendo.parseDate(updatedOnDate), 'dd MMM yyyy')#  #}#"},{template:'<a href="javascript: DisplayFields.prototype.LoadLeaveType(\'#:leaveTypeId#\');"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Leave Type" /><\/a>',width:"50px"},{command:[{name:"destroy",text:"",visible:function(n){return n.isUsed===!1}}],title:"&nbsp;",width:"50px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};LoadNationalHolidayGrid=function(){function t(){if(setTimeout(function(){$("#NationalHolidayGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Holiday");$("#NationalHolidayGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#NationalHolidayGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Holiday");$("#NationalHolidayGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$("#NationalHolidayGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Holiday");$(".k-i-close").removeClass("k-icon k-i-close");$("#NationalHolidayGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("NationalHolidayGrid",$(".k-list-scroller").length-1);$("#NationalHolidayGrid a.k-grid-update.grid-update").on("click",function(){var i=$(this).closest("tr"),n=i.find("#pickerHolidayDate"),t;n.val().toLowerCase()!=n.attr("start-dt").toLowerCase()&&(t=$("#NationalHolidayGrid").data("kendoGrid").dataItem(i),n.attr("start-dt",n.val()),t.dirty||HandleUpdateEvent("#NationalHolidayGrid",baseURL+"Settings/UpdateNationalHoliday",{nationalHolidayDetails:JSON.stringify([t])}))})},1),this.dataSource.view().length==0){var t=this.dataSource.page();t>1&&this.dataSource.page(t-1)}}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadNationalHolidays",dataType:"json"},update:{url:baseURL+"Settings/UpdateNationalHoliday",dataType:"json"},destroy:{url:baseURL+"Settings/DeleteNationalHoliday",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{nationalHolidayDetails:kendo.stringify(n.models)}:t==="read"?{holidayYear:$("#ddlHolidayYear").val()}:void 0}},batch:!0,pageSize:5,schema:{model:{id:"nationalHolidayId",fields:{nationalHolidayId:{editable:!1},holidayDate:{editable:!0},weekDay:{editable:!1},holidayName:{editable:!0},updatedByUserId:{editable:!1},updatedOnDate:{editable:!1}}}}});$("#NationalHolidayGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,scrollable:!0,resizable:!0,columns:[{field:"nationalHolidayId",hidden:!0},{title:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:45},{field:"holidayDate",title:"Holiday Date",width:"120px",editor:function(n,t){var i=$("<input id='pickerHolidayDate' class='k-input k-textbox' start-dt='"+t.model.holidayDate+"' value='"+t.model.holidayDate+"' data-bind='value:"+t.field+"' />").appendTo(n);i.datepicker({format:"mm/dd/yyyy",autoclose:!0});$("#pickerHolidayDate").change(function(){$(this).attr("value",$("#pickerHolidayDate").val());t.model.holidayDate=$("#pickerHolidayDate").val()})}},{field:"weekDay",width:"100px",title:"Weekday"},{field:"holidayName",width:"250px",title:"Holiday Name"},{field:"updatedByUserId",title:"Update User",width:"150px",template:"#if(updatedByUserId === null || updatedByUserId === ''){#-#}else{# #=updatedByUserId#  #}#"},{field:"updatedOnDate",title:"Update date",width:"150px",template:"#if(updatedOnDate === null || updatedOnDate === ''){#-#}else{# #=kendo.toString(kendo.parseDate(updatedOnDate), 'dd MMM yyyy')#  #}#"},{command:[{name:"edit",text:{edit:"",update:"",cancel:""}},{name:"destroy",text:""}],title:"&nbsp;",width:"80px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};ExpenseView.prototype.Init=function(){var i=this,n,t;$("#datePickerFrom").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#datePickerTo").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#ddlBoss").val($("#hdnBossEmpId").val());n=kendo.toString(kendo.parseDate(new Date),"dd/MMM/yyyy");t=kendo.toString(kendo.parseDate(addMonths(new Date,-6)),"dd/MMM/yyyy");$("#datePickerFrom").datepicker("setDate",t);$("#datePickerTo").datepicker("setDate",n);$('#ddlExpenseStatus option[value=""], #ddlExpenseCategory option[value=""]').attr("selected",!0);$('#ddlExpenseReportList option[value=""], #ddlExpenseReportList option[value=""]').attr("selected",!0);this.LoadExpenseGrid();$("#btnAddExpense").click(function(n){n.preventDefault();AddExpense()});$("#btnExpenseDownloadExcel").click(function(n){n.preventDefault();$("#ExpenseGrid").getKendoGrid().saveAsExcel()});$("#btnExpenseDownloadPDF").click(function(n){n.preventDefault();$("#ExpenseGrid").getKendoGrid().saveAsPDF()});$("#ddlExpenseStatus, #ddlExpenseCategory, #dtFrom, #dtTo, #ddlExpenseReportList").change(function(){i.FilterExpenseListGrid()});$("#dtFrom, #dtTo").change(function(){refreshGrid($("#ExpenseGrid"))});$("#ddlBoss").change(function(){refreshGrid($("#ExpenseGrid"))})};ExpenseView.prototype.FilterExpenseListGrid=function(){var n=$("#ddlExpenseStatus").find(":selected").val(),t=$("#ddlExpenseCategory").find(":selected").val(),i=$("#ddlExpenseReportList").find(":selected").val();doApplyGridFilter("ExpenseGrid","eq","status",n==""?0:n);doApplyGridFilter("ExpenseGrid","eq","category",t==""?0:t);doApplyGridFilter("ExpenseGrid","eq","reportReferenceId",i==""?0:i)};ExpenseView.prototype.LoadExpenseGrid=function(){function t(){setTimeout(function(){$("#ExpenseGrid tbody tr").on("dblclick",function(){var t=$("#ExpenseGrid").data("kendoGrid"),n=t.dataItem(t.select());n!=null&&n!=undefined&&n.expenseIdHash!=0&&EditExpense(n.expenseIdHash,n.category)});KGrdPageSizeDdlPosition("ExpenseGrid")},1)}function i(n){switch(n){case"Submitted":color="blue";break;case"Approved":color="green";break;case"Rejected":color="red";break;case"Reimbursed":color="green";break;default:return n}return"<font color='"+color+"'>"+n+"<\/font>"}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenses",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#dtFrom").val(),r=$("#dtTo").val(),u=$("#ddlBoss").val();return{fromDate:i,toDate:r,onBehalfOfEmoloyee:u}}}},batch:!0,pageSize:5,schema:{model:{id:"expenseId",fields:{expenseIdHash:{editable:!1},expenseId:{editable:!1},category:{editable:!1},description:{editable:!1},dateIncurred:{editable:!1,type:"date"},merchant:{editable:!1},refReport:{editable:!1},status:{editable:!1},currency:{editable:!1},amount:{editable:!1},reportReferenceId:{editable:!1}}}}});$("#ExpenseGrid").kendoGrid({excel:{fileName:"Expenses.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var i,t,r,u;for(SetKGridExportExcelHeader(n.workbook.sheets[0],$(".lblMyCompany").text()+"\nExpenses",!1,!1,0,6),i=n.workbook.sheets[0],t=2;t<i.rows.length;t++)for(r=i.rows[t],u=0;u<r.cells.length;u++)r.cells[7].format="##0.00"},pdf:{title:"Expenses",allPages:!0,avoidLinks:!0,scale:.8,paperSize:"A3",margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,date:new Date,fileName:"Expenses.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Expenses<\/div><\/div>"}},pdfExport:function(n){var i="",r=$("#ExpenseGrid").data("kendoGrid").dataSource,t;for($("div").removeClass("k-grid-content k-auto-scrollable"),r.pageSize(r.data().length+1),t=n.sender.columns.length-1;t>=0;t--)n.sender.columns[t].attributes!=undefined&&n.sender.columns[t].attributes.colPdfHide&&(n.sender.hideColumn(t),i=i==""?t:i+","+t);n.promise.done(function(){window.location.href=baseURL+"Expense/expense"})},dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,sortable:!0,dataBound:t,columns:[{field:"expenseIdHash",hidden:!0},{field:"expenseId",hidden:!0},{field:"reportReferenceId",hidden:!0},{field:"dateIncurred",title:"Date",width:"100px",template:"#= kendo.toString(kendo.parseDate(dateIncurred), 'dd MMM yyyy') #"},{field:"category",title:"Category",width:"180px"},{field:"merchant",title:"Merchant",width:"150px",template:"#if(merchant === null || merchant === ''){# - #}else{# #=merchant# #} #"},{field:"description",title:"Description",width:"140px",template:"#if(description === null || description === ''){# - #}else{# #=description# #} #"},{field:"refReport",title:"Report",width:"150px",template:"#if(refReport === null || refReport === ''){# - #}else{# #=refReport# #} #"},{field:"status",title:"Status",width:"100px",template:function(n){return i(n.status)}},{field:"currency",title:"Currency",width:"60px",template:"#if(currency === null || currency === ''){# - #}else{# #=currency# #} #"},{field:"amount",title:"Amount",width:"150px",template:"#= kendo.toString(amount, 'n2') #"},{template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?"":'<div class="pointer" title="Edit expense" onclick="EditExpense(\''+n.expenseIdHash+"','"+n.category+'\')"><img src="'+baseURL+'images/edit.png" class="img-responsive" /><\/div>'},attributes:{colPdfHide:!0},width:"50px"},{template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?"":'<div class="pointer" title="Delete expense" onclick="DeleteExpense(\''+n.expenseId+'\')"><img src="'+baseURL+'images/delete.png" class="img-responsive" /><\/div>'},attributes:{colPdfHide:!0},width:"50px"}],selectable:"row"})};AddExpenseView.prototype.Init=function(){var n=this,r,t;ValidateAndScrollToEmptyField();r=$("#divLeftSection").height();$("#divRightSection").removeClass("hide-span");$("#datePickerExpense").datepicker({format:"dd/M/yyyy",autoclose:!0}).on("hide",function(){var n=$("#datePickerExpense").datepicker("getDate");n==null||($("#datePickerExpenseToDate").datepicker("setStartDate",new Date(n.valueOf())),$("#datePickerExpenseToDate").datepicker("setDate",null),$("#txtDays").val(""))});$("#datePickerExpenseToDate").datepicker({format:"dd/M/yyyy",autoclose:!0});this.SetInvoiceNumberRequired($("#chkInvoiceNotAvailable").is(":checked"));$("#txtRef").blur(function(){var i=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtRef").val(),u=$("#ddlExpenseMerchant").val(),t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);n.ValidateInvoice("Expense",i,r,u,t)});$("#ddlExpenseMerchant").blur(function(){var i=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtRef").val(),u=$("#ddlExpenseMerchant").val(),t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);n.ValidateInvoice("Expense",i,r,u,t)});$("#ddlExpenseCategory").change(function(){var i=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtRef").val(),u=$("#ddlExpenseMerchant").val(),t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);n.ValidateInvoice("Expense",i,r,u,t)});$("#linkAddExpenseMerchant").click(function(n){n.preventDefault();$("#txtListItemName").val("");$("#hdnListName").val("ExpenseMerchant");$("#AddListItem").modal()});$("#chkInvoiceNotAvailable").change(function(){n.SetInvoiceNumberRequired($(this).is(":checked"));var i=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtRef").val(),u=$("#ddlExpenseMerchant").val(),t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);n.ValidateInvoice("Expense",i,r,u,t)});ShowHideDropDownOption("ddlExpenseCategory","Fuel/Mileage Expenses",!0);ShowHideDropDownOption("ddlExpenseCategory","Per Diem",!0);$("#fileUploadExpenseReceipt").change(function(){ShowUploadedImage("divRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0);FileUploadDivborder()});$("#divRightSection").on("mouseup",function(n){n.button==0&&$("#fileUploadExpenseReceipt").click()});t=$("#divRightSection");t.on("dragover",function(n){n.preventDefault();n.stopPropagation()});t.on("drop",function(n){n.preventDefault();n.stopPropagation();n.originalEvent.dataTransfer&&n.originalEvent.dataTransfer.files.length&&(n.originalEvent.dataTransfer.files.length>1?ShowAlertBox("Please upload a single file."):($("#fileUploadExpenseReceipt")[0].files=n.originalEvent.dataTransfer.files,(navigator.userAgent.indexOf("Firefox")>=0||navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident/")>=0)&&ShowUploadedImage("divRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0)))});$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#chkclmReimbursement").attr("isAddNew")=="true"&&$("#chkclmReimbursement").prop("checked",!0);this.SetPaidThroughVisibility($("#chkclmReimbursement").is(":checked"));$("#chkclmReimbursement").change(function(){n.SetPaidThroughVisibility($(this).is(":checked"));$("#ddlAdvPaymentPaidThrough").val("")});this.LoadExpenseHistoryGrid();$("#ddlCurrency").change(function(){n.SetConversionAmountInAddExpense()});$("#txtAmount").blur(function(){n.SetConversionAmountInAddExpense()});$("#ExpenseId").val()==""&&$("#lblExchangeRate").css("visibility","hidden");$("#ddlExpenseCountry").on("change",function(){n.SetExpenseCurrencybyCountry()});this.SetFieldsBasedOnStatus($("#Status").val());$("#frmListItemName").submit(function(n){var t,r,u,f;if(n.preventDefault(),t=$("#txtListItemName").val(),!(t.length<=0)){for(r=!1,u=$("#ddlExpenseMerchant>option").map(function(){return $(this).val()}),i=0;i<u.length;i++)u[i].trim().toLowerCase()==t.trim().toLowerCase()&&(r=!0);if(r){ShowAlertBox("List item already exists.");return}f=$.post(baseURL+"Settings/AddListItemName",{listName:$("#hdnListName").val(),listItemName:t});f.done(function(n){n?($("#AddListItem").modal("hide"),ShowAlertBox("List item added successfully."),$("#ddlExpenseMerchant").append($("<option>",{value:t,text:t})),$("#txtListItemName").val("")):ShowAlertBox("Error while adding list item.")});f.fail(function(){ShowAlertBox("Error while adding list item.")})}});$("#txtReimburseAmount").blur(function(){ManageReimburseAmountModifyReasonControls()});$("#CurrencyExRate").val()!=null&&$("#CurrencyExRate").val()!=""?$("#btnChangeExchangeRate").css("visibility","visible"):$("#btnChangeExchangeRate").css("visibility","hidden");$("#btnChangeExchangeRate").click(function(n){n.preventDefault();var t=$("#CurrencyExRate").val();$("#txtExhangeRate").val(t);$("#lblExhangeRate").text("Exchange Rate (in "+$("#ddlReimburseCurrency").val()+")");$("#EditExchangeRatePopUp").modal()});$("#frmEditExchangeRate").submit(function(t){t.preventDefault();var i=$("#txtExhangeRate").val();if(i.length<=0||!$.isNumeric(i)||!/^\s*(?=.*[1-9])\d*(?:\.\d{1,6})?\s*$/.test(i))return!1;n.SetReimburseAmountOnExchangeRateChange()});$("#AddListItem").on("hidden.bs.modal",function(){$(this).find("#frmListItemName .has-error.has-danger").removeClass("has-error has-danger")})};AddExpenseView.prototype.SetInvoiceNumberRequired=function(n){n?($("#txtRef").prop("required",!1),$("#lbltxtRef").removeClass("required"),$("#fileUploadExpenseReceipt").prop("required",!1),$("#divRightSection").removeClass("divDottedBorderError")):($("#txtRef").prop("required",!0),$("#lbltxtRef").addClass("required"),($("#ExpenseReceiptAssetId").val()==""||$("#ExpenseReceiptAssetId").val()==undefined||$("#ExpenseReceiptAssetId").val()==0)&&$("#fileUploadExpenseReceipt").val()==""&&($("#fileUploadExpenseReceipt").prop("required",!0),$("#divRightSection").addClass("divDottedBorderError")));var i=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtRef").val(),u=$("#ddlExpenseMerchant").val(),t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);AddExpenseView.prototype.ValidateInvoice("Expense",i,r,u,t)};AddExpenseView.prototype.ValidateInvoice=function(n,t,i,r,u){var f=ValidateReferenceNumber(n,t,i,r,u);f&&($("#txtRef").val(""),$("#fileUploadExpenseReceipt").val(""),ShowAlertBox("Invoice number already exists!"))};AddExpenseView.prototype.SetReimburseAmountOnExchangeRateChange=function(){var r=$("#txtExhangeRate").val(),n=$("#txtAmount").val(),t,i;parseFloat(n)>0?($("#CurrencyExRate").val(parseFloat(r)),$("#txtReimburseAmount").val((r*n).toFixed(2)),ManageReimburseAmountModifyReasonControls()):($("#CurrencyExRate").val(0),$("#txtReimburseAmount").val(""));t=$("#ddlCurrency").val();i=$("#ddlReimburseCurrency").val();t!=i&&parseFloat(n)>0?($("#lblExchangeRate").text("Exchange Rate : 1 "+t+" = "+$("#CurrencyExRate").val()+" "+i),$("#lblExchangeRate").css("visibility","visible"),$("#btnChangeExchangeRate").css("visibility","visible")):($("#lblExchangeRate").css("visibility","hidden"),$("#btnChangeExchangeRate").css("visibility","hidden"));$("#EditExchangeRatePopUp").modal("toggle")};AddExpenseView.prototype.SetConversionAmountInAddExpense=function(){var n=$("#ddlCurrency").val(),t=$("#ddlReimburseCurrency").val(),i=$("#txtAmount").val(),r;parseFloat(i)>0?(r=GetCurrencyExchangeRate(n,t,1),$("#CurrencyExRate").val(parseFloat(r)),$("#txtReimburseAmount").val((r*i).toFixed(2)),$("#txtReimburseAmount").closest(".form-group").removeClass("has-error has-danger"),$("#txtReimburseAmount").attr("originalValue",$("#txtReimburseAmount").val()),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtReimburseAmount").val(""));n!=t&&parseFloat(i)>0?($("#lblExchangeRate").text("Exchange Rate : 1 "+n+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblExchangeRate").css("visibility","visible"),$("#btnChangeExchangeRate").css("visibility","visible")):($("#lblExchangeRate").css("visibility","hidden"),$("#btnChangeExchangeRate").css("visibility","hidden"))};AddExpenseView.prototype.SetExpenseCurrencybyCountry=function(){var t=$("#ddlExpenseCountry").val(),n;t!=""&&(n=$.get(baseURL+"Expense/LoadCurrencyByCounty",{countryName:t}),n.done(function(n){n!=null&&($("#ddlCurrency").val(n.currency).attr("selected","selected"),$("#txtAmount").val(""),$("#txtReimburseAmount").val(""),$("#lblExchangeRate").css("visibility","hidden"),$("#btnChangeExchangeRate").css("visibility","hidden"))}),n.fail(function(){ShowAlertBox("Fail to get expense currency information!")}))};AddExpenseView.prototype.SetPaidThroughVisibility=function(n){n?$("#divPaidThrough").addClass("hidden"):$("#divPaidThrough").removeClass("hidden")};AddExpenseView.prototype.SetFieldsBasedOnStatus=function(n){switch(n){case"Submitted":case"Approved":case"Reimbursed":$("#dtExpense, #ddlExpenseMerchant, #ddlExpenseCategory, #ddlCurrency, #txtAmount, #txtReimburseAmount, #chkclmReimbursement, #chkInvoiceNotAvailable, #dtToExpense, #ddlExpenseCountry").attr("disabled",!0);$("#txtRef, #txtDescription, #ddlAddToReport, #ddlAdvPaymentPaidThrough").attr("disabled",!0);$("#divRightSection").addClass("disabledReceipt");$("#linkAddExpenseMerchant").addClass("disabledDiv");$("#btnChangeExchangeRate").addClass("disabledDiv");$("#txtReasonForModifyingReimbursementAmount").attr("disabled",!0);break;default:$("#dtExpense, #ddlExpenseMerchant, #ddlExpenseCategory, #ddlCurrency, #txtAmount, #chkclmReimbursement, #dtToExpense, #ddlExpenseCountry").attr("disabled",!1);$("#txtRef, #txtDescription, #ddlAddToReport, #ddlAdvPaymentPaidThrough").attr("disabled",!1)}};AddExpenseView.prototype.LoadExpenseHistoryGrid=function(){var n=$("#ExpenseId").val(),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseHistory",dataType:"json",data:{expenseId:n}}},batch:!0,pageSize:5,schema:{model:{id:"expenseId",fields:{expenseId:{editable:!1},description:{editable:!1},datetime:{editable:!1}}}}});$("#ExpenseHistoryGrid").kendoGrid({dataSource:t,pageable:!0,columns:[{field:"expenseId",hidden:!0},{field:"description",width:"500px"},{field:"datetime",width:"100px",template:"#= kendo.toString(kendo.parseDate(datetime), 'dd MMM yyyy hh:mm tt') #"}]})};AddExpenseView.prototype.LoadItemizedViewGrid=function(){};AddMileageView.prototype.Init=function(){var t,u,r,n;objThis=this;ValidateAndScrollToEmptyField();t=$("#txtDistance").css("padding-top");$("#divCalDistance").css("padding-top",t);u=$("#divLeftSection").height();$("#divRightSection").removeClass("hide-span");$("#datePickerMileage").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#ddlExpenseCategory").val("Fuel/Mileage Expenses").attr("selected","selected");$("#CategoryHidden").val($("#ddlExpenseCategory").find("option:selected").val());$("#DistanceHidden").val($("#txtDistance").val());r=$("#rdnOdometerReading").prop("checked");$('#lbltoolTip[data-toggle="tooltip"]').tooltip();r&&($("#RowReading").removeClass("hide-span"),$("#txtDistance").prop("disabled",!0),$("#txtEndReading, #txtStartReading").prop("required",!0));this.LoadEmployeeReimburseCurrency();this.LoadExpenseMileageSettings();this.SetFieldsBasedOnStatus($("#Status").val());this.LoadMileageHistoryGrid();$("#ExpenseId").val()==""&&$("#lblMileageExchangeRate").css("visibility","hidden");$("#txtRef").blur(function(){var t=$("#ddlExpenseCategory").find("option:selected").val(),i=$("#txtRef").val(),n=$("#ExpenseId").val();(n==undefined||n=="")&&(n=0);objThis.ValidateInvoice("Mailage",t,i,"",n)});$("#linkAddMileageVehicle").click(function(n){n.preventDefault();$("#txtListItemName").val("");$("#hdnListName").val("ExpenseVehicle");$("#AddListItem").modal()});$("#rdnOdometerReading").change(function(){$("#RowReading").removeClass("hide-span");$("#txtDistance").prop("disabled",!0);$("#txtDistance").closest(".form-group").removeClass("has-error has-danger");$("#txtEndReading, #txtStartReading").prop("required",!0)});$("#txtStartReading, #txtEndReading").click(function(){var n,t,i;this.value=this.value<0?"":this.value;n=$("#txtStartReading").val();t=$("#txtEndReading").val();n!=""&&t!=""&&parseInt(t)>=parseInt(n)&&(i=parseInt(t)-parseInt(n),$("#txtDistance, #DistanceHidden").val(i),CalculateMileageDistanceAmount())});$("#rdnDistanceTraveled").change(function(){$("#RowReading").addClass("hide-span");$("#txtDistance").prop("disabled",!1);$("#txtEndReading, #txtStartReading").prop("required",!1)});$("#txtStartReading, #txtEndReading").blur(function(){var n,t,i;if(this.value=this.value<0?"":this.value,n=$("#txtStartReading").val(),t=$("#txtEndReading").val(),n!=""&&t!=""&&parseInt(t)<parseInt(n))return ShowAlertBox("End reading should be greater than start reading"),this.value="",$(this).focus(),!1;if(n!=""&&t!=""&&parseInt(t)>parseInt(n))i=parseInt(t)-parseInt(n),$("#txtDistance, #DistanceHidden").val(i),CalculateMileageDistanceAmount();else if(n!=""&&t!=""&&parseInt(t)===parseInt(n))return ShowAlertBox("Start and end reading should not be the same"),this.value="",$(this).focus(),!1});$("#fileUploadExpenseReceipt").change(function(){ShowUploadedImage("divRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0);FileUploadDivborder()});$("#divRightSection").on("mouseup",function(n){n.button==0&&$("#fileUploadExpenseReceipt").click()});n=$("#divRightSection");n.on("dragover",function(n){n.preventDefault();n.stopPropagation()});n.on("drop",function(n){n.preventDefault();n.stopPropagation();n.originalEvent.dataTransfer&&n.originalEvent.dataTransfer.files.length&&(n.originalEvent.dataTransfer.files.length>1?ShowAlertBox("Please upload a single file."):($("#fileUploadExpenseReceipt")[0].files=n.originalEvent.dataTransfer.files,(navigator.userAgent.indexOf("Firefox")>=0||navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident/")>=0)&&ShowUploadedImage("divRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0)))});$("#btnChangeMileageRate").click(function(n){n.preventDefault();$("#EditMileageRatePopUp").modal()});$("#chkClmReimbursement").attr("isAddNew")=="true"&&$("#chkClmReimbursement").prop("checked",!0);$("#frmEditMileageRate").submit(function(n){n.preventDefault();var t=$("#txtMileageRate").val(),i=$("#hdnMileageId").val();if(i.length<=0||t.length<=0||!$.isNumeric(t)||!/^[0-9]{1,5}(?:\.[0-9]{1,2})?$/.test(t))return!1;objThis.UpdateExpenseMileageSettings(i,t);objThis.LoadExpenseMileageSettings()});$("#txtDistance").blur(function(){CalculateMileageDistanceAmount()});this.SetInvoiceNumberRequired($("#chkInvoiceNotAvailable").is(":checked"));$("#chkInvoiceNotAvailable").change(function(){objThis.SetInvoiceNumberRequired($(this).is(":checked"))});$("#txtReimburseAmount").blur(function(){ManageReimburseAmountModifyReasonControls()});$("#CurrencyExRate").val()!=null&&$("#CurrencyExRate").val()!=""?$("#btnChangeMileageExchangeRate").css("visibility","visible"):$("#btnChangeMileageExchangeRate").css("visibility","hidden");$("#btnChangeMileageExchangeRate").click(function(n){n.preventDefault();var t=$("#CurrencyExRate").val();$("#txtExhangeRate").val(t);$("#lblExhangeRate").text("Exchange Rate (in "+$("#ddlReimburseCurrency").val()+")");$("#EditExchangeRatePopUp").modal()});$("#frmEditExchangeRate").submit(function(n){n.preventDefault();var t=$("#txtExhangeRate").val();if(t.length<=0||!$.isNumeric(t)||!/^\s*(?=.*[1-9])\d*(?:\.\d{1,6})?\s*$/.test(t))return!1;objThis.SetMileageReimburseAmountOnExchangeRateChange()});$("#frmListItemName").submit(function(n){var t,r,u,f;if(n.preventDefault(),t=$("#txtListItemName").val(),!(t.length<=0)){for(r=!1,u=$("#ddlVehicle>option").map(function(){return $(this).val()}),i=0;i<u.length;i++)u[i].trim().toLowerCase()==t.trim().toLowerCase()&&(r=!0);if(r){ShowAlertBox("List item already exists.");return}f=$.post(baseURL+"Settings/AddListItemName",{listName:$("#hdnListName").val(),listItemName:t});f.done(function(n){n?($("#AddListItem").modal("hide"),ShowAlertBox("List item added successfully."),$("#ddlVehicle").append($("<option>",{value:t,text:t})),$("#txtListItemName").val("")):ShowAlertBox("Error while adding list item.")});f.fail(function(){ShowAlertBox("Error while adding list item.")})}});$("#AddListItem").on("hidden.bs.modal",function(){$(this).find("#frmListItemName .has-error.has-danger").removeClass("has-error has-danger")})};AddMileageView.prototype.SetMileageReimburseAmountOnExchangeRateChange=function(){var f=$("#txtExhangeRate").val(),n=$("#hdnMileageRate").val(),t=$("#txtDistance").val(),i=0,r,u;parseFloat(t)*parseFloat(n)>0?($("#CurrencyExRate").val(parseFloat(f)),i=(t*f*n).toFixed(2),$("#txtReimburseAmount").val(i),$("#Amount").val(parseFloat(t*n)),ManageReimburseAmountModifyReasonControls()):($("#CurrencyExRate").val(0),$("#txtReimburseAmount").val(""));r=$("#hdnMileageCurrency").val();u=$("#ddlReimburseCurrency").val();r!=u&&parseFloat(i)>0?($("#lblMileageExchangeRate").text("Exchange Rate : 1 "+r+" = "+$("#CurrencyExRate").val()+" "+u),$("#lblMileageExchangeRate").css("visibility","visible"),$("#btnChangeMileageExchangeRate").css("visibility","visible")):($("#lblMileageExchangeRate").css("visibility","hidden"),$("#btnChangeMileageExchangeRate").css("visibility","hidden"));$("#EditExchangeRatePopUp").modal("toggle")};AddMileageView.prototype.SetInvoiceNumberRequired=function(n){n?($("#txtRef").prop("required",!1),$("#lbltxtRef").removeClass("required"),$("#fileUploadExpenseReceipt").prop("required",!1),$("#divRightSection").removeClass("divDottedBorderError")):($("#txtRef").prop("required",!0),$("#lbltxtRef").addClass("required"),($("#ExpenseReceiptAssetId").val()==""||$("#ExpenseReceiptAssetId").val()==undefined||$("#ExpenseReceiptAssetId").val()==0)&&$("#fileUploadExpenseReceipt").val()==""&&($("#fileUploadExpenseReceipt").prop("required",!0),$("#divRightSection").addClass("divDottedBorderError")));var i=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtRef").val(),t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);AddMileageView.prototype.ValidateInvoice("Mailage",i,r,"",t)};AddMileageView.prototype.LoadEmployeeReimburseCurrency=function(){var n=$.post(baseURL+"Expense/EmployeeReimburseCurrency/",{employeeId:$("#EmployeeId").val()});n.done(function(n){n&&$("#ddlReimburseCurrency").val(n)})};AddMileageView.prototype.LoadExpenseMileageSettings=function(){$.ajax({type:"GET",url:baseURL+"Expense/LoadExpenseMileageSettings",async:!1,success:function(n){n!=null&&n!=undefined&&($("#lblMileageSetting").text(n.mileageRatePerKM+" "+n.baseCurrency),$("#lblMileageRate").text("Mileage Rate ( in "+n.baseCurrency+" )"),$("#hdnMileageId").val(n.mileageId),$("#hdnMileageRate").val(n.mileageRatePerKM),$("#hdnMileageCurrency").val(n.baseCurrency),$("#Currency").val(n.baseCurrency))},error:function(){ShowAlertBox("Error while loading mileage rate")}})};AddMileageView.prototype.UpdateExpenseMileageSettings=function(n,t){var i=$.get(baseURL+"Expense/UpdateExpenseSettings",{mileageId:n,mileageRatePerKM:t});i.done(function(){$("#EditMileageRatePopUp").modal("toggle");$("#txtMileageRate").val("")});i.fail(function(){ShowAlertBox("Fail to get per mileage rate!")})};AddMileageView.prototype.SetFieldsBasedOnStatus=function(n){switch(n){case"Submitted":case"Approved":case"Reimbursed":$("#dtMileage").attr("disabled",!0);$("#ddlVehicle").attr("disabled",!0);$("#rdnDistanceTraveled").attr("disabled",!0);$("#rdnOdometerReading").attr("disabled",!0);$("#txtStartReading").attr("disabled",!0);$("#txtEndReading").attr("disabled",!0);$("#txtDistance").attr("disabled",!0);$("#txtReimburseAmount").attr("disabled",!0);$("#chkClmReimbursement").attr("disabled",!0);$("#txtRef").attr("disabled",!0);$("#txtDescription").attr("disabled",!0);$("#ddlAddToReport").attr("disabled",!0);$("#divRightSection").addClass("disabledReceipt");$("#btnChangeMileageExchangeRate").addClass("disabledDiv");$("#txtReimburseAmount").attr("disabled",!0);$("#txtReasonForModifyingReimbursementAmount").attr("disabled",!0);$("#chkInvoiceNotAvailable").attr("disabled",!0);$("#linkAddMileageVehicle").addClass("disabledDiv");break;default:$("#dtMileage").attr("disabled",!1);$("#ddlVehicle").attr("disabled",!1);$("#rdnDistanceTraveled").attr("disabled",!1);$("#rdnOdometerReading").attr("disabled",!1);$("#txtStartReading").attr("disabled",!1);$("#txtEndReading").attr("disabled",!1);$("#txtDistance").attr("disabled",!1);$("#txtReimburseAmount").attr("disabled",!1);$("#chkClmReimbursement").attr("disabled",!1);$("#txtRef").attr("disabled",!1);$("#txtDescription").attr("disabled",!1);$("#ddlAddToReport").attr("disabled",!1)}var t=$("#rdnOdometerReading").prop("checked");t&&$("#txtDistance").prop("disabled",!0)};AddMileageView.prototype.LoadMileageHistoryGrid=function(){var n=$("#ExpenseId").val(),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseHistory",dataType:"json",data:{expenseId:n}}},batch:!0,pageSize:5,schema:{model:{id:"expenseId",fields:{expenseId:{editable:!1},description:{editable:!1},datetime:{editable:!1}}}}});$("#MileageHistoryGrid").kendoGrid({dataSource:t,pageable:!0,columns:[{field:"expenseId",hidden:!0},{field:"description",width:"500px"},{field:"datetime",width:"100px",template:"#= kendo.toString(kendo.parseDate(datetime), 'dd MMM yyyy hh:mm tt') #"}]})};AddMileageView.prototype.ValidateInvoice=function(n,t,i,r,u){var f=ValidateReferenceNumber(n,t,i,r,u);f&&($("#txtRef").val(""),$("#fileUploadExpenseReceipt").val(""),$("#imgExpenseReceipt").attr("src",baseURL+"images/receipt.png"),ShowAlertBox("Invoice number already exists!"))};AddPerDiemView.prototype.Init=function(){var n;objThis=this;ValidateAndScrollToEmptyField();var t=$("#divLeftSection").height();$("#divRightSection").removeClass("hide-span");$("#datePickerDiem").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&(objThis.CalculateNoDays(),objThis.GetPerDiemAmount())});$("#PerDiemToDateIncurred").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){if(n.date!=undefined){var t=$("#datePickerDiem").datepicker("getDate"),i=$("#PerDiemToDateIncurred").datepicker("getDate");if(i.valueOf()==t.valueOf()){$("#PerDiemToDateIncurred").datepicker("setDate","");ShowMessageBox("Warning!!!","Per-Diem claims are not permitted when From Date is same as To Date","300px");$("#txtDays").val("");return}objThis.CalculateNoDays();objThis.GetPerDiemAmount()}});$("#datePickerDiem").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("hide",function(){var n=$("#datePickerDiem").datepicker("getDate");n==null||($("#PerDiemToDateIncurred").datepicker("setStartDate",new Date(n.valueOf())),$("#PerDiemToDateIncurred").datepicker("setDate",null),$("#txtDays").val(""))});$("#ddlExpenseCategory").val("Per Diem").attr("selected","selected");$("#CategoryHidden").val($("#ddlExpenseCategory").find("option:selected").val());$("#CurrencyHidden").val($("#ddlCurrency").find("option:selected").val());$("#AmountHidden").val($("#txtAmount").val());$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#txtDays").blur(function(){$("#txtDays").val()!=""&&/^[1-9][0-9]*(?:\.{1,2})?$/.test($("#txtDays").val())&&objThis.GetPerDiemAmount()});$("#ddlPerDiemRateList").val()==""?$("#txtDays").prop("disabled",!0):$("#txtDays").prop("disabled",!1);$("#ddlPerDiemRateList").on("change",function(){$("#ddlPerDiemRateList").val()==""?($("#ddlCurrency").val(""),$("#txtDays").val(""),$("#txtAmount").val(""),$("#txtDays").prop("disabled",!0)):($("#txtDays").prop("disabled",!1),objThis.GetPerDiemAmount())});$("#fileUploadExpenseReceipt").change(function(){ShowUploadedImage("divRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0);FileUploadDivborder()});$("#divRightSection").on("mouseup",function(n){n.button==0&&$("#fileUploadExpenseReceipt").click()});n=$("#divRightSection");n.on("dragover",function(n){n.preventDefault();n.stopPropagation()});n.on("drop",function(n){n.preventDefault();n.stopPropagation();n.originalEvent.dataTransfer&&n.originalEvent.dataTransfer.files.length&&(n.originalEvent.dataTransfer.files.length>1?ShowAlertBox("Please upload a single file."):($("#fileUploadExpenseReceipt")[0].files=n.originalEvent.dataTransfer.files,(navigator.userAgent.indexOf("Firefox")>=0||navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident/")>=0)&&ShowUploadedImage("divRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0)))});$("#chkClmReimbursement").attr("isAddNew")=="true"&&$("#chkClmReimbursement").prop("checked",!0);this.LoadExpenseHistoryGrid();this.SetFieldsBasedOnStatus($("#Status").val());$("#ddlReimburseCurrency").val()!=$("#ddlCurrency").val()&&$("#txtAmount").val()>0?($("#lblExchangeRate").css("visibility","visible"),$("#btnChangePerDiemExchangeRate").css("visibility","visible"),$("#spanEditExchangeIcon").css("visibility","visible")):($("#lblExchangeRate").css("visibility","hidden"),$("#btnChangePerDiemExchangeRate").css("visibility","hidden"),$("#spanEditExchangeIcon").css("visibility","hidden"));$("#ddlPerdiemCountry").on("change",function(){$("#ddlPerdiemCountry").val()==""?($("#ddlCurrency").val(""),$("#txtDays").val(""),$("#txtAmount").val(""),$("#txtDays").prop("disabled",!0)):($("#txtDays").prop("disabled",!1),objThis.LoadPerdiemRateByCountrySpecific(),objThis.GetPerDiemRateByCountry(),objThis.GetPerDiemAmount())});$("#txtReimburseAmount").blur(function(){ManageReimburseAmountModifyReasonControls()});$("#CurrencyExRate").val()!=null&&$("#CurrencyExRate").val()!=""?$("#btnChangePerDiemExchangeRate").css("visibility","visible"):$("#btnChangePerDiemExchangeRate").css("visibility","hidden");$("#btnChangePerDiemExchangeRate").click(function(n){n.preventDefault();var t=$("#CurrencyExRate").val();$("#txtExhangeRate").val(t);$("#lblExhangeRate").text("Exchange Rate (in "+$("#ddlReimburseCurrency").val()+")");$("#EditExchangeRatePopUp").modal()});$("#frmEditExchangeRate").submit(function(n){n.preventDefault();var t=$("#txtExhangeRate").val();if(t.length<=0||!$.isNumeric(t)||!/^\s*(?=.*[1-9])\d*(?:\.\d{1,6})?\s*$/.test(t))return!1;objThis.SetPerDiemReimburseAmountOnExchangeRateChange()})};AddPerDiemView.prototype.SetPerDiemReimburseAmountOnExchangeRateChange=function(){var n=$("#txtExhangeRate").val(),i=$("#ddlPerDiemRateList").val(),r=$("#txtDays").val(),t;i>0&&r.length>0&&(t=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:i,NoOfDays:r}),t.done(function(t){$("#ddlCurrency").val(t.currency).attr("selected","selected");$("#txtAmount").val(t.amount);var i=$("#ddlReimburseCurrency").val(),r=t.currency;parseFloat(t.amount)>0?($("#txtReimburseAmount").val((n*t.amount).toFixed(2)),$("#CurrencyExRate").val(parseFloat(n))):($("#CurrencyExRate").val(0),$("#txtReimburseAmount").val(""));r!=i&&parseFloat(t.amount)>0?($("#lblExchangeRate").text("Exchange Rate : 1 "+r+" = "+n+" "+i),$("#lblExchangeRate").css("visibility","visible"),$("#btnChangePerDiemExchangeRate").css("visibility","visible"),$("#spanEditExchangeIcon").css("visibility","visible")):($("#lblExchangeRate").css("visibility","hidden"),$("#btnChangePerDiemExchangeRate").css("visibility","hidden"),$("#spanEditExchangeIcon").css("visibility","hidden"));ManageReimburseAmountModifyReasonControls()}),t.fail(function(){ShowAlertBox("Fail to get per diem information!")}));$("#EditExchangeRatePopUp").modal("toggle")};AddPerDiemView.prototype.SetInvoiceNumberRequired=function(n){n||($("#ExpenseReceiptAssetId").val()==""||$("#ExpenseReceiptAssetId").val()==undefined||$("#ExpenseReceiptAssetId").val()==0)&&$("#fileUploadExpenseReceipt").val()==""};AddPerDiemView.prototype.SetFieldsBasedOnStatus=function(n){switch(n){case"Submitted":case"Approved":case"Reimbursed":$("#dtDiem").attr("disabled",!0);$("#ddlPerDiemRateList").attr("disabled",!0);$("#txtDays").attr("disabled",!0);$("#chkClmReimbursement").attr("disabled",!0);$("#txtDescription").attr("disabled",!0);$("#ddlAddToReport").attr("disabled",!0);$("#divRightSection").addClass("disabledReceipt");$("#btnChangePerDiemExchangeRate").addClass("disabledDiv");$("#txtReimburseAmount").attr("disabled",!0);$("#txtReasonForModifyingReimbursementAmount").attr("disabled",!0);$("#dtPerDiemToDateIncurred").attr("disabled",!0);$("#ddlPerdiemCountry").attr("disabled",!0);break;default:$("#dtDiem").attr("disabled",!1);$("#ddlPerDiemRateList").attr("disabled",!1);$("#txtDays").attr("disabled",!1);$("#chkClmReimbursement").attr("disabled",!1);$("#txtDescription").attr("disabled",!1);$("#ddlAddToReport").attr("disabled",!1);$("#dtPerDiemToDateIncurred").attr("disabled",!1);$("#ddlPerdiemCountry").attr("disabled",!1)}};AddPerDiemView.prototype.LoadExpenseHistoryGrid=function(){var n=$("#ExpenseId").val(),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseHistory",dataType:"json",data:{expenseId:n}}},batch:!0,pageSize:5,schema:{model:{id:"expenseId",fields:{expenseId:{editable:!1},description:{editable:!1},datetime:{editable:!1}}}}});$("#PerDiemHistoryGrid").kendoGrid({dataSource:t,pageable:!0,columns:[{field:"expenseId",hidden:!0},{field:"description",width:"500px"},{field:"datetime",width:"100px",template:"#= kendo.toString(kendo.parseDate(datetime), 'dd MMM yyyy hh:mm tt') #"}]})};AddPerDiemView.prototype.GetPerDiemAmount=function(){var t=$("#ddlPerDiemRateList").val(),i=$("#txtDays").val(),n;t>0&&i.length>0&&(n=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:t,NoOfDays:i}),n.done(function(n){var t,i,r;$("#ddlCurrency").val(n.currency).attr("selected","selected");$("#txtAmount").val(n.amount);t=$("#ddlReimburseCurrency").val();i=n.currency;parseFloat(n.amount)>0?(r=GetCurrencyExchangeRate(i,t,1),$("#CurrencyExRate").val(parseFloat(r)),$("#txtReimburseAmount").val((r*n.amount).toFixed(2)),$("#txtReimburseAmount").attr("originalValue",$("#txtReimburseAmount").val()),$("#txtReimburseAmount").closest(".form-group").removeClass("has-error has-danger"),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtReimburseAmount").val(""));i!=t&&parseFloat(n.amount)>0?($("#lblExchangeRate").text("Exchange Rate : 1 "+i+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblExchangeRate").css("visibility","visible"),$("#btnChangePerDiemExchangeRate").css("visibility","visible"),$("#spanEditExchangeIcon").css("visibility","visible")):($("#lblExchangeRate").css("visibility","hidden"),$("#btnChangePerDiemExchangeRate").css("visibility","hidden"),$("#spanEditExchangeIcon").css("visibility","hidden"))}),n.fail(function(){ShowAlertBox("Fail to get per diem information!")}))};AddPerDiemView.prototype.GetPerDiemRateByCountry=function(){if($("#ddlPerdiemCountry").val()!=""){var t=$("#ddlPerdiemCountry").val(),i=$("#ddlReimburseCurrency").val(),n=$.get(baseURL+"Expense/LoadPerDiemAmountByCountry",{country:t,currency:i});n.done(function(n){$("#ddlPerDiemRateList").val(n).attr("selected","selected");objThis.GetPerDiemAmount()});n.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}};AddPerDiemView.prototype.parseDate=function(n){var t;return n.indexOf("-")?(t=n.split("-"),new Date(t[2],t[0]-1,t[1])):(t=n.split("/"),new Date(t[2],t[0]-1,t[1]))};AddPerDiemView.prototype.daydiff=function(n,t){return(t-n)/864e5};AddPerDiemView.prototype.CalculateNoDays=function(){var n=kendo.toString(kendo.parseDate($("#datePickerDiem").datepicker("getDate")),"MM-dd-yyyy"),t=kendo.toString(kendo.parseDate($("#PerDiemToDateIncurred").datepicker("getDate")),"MM-dd-yyyy"),i;n!=null&&t!=null?(i=objThis.daydiff(objThis.parseDate(n),objThis.parseDate(t)),$("#txtDays").val(i)):$("#txtDays").val("")};AddPerDiemView.prototype.LoadPerdiemRateByCountrySpecific=function(){var t;if($("#ddlPerdiemCountry").val()!=""){var i=$("#ddlPerdiemCountry").val(),r=$("#ddlReimburseCurrency").val(),n=$("#ExpenseId").val();n==""&&(n=0);t=$.get(baseURL+"Expense/LoadPerdiemRateByCountry",{country:i,currency:r,expenseId:n,reportId:0});t.done(function(n){$("#ddlPerDiemRateList").empty();$.each(n,function(n,t){$("<option>").val(t.value).text(t.text).appendTo("#ddlPerDiemRateList")})});t.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}};BulkAddExpenseView.prototype.Init=function(){LoadBulkAddExpenseGrid();LoadBulkAddPerdiemExpenseGrid();objThis=this;$("#lnkAddNewRow").click(function(n){n.preventDefault();InsertRowItem("AddBulkExpenseGrid")});$("#frmAddBulkExpense").submit(function(n){n.preventDefault();SubmitBulkExpenses(!0)});$("#frmListItemName").submit(function(n){n.preventDefault();AddNewListItem()});$("#AddListItem").on("hidden.bs.modal",function(){$(this).find("#frmListItemName .has-error.has-danger").removeClass("has-error has-danger")});$("#ddlBulkExpenseType").on("change",function(){$("#AddBulkExpenseGrid").addClass("hidden");$("#AddPerdiemExpenseGrid").removeClass("hidden")})};ExpenseReportsView.prototype.Init=function(){var n=this;$("#datePickerFrom").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#datePickerTo").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#btnAddNewReport").click(function(n){n.preventDefault();window.location.href=baseURL+"Expense/AddExpenseReport"});$("#ddlExpenseReportStatus option[value='Submitted']").remove();$("#ddlBossEReport").val($("#hdnBossEReportEmpId").val());$("#ddlBossEReport").change(function(){refreshGrid($("#ExpenseReportsGrid"))});this.LoadExpenseReportsGrid();$('#ddlExpenseReportStatus option[value=""], #dtFrom option[value=""], #dtTo option[value=""]').attr("selected",!0);$("#ddlExpenseReportStatus, #dtFrom, #dtTo").change(function(){n.FilterExpenseReportGrid()})};ExpenseReportsView.prototype.FilterExpenseReportGrid=function(){var i=$("#ddlExpenseReportStatus").find(":selected").val(),n=GetDateInFormat($("#dtFrom").val(),"yyyy-MM-ddT00:00:00"),t=GetDateInFormat($("#dtTo").val(),"yyyy-MM-ddT00:00:00");doApplyGridFilter("ExpenseReportsGrid","eq","status",i==""?0:i);doApplyGridFilter("ExpenseReportsGrid","gte","startDate",n==""||n==null?0:n);doApplyGridFilter("ExpenseReportsGrid","lte","endDate",t==""||t==null?0:t)};ExpenseReportsView.prototype.LoadExpenseReportsGrid=function(){function t(){setTimeout(function(){$("#ExpenseReportsGrid tbody tr").on("dblclick",function(){var t=$("#ExpenseReportsGrid").data("kendoGrid"),n=t.dataItem(t.select());n!=null&&n!=undefined&&n.expenseReportIdHash!=0&&EditExpenseReport(n.expenseReportIdHash)});KGrdPageSizeDdlPosition("ExpenseReportsGrid")},1)}function i(n){var t="";switch(n.toLowerCase()){case"submitted (pending finance approval)":case"submitted (pending secondary approval)":case"submitted (pending primary approval)":case"submitted":t="blue";break;case"approved":t="green";break;case"reimbursed":t="green";break;case"partially primary approved":case"partially finance approved":case"partially secondary approved":case"rejected":t="red";break;default:return n}return'<font color="'+t+'">'+n+"<\/font>"}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseReports",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#ddlBossEReport").val();return{onBehalfOfEmoloyee:i}}}},batch:!0,pageSize:5,schema:{model:{id:"expenseReportId",fields:{expenseReportIdHash:{editable:!1},expenseReportId:{editable:!1},reportNumber:{editable:!1},reportTitle:{editable:!1},businessPurpose:{editable:!1},startDate:{editable:!1},endDate:{editable:!1},status:{editable:!1},submittedOn:{editable:!1,type:"date"},amount:{editable:!1},currency:{editable:!1}}}}});$("#ExpenseReportsGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,dataBound:t,columns:[{field:"expenseReportIdHash",hidden:!0},{field:"expenseReportId",hidden:!0},{field:"reportNumber",title:"Report Number",width:"100px"},{field:"reportTitle",title:"Report Title",width:"130px"},{field:"startDate",title:"Start Date",width:"130px",template:"#= kendo.toString(kendo.parseDate(startDate), 'dd MMM yyyy') #"},{field:"endDate",title:"End Date",width:"90px",template:"#= kendo.toString(kendo.parseDate(endDate), 'dd MMM yyyy') #"},{field:"status",title:"Status",width:"90px",template:function(n){return i(n.status)}},{field:"submittedOn",title:"Submitted On",width:"90px",template:"#if(submittedOn === null){#  N/A #}else{# #=kendo.toString(kendo.parseDate(submittedOn), 'dd MMM yyyy')#  #}#"},{title:"Amount",width:"90px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #"},{field:"",title:"",width:"30px",template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?"":'<div class="pointer" title="Edit Report" onclick="EditExpenseReport(\''+n.expenseReportIdHash+'\')"><img src="'+baseURL+'images/edit.png" class="img-responsive" /><\/div>'}},{field:"",title:"",width:"30px",template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?"":'<div class="pointer" title="Delete Report" onclick="DeleteExpenseReport(\''+n.expenseReportId+'\')"><img src="'+baseURL+'images/delete.png" class="img-responsive" /><\/div>'}}],selectable:"row"})};AddExpenseReportsView.prototype.Init=function(){var r,t,n;objThis=this;ValidateAndScrollToEmptyField();r=$("#ddlExpenseType").css("padding-top");$("#divCalDistance").css("padding-top",r);$("#ddlExpenseType").val("Expense");$("#datePickerExpense").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){if(n.date!=undefined){var t=$("#datePickerExpense").datepicker("getDate");t==null||($("#ddlExpenseType").val()=="Per Diem"?($("#datePickerExpenseToDateIncurred").datepicker("setStartDate",new Date(t.valueOf())),$("#datePickerExpenseToDateIncurred").datepicker("setDate",null),$("#txtDays").val("")):($("#datePickerExpenseToDateIncurred").datepicker("setStartDate",new Date(t.valueOf())),$("#datePickerExpenseToDateIncurred").datepicker("setDate",null),$("#ddlExpenseType").val()=="Per Diem"&&$("#txtDays").val("")))}});$("#datePickerExpense").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("hide",function(){var n=$("#datePickerExpense").datepicker("getDate");n==null||($("#ddlExpenseType").val()=="Per Diem"?($("#datePickerExpenseToDateIncurred").datepicker("setStartDate",new Date(n.valueOf())),$("#datePickerExpenseToDateIncurred").datepicker("setDate",null),$("#txtDays").val("")):($("#datePickerExpenseToDateIncurred").datepicker("setStartDate",new Date(n.valueOf())),$("#datePickerExpenseToDateIncurred").datepicker("setDate",null)))});$("#datePickerExpenseToDateIncurred").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){if(n.date!=undefined){var t=$("#datePickerExpense").datepicker("getDate"),i=$("#datePickerExpenseToDateIncurred").datepicker("getDate");if(i.valueOf()==t.valueOf()&&$("#ddlExpenseType").val()=="Per Diem"){$("#datePickerExpenseToDateIncurred").datepicker("setDate","");ShowMessageBox("Warning!!!","Per-Diem claims are not permitted when From Date is same as To Date","300px");$("#txtDays").val("");return}$("#ddlExpenseType").val()=="Per Diem"&&(objThis.CalculateNoDays(),objThis.GetPerDiemAmount())}});$("#ddlExpenseReportCountry").on("change",function(){$("#ddlExpenseReportCountry").val()==""?($("#ddlPerDiemCurrency").val(""),$("#ddlExpenseType").val()!="Per Diem"&&$("#txtDays").val(""),$("#txtPerDiemAmount").val(""),$("#txtDays").prop("disabled",!0)):($("#txtDays").prop("disabled",!1),$("#ddlExpenseType").val()=="Per Diem"&&(objThis.LoadPerdiemRateDetailsByCountrySpecific(),objThis.GetPerDiemRateByCountry()))});$("#datePickerAdvPayDate").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0});$("#datePickerFrom").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&AddOrMinusDayFromDate(new Date(n.date.valueOf()),"datePickerTo",!0,1,"setStartDate")});$("#datePickerTo").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&AddOrMinusDayFromDate(new Date(n.date.valueOf()),"datePickerFrom",!1,1,"setEndDate")});ShowHideDropDownOption("ddlExpenseCategory","Fuel/Mileage Expenses",!0);ShowHideDropDownOption("ddlExpenseCategory","Per Diem",!0);$('#lbltoolTip[data-toggle="tooltip"]').tooltip();$("#ddlExpenseType").change(function(){objThis.HideShowValidatePerdiemControls();objThis.ShowHideControls(this.value);objThis.SetRequiredFields(this.value);AddExpenseReportsView.prototype.HideShowModifyReasonControls(0,0);$("#btnChangeExpenseReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangePerDiemReportExchangeRate").css("visibility","hidden");$("#chkInvoiceNotAvailable").removeAttr("checked");$("#txtInvoiceReferenceNo, #txtDesc").val("")});$("#ddlExpenseReportCountry").on("change",function(){objThis.SetExpenseReportCurrencybyCountry()});$("#txtDays").blur(function(){$("#txtDays").val()!=""&&/^[1-9][0-9]*(?:\.{1,2})?$/.test($("#txtDays").val())&&(objThis.GetPerDiemAmount(),objThis.SetPerDiemExchangeRateAmtFields())});this.SetInvoiceNumberRequired($("#chkInvoiceNotAvailable").is(":checked"));$("#chkInvoiceNotAvailable").change(function(){objThis.SetInvoiceNumberRequired($(this).is(":checked"))});$("#btnUnreportedExpenses").click(function(n){if(n.preventDefault(),!$("#ExpenseReportId").val()){ShowAlertBox("Please save report first");$(".alertMsgBtn").click(function(){$("html, body").animate({scrollTop:$("#btnReportSave").offset().top},500)});return}$("#IncludeExpensesModal").modal();objThis.LoadIncludeExpenseGrid()});this.SetStatusColor($("#Status").val());$("#btnIncludeExpenses").click(function(n){var t,i,r;n.preventDefault();t=0;i=$("#ExpenseReportId").val();i?($("#IncludeExpensesGrid").find("input:checked").each(function(){this.id!="header-chk-expense"&&(objThis.IncludeExpense(this.id,i),t++)}),t===0?ShowAlertBox("Please select expenses to include."):($("#IncludeExpensesModal").modal("toggle"),r=$("#hdnExpenseReportIdHash").val(),window.location.href=baseURL+"Expense/AddExpenseReport?expenseReportIdHash="+encodeURIComponent(r))):(ShowAlertBox("Please Save report first"),$(".alertMsgBtn").click(function(){$("html, body").animate({scrollTop:$("#btnReportSave").offset().top},500)}))});$("#btnUnreportedAdvPay").click(function(n){if(n.preventDefault(),!$("#ExpenseReportId").val()){ShowAlertBox("Please save report first");$(".alertMsgBtn").click(function(){$("html, body").animate({scrollTop:$("#btnReportSave").offset().top},500)});return}$("#ApplyAdvancePaymentModal").modal();objThis.LoadApplyAdvancePaymentGrid()});$("#btnAddExpense").click(function(n){if(n.preventDefault(),objThis.HideShowValidatePerdiemControls(),objThis.ShowHideControls(this.value),objThis.SetRequiredFields(this.value),AddExpenseReportsView.prototype.HideShowModifyReasonControls(0,0),$("#btnChangeExpenseReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangePerDiemReportExchangeRate").css("visibility","hidden"),$("#chkInvoiceNotAvailable").removeAttr("checked"),$("#txtInvoiceReferenceNo, #txtDesc").val(""),!$("#ExpenseReportId").val()){ShowAlertBox("Please save report first");$(".alertMsgBtn").click(function(){$("html, body").animate({scrollTop:$("#btnReportSave").offset().top},500)});return}objThis.ClearFields();objThis.EnableAllFields();$("html, body").animate({scrollTop:$(document).height()},10);$("#ExpenseId").val()?$("#btnSaveExpense").val("SAVE"):$("#btnSaveExpense").val("SAVE AND INCLUDE");$("#AddExpenseModal").modal()});$("#linkAddExpenseMerchant").click(function(n){n.preventDefault();$("#txtListItemName").val("");$("#AddListItem").modal("show");$("#hdnListName").val("ExpenseMerchant")});$("#linkAddMileageVehicle").click(function(n){n.preventDefault();$("#txtListItemName").val("");$("#hdnListName").val("ExpenseVehicle");$("#AddListItem").modal()});$("#btnAddBulkExpense").click(function(n){if(n.preventDefault(),!$("#ExpenseReportId").val()){ShowAlertBox("Please save report first");$(".alertMsgBtn").click(function(){$("html, body").animate({scrollTop:$("#btnReportSave").offset().top},500)});return}$("#rowBtnBulkGroup").addClass("hide-span");LoadBulkAddExpenseGrid();LoadBulkAddPerdiemExpenseGrid();$("#BulkAddExpenseModal").modal()});$("#frmAddBulkExpense").submit(function(n){n.preventDefault();var t=SubmitBulkExpenses(!1,$("#ExpenseReportId").val());t&&(ShowAlertBox("Bulk Expenses Added successfully"),refreshGrid($("#LoadAddExpenseReportGrid")))});$("#lnkAddNewRow").click(function(n){n.preventDefault();var t=$("#ddlBulkExpenseType").val();t=="Expense"||t==""?InsertRowItem("AddBulkExpenseGrid"):t=="Per Diem"&&InsertRowPerDiemItem("AddPerdiemExpenseGrid")});$("#btnAddExpenseCancel").click(function(n){n.preventDefault();objThis.ClearFields()});$("#frmListItemName").submit(function(n){var f,r,t,u,e,o;if(n.preventDefault(),f=$("#AddListItem").attr("source"),f!=undefined&&f.toLowerCase()=="bulkexpense")AddNewListItem();else{if(r=$("#hdnListName").val(),t=$("#txtListItemName").val(),t.length<=0)return;for(r==="ExpenseMerchant"?u=$("#ddlMerchant>option").map(function(){return $(this).val()}):(r="ExpenseVehicle")&&(u=$("#ddlVehicle>option").map(function(){return $(this).val()})),e=!1,i=0;i<u.length;i++)u[i].trim().toLowerCase()==t.trim().toLowerCase()&&(e=!0);if(e){ShowAlertBox("Item is already exist.");return}o=$.post(baseURL+"Settings/AddListItemName",{listName:$("#hdnListName").val(),listItemName:t});o.done(function(n){n?($("#AddListItem").modal("hide"),ShowAlertBox("Item added successfully."),r==="ExpenseMerchant"?$("#ddlMerchant").append($("<option>",{value:t,text:t})):r=="ExpenseVehicle"&&$("#ddlVehicle").append($("<option>",{value:t,text:t})),$("#txtListItemName").val("")):ShowAlertBox("Error while adding list item.")});o.fail(function(){ShowAlertBox("Error while adding list item.")})}});this.LoadExpenseMileageSettings();$("#btnApply").click(function(n){var t,i,r;n.preventDefault();t=0;i=$("#ExpenseReportId").val();i?($("#ApplyAdvancePaymentGrid").find("input:checked").each(function(){this.id!="header-chk-pmt"&&(objThis.ApplyAdvancePayment(this.id,i),t++)}),t===0?ShowAlertBox("Please select advance payment to apply."):($("#ApplyAdvancePaymentModal").modal("toggle"),r=$("#hdnExpenseReportIdHash").val(),window.location.href=baseURL+"Expense/AddExpenseReport?expenseReportIdHash="+encodeURIComponent(r))):ShowAlertBox("Please save report first")});$("#AddExpenseModal").on("hidden.bs.modal",function(){objThis.ClearFields();$("html, body").animate({scrollTop:0},10);AddExpenseReportsView.prototype.HideShowModifyReasonControls(0,0);$("#hdnReimburseAmountModifyReason").val("");objThis.ShowHideControls($("#ddlExpenseType").val());objThis.SetRequiredFields($("#ddlExpenseType").val());$(this).find("#frmAddExpenseModel .has-error.has-danger").removeClass("has-error has-danger");$("#btnSaveExpense").addClass("disabled");AddExpenseReportsView.prototype.SetInvoiceNumberRequired($("#chkInvoiceNotAvailable").is(":checked"))});$("#divModalRightSection").on("mouseup",function(n){n.button==0&&$("#fileUploadExpenseReceipt").click()});$("#fileUploadExpenseReceipt").change(function(){ShowUploadedImage("divModalRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0);var n=$("#fileUploadExpenseReceipt").val();n&&($("#divModalRightSection").removeClass("divDottedBorderError"),$("#divModalRightSection").addClass("divDottedBorder"))});t=$("#divModalRightSection");t.on("dragover",function(n){n.preventDefault();n.stopPropagation()});t.on("drop",function(n){n.preventDefault();n.stopPropagation();n.originalEvent.dataTransfer&&n.originalEvent.dataTransfer.files.length&&(n.originalEvent.dataTransfer.files.length>1?ShowAlertBox("Please upload a single file."):($("#fileUploadExpenseReceipt")[0].files=n.originalEvent.dataTransfer.files,(navigator.userAgent.indexOf("Firefox")>=0||navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident/")>=0)&&ShowUploadedImage("divModalRightSection","fileUploadExpenseReceipt","imgExpenseReceipt",!0)))});$("#rdnOdometerReading").change(function(){objThis.ShowControlByrbdCalculateMileage()});$("#rdnDistanceTraveled").change(function(){objThis.ShowControlByrbdCalculateMileage()});$("#txtStartReading, #txtEndReading").blur(function(){this.value=this.value<0?"":this.value;var n=$("#txtStartReading").val(),t=$("#txtEndReading").val();if(n!=""&&t!=""&&parseInt(t)<parseInt(n))return ShowAlertBox("End reading should be greater than start reading"),this.value="",$(this).focus(),!1;if(n!=""&&t!=""&&parseInt(t)>parseInt(n))$("#txtMileageDistance, #DistanceHidden").val(parseInt(t)-parseInt(n)),objThis.CalculateMileageDistanceAmount();else if(n!=""&&t!=""&&parseInt(t)===parseInt(n))return ShowAlertBox("Start and end reading should not be the same"),this.value="",$(this).focus(),!1});this.LoadAddExpenseReportGrid();this.LoadAdvancePaymentGrid();this.LoadExpenseReportHistoryGrid();this.SetFieldsBasedOnStatus($("#Status").val());$("#frmAddExpenseModel").submit(function(n){var p,u,tt;if(n.preventDefault(),!$("#btnSaveExpense").hasClass("disabled")){if(p=$("#ExpenseReportId").val(),!p){ShowAlertBox("Please Save report first");return}var w=$("#ExpenseId").val(),it=$("#EmployeeId").val(),rt=$("#CompanyId").val(),ut=$("#Status").val(),ft=$("#CurrencyExRate").val(),i=$("#ddlExpenseType option:selected").text(),et=$("#AdvExpenseDt").val(),ot=$("#AdvExpenseDtToDateIncurred").val(),b=$("#ddlMerchant").val(),r="",f="",e="",o="",s="",h=!1,c=!1,l="";i==="Mileage"?(r="Fuel/Mileage Expenses",f=$("#Currency").val(),e=$("#Amount").val(),o=$("#ddlMLGReimburseCurrency").val(),s=$("#txtMLGReimburseAmount").val(),h=$("#chkclmReimburseForMileage").is(":checked"),c=$("#chkInvoiceNotAvailable").is(":checked")):i==="Per Diem"?(r="Per Diem",f=$("#ddlPerDiemCurrency").val(),e=$("#txtPerDiemAmount").val(),h=$("#chkClmReimburseDiem").is(":checked"),o=$("#ddlReimburseCurrencyPDPopup").val(),s=$("#txtReimburseAmountPDPopup").val(),c=$("#chkInvoiceNotAvailable").is(":checked"),l=$("#ddlExpenseReportCountry").val()):(r=$("#ddlExpenseCategory").val(),f=$("#ddlExpeCurrency").val(),e=$("#txtExpenseAmount").val(),h=$("#chkclmReimbursement").is(":checked"),o=$("#ddlReimburseCurrencyPopup").val(),s=$("#txtReimburseAmountPopup").val(),c=$("#chkInvoiceNotAvailable").is(":checked"),l=$("#ddlExpenseReportCountry").val());var st=$("#txtReasonForModifyingReimbursementAmount").val(),k=$("#ddlPerDiemRateList option:selected").val(),ht=$("#txtDays").val(),ct=$("#ddlVehicle option:selected").text(),a=$("#rdnDistanceTraveled").prop("checked")?"Distance":"Odometer";var d="",g="",v="";i==="Mileage"&&a=="Odometer"?(d=$("#txtStartReading").val(),g=$("#txtEndReading").val(),v=$("#DistanceHidden").val()):i==="Mileage"&&a=="Distance"&&(v=$("#txtMileageDistance").val().trim());var nt=$("#txtInvoiceReferenceNo").val(),lt=$("#ExpenseReportId").val(),at=$("#txtDesc").val(),vt=$("#ExpenseReceiptAssetId").val(),yt=$("#EmployeeAssetId").val(),pt=$("#fileUploadExpenseReceipt").get(0),y=pt.files,t=new FormData;for(u=0;u<y.length;u++)t.append(y[u].name,y[u]);if(tt=ValidateReferenceNumber(i,r,nt,b,w),i!="Per Diem"&&tt){ShowAlertBox("Invoice number already exists!");return}t.append("parameterExpenseId",w);t.append("parameterEmployeeId",it);t.append("parameterCompanyId",rt);t.append("parameterStatus",ut);t.append("parameterType",i);t.append("parameterDateIncurred",et);t.append("parameterMerchant",b);t.append("parameterCategory",r);t.append("parameterCurrency",f);t.append("parameterAmount",e);t.append("parameterReimburseCurrency",o);t.append("parameterReimburseAmount",s);t.append("parameterCurrencyExRate",ft);t.append("parameterIsClaimReimbursement",h);t.append("parameterPerDiemRate",k!=undefined?k:"");t.append("parameterNoOfDays",ht);t.append("parameterVehicle",ct);t.append("parameterMileageUsing",a);t.append("parameterStartReading",d);t.append("parameterEndreading",g);t.append("parameterDistance",v);t.append("parameterReferenceNo",nt);t.append("parameterReportReferenceId",lt);t.append("parameterDescription",at);t.append("parameterExpenseReceiptAssetId",vt);t.append("parameterEmployeeAssetId",yt);t.append("parameterIsInvoiceNotAvailable",c);t.append("parameterReimburseAmountModifyReason",st);t.append("parameterToDateIncurred",ot);t.append("parameterCountry",l);result=objThis.SaveExpense(t);result?($("#AddExpenseModal").modal("hide"),ShowAlertBox("Expense Added/Updated!"),refreshGrid($("#LoadAddExpenseReportGrid"))):ShowAlertBox("Fail to save expense!")}});$("#ddlExpeCurrency").change(function(){objThis.SetExpeExchangeAndConversionAmount()});$("#txtExpenseAmount").blur(function(){objThis.SetExpeExchangeAndConversionAmount()});$("#txtMileageDistance").blur(function(){objThis.CalculateMileageDistanceAmount()});$("#ddlPerDiemRateList").on("change",function(){$("#ddlPerDiemRateList").val()==""?($("#ddlPerDiemCurrency").val(""),$("#txtDays").val(""),$("#txtPerDiemAmount").val(""),$("#txtDays").prop("disabled",!0)):($("#txtDays").prop("disabled",!1),objThis.GetPerDiemAmount())});$("#btnAdvPayment").click(function(n){if(n.preventDefault(),!$("#ExpenseReportId").val()){ShowAlertBox("Please save report first");return}objThis.AdvancePaymentPopupClearFields();$("#ExpenseAdvPaymentId").val()?$("#btnRecAdvPay").val("SAVE"):$("#btnRecAdvPay").val("SAVE AND INCLUDE");$("#recordAdvancePaymentModal").modal()});$("#txtAdvPmtPopupAmount").blur(function(){objThis.AdvPmtExchangeAmtToRemiburseCurrency()});$("#ddlAdvPmtPopupCurrency").change(function(){objThis.AdvPmtExchangeAmtToRemiburseCurrency()});$("#frmRecordAdvancePayment").submit(function(n){var o;if(n.preventDefault(),!$("#btnRecAdvPay").hasClass("disabled")){var s=$("#ExpenseAdvPaymentId").val(),h=$("#EmployeeId").val(),c=$("#ExpenseReportId").val(),t=$("#AdvPayDate").val(),i=$("#ddlAdvPmtPopupCurrency").val(),r=$("#txtAdvPmtPopupAmount").val(),u=$("#ddlAdvPmtPopupReimburseCurr").val(),f=$("#txtAdvPmtPopupReimburseAmt").val(),l=$("#CurrencyExRate").val(),e=$("#ddlAdvPaymentPaidThrough").val(),a=$("#txtRef").val(),v=$("#txtNote").val();i!==""&&t!==""&&r!==""&&e!==""&&u!==""&&f!==""&&(o={ExpenseAdvPaymentId:s,EmployeeId:h,ExpenseReportId:c,Date:t,PaidThrough:e,ReferenceNo:a,Amount:r,Currency:i,Notes:v,ReimburseCurrency:u,ReimburseAmount:f,CurrencyExRate:l},objThis.SaveAdvancePayment(o))}});$("#recordAdvancePaymentModal").on("hidden.bs.modal",function(){$(this).find("#frmRecordAdvancePayment .has-error.has-danger").removeClass("has-error has-danger");$("#frmRecordAdvancePayment #btnRecAdvPay").addClass("disabled")});$("#txtReimburseAmountPopup").blur(function(){objThis.ManageReimburseAmountModifyReasonControlsOnExpenseReport()});$("#txtMLGReimburseAmount").blur(function(){objThis.ManageReimburseAmountModifyReasonControlsOnMileageReport()});$("#txtReimburseAmountPDPopup").blur(function(){objThis.ManageReimburseAmountModifyReasonControlsOnPerDiemReport()});AddExpenseReportsView.prototype.HideShowModifyReasonControls(0,0);$("#hdnReimburseAmountModifyReason").val("");$("#CurrencyExRate").val()!=null&&$("#CurrencyExRate").val()!=""?(n=$("#ddlExpenseType option:selected").text(),n=="Expense"?$("#btnChangeExpenseReportExchangeRate").css("visibility","visible"):n=="Mileage"?$("#btnChangeMileageReportExchangeRate").css("visibility","visible"):n=="Per Diem"&&$("#btnChangePerDiemReportExchangeRate").css("visibility","visible")):($("#btnChangeExpenseReportExchangeRate").css("visibility","hidden"),$("#btnChangeMileageReportExchangeRate").css("visibility","hidden"),$("#btnChangePerDiemReportExchangeRate").css("visibility","hidden"));$("#btnChangeExpenseReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangePerDiemReportExchangeRate").click(function(n){n.preventDefault();$("#txtExhangeRate").val($("#CurrencyExRate").val());var i=$("#ddlExpenseType option:selected").text(),t="INR";i=="Expense"?t=$("#ddlReimburseCurrencyPopup option:selected").val():i=="Mileage"?t=$("#ddlMLGReimburseCurrency option:selected").val():i=="Per Diem"&&(t=$("#ddlReimburseCurrencyPDPopup option:selected").val());$("#lblExhangeRate").text("Exchange Rate (in "+t+")");$("#EditExchangeRatePopUp").modal("show")});$("#frmEditExchangeRate").submit(function(n){n.preventDefault();var i=$("#txtExhangeRate").val(),t=$("#ddlExpenseType option:selected").text();if(i.length<=0||!$.isNumeric(i)||!/^\s*(?=.*[1-9])\d*(?:\.\d{1,6})?\s*$/.test(i)||t=="")return!1;t=="Expense"?objThis.SetReimburseAmountOnExchangeRateChangeInExpenseReport():t=="Mileage"?objThis.SetReimburseAmountOnExchangeRateChangeInMileageReport():t=="Per Diem"&&objThis.SetReimburseAmountOnExchangeRateChangeInPerDiemReport();$("#EditExchangeRatePopUp").modal("hide")});$("#AddListItem").on("hidden.bs.modal",function(){$(this).find("#frmListItemName .has-error.has-danger").removeClass("has-error has-danger")});$("#txtInvoiceReferenceNo").blur(function(){var t=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtInvoiceReferenceNo").val(),u=$("#ddlMerchant").val(),i=$("#ddlExpenseType option:selected").text(),n;i==="Mileage"&&(t="Fuel/Mileage Expenses");n=$("#ExpenseId").val();(n==undefined||n=="")&&(n=0);objThis.ValidateInvoice(i,t,r,u,n)});$("#ddlMerchant").blur(function(){var t=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtInvoiceReferenceNo").val(),u=$("#ddlMerchant").val(),i=$("#ddlExpenseType option:selected").text(),n;i==="Mileage"&&(t="Fuel/Mileage Expenses");n=$("#ExpenseId").val();(n==undefined||n=="")&&(n=0);objThis.ValidateInvoice(i,t,r,u,n)});$("#ddlExpenseCategory").change(function(){var t=$("#ddlExpenseCategory").find("option:selected").val(),r=$("#txtInvoiceReferenceNo").val(),u=$("#ddlMerchant").val(),i=$("#ddlExpenseType option:selected").text(),n;i==="Mileage"&&(t="Fuel/Mileage Expenses");n=$("#ExpenseId").val();(n==undefined||n=="")&&(n=0);objThis.ValidateInvoice(i,t,r,u,n)});$("#ddlBulkExpenseType option[value='Mileage']").remove();$("#ddlBulkExpenseType").val("Expense").attr("selected",!0);$("#ddlBulkExpenseType").on("change",function(){var n=$("#ddlBulkExpenseType").val();n=="Expense"||n==""?($("#AddBulkExpenseGrid").removeClass("hidden"),$("#AddPerdiemExpenseGrid").addClass("hidden")):n=="Per Diem"&&($("#AddBulkExpenseGrid").addClass("hidden"),$("#AddPerdiemExpenseGrid").removeClass("hidden"))})};AddExpenseReportsView.prototype.ManageReimburseAmountModifyReasonControlsOnExpenseReport=function(){var n=$("#txtReimburseAmountPopup").val(),t=$("#txtReimburseAmountPopup").attr("originalValue");AddExpenseReportsView.prototype.HideShowModifyReasonControls(n,t)};AddExpenseReportsView.prototype.ManageReimburseAmountModifyReasonControlsOnMileageReport=function(){var n=$("#txtMLGReimburseAmount").val(),t=$("#txtMLGReimburseAmount").attr("originalValue");AddExpenseReportsView.prototype.HideShowModifyReasonControls(n,t)};AddExpenseReportsView.prototype.ManageReimburseAmountModifyReasonControlsOnPerDiemReport=function(){var n=$("#txtReimburseAmountPDPopup").val(),t=$("#txtReimburseAmountPDPopup").attr("originalValue");AddExpenseReportsView.prototype.HideShowModifyReasonControls(n,t)};AddExpenseReportsView.prototype.HideShowModifyReasonControls=function(n,t){parseFloat(n)>0?parseFloat(t)==parseFloat(n)&&$("#hdnReimburseAmountModifyReason").val()==""?($("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#divReasonForModifyingReimbursementAmount").removeClass("hidden"),$("#txtReasonForModifyingReimbursementAmount").prop("required",!0),$("#txtReasonForModifyingReimbursementAmount").focus()):($("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#divReasonForModifyingReimbursementAmount").addClass("hidden"),$("#hdnReimburseAmountModifyReason").val(""))};AddExpenseReportsView.prototype.SetReimburseAmountOnExchangeRateChangeInExpenseReport=function(){var t=$("#txtExhangeRate").val(),i=$("#ddlExpeCurrency").val(),r=$("#ddlReimburseCurrencyPopup").val(),n=$("#txtExpenseAmount").val();parseFloat(n)>0?($("#CurrencyExRate").val(parseFloat(t)),$("#txtReimburseAmountPopup").val((t*n).toFixed(2)),AddExpenseReportsView.prototype.ManageReimburseAmountModifyReasonControlsOnExpenseReport()):($("#CurrencyExRate").val(0),$("#txtReimburseAmountPopup").val(""));i!=r&&parseFloat(n)>0?($("#lblExchangeChngRatePopup").text("1 "+i+" = "+$("#CurrencyExRate").val()+" "+r),$("#lblExchangeChngRatePopup").show(),$("#btnChangeExpenseReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRatePopup").hide(),$("#btnChangeExpenseReportExchangeRate").css("visibility","hidden"))};AddExpenseReportsView.prototype.SetReimburseAmountOnExchangeRateChangeInMileageReport=function(){var i=$("#txtExhangeRate").val(),n=$("#txtMileageDistance").val(),r=$("#Currency").val(),u=$("#ddlMLGReimburseCurrency").val(),t=$("#hdnMileageRate").val(),f;$("#Amount").val(parseFloat(n*t));parseFloat(n*t)>0?($("#CurrencyExRate").val(parseFloat(i)),f=(n*i*t).toFixed(2),$("#txtMLGReimburseAmount").val(f),AddExpenseReportsView.prototype.ManageReimburseAmountModifyReasonControlsOnMileageReport()):($("#CurrencyExRate").val(0),$("#txtMLGReimburseAmount").val(""));r!=u&&parseFloat(n*t)>0?($("#lblExchangeChngRateMileage").text("1 "+r+" = "+$("#CurrencyExRate").val()+" "+u),$("#lblExchangeChngRateMileage").show(),$("#btnChangeMileageReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRateMileage").hide(),$("#btnChangeMileageReportExchangeRate").css("visibility","hidden"))};AddExpenseReportsView.prototype.SetReimburseAmountOnExchangeRateChangeInPerDiemReport=function(){var t=$("#txtExhangeRate").val(),i=$("#ddlPerDiemRateList").val(),r=$("#txtDays").val(),n;i>0&&r>0&&(n=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:i,NoOfDays:r}),n.done(function(n){$("#ddlPerDiemCurrency").val(n.currency).attr("selected","selected");$("#txtPerDiemAmount").val(n.amount);var i=$("#ddlReimburseCurrencyPDPopup").val(),r=n.currency;parseFloat(n.amount)>0?($("#txtReimburseAmountPDPopup").val((t*n.amount).toFixed(2)),$("#CurrencyExRate").val(parseFloat(t)),AddExpenseReportsView.prototype.ManageReimburseAmountModifyReasonControlsOnPerDiemReport()):($("#CurrencyExRate").val(0),$("#txtReimburseAmountPDPopup").val(""));r!=i&&parseFloat(n.amount)>0?($("#lblExchangeChngRatePDPopup").text("1 "+r+" = "+$("#CurrencyExRate").val()+" "+i),$("#lblExchangeChngRatePDPopup").css("visibility","visible"),$("#btnChangePerDiemReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRatePDPopup").css("visibility","hidden"),$("#btnChangePerDiemReportExchangeRate").css("visibility","hidden"))}),n.fail(function(){ShowAlertBox("Fail to get per diem information!")}))};AddExpenseReportsView.prototype.SetInvoiceNumberRequired=function(n){var t;n?($("#txtInvoiceReferenceNo").prop("required",!1),$("#lblReferenceNo").removeClass("required"),$("#fileUploadExpenseReceipt").prop("required",!1),$("#divModalRightSection").removeClass("divDottedBorderError")):$("#ddlExpenseType").val()!="Per Diem"&&($("#txtInvoiceReferenceNo").prop("required",!0),$("#lblReferenceNo").addClass("required"),($("#ExpenseReceiptAssetId").val()==""||$("#ExpenseReceiptAssetId").val()==undefined||$("#ExpenseReceiptAssetId").val()==0)&&$("#fileUploadExpenseReceipt").val()==""&&($("#fileUploadExpenseReceipt").prop("required",!0),$("#divModalRightSection").addClass("divDottedBorderError")));var i=$("#ddlExpenseCategory").find("option:selected").val(),u=$("#txtInvoiceReferenceNo").val(),f=$("#ddlMerchant").val(),r=$("#ddlExpenseType option:selected").text();r==="Mileage"&&(i="Fuel/Mileage Expenses");t=$("#ExpenseId").val();(t==undefined||t=="")&&(t=0);AddExpenseReportsView.prototype.ValidateInvoice(r,i,u,f,t)};AddExpenseReportsView.prototype.SetExpeExchangeAndConversionAmount=function(){var n=$("#ddlExpeCurrency").val(),t=$("#ddlReimburseCurrencyPopup").val(),i=$("#txtExpenseAmount").val(),r;parseFloat(i)>0?(r=GetCurrencyExchangeRate(n,t,1),$("#CurrencyExRate").val(parseFloat(r)),$("#txtReimburseAmountPopup").val((r*i).toFixed(2)),$("#txtReimburseAmountPopup").attr("originalValue",$("#txtReimburseAmountPopup").val()),$("#txtReimburseAmountPopup").closest(".form-group").removeClass("has-error has-danger"),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtReimburseAmountPopup").val(""));n!=t&&parseFloat(i)>0?($("#lblExchangeChngRatePopup").text("1 "+n+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblExchangeChngRatePopup").show(),$("#btnChangeExpenseReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRatePopup").hide(),$("#btnChangeExpenseReportExchangeRate").css("visibility","hidden"))};AddExpenseReportsView.prototype.LoadExpenseMileageSettings=function(){var n=$.get(baseURL+"Expense/LoadExpenseMileageSettings");n.done(function(n){$("#lblMileageSetting").text(n.mileageRatePerKM+" "+n.baseCurrency);$("#hdnMileageRate").val(n.mileageRatePerKM);$("#Currency").val(n.baseCurrency)});n.fail(function(){ShowAlertBox("Failed to get per mileage rate!")})};AddExpenseReportsView.prototype.CalculateMileageDistanceAmount=function(){var n=$("#txtMileageDistance").val(),i=$("#Currency").val(),r=$("#ddlMLGReimburseCurrency").val(),t=$("#hdnMileageRate").val(),u,f;$("#Amount").val(parseFloat(n*t));parseFloat(n*t)>0?(u=GetCurrencyExchangeRate(i,r,1),$("#CurrencyExRate").val(parseFloat(u)),f=(n*u*t).toFixed(2),$("#txtMLGReimburseAmount").val(f),$("#txtMLGReimburseAmount").attr("originalValue",$("#txtMLGReimburseAmount").val()),$("#txtMLGReimburseAmount").closest(".form-group").removeClass("has-error has-danger"),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtMLGReimburseAmount").val(""));i!=r&&parseFloat(n*t)>0?($("#lblExchangeChngRateMileage").text("1 "+i+" = "+$("#CurrencyExRate").val()+" "+r),$("#lblExchangeChngRateMileage").show(),$("#btnChangeMileageReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRateMileage").hide(),$("#btnChangeMileageReportExchangeRate").css("visibility","hidden"))};AddExpenseReportsView.prototype.SetPerDiemExchangeRateAmtFields=function(){var n=$("#ddlPerDiemCurrency").val(),t=$("#ReimburseCurrency").val();n===t?$("#divExchangeRate").hide():$("#divExchangeRate").show()};AddExpenseReportsView.prototype.GetPerDiemAmount=function(){var t=$("#ddlPerDiemRateList").val(),i=$("#txtDays").val(),n;t>0&&i>0&&(n=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:t,NoOfDays:i}),n.done(function(n){var t,i,r;$("#ddlPerDiemCurrency").val(n.currency).attr("selected","selected");$("#txtPerDiemAmount").val(n.amount);t=$("#ddlReimburseCurrencyPDPopup").val();i=n.currency;parseFloat(n.amount)>0?(r=GetCurrencyExchangeRate(i,t,1),$("#txtReimburseAmountPDPopup").val((r*n.amount).toFixed(2)),$("#txtReimburseAmountPDPopup").attr("originalValue",$("#txtReimburseAmountPDPopup").val()),$("#txtReimburseAmountPDPopup").closest(".form-group").removeClass("has-error has-danger"),$("#CurrencyExRate").val(parseFloat(r)),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtReimburseAmountPDPopup").val(""));i!=t&&parseFloat(n.amount)>0?($("#lblExchangeChngRatePDPopup").text("1 "+i+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblExchangeChngRatePDPopup").css("visibility","visible"),$("#btnChangePerDiemReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRatePDPopup").css("visibility","hidden"),$("#btnChangePerDiemReportExchangeRate").css("visibility","hidden"))}),n.fail(function(){ShowAlertBox("Fail to get per diem information!")}))};AddExpenseReportsView.prototype.GetPerDiemAmountByCountry=function(n){var i=n,r=$("#txtDays").val(),t;i>0&&r>0&&(t=$.get(baseURL+"Expense/LoadPerDiemAmount",{PerDiemRateId:i,NoOfDays:r}),t.done(function(n){var t,i,r;$("#ddlPerDiemCurrency").val(n.currency).attr("selected","selected");$("#txtPerDiemAmount").val(n.amount);t=$("#ddlReimburseCurrencyPDPopup").val();i=n.currency;parseFloat(n.amount)>0?(r=GetCurrencyExchangeRate(i,t,1),$("#txtReimburseAmountPDPopup").val((r*n.amount).toFixed(2)),$("#txtReimburseAmountPDPopup").attr("originalValue",$("#txtReimburseAmountPDPopup").val()),$("#txtReimburseAmountPDPopup").closest(".form-group").removeClass("has-error has-danger"),$("#CurrencyExRate").val(parseFloat(r)),$("#txtReasonForModifyingReimbursementAmount").val(""),$("#txtReasonForModifyingReimbursementAmount").prop("required",!1),$("#divReasonForModifyingReimbursementAmount").addClass("hidden")):($("#CurrencyExRate").val(0),$("#txtReimburseAmountPDPopup").val(""));i!=t&&parseFloat(n.amount)>0?($("#lblExchangeChngRatePDPopup").text("1 "+i+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblExchangeChngRatePDPopup").css("visibility","visible"),$("#btnChangePerDiemReportExchangeRate").css("visibility","visible")):($("#lblExchangeChngRatePDPopup").css("visibility","hidden"),$("#btnChangePerDiemReportExchangeRate").css("visibility","hidden"))}),t.fail(function(){ShowAlertBox("Fail to get per diem information!")}))};AddExpenseReportsView.prototype.SaveExpense=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/SaveExpense",data:n,contentType:!1,processData:!1,datatype:"json",type:"POST",async:!1})).then(function(n){t=n}),t};AddExpenseReportsView.prototype.SetFieldsBasedOnStatus=function(n){switch(n){case"Submitted":case"Approved":case"Reimbursed":$("#txtReportTitle").attr("readonly",!0);$("#FromDate").attr("readonly",!0);$("#ToDate").attr("readonly",!0);$("#txtBusinessPurpose").attr("readonly",!0);$("#btnUnreportedExpenses").hide();$("#btnUnreportedAdvPay").hide();$("#btnAddExpense").hide();$("#btnAddBulkExpense").hide();$("#btnAdvPayment").hide();break;default:$("#txtReportTitle").attr("readonly",!1);$("#FromDate").attr("readonly",!1);$("#ToDate").attr("readonly",!1);$("#txtBusinessPurpose").attr("readonly",!1);$("#btnUnreportedExpenses").show();$("#btnUnreportedAdvPay").show();$("#btnAddExpense").show();$("#btnAddBulkExpense").show();$("#btnAdvPayment").show()}};AddExpenseReportsView.prototype.IncludeExpense=function(n,t){$.ajax({type:"POST",url:baseURL+"Expense/IncludeExpense",async:!1,datatype:"json",data:{expId:n,expReportId:t},success:function(n){return n},error:function(){return!1}})};AddExpenseReportsView.prototype.LoadExpenseReportHistoryGrid=function(){var n=$("#ExpenseReportId").val(),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseReportHistory",dataType:"json",data:{expenseReportId:n}}},batch:!0,pageSize:5,schema:{model:{id:"expenseReportId",fields:{expenseReportId:{editable:!1},description:{editable:!1},datetime:{editable:!1}}}}});$("#ExpenseReportHistoryGrid").kendoGrid({dataSource:t,pageable:!0,columns:[{field:"expenseReportId",hidden:!0},{field:"description",width:"500px"},{field:"datetime",width:"200px",template:"#= kendo.toString(kendo.parseDate(datetime), 'dd MMM yyyy hh:mm tt') #"}]})};AddExpenseReportsView.prototype.LoadAddExpenseReportGrid=function(){function t(){setTimeout(function(){KGrdPageSizeDdlPosition("LoadAddExpenseReportGrid",0)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadReportExpenses",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{expenseReportId:$("#ExpenseReportId").val()}}},batch:!0,aggregate:[{field:"reimburseAmount",aggregate:"sum"}],pageSize:5,schema:{model:{id:"expenseIdHash",fields:{expenseIdHash:{editable:!1},expenseId:{editable:!1},reportReferenceId:{editable:!1},dateIncurred:{editable:!1,type:"date"},type:{editable:!1},description:{editable:!1},category:{editable:!1},merchant:{editable:!1},status:{editable:!1},amount:{editable:!1},currency:{editable:!1},isClaimReimbursement:{editable:!1},reimburseAmount:{editable:!1},reimburseCurrency:{editable:!1},expenseReceiptAssetId:{editable:!1},totalAdvanceAmt:{editable:!1},toDateIncurred:{editable:!1},country:{editable:!1}}}}});$("#LoadAddExpenseReportGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,dataBound:t,columns:[{field:"expenseIdHash",hidden:!0},{field:"isClaimReimbursement",hidden:!0},{field:"expenseId",hidden:!0},{field:"reportReferenceId",hidden:!0},{field:"isClaimReimbursement",hidden:!0},{field:"totalAdvanceAmt",hidden:!0,template:function(n){return n.totalAdvanceAmt},attributes:{"total-adv-amt":"Y"}},{field:"dateIncurred",title:"From Date",width:"70px",template:"#if(dateIncurred === null){# #}else{# #=kendo.toString(kendo.parseDate(dateIncurred), 'dd MMM yyyy')#  #}#"},{field:"toDateIncurred",title:"To Date",width:"70px",template:"#if(toDateIncurred === null){# #}else{# #=kendo.toString(kendo.parseDate(toDateIncurred), 'dd MMM yyyy')#  #}#"},{field:"type",title:"Type",width:"60px"},{field:"country",title:"Country",width:"60px"},{field:"category",title:"Category",width:"90px"},{field:"description",title:"Description",width:"120px"},{field:"amount",title:"Amount",width:"120px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #",footerTemplate:function(){return'<div class="div-wrapper"><div>Total Expense Amount<\/div><div>Non-Reimbursable Amount<\/div><div>Advance Amount<\/div><div class="show-line"><\/div><div>Reimbursable Amount<\/div><\/div>'}},{field:"reimburseAmount",headerTemplate:'<span id="lblHeaderAmt"><\/span>',width:"100px",template:"#= reimburseCurrency + ' ' + kendo.toString(reimburseAmount, 'n2') #",footerTemplate:function(n){var i=0,t=$('#LoadAddExpenseReportGrid td[total-adv-amt="Y"]:eq(0)');return i=t.html()!=""&&t.html()!=undefined&&t.html()!=null?parseFloat(t.html()).toFixed(2):0,"<div class='div-wrapper'><div><b>"+kendo.toString(n.reimburseAmount.sum,"n2")+"<\/b><\/div><div>(-) "+kendo.toString(conditionalSum("#LoadAddExpenseReportGrid"),"n2")+"<\/div><div>(-) "+kendo.toString(i,"n2")+"<\/div><div class='show-line'><\/div><div>"+kendo.toString(n.reimburseAmount.sum-(conditionalSum("#LoadAddExpenseReportGrid")+parseFloat(i)),"n2")+"<\/div><\/div>"}},{field:"",title:"",width:"60px",template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?'<div class="pointer text-success" > <strong> '+n.status+"<\/strong> <\/div>":'<div class="pointer text-danger"><strong> '+n.status+"<\/strong><\/div>"}},{field:"",title:"",width:"30px",template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?"":(n.isFirstPartiallyApproval&&n.firstApprovalStatus=="Pending"||n.isSecondPartiallyApproval&&n.secondApprovalStatus=="Pending")&&n.status==="Rejected"||$("#Status").val().toUpperCase()==="REJECTED"||n.status==="Unsubmitted"?'<div class="pointer" title="Edit Expense" onclick="EditExpenseFromReport(\''+n.expenseId+"','"+n.type+'\')"><img src="'+baseURL+'images/edit.png" class="img-responsive" /><\/div>':""}},{field:"",title:"",width:"30px",template:function(n){return n.status==="Submitted"||n.status==="Approved"||n.status==="Reimbursed"?"":(n.isFirstPartiallyApproval&&n.firstApprovalStatus=="Pending"||n.isSecondPartiallyApproval&&n.secondApprovalStatus=="Pending")&&n.status==="Rejected"||$("#Status").val().toUpperCase()==="REJECTED"||n.status==="Unsubmitted"?'<div class="pointer" title="Exclude expense" onclick="excludeExpense(\''+n.expenseId+'\')"><img src="'+baseURL+'images/close.png" class="img-responsive" /><\/div>':""}},{field:"",title:"",width:"30px",template:function(n){return($("#LoadAddExpenseReportGrid").find("#lblHeaderAmt").html()==""&&$("#LoadAddExpenseReportGrid").find("#lblHeaderAmt").html("Amount ("+n.reimburseCurrency+")"),n.expenseReceiptAssetId!=null&&n.expenseReceiptAssetId>0)?"<div class='pointer' title='Download Attachment'><a href='"+baseURL+"Asset/Download/"+n.expenseReceiptAssetId+"'><img src='"+baseURL+"images/attached.png' class='img-responsive'/><\/a><\/div>":""}},{field:"",title:"",width:"30px",template:function(n){return'<div class="pointer" title="Expense details" onclick="OpenExpenseDetailsFromReportApproval(\''+n.expenseId+"','"+n.type+'\')"><img src="'+baseURL+'images/info_line.png" class="img-responsive" /><\/div>'}}]})};AddExpenseReportsView.prototype.SetStatusColor=function(n){switch(n.toLowerCase()){case"submitted":$("#DivReportStatus").removeClass("div-danger").removeClass("div-btnSuccess").removeClass("div-btnReim").removeClass("div-btnSuccess").addClass("div-btnDefault");break;case"approved":$("#DivReportStatus").removeClass("div-btnDefault").removeClass("div-btnSuccess").removeClass("div-danger").removeClass("div-btnReim").addClass("div-btnSuccess");break;case"reimbursed":$("#DivReportStatus").removeClass("div-btnDefault").removeClass("div-btnSuccess").removeClass("div-danger").removeClass("div-btnSuccess").addClass("div-btnReim")}};AddExpenseReportsView.prototype.LoadAdvancePaymentGrid=function(){function t(){setTimeout(function(){$("#AdvancePaymentGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Advance Payment");$("#AdvancePaymentGrid .k-i-close").removeClass("k-icon k-i-close");KGrdPageSizeDdlPosition("AdvancePaymentGrid",1)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadReportAdvancePayments",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{expenseReportId:$("#ExpenseReportId").val()}}},batch:!0,pageSize:10,scrollable:!0,schema:{model:{id:"expenseAdvPaymentId",fields:{expenseAdvPaymentId:{editable:!1},companyId:{editable:!1},employeeId:{editable:!1},date:{editable:!1},referenceNo:{editable:!1},recordedBy:{editable:!1},amount:{editable:!1},currency:{editable:!1},reportStatus:{editable:!1},reimburseAmount:{editable:!1},reimburseCurrency:{editable:!1}}}}});$("#AdvancePaymentGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,editable:"inline",dataBound:t,columns:[{field:"expenseAdvPaymentId",hidden:!0},{field:"date",title:"Date",width:"110px",template:"#= kendo.toString(kendo.parseDate(date), 'dd MMM yyyy') #"},{field:"referenceNo",title:"Ref #",width:"100px"},{field:"recordedBy",title:"Recorded By",width:"140px"},{field:"amount",title:"Amount",width:"110px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #"},{field:"reimburseAmount",headerTemplate:'<span id="lblHeaderAmt"><\/span>',width:"60px",template:"#= reimburseCurrency + ' ' + kendo.toString(reimburseAmount, 'n2') #"},{field:"",title:"",width:"30px",template:function(n){return $("#AdvancePaymentGrid").find("#lblHeaderAmt").html()==""&&$("#AdvancePaymentGrid").find("#lblHeaderAmt").html("Amount ("+n.reimburseCurrency+")"),n.reportStatus==="Submitted"||n.reportStatus==="Approved"||n.reportStatus==="Reimbursed"?"":'<div class="pointer" title="Edit Adavnce Payment" onclick="EditAdvancedPayments(\''+n.expenseAdvPaymentId+'\')"><img src="'+baseURL+'images/edit.png" class="img-responsive" /><\/div>'}},{field:"",title:"",width:"30px",template:function(n){return n.reportStatus==="Submitted"||n.reportStatus==="Approved"||n.reportStatus==="Reimbursed"?"":'<div class="pointer" title="Exclude Advance Payment" onclick="ExcludeAdvancedPayment(\''+n.expenseAdvPaymentId+'\')"><img src="'+baseURL+'images/close.png" class="img-responsive" /><\/div>'}}]})};AddExpenseReportsView.prototype.AdvancePaymentPopupClearFields=function(){$("#ddlAdvPmtPopupCurrency").val("");$("#txtAdvPmtPopupAmount").val("");$("#txtAdvPmtPopupReimburseAmt").val("");$("#txtRef").val("");$("#txtNote").val("");$("#ddlAdvPaymentPaidThrough").val("");$("#ddladavancePaymentDate").datepicker("setDate","");$("#CurrencyExRate").val("")};AddExpenseReportsView.prototype.AdvPmtExchangeAmtToRemiburseCurrency=function(){var n=$("#ddlAdvPmtPopupCurrency").val(),t=$("#ddlAdvPmtPopupReimburseCurr").val(),i=$("#txtAdvPmtPopupAmount").val(),r;parseFloat(i)>0?(r=GetCurrencyExchangeRate(n,t,1),$("#CurrencyExRate").val(parseFloat(r)),$("#txtAdvPmtPopupReimburseAmt").val((r*i).toFixed(2))):($("#CurrencyExRate").val(0),$("#txtAdvPmtPopupReimburseAmt").val(""));n!=t&&parseFloat(i)>0?($("#lblAdvPmtPopupExchangeRate").text("1 "+n+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblAdvPmtPopupExchangeRate").css("visibility","visible")):$("#lblAdvPmtPopupExchangeRate").css("visibility","hidden")};AddExpenseReportsView.prototype.SaveAdvancePayment=function(n){var i=n.ExpenseAdvPaymentId>0?!0:!1,t=$.post(baseURL+"Expense/AddRecordAdvancePayment",n);t.done(function(){$("#recordAdvancePaymentModal").modal("hide");i?ShowAlertBox("Advance Payment Updated!"):ShowAlertBox("Advance Payment Added!");var n=$("#hdnExpenseReportIdHash").val();window.location.href=baseURL+"Expense/AddExpenseReport?expenseReportIdHash="+encodeURIComponent(n)});t.fail(function(){ShowAlertBox("Fail to save Advance Payment!")})};AddExpenseReportsView.prototype.LoadIncludeExpenseGrid=function(){function t(){setTimeout(function(){$("#IncludeExpensesGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("IncludeExpensesGrid")});KGrdPageSizeDdlPosition("IncludeExpensesGrid",2)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadUnreportedExpenses",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{Expense:kendo.stringify(n.models)}}},batch:!0,pageSize:5,schema:{model:{id:"expenseId",fields:{expenseId:{editable:!1},dateIncurred:{editable:!1,type:"date"},type:{editable:!1},category:{editable:!1},merchant:{editable:!1},status:{editable:!1},amount:{editable:!1},currency:{editable:!1}}}}});$("#IncludeExpensesGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.expenseId#" class="chk-box"><label class="checkbox-inline" for="#:data.expenseId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-expense" class="checkAll"><label class="checkbox-inline" for="header-chk-expense"><\/label>',width:40},{field:"expenseId",hidden:!0},{field:"dateIncurred",title:"Date",width:"110px",template:"#= kendo.toString(kendo.parseDate(dateIncurred), 'dd MMM yyyy') #"},{field:"type",title:"Type",width:"100px"},{field:"category",title:"Category",width:"130px"},{field:"merchant",title:"Merchant",width:"110px"},{field:"status",title:"Status",width:"110px"},{field:"amount",title:"Amount",width:"100px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #"}],dataBound:t,dataBinding:function(){$("#IncludeExpensesGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#IncludeExpensesGrid tbody input:checkbox").prop("checked",this.checked)})};AddExpenseReportsView.prototype.ApplyAdvancePayment=function(n,t){$.ajax({type:"POST",url:baseURL+"Expense/ApplyAdvancePayment",async:!1,datatype:"json",data:{expenseAdvPaymentId:n,expReportId:t},success:function(){return!0},error:function(){return ShowAlertBox("Fail to Apply Apply AdvancePayment!"),!1}})};AddExpenseReportsView.prototype.LoadApplyAdvancePaymentGrid=function(){function t(){setTimeout(function(){$("#ApplyAdvancePaymentGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("ApplyAdvancePaymentGrid")})},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadUnreportedAdvancePayments",dataType:"json"}},batch:!0,pageSize:5,schema:{model:{id:"expenseAdvPaymentId",fields:{expenseAdvPaymentId:{editable:!1},date:{editable:!1},referenceNo:{editable:!1},amount:{editable:!1},currency:{editable:!1}}}}});$("#ApplyAdvancePaymentGrid").kendoGrid({dataSource:n,pageable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.expenseAdvPaymentId#" class="chk-box"><label class="checkbox-inline" for="#:data.expenseAdvPaymentId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-pmt" class="checkAll"><label class="checkbox-inline" for="header-chk-pmt"><\/label>',width:40},{field:"expenseAdvPaymentId",hidden:!0},{field:"date",title:"Date",width:"110px",template:"#= kendo.toString(kendo.parseDate(date), 'dd MMM yyyy') #"},{field:"referenceNo",title:"REF#",width:"100px"},{field:"amount",title:"Amount",width:"100px"}],dataBound:t,dataBinding:function(){$("#ApplyAdvancePaymentGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#ApplyAdvancePaymentGrid tbody input:checkbox").prop("checked",this.checked)})};AddExpenseReportsView.prototype.ShowHideControls=function(n){n=="Expense"?($("#RowReimbursement").css("padding-top","1px"),$("#ddlMileageCategory").val("Select Catagory"),$("#ddlPerDiemRateList").val("Select Per Diem Rate"),$("#ddlPerDiemCurrency").val("Select Currency"),$("#ddlVehicle").val("Select Vehicle"),$("#txtDays, #txtPerDiemAmount").val(""),$("#txtMileageDistance, #txtMLGReimburseAmount, #txtReimburseAmountPDPopup ").val(""),$("#lblExchangeChngRatePDPopup").text(""),$("#RowMileageSect, #RowMileageSectVehicle, #RowMileageSectCal, #RowReading, #RowPerDiemRate, #divPerDiemCurrAmt, #RowDistance, #divPerDiemReimCurrAmt").addClass("hidden"),$("#RowExpensSect, #RowExpenseSectCategory, #RowExpenseSectAmt, #RowExMiItemized, #RowReimbursement, #divAdvExpenseDtToDateIncurred, #RowExpensSectCountry, #RowExpensSectMerchant").removeClass("hidden"),$("#lblFromDate").text("From Date")):n=="Mileage"?($("#RowReimbursement").css("padding-top","10px"),$("#ddlMileageCategory").val("Fuel/Mileage Expenses"),$("#ddlPerDiemRateList").val("Select Per Diem Rate"),$("#ddlPerDiemCurrency").val("Select Currency"),$("#ddlExpenseCategory").val("Select Catagory"),$("#ddlExpenseCurrency").val("Select Currency"),$("#ddlMileageCategory").attr("disabled",!0),$("#txtDays, #txtPerDiemAmount, #txtExpenseAmount, #txtReimburseAmountPopup, #txtReimburseAmountPDPopup, #ddlMerchant").val(""),$("#lblExchangeChngRatePopup, #lblExchangeChngRatePDPopup, #lblExchangeChngRateMileage").text(""),$("#RowMileageSect, #RowMileageSectVehicle, #RowMileageSectCal, #RowExMiItemized, #RowDistance").removeClass("hidden"),$("#RowExpensSect, #RowExpenseSectCategory, #RowExpenseSectAmt, #RowReading, #RowPerDiemRate, #RowReimbursement, #divPerDiemCurrAmt, #divPerDiemReimCurrAmt, #divAdvExpenseDtToDateIncurred, #RowExpensSectCountry, #RowExpensSectMerchant").addClass("hidden"),$("#ddlExpenseReportCountry").val("Select Currency"),$("#AdvExpenseDtToDateIncurred").val(""),$("#lblFromDate").text("Date"),AddExpenseReportsView.prototype.ShowControlByrbdCalculateMileage()):n=="Per Diem"&&($("#RowReimbursement").css("padding-top","10px"),$("#ddlMileageCategory").val("Per Diem"),$("#ddlVehicle").val("Select Vehicle"),$("#ddlExpenseCurrency").val("Select Currency"),$("#ddlMileageCategory").attr("disabled",!0),$("#ddlExpenseCategory").val("Select Catagory"),$("#txtExpenseAmount, #txtMileageDistance, #txtMLGReimburseAmount, #txtReimburseAmountPopup, #ddlMerchant").val(""),$("#lblExchangeChngRatePopup").text(""),$("#RowPerDiemRate, #RowMileageSect, #divPerDiemCurrAmt, #divPerDiemReimCurrAmt, #divAdvExpenseDtToDateIncurred, #RowExpensSect, #RowExpensSectCountry").removeClass("hidden"),$(" #RowExpenseSectAmt, #RowReading, #RowMileageSectCal, #RowMileageSectVehicle, #RowExpenseSectCategory, #RowDistance, #RowReimbursement, #RowExpensSectMerchant").addClass("hidden"),$("#lblFromDate").text("From Date"))};AddExpenseReportsView.prototype.EnableAllFields=function(){$("#ddlExpenseType, #txtMileageDistance").attr("disabled",!1);$("#txtMLGReimburseAmount, #txtReimburseAmountPopup,#txtReimburseAmountPDPopup ").attr("disabled",!1);$("#ddlExpenseCategory, #AdvExpenseDt, #ddlExpeCurrency, #txtExpenseAmount").attr("disabled",!1);$("#ddlMileageCategory, #txtStartReading, #txtEndReading, #rdnDistanceTraveled, #rdnOdometerReading").attr("disabled",!1);$("#txtInvoiceReferenceNo, #ddlVehicle, #ddlMerchant, #txtDesc").attr("disabled",!1);$("#ddlPerDiemRateList, #ddlPerDiemCurrency, #txtPerDiemAmount, #txtDays").attr("disabled",!1);$("#chkClmReimburseDiem, #chkclmReimbursement, #chkInvoiceNotAvailable, #chkclmReimburseForMileage").attr("disabled",!1);$("#linkAddExpenseMerchant, #linkAddMileageVehicle").removeClass("disabledDiv");$("#lblExchangeChngRatePopup, #lblExchangeChngRatePDPopup, #lblExchangeChngRateMileage").attr("disabled",!1);$("#btnChangePerDiemReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangeExpenseReportExchangeRate").removeClass("disabledDiv");$("#txtReasonForModifyingReimbursementAmount, #fileUploadExpenseReceipt").attr("disabled",!1);$("#ddlExpenseReportCountry, #AdvExpenseDtToDateIncurred").attr("disabled",!1);$("#btnSaveExpense").css("visibility","visible");$("#divRejectionReason").addClass("hidden")};AddExpenseReportsView.prototype.ClearFields=function(){$("#ExpenseId").val("");$("#lblExchangeChngRatePopup, #lblExchangeChngRatePDPopup").text("");$("#ddlExpenseType").val("Expense");$("#ddlMileageCategory, #ddlExpenseCategory, #ddlVehicle, #ddlMerchant, #ddlPerDiemRateList, #ddlExpenseReportCountry").val("");$("#btnChangeExpenseReportExchangeRate, #btnChangeMileageReportExchangeRate, #btnChangePerDiemReportExchangeRate").css("visibility","hidden");$("#chkClmReimburseDiem, #chkclmReimburseForMileage").prop("checked",!1);$("#chkclmReimbursement").prop("checked",!0);$("#fileUploadExpenseReceipt").val(null);$("#imgExpenseReceipt").attr("src",baseURL+"images/receipt.png");$("#lnkReceiptDoc").val("");$("#lnkReceiptDoc").addClass("hide-span");$("#txtDays, #txtInvoiceReferenceNo, #txtPerDiemAmount, #txtExpenseAmount, #txtMileageDistance, #txtMLGReimburseAmount, #AdvExpenseDt, #txtDesc, #txtStartReading, #txtEndReading, #txtReimburseAmountPopup, #txtReimburseAmountPopup, #txtReimburseAmountPDPopup, #lblExchangeChngRatePopup, #lblExchangeChngRatePDPopup, #AdvExpenseDtToDateIncurred").val("");$("#ExpenseReceiptAssetId").val("");$("#EmployeeAssetId").val("");$("#chkInvoiceNotAvailable").removeAttr("checked")};AddExpenseReportsView.prototype.SetExpenseReportCurrencybyCountry=function(){var t=$("#ddlExpenseReportCountry").val(),n;t!=""&&(n=$.get(baseURL+"Expense/LoadCurrencyByCounty",{countryName:t}),n.done(function(n){n!=null&&($("#ddlExpeCurrency").val(n.currency).attr("selected","selected"),$("#txtExpenseAmount").val(""),$("#txtReimburseAmountPopup").val(""))}),n.fail(function(){ShowAlertBox("Fail to get expense currency information!")}))};AddExpenseReportsView.prototype.SetRequiredFields=function(n){var t=$("#datePickerExpense").datepicker("getDate"),i;if(n=="Expense")$("#ddlExpenseCategory, #ddlMerchant, #ddlExpeCurrency, #txtExpenseAmount, #txtReimburseAmountPopup, #ddlReimburseCurrencyPopup, #AdvExpenseDtToDateIncurred, #ddlExpenseReportCountry").prop("required",!0),$("#ddlPerDiemRateList, #txtDays, #ddlPerDiemCurrency, #txtPerDiemAmount").prop("required",!1),$("#chkClmReimburseDiem, #chkclmReimburseForMileage").prop("checked",!1),$("#chkclmReimbursement").prop("checked",!0),$("#ddlMileageCategory, #ddlVehicle, #txtMileageDistance, #ddlMLGReimburseCurrency, #txtMLGReimburseAmount, #txtStartReading, #txtEndReading, #ddlReimburseCurrencyPDPopup, #txtReimburseAmountPDPopup").prop("required",!1),t!=null&&($("#datePickerExpenseToDateIncurred").datepicker("setStartDate",new Date(t.valueOf())),$("#datePickerExpenseToDateIncurred").datepicker("setDate",null));else if(n=="Mileage")$("#ddlMileageCategory, #ddlVehicle, #txtMileageDistance, #ddlMLGReimburseCurrency, #txtMLGReimburseAmount").prop("required",!0),AddExpenseReportsView.prototype.ShowControlByrbdCalculateMileage(),$("#ddlExpenseCategory, #ddlMerchant, #ddlExpeCurrency, #txtExpenseAmount, #txtReimburseAmountPopup, #ddlReimburseCurrencyPopup, #ddlReimburseCurrencyPDPopup, #txtReimburseAmountPDPopup, #AdvExpenseDtToDateIncurred, #ddlExpenseReportCountry").prop("required",!1),$("#ddlPerDiemRateList, #txtDays, #ddlPerDiemCurrency, #txtPerDiemAmount").prop("required",!1),$("#chkClmReimburseDiem, #chkclmReimbursement").prop("checked",!1),$("#chkclmReimburseForMileage").prop("checked",!0),t!=null&&($("#datePickerExpenseToDateIncurred").datepicker("setStartDate",new Date(t.valueOf())),$("#datePickerExpenseToDateIncurred").datepicker("setDate",null));else if(n=="Per Diem"&&($("#ddlPerDiemRateList, #txtDays, #ddlPerDiemCurrency, #txtPerDiemAmount, #ddlReimburseCurrencyPDPopup, #txtReimburseAmountPDPopup, #AdvExpenseDtToDateIncurred, #ddlExpenseReportCountry").prop("required",!0),$("#ddlMileageCategory, #ddlVehicle, #txtMileageDistance, #ddlMLGReimburseCurrency, #txtMLGReimburseAmount, #txtStartReading, #txtEndReading").prop("required",!1),$("#chkClmReimburseDiem").prop("checked",!0),$("#chkclmReimburseForMileage, #chkclmReimbursement").prop("checked",!1),$("#ddlExpenseCategory, #ddlMerchant, #ddlExpeCurrency, #txtExpenseAmount, #txtReimburseAmountPopup, #ddlReimburseCurrencyPopup").prop("required",!1),i=$("#datePickerExpenseToDateIncurred").datepicker("getDate"),t!=null&&i!=null&&i.valueOf()==t.valueOf())){$("#datePickerExpenseToDateIncurred").datepicker("setDate","");ShowMessageBox("Warning!!!","Per-Diem claims are not permitted when From Date is same as To Date","300px");$("#txtDays").val("");return}};AddExpenseReportsView.prototype.ShowControlByrbdCalculateMileage=function(){var n=$("#rdnOdometerReading").prop("checked");n?($("#RowReading").removeClass("hidden"),$("#txtMileageDistance").prop("disabled",!0),$("#txtMileageDistance").closest(".form-group").removeClass("has-error has-danger"),$("#txtStartReading, #txtMLGReimburseAmount, #txtEndReading, #txtMileageDistance, #DistanceHidden").val(""),$("#txtEndReading, #txtStartReading").prop("required",!0)):($("#RowReading").addClass("hidden"),$("#txtMileageDistance").prop("disabled",!1),$("#txtStartReading, #txtMLGReimburseAmount, #txtEndReading, #txtMileageDistance, #DistanceHidden").val(""),$("#txtEndReading, #txtStartReading").prop("required",!1))};AddExpenseReportsView.prototype.CalculateNoDays=function(){var n=kendo.toString(kendo.parseDate($("#datePickerExpense").datepicker("getDate")),"MM-dd-yyyy"),t=kendo.toString(kendo.parseDate($("#datePickerExpenseToDateIncurred").datepicker("getDate")),"MM-dd-yyyy"),i;n!=null&&t!=null&&(i=objThis.daydiff(objThis.parseDate(n),objThis.parseDate(t)),$("#txtDays").val(i))};AddExpenseReportsView.prototype.parseDate=function(n){var t;return n.indexOf("-")?(t=n.split("-"),new Date(t[2],t[0]-1,t[1])):(t=n.split("/"),new Date(t[2],t[0]-1,t[1]))};AddExpenseReportsView.prototype.daydiff=function(n,t){return(t-n)/864e5};AddExpenseReportsView.prototype.GetPerDiemRateByCountry=function(){if($("#ddlExpenseReportCountry").val()!=""){var t=$("#ddlExpenseReportCountry").val(),i=$("#ddlReimburseCurrencyPDPopup").val(),n=$.get(baseURL+"Expense/LoadPerDiemAmountByCountry",{country:t,currency:i});n.done(function(n){$("#ddlPerDiemRateList").val(n).attr("selected","selected");AddExpenseReportsView.prototype.GetPerDiemAmountByCountry(n)});n.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}};AddExpenseReportsView.prototype.HideShowValidatePerdiemControls=function(){if($("#ddlExpenseType").val()=="Per Diem")$("#txtRef").prop("required",!1),$("#fileUploadExpenseReceipt").prop("required",!1),$("#divExpenseInvoiceAttachment").addClass("hidden"),$("#divExpenseInvoiceAttachment").removeClass("col-md-4"),$("#divExpenseReportMainDiv").removeClass("col-md-8"),$("#divExpenseReportMainDiv").addClass("col-md-12"),$("#divExpenseInvoiceNumber").addClass("hidden"),$("#txtInvoiceReferenceNo").prop("required",!1),$("#fileUploadExpenseReceipt").prop("required",!1);else{$("#divExpenseInvoiceAttachment").removeClass("hidden");$("#divExpenseInvoiceAttachment").addClass("col-md-4");$("#divExpenseReportMainDiv").removeClass("col-md-12");$("#divExpenseReportMainDiv").addClass("col-md-8");$("#divExpenseInvoiceNumber").removeClass("hidden");var n=$("#chkInvoiceNotAvailable").is(":checked");n!=undefined&&n&&($("#txtInvoiceReferenceNo").prop("required",!0),$("#fileUploadExpenseReceipt").prop("required",!0))}};AddExpenseReportsView.prototype.ValidateInvoice=function(n,t,i,r,u){var f=ValidateReferenceNumber(n,t,i,r,u);f&&($("#txtInvoiceReferenceNo").val(""),$("#fileUploadExpenseReceipt").val(""),ShowAlertBox("Invoice number already exists!"))};AddExpenseReportsView.prototype.LoadPerdiemRateDetailsByCountrySpecific=function(){var t;if($("#ddlExpenseReportCountry").val()!=""){var i=$("#ddlExpenseReportCountry").val(),r=$("#ddlReimburseCurrencyPDPopup").val(),n=$("#ExpenseId").val(),u=$("#ddlPerDiemRateList");n==""&&(n=0);t=$.get(baseURL+"Expense/LoadPerdiemRateByCountry",{country:i,currency:r,expenseId:n,reportId:0});t.done(function(n){$("#ddlPerDiemRateList").empty();$.each(n,function(n,t){$("<option>").val(t.value).text(t.text).appendTo("#ddlPerDiemRateList");$("#ddlPerDiemRateList").val(t.value).attr("selected",!0)})});t.fail(function(){ShowAlertBox("Fail to get per diem information by country!")})}};MyApprovalsView.prototype.Init=function(){var n=this;$("#ddlReportStatus option[value='Submitted']").remove();$("#datePickerFrom, #datePickerTo").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#dtBulkReimbursedOn").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0});ShowHideDropDownOption("ddlReportStatus","Draft",!0);ShowHideDropDownOption("ddlReportStatus","Recalled",!0);$('#dtFrom option[value=""], #dtTo option[value=""]').attr("selected",!0);this.LoadMyApprovalsReportGrid();n.HideGridColumn();$("#ddlReportStatus").change(function(){refreshGrid($("#MyApprovalsReportGrid"));n.FilterReportListGrid()});$("#dtFrom, #dtTo").change(function(){n.FilterReportListGrid()});$("#btnBulkApproveReport").click(function(t){var r;if(t.preventDefault(),r=$("#MyApprovalsReportGrid tbody").find("input:checked").length,r<=0){ShowAlertBox("Please select report(s) to approve");return}var u=!1,i=[],f=ShowConfirmationAlertBox("Do you want to approve selected report(s)?");f.then(function(){$("#MyApprovalsReportGrid tbody").find("input:checked").each(function(){var t=$("#MyApprovalsReportGrid").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.status.toUpperCase()=="AWAITING APPROVAL"||t.status.toUpperCase()=="REJECTED"?t.awaitingFromUserId==t.userId||t.isAdminAccess==!0?(u=n.ApproveExpenseReport(this.id,t.isAdminAccess),u?i.push(t.reportNumber+" - Report approved successfully"):i.push(t.reportNumber+" - Error while approving report")):i.push(t.reportNumber+" - Report assigned to another user"):i.push(t.reportNumber+" - Only submitted/rejected reports can be approved"))});ShowSummaryBox("Bulk Approve Summary",i);refreshGrid($("#MyApprovalsReportGrid"))})});$("#btnBulkReimburseReport").click(function(n){if(n.preventDefault(),$("#MyApprovalsReportGrid tbody").find("input:checked").length<=0){ShowAlertBox("Please select report(s) to reimburse");return}var t=0,i=0,r="";$("#MyApprovalsReportGrid tbody").find("input:checked").each(function(){var n=$("#MyApprovalsReportGrid").data("kendoGrid").dataSource.get(this.id);n!=null&&n!=undefined&&(t+=parseFloat(n.reimbursableAmount),r=n.currency,i++)});$("#dtBulkReimburseOn, #ddlBulkPaidThrough, #txtBulkReferenceNo, #txtBulkNote").val("");$("#lblTotalReports, #lblBulkReimburseAmt").text("");$("#lblTotalReports").text("(for "+i+" reports)");$("#lblBulkReimburseAmt").text(r+" "+t);$("#BulkReimbursementPopup").modal()});$("#frmBulkReimburseReport").submit(function(t){var r,i;t.preventDefault();var u=$("#ddlBulkPaidThrough").val(),f=$("#dtBulkReimburseOn").val(),e=$("#txtBulkReferenceNo").val(),o=$("#txtBulkNote").val();f!==""&&u!==""&&e!==""&&(r=!1,i=[],$("#MyApprovalsReportGrid tbody").find("input:checked").each(function(){var t=$("#MyApprovalsReportGrid").data("kendoGrid").dataSource.get(this.id),s;t!=null&&t!=undefined&&(t.status.toUpperCase()=="APPROVED"?(s={ExpenseReportId:t.expenseReportId,EmployeeId:0,Amount:t.reimbursableAmount,PaidThrough:u,ReimbursedOn:f,Ref:e,Notes:o},r=n.ReimburseExpenseReport(s),r?i.push(t.reportNumber+" - Report reimbursed successfully"):i.push(t.reportNumber+" - Error while reimbursing report")):t.status.toUpperCase()=="REIMBURSED"?i.push(t.reportNumber+" - This report has been already reimbursed"):i.push(t.reportNumber+" - Only approved reports can be reimbursed"))}),ShowSummaryBox("Bulk Reimburse Summary",i),$("#BulkReimbursementPopup").modal("toggle"),refreshGrid($("#MyApprovalsReportGrid")))});$("#btnBulkRejectReport").click(function(n){if(n.preventDefault(),$("#MyApprovalsReportGrid tbody").find("input:checked").length<=0){ShowAlertBox("Please select report(s) to reject");return}$("#txtRptRejectionReason").val("");$("#ReportRejectPopup").modal()});$("#frmRejectExpReport").submit(function(t){var i;t.preventDefault();var r=!1,f=$("#MyApprovalsReportGrid tbody").find("input:checked").length,u=$("#txtRptRejectionReason").val();u!==""&&(i=[],$("#MyApprovalsReportGrid tbody").find("input:checked").each(function(){var t=$("#MyApprovalsReportGrid").data("kendoGrid").dataSource.get(this.id);t!=null&&t!=undefined&&(t.status.toUpperCase()=="AWAITING APPROVAL"||t.status.toUpperCase()=="APPROVED"?t.awaitingFromUserId==t.userId||t.status.toUpperCase()=="AWAITING APPROVAL"||t.isAdminAccess==!0?(r=n.RejectExpenseReport(this.id,u),r?i.push(t.reportNumber+" - Report has been rejected"):i.push(t.reportNumber+" - Error while rejecting report")):i.push(t.reportNumber+" - Report assigned to another user"):i.push(t.reportNumber+" - Only submitted/approved reports can be reject"))}),ShowSummaryBox("Bulk Reject Summary",i),$("#ReportRejectPopup").modal("toggle"),refreshGrid($("#MyApprovalsReportGrid")))})};MyApprovalsView.prototype.FilterReportListGrid=function(){var i=$("#ddlReportStatus option:selected").val(),n=GetDateInFormat($("#dtFrom").val(),"yyyy-MM-ddT00:00:00"),t=GetDateInFormat($("#dtTo").val(),"yyyy-MM-ddT00:00:00");doApplyGridFilter("MyApprovalsReportGrid","eq","status",i==""?0:i.toLowerCase());doApplyGridFilter("MyApprovalsReportGrid","gte","startDate",n==""||n==null?0:n);doApplyGridFilter("MyApprovalsReportGrid","lte","endDate",t==""||t==null?0:t)};MyApprovalsView.prototype.LoadMyApprovalsReportGrid=function(){function t(){setTimeout(function(){$("#MyApprovalsReportGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("MyApprovalsReportGrid")});$("#MyApprovalsReportGrid tbody tr").on("dblclick",function(){var t=$("#MyApprovalsReportGrid").data("kendoGrid"),n=t.dataItem(t.select());n!=null&&n!=undefined&&n.expenseReportIdHash!=0&&ViewReportApprovalPage(n.expenseReportIdHash,n.isAdminAccess)});KGrdPageSizeDdlPosition("MyApprovalsReportGrid")},1)}function i(n){switch(n){case"Submitted (Pending Finance Approval)":case"Submitted (Pending Secondary Approval)":case"Submitted (Pending Primary Approval)":case"Awaiting Approval":color="blue";break;case"Approved":color="green";break;case"Partially Primary Approved":case"Partially Finance Approved":case"Partially Secondary Approved":case"Rejected":color="red";break;case"Reimbursed":color="green";break;default:return n}return"<font color='"+color+"'>"+n+"<\/font>"}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseReportsForApproval",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{isLoadAll:$("#isLoadAllReports").val(),status:$("#ddlReportStatus").val()}}},batch:!0,scrollable:!0,pageSize:10,schema:{model:{id:"expenseReportId",fields:{expenseReportId:{editable:!1},expenseReportIdHash:{editable:!1},awaitingFromUserId:{editable:!1},userId:{editable:!1},isAdminAccess:{editable:!1},reportNumber:{editable:!1},reportTitle:{editable:!1},startDate:{editable:!1},endDate:{editable:!1},status:{editable:!1},submittedBy:{editable:!1},approver:{editable:!1},submittedOn:{editable:!1},amount:{editable:!1},reimbursableAmount:{editable:!1},currency:{editable:!1}}}}});$("#MyApprovalsReportGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,selectable:"row",columns:[{template:'<input type="checkbox" id="#:data.expenseReportId#" class="chk-box"><label class="checkbox-inline" for="#:data.expenseReportId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-rpt" class="checkAll"><label class="checkbox-inline" for="header-chk-rpt"><\/label>',width:40},{field:"expenseReportIdHash",hidden:!0},{field:"userId",hidden:!0},{field:"awaitingFromUserId",hidden:!0},{field:"isAdminAccess",hidden:!0},{field:"reimbursableAmount",hidden:!0},{field:"reportNumber",title:"Report Number",width:"10%"},{field:"reportTitle",title:"Report Title",width:"20%"},{field:"startDate",title:"Start Date",width:"10%",template:"#= kendo.toString(kendo.parseDate(startDate), 'dd MMM yyyy') #"},{field:"endDate",title:"End Date",width:"10%",template:"#= kendo.toString(kendo.parseDate(endDate), 'dd MMM yyyy') #"},{field:"status",title:"Status",width:"10%",template:function(n){return i(n.status)}},{field:"submittedBy",title:"Submitted By",width:"10%"},{field:"approver",title:"Approver",width:"10%"},{field:"submittedOn",title:"Sumbitted On",width:"10%",template:"#if(submittedOn === null){#  N/A #}else{# #=kendo.toString(kendo.parseDate(submittedOn), 'dd MMM yyyy')#  #}#"},{title:"Amount",width:"110px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #"},],dataBound:t,dataBinding:function(){$("#MyApprovalsReportGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change","#header-chk-rpt",function(){$("#MyApprovalsReportGrid tbody input:checkbox").prop("checked",this.checked)})};MyApprovalsView.prototype.HideGridColumn=function(){var n=!1,t=$("#MyApprovalsReportGrid").data("kendoGrid");n=JSON.parse($("#isLoadAllReports").val());n?t.showColumn("approver"):t.hideColumn("approver")};MyApprovalsView.prototype.ApproveExpenseReport=function(n,t){var i=!1;return $.when($.ajax({url:baseURL+"Expense/ApproveExpenseReport",data:{expenseReportId:n,isAdminAction:t},type:"POST",async:!1})).then(function(n){i=n?n:!1}),i};MyApprovalsView.prototype.RejectExpenseReport=function(n,t){var i=!1;return $.when($.ajax({url:baseURL+"Expense/RejectExpenseReport",data:{expenseReportId:n,rejectionReason:t},type:"POST",async:!1})).then(function(n){i=n?n:!1}),i};MyApprovalsView.prototype.ReimburseExpenseReport=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/ReimburseExpenseReport",data:{request:n},type:"POST",async:!1})).then(function(n){t=n?n:!1}),t};ReportApprovalView.prototype.Init=function(){objThis=this;this.LoadApprovalItemGrid();this.LoadReportHistoryGrid();this.SetControlVisibilty($("#hdnReportStatus").val());$("#dtDurationFromDate, #dtDurationToDate").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#dtReimbursedOn").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0});$("#btnEditReport").click(function(n){n.preventDefault();$("#hdnExpReportId").val($("#ExpenseReportId").val());$("#txtReportName").val($("#lblReportTitle").text());$("#txtReportPurpose").val($("#lblBusinessPurpose").text());$("#dtDurationFrom").val(kendo.toString(kendo.parseDate($("#StartDate").val()),"dd/MMM/yyyy"));$("#dtDurationTo").val(kendo.toString(kendo.parseDate($("#EndDate").val()),"dd/MMM/yyyy"));$("#EditReportPopup").modal()});$("#btnSaveEditReport").click(function(n){var e,t;n.preventDefault();var i=$("#hdnExpReportId").val(),r=$("#txtReportName").val(),o=$("#txtReportPurpose").val(),u=$("#dtDurationFrom").val(),f=$("#dtDurationTo").val(),s=$("#isAdmin").val();i!==""&&r!==""&&u!==""&&f!==""&&(e={ExpenseReportId:i,ReportTitle:r,BusinessPurpose:o,StartDate:u,EndDate:f},t=$.post(baseURL+"Expense/ModifyExpenseReport",e),t.done(function(){ShowAlertBox("Expense report details updated successfully");$("#EditReportPopup").modal("toggle");var n=$("#ExpenseReportIdHash").val();window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(n)+"&a="+s}),t.fail(function(){ShowAlertBox("Failed to update expense report details")}))});$("#btnSubmitReport").click(function(n){var f;n.preventDefault();var i=!1,r=!1,t=$("#isAdmin").val(),u=$("#ExpenseReportId").val();if(t.toLowerCase()=="false"&&(r=objThis.ExpensesReportValidationCheckAllVerify(u),!r)){ShowAlertBox("Please verify all expenses to submit report");return}f=ShowConfirmationAlertBox("Do you want to submit this report?");f.then(function(){i=objThis.ApproveReport(u,t);i?ShowAlertBox("Report submitted successfully"):ShowAlertBox("Error while submitting report");var n=$("#ExpenseReportIdHash").val();window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(n)+"&a="+t})});$("#btnApproveReport").click(function(n){var i,u;n.preventDefault();var t=!1,f=!1,r=$("#ExpenseReportId").val();if(f=objThis.ExpensesReportValidationCheckAllVerify(r),!t){ShowAlertBox("Please verify all expenses to submit report");return}i=$("#isAdmin").val();u=ShowConfirmationAlertBox("Do you want to approve this report?");u.then(function(){t=objThis.ApproveReport(r,i);t?ShowAlertBox("Report approved successfully"):ShowAlertBox("Error while approving report");var n=$("#ExpenseReportIdHash").val();window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(n)+"&a="+i})});$("#btnRejectReport").click(function(n){n.preventDefault();$("#txtRptRejectionReason").val("");$("#RejectReportModal").modal()});$("#frmRejectReport").submit(function(n){var r,u;n.preventDefault();var t=$("#txtRptRejectionReason").val(),i=$("#ExpenseReportId").val(),f=$("#isAdmin").val();t===""||i<=0||(r=objThis.RejectReport(i,t),$("#RejectReportModal").modal("toggle"),r?ShowAlertBox("Report has been rejected"):ShowAlertBox("Error while rejecting report"),u=$("#ExpenseReportIdHash").val(),window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(u)+"&a="+f)});$("#frmRejectExpenseReport").submit(function(n){var i,r,t,u;(n.preventDefault(),i=$("#txtRptExpenseRejectionReason").val(),r=$("#hdnRptExpenseId").val(),i!==""||r=="")&&(t=!1,$.when($.ajax({url:baseURL+"Expense/RejectExpense",data:{expenseId:r,rejectionReason:i},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),$("#RejectExpenseReportModal").modal("toggle"),t?ShowAlertBox("Expense rejected"):ShowAlertBox("Error while rejecting expense"),u=$("#ExpenseReportIdHash").val(),window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(u))});$("#btnRecordReimbursement").click(function(n){n.preventDefault();$("#dtReimburseOn, #ddlPaidThrough, #txtReferenceNo, #txtNote, #hdnEmployeeId, #hdnExpenseReportId, #hdnAmount").val("");$("#lblReimburseAmt, #lblReimburseTo").text("");var t=$("#ReimburseAmount").val(),i=$("#ReimburseCurrency").val();$("#lblReimburseAmt").text(i+" "+t);$("#lblReimburseTo").text($("#SubmittedBy").val());$("#hdnAmount").val($("#ReimburseAmount").val());$("#hdnEmployeeId").val($("#EmployeeId").val());$("#hdnExpenseReportId").val($("#ExpenseReportId").val());$("#ManualReimbursementPopup").modal()});$("#frmReimburseExpense").submit(function(n){var e,t;n.preventDefault();var i=$("#hdnExpenseReportId").val(),o=$("#hdnEmployeeId").val(),s=$("#hdnAmount").val(),r=$("#ddlPaidThrough").val(),u=$("#dtReimburseOn").val(),f=$("#txtReferenceNo").val(),h=$("#txtNote").val(),c=$("#isAdmin").val();u!==""&&r!==""&&f!==""&&i!==""&&(e={ExpenseReportId:i,EmployeeId:o,Amount:s,PaidThrough:r,ReimbursedOn:u,Ref:f,Notes:h},t=$.post(baseURL+"Expense/ReimburseExpenseReport",e),t.done(function(){ShowAlertBox("Report has been reimbursed");$("#ManualReimbursementPopup").modal("toggle");var n=$("#ExpenseReportIdHash").val();window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(n)+"&a="+c}),t.fail(function(){ShowAlertBox("Failed to reimburse report")}))});$("#btnUndoReimbursement").click(function(n){n.preventDefault();var t=!1,i=$("#ExpenseReportId").val(),r=$("#isAdmin").val(),u=ShowConfirmationAlertBox("Do you want to undo this reimbursed report?");u.then(function(){t=objThis.UndoReimbursement(i);t?ShowAlertBox("Report reimbursement canceled successfully"):ShowAlertBox("Error while cancelling report reimbursement");var n=$("#ExpenseReportIdHash").val();window.location.href=baseURL+"Expense/ReportApproval?id="+encodeURIComponent(n)+"&a="+r})});$("#btnUpdateReport").click(function(n){n.preventDefault();objThis.SetControlVisibilty("awaiting approval")});$("#EditReportPopup").on("hidden.bs.modal",function(){$(this).find("#frmEditReport .has-error.has-danger").removeClass("has-error has-danger")});$(document).on("change","#header-chk-expensereport",function(){$("#ApprovalItemGrid tbody input:checkbox").prop("checked",this.checked)});$("#btnRejectMultiExpensesReport").click(function(n){var t;if(n.preventDefault(),t=$("#ApprovalItemGrid tbody").find("input:checked").length,t<=0){ShowAlertBox("Please select expense(s) to reject");return}var r=!0,i=0,u=ShowConfirmationAlertBox("Do you want to reject selected expense(s)?");u.then(function(){$("#ApprovalItemGrid tbody").find("input:checked").each(function(){this.id!="header-chk-expensereport"&&(r=objThis.RejectReportExpenses(this.id),i++)});t===i?(objThis.LoadApprovalItemGrid(),ShowAlertBox("Expense(s) rejected successfully")):ShowAlertBox("Error while rejecting expense(s)")})});$("#btnApproveMultiExpensesReport").click(function(n){var t;if(n.preventDefault(),t=$("#ApprovalItemGrid tbody").find("input:checked").length,t<=0){ShowAlertBox("Please select expense(s) to approve");return}var r=!0,i=0,u=ShowConfirmationAlertBox("Do you want to approve selected expense(s)?");u.then(function(){$("#ApprovalItemGrid tbody").find("input:checked").each(function(){this.id!="header-chk-expensereport"&&(r=ApproveReportExpense(this.id),i++)});t===i?ShowAlertBox("Expense(s) approved successfully"):ShowAlertBox("Error while approving expense(s)")})});$("#txtInvoiceReferenceNo").blur(function(){var n=$("#ddlExpenseCategory").find("option:selected").val(),t=$("#txtInvoiceReferenceNo").val(),i=$("#ddlMerchant").val(),r=$("#ddlExpenseType option:selected").text();objThis.ValidateInvoice(r,n,t,i,0)});$("#ddlMerchant").blur(function(){var n=$("#ddlExpenseCategory").find("option:selected").val(),t=$("#txtInvoiceReferenceNo").val(),i=$("#ddlMerchant").val(),r=$("#ddlExpenseType option:selected").text();objThis.ValidateInvoice(r,n,t,i,0)});$("#ddlExpenseCategory").change(function(){var n=$("#ddlExpenseCategory").find("option:selected").val(),t=$("#txtInvoiceReferenceNo").val(),i=$("#ddlMerchant").val(),r=$("#ddlExpenseType option:selected").text();objThis.ValidateInvoice(r,n,t,i,0)})};ReportApprovalView.prototype.LoadApprovalItemGrid=function(){function e(){if(setTimeout(function(){$(".k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Reject Expense");$(".k-i-close").removeClass("k-icon k-i-close");$("#ApprovalItemGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("ApprovalItemGrid")});KGrdPageSizeDdlPosition("ApprovalItemGrid")},1),this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}}var u=$("#ExpenseReportId").val(),i=$("#isAdmin").val(),n=$("#AwaitingFromUserId").val(),t=$("#UserId").val(),r=$("#lblApprovalStatus").text(),f=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadReportExpenses",dataType:"json",data:{expenseReportId:u}}},batch:!0,aggregate:[{field:"reimburseAmount",aggregate:"sum"}],scrollable:!0,sortable:!0,resizable:!0,pageSize:5,schema:{model:{id:"expenseIdHash",fields:{expenseIdHash:{editable:!1},expenseId:{editable:!1},dateIncurred:{editable:!1,type:"date"},description:{editable:!1},type:{editable:!1},country:{editable:!1},category:{editable:!1},merchant:{editable:!1},status:{editable:!1},amount:{editable:!1},currency:{editable:!1},reimburseAmount:{editable:!1},reimburseCurrency:{editable:!1},expenseReceiptAssetId:{editable:!1},isClaimReimbursement:{editable:!1},totalAdvanceAmt:{editable:!1},isApproved:{editable:!1}}}}});$("#ApprovalItemGrid").kendoGrid({dataSource:f,pageable:!0,sortable:!0,pageable:KGridPagableObj(),scrollable:!0,selectable:!0,resizable:!0,columns:[{width:25,headerTemplate:'<input type="checkbox" id="header-chk-expensereport" class="checkAll"><label class="checkbox-inline" id="ApprovalItemGridChkHeader" for="header-chk-expensereport"><\/label>',template:function(n){return i.toLowerCase()=="true"||r.toLowerCase()=="rejected"||r.toLowerCase()=="approved"||r.toLowerCase()==="partially primary approved"||r.toLowerCase()==="partially secondary approved"?"":n.status.toLowerCase()==="submitted"||n.status.toLowerCase()==="approved"||n.status.toLowerCase()==="rejected"?'<input type="checkbox" id='+n.expenseId+' class="chk-box"><label class="checkbox-inline" for='+n.expenseId+"><\/label>":""}},{field:"expenseIdHash",hidden:!0},{field:"expenseId",hidden:!0},{field:"isClaimReimbursement",hidden:!0},{field:"dateIncurred",title:"From Date",width:"60px",template:"#if(dateIncurred === null){# #}else{# #=kendo.toString(kendo.parseDate(dateIncurred), 'dd MMM yyyy')#  #}#"},{field:"toDateIncurred",title:"To Date",width:"60px",template:"#if(toDateIncurred === null){# #}else{# #=kendo.toString(kendo.parseDate(toDateIncurred), 'dd MMM yyyy')#  #}#"},{field:"type",title:"Type",width:"60px"},{field:"country",title:"Country",width:"60px"},{field:"category",title:"Category",width:"90px"},{field:"description",title:"Description",width:"120px"},{field:"totalAdvanceAmt",hidden:!0,template:function(n){return n.totalAdvanceAmt},attributes:{"total-adv-amt":"Y"}},{field:"amount",title:"Amount",width:"120px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #",footerTemplate:function(){return'<div class="div-wrapper"><div>Total Expense Amount<\/div><div>Non-Reimbursable Amount<\/div><div>Advance Amount<\/div><div class="show-line"><\/div><div>Reimbursable Amount<\/div><\/div>'}},{field:"reimburseAmount",headerTemplate:'<span id="lblHeaderAmt"><\/span>',width:"120px",template:"#= reimburseCurrency + ' ' + kendo.toString(reimburseAmount, 'n2') #",footerTemplate:function(n){var i=0,t=$('#ApprovalItemGrid td[total-adv-amt="Y"]:eq(0)');return i=t.html()!=""&&t.html()!=undefined&&t.html()!=null?parseFloat(t.html()).toFixed(2):0,"<div class='div-wrapper'><div><b>"+kendo.toString(n.reimburseAmount.sum,"n2")+"<\/b><\/div><div>(-) "+kendo.toString(conditionalSum("#ApprovalItemGrid"),"n2")+"<\/div><div>(-) "+kendo.toString(i,"n2")+"<\/div><div class='show-line'><\/div><div>"+kendo.toString(n.reimburseAmount.sum-(conditionalSum("#ApprovalItemGrid")+parseFloat(i)),"n2")+"<\/div><\/div>"}},{field:"",title:"",width:"50px",template:function(r){if(i.toLowerCase()=="false"&&(r.status.toLowerCase()==="submitted"||r.status.toLowerCase()==="approved"||r.status.toLowerCase()==="rejected"))if(r.isApproved&&n==t&&r.awaitingFrom==="First"&&!r.isFirstPartiallyApproval||r.isSecondApproved&&n==t&&r.awaitingFrom==="Second"&&!r.isSecondPartiallyApproval){if(i.toLowerCase()=="true"||n==t&&r.status.toLowerCase()==="submitted")return'<div class="pointer text-success" title="Expense Approved"> <strong> Approved<\/strong> <\/div>';if(n==t&&r.status.toLowerCase()==="rejected")return'<div class="pointer" title="Approve Expense" onclick="ApproveReportExpense(\''+r.expenseId+'\')"><button type="button" id="btnApproveExpense" class="btn btn-success btn-xs">   Approve <\/button><\/div>'}else if((!r.isApproved&&n==t||!r.isSecondApproved&&n==t)&&(i.toLowerCase()=="true"||r.awaitingFrom==="First"&&n==t&&r.status.toLowerCase()==="submitted"&&!r.isFirstPartiallyApproval||r.awaitingFrom==="First"&&n==t&&r.status.toLowerCase()==="rejected"&&!r.isFirstPartiallyApproval||r.awaitingFrom==="Second"&&n==t&&r.status.toLowerCase()==="submitted"&&!r.isSecondPartiallyApproval||r.awaitingFrom==="Second"&&n==t&&r.status.toLowerCase()==="rejected"&&!r.isSecondPartiallyApproval))return'<div class="pointer" title="Approve Expense" onclick="ApproveReportExpense(\''+r.expenseId+'\')"><button type="button" id="btnApproveExpense" class="btn btn-success btn-xs"> Approve <\/button><\/div>';return""}},{field:"",title:"",width:"50px",template:function(r){if(i.toLowerCase()=="false")if(r.status.toLowerCase()==="submitted"||r.status.toLowerCase()==="approved"){if(i.toLowerCase()=="true"||r.status.toLowerCase()==="submitted"&&n==t&&r.awaitingFrom==="First"&&!r.isFirstPartiallyApproval||r.status.toLowerCase()==="submitted"&&n==t&&r.awaitingFrom==="Second"&&!r.isSecondPartiallyApproval)return'<div class="pointer" title="Reject Expense" onclick="RejectExpense(\''+r.expenseId+'\')"><button type="button" id="btnApproveExpense" class="btn btn-danger btn-xs">Reject<\/button><\/div>'}else if(r.status.toLowerCase()==="rejected"&&(i.toLowerCase()=="true"||r.awaitingFrom==="First"&&n==t&&r.status.toLowerCase()==="rejected"&&!r.isFirstPartiallyApproval||r.awaitingFrom==="Second"&&n==t&&r.status.toLowerCase()==="rejected"&&!r.isSecondPartiallyApproval))return'<div class="pointer text-danger" title="Rejected Expense"><strong>Rejected<\/strong><\/div>';return""}},{field:"",title:"",width:"25px",template:function(n){return($("#ApprovalItemGrid").find("#lblHeaderAmt").html()==""&&$("#ApprovalItemGrid").find("#lblHeaderAmt").html("Amount ("+n.reimburseCurrency+")"),n.expenseReceiptAssetId!=null&&n.expenseReceiptAssetId>0)?"<div class='pointer' title='Download Attachment'><a href='"+baseURL+"Asset/Download/"+n.expenseReceiptAssetId+"'><img src='"+baseURL+"images/attached.png' class='img-responsive' /><\/a><\/div>":""}},{field:"",title:"",width:"30px",template:function(n){return'<div class="pointer" title="Expense details" onclick="OpenExpenseDetailsFromReportApproval(\''+n.expenseId+"','"+n.type+'\')"><img src="'+baseURL+'images/info_line.png" class="img-responsive" /><\/div>'}}],dataBound:e,dataBinding:function(){$("#ApprovalItemGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#ApprovalItemGrid tbody input:checkbox").prop("checked",this.checked)})};ReportApprovalView.prototype.HideShowValidatePerdiemControls=function(n){if(n=="Per Diem")$("#txtRef").prop("required",!1),$("#fileUploadExpenseReceipt").prop("required",!1),$("#divExpenseInvoiceAttachment").addClass("hidden"),$("#divExpenseInvoiceAttachment").removeClass("col-md-4"),$("#divExpenseReportMainDiv").removeClass("col-md-8"),$("#divExpenseReportMainDiv").addClass("col-md-12"),$("#divExpenseInvoiceNumber").addClass("hidden"),$("#txtInvoiceReferenceNo").prop("required",!1),$("#fileUploadExpenseReceipt").prop("required",!1);else{$("#divExpenseInvoiceAttachment").removeClass("hidden");$("#divExpenseInvoiceAttachment").addClass("col-md-4");$("#divExpenseReportMainDiv").removeClass("col-md-12");$("#divExpenseReportMainDiv").addClass("col-md-8");$("#divExpenseInvoiceNumber").removeClass("hidden");var t=$("#chkInvoiceNotAvailable").is(":checked");t!=undefined&&t&&($("#txtInvoiceReferenceNo").prop("required",!0),$("#fileUploadExpenseReceipt").prop("required",!0))}};ReportApprovalView.prototype.SetControlVisibilty=function(n){var t=$("#isAdmin").val();switch(n.toLowerCase()){case"submitted":case"partially secondary approved":case"partially primary approved":case"submitted (pending primary approval)":case"submitted (pending secondary approval)":$("#UpdateReportModal").modal("hide");$("#DivReportStatus").removeClass("div-danger").removeClass("div-btnSuccess").removeClass("div-btnReim").removeClass("div-btnSuccess").addClass("div-btnDefault");$("#btnSubmitReport").remove("hidden");t=="True"?$("#btnSubmitReport").text("APPROVE REPORT"):$("#btnSubmitReport").text("SUBMIT REPORT");break;case"approved":$("#lblApprovalStatus").html("APPROVED");$("#btnRecordReimbursement").removeClass("hidden");$("#DivReportStatus").removeClass("div-btnDefault").removeClass("div-btnSuccess").removeClass("div-danger").removeClass("div-btnReim").addClass("div-btnSuccess");$("#btnApproveReport").addClass("hidden");t=="True"?$("#btnSubmitReport").addClass("hidden"):($("#btnSubmitReport").remove("hidden"),$("#btnSubmitReport").text("APPROVE REPORT"));break;case"rejected":$("#lblApprovalStatus").html("REJECTED");$("#btnRejectReport, #btnRecordReimbursement, #btnRejectMultiExpensesReport").addClass("hidden");$("#btnApproveReport").addClass("hidden");$("#DivReportStatus").removeClass("div-btnDefault").removeClass("div-btnSuccess").removeClass("div-btnReim").removeClass("div-btnSuccess").addClass("div-danger");$("#btnSubmitReport").addClass("hidden");t=="True"?($("#btnSubmitReport").text("APPROVE REPORT"),$("#btnSubmitReport").removeClass("hidden")):$("#btnSubmitReport").text("SUBMIT REPORT");break;case"reimbursed":$("#lblApprovalStatus").html("REIMBURSED");$("#DivReportStatus").removeClass("div-btnDefault").removeClass("div-btnSuccess").removeClass("div-danger").removeClass("div-btnSuccess").addClass("div-btnReim");$("#btnUndoReimbursement").removeClass("hidden");$("#btnRejectReport, #btnRecordReimbursement, #btnApproveReport, #btnEditReport, #btnRejectMultiExpensesReport").addClass("hidden");$("#btnSubmitReport").addClass("hidden");break;case"undoreimbursed":$("#lblApprovalStatus").html("APPROVED");$("#btnUndoReimbursement").addClass("hidden");$("#btnRecordReimbursement, #btnRejectReport, #btnRejectMultiExpensesReport").removeClass("hidden");$("#DivReportStatus").removeClass("div-btnDefault").removeClass("div-btnSuccess").removeClass("div-danger").removeClass("div-btnReim").addClass("div-btnSuccess")}};ReportApprovalView.prototype.LoadReportHistoryGrid=function(){var n=$("#ExpenseReportId").val(),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseReportHistory",dataType:"json",data:{expenseReportId:n}}},batch:!0,pageSize:5,schema:{model:{id:"expenseReportId",fields:{expenseReportId:{editable:!1},description:{editable:!1},datetime:{editable:!1}}}}});$("#ReportHistoryGrid").kendoGrid({dataSource:t,pageable:!0,columns:[{field:"expenseReportId",hidden:!0},{field:"description",width:"500px"},{field:"datetime",width:"200px",template:"#= kendo.toString(kendo.parseDate(datetime), 'dd MMM yyyy hh:mm tt') #"}]})};ReportApprovalView.prototype.ApproveReport=function(n,t){var i=!1;return $.when($.ajax({url:baseURL+"Expense/ApproveExpenseReport",data:{expenseReportId:n,isAdminAction:t},type:"POST",async:!1})).then(function(n){i=n?n:!1}),i};ReportApprovalView.prototype.RejectReport=function(n,t){var i=!1;return $.when($.ajax({url:baseURL+"Expense/RejectExpenseReport",data:{expenseReportId:n,rejectionReason:t},type:"POST",async:!1})).then(function(n){i=n?n:!1}),i};ReportApprovalView.prototype.UndoReimbursement=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/UndoReimbursement",data:{expenseReportId:n},type:"POST",async:!1})).then(function(n){t=n?n:!1}),t};ReportApprovalView.prototype.RejectReportExpenses=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/RejectExpense",data:{expenseId:n,rejectionReason:""},type:"POST",async:!1})).then(function(n){t=n?!0:!1}),t};ReportApprovalView.prototype.ValidateInvoice=function(n,t,i,r,u){var f=ValidateReferenceNumber(n,t,i,r,u);f&&($("#txtInvoiceReferenceNo").val(""),$("#fileUploadExpenseReceipt").val(""),ShowAlertBox("Invoice number already exists!"))};ReportApprovalView.prototype.ExpensesReportValidationCheckAllVerify=function(n){var t=!1;return $.when($.ajax({url:baseURL+"Expense/ExpensesReportValidationCheckAllVerify",data:{reportId:n},type:"POST",async:!1})).then(function(n){t=n?n:!1}),t};AdvancedPaymentViews.prototype.Init=function(){var n=this;$("#datePickerFrom, #datePickerTo").datepicker({format:"dd/M/yyyy",autoclose:!0});$("#ddladavancePaymentDate").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0,orientation:"bottom"});$("#advancepayment").on("hidden.bs.modal",function(){$("#ddlLeaveToDate").datepicker("setDate",null)});$("#btnAdvancePayment").click(function(t){t.preventDefault();$("#RecordAdvancePayment").modal();n.AdvancePaymentClearFields();$("#ddladavancePaymentDate").datepicker("setDate",kendo.toString(new Date,"dd/MMM/yyyy"))});this.LoadAdvancePaymentGrid();$("#frmAdvPayment").submit(function(t){t.preventDefault();var i=AdvancePaymentObject();i!=undefined&&n.SaveAdvancePayment(i)});$("#RecordAdvancePayment").on("hidden.bs.modal",function(){$(this).find("#frmAdvPayment .has-error.has-danger").removeClass("has-error has-danger");$("#frmAdvPayment #btnAddAdvancePayment.disabled").removeClass("disabled")});$('#ddlExpenseAdvPaymentStatus option[value=""], #dtFrom option[value=""], #dtTo option[value=""]').attr("selected",!0);$("#ddlExpenseAdvPaymentStatus, #dtFrom, #dtTo").change(function(){n.FilterAdvancePaymentGrid()});$("#ddlAdvPmtCurrency").change(function(){n.ExchangeAmountToRemiburseCurrency()});$("#txtAdvPmtAmount").blur(function(){n.ExchangeAmountToRemiburseCurrency()});$("#ddlEmployeeList").change(function(){if(this.value!=""){var t=$.post(baseURL+"Expense/EmployeeReimburseCurrency/",{employeeId:this.value});t.done(function(t){t&&($("#ddlAdvPmtReimburseCurrency").val(t),n.ExchangeAmountToRemiburseCurrency())})}})};AdvancedPaymentViews.prototype.ExchangeAmountToRemiburseCurrency=function(){var n=$("#ddlAdvPmtCurrency").val(),t=$("#ddlAdvPmtReimburseCurrency").val(),i=$("#txtAdvPmtAmount").val(),r;parseFloat(i)>0?(r=GetCurrencyExchangeRate(n,t,1),$("#CurrencyExRate").val(parseFloat(r)),$("#txtAdvPmtReimburseAmount").val((r*i).toFixed(2))):($("#CurrencyExRate").val(0),$("#txtAdvPmtReimburseAmount").val(""));n!=t&&parseFloat(i)>0?($("#lblAdvPmtExchangeRate").text("Rate : 1 "+n+" = "+$("#CurrencyExRate").val()+" "+t),$("#lblAdvPmtExchangeRate").css("visibility","visible")):$("#lblAdvPmtExchangeRate").css("visibility","hidden")};AdvancedPaymentViews.prototype.SaveAdvancePayment=function(n){var i=n.ExpenseAdvPaymentId>0?!0:!1,t=$.post(baseURL+"Expense/AddAdvancePayment",n);t.done(function(){$("#RecordAdvancePayment").modal("hide");i?ShowAlertBox("Advance Payment Updated!"):ShowAlertBox("Advance Payment Added!");refreshGrid($("#AdvancePaymentGrid"))});t.fail(function(){ShowAlertBox("Fail to save Advance Payment!")})};AdvancedPaymentViews.prototype.FilterAdvancePaymentGrid=function(){var i=$("#ddlExpenseAdvPaymentStatus").find(":selected").val(),n=GetDateInFormat($("#dtFrom").val(),"yyyy-MM-ddT00:00:00"),t=GetDateInFormat($("#dtTo").val(),"yyyy-MM-ddT00:00:00");doApplyGridFilter("AdvancePaymentGrid","eq","status",i==""?0:i);doApplyGridFilter("AdvancePaymentGrid","gte","date",n==""||n==null?0:n);doApplyGridFilter("AdvancePaymentGrid","lte","date",t==""||t==null?0:t)};AdvancedPaymentViews.prototype.LoadAdvancePaymentGrid=function(){function t(){if(setTimeout(function(){$(".k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Advance Payment");$(".k-i-close").removeClass("k-icon k-i-close");$("#AdvancePaymentGrid tbody tr").on("dblclick",function(){var n=$("#AdvancePaymentGrid").data("kendoGrid").dataItem(this);ViewAdvancePayment(n.expenseAdvPaymentIdHash)});KGrdPageSizeDdlPosition("AdvancePaymentGrid")},1),this.dataSource.view().length==0){var n=this.dataSource.page();n>1&&this.dataSource.page(n-1)}}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseAdvancePayments",dataType:"json"},destroy:{url:baseURL+"Expense/DeleteExpenseAdvancePayment",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)if(n.models[0].associatedReportStatus==="Submitted"||n.models[0].associatedReportStatus==="Approved"||n.models[0].associatedReportStatus==="Reimbursed")ShowAlertBox("Advance payments cannot be edited in a submitted, approved or reimbursed report.");else return{expenseAdvPayment:kendo.stringify(n.models)}}},batch:!0,pageSize:10,scrollable:!0,schema:{model:{id:"expenseAdvPaymentId",fields:{expenseAdvPaymentId:{editable:!1},expenseAdvPaymentIdHash:{editable:!1},companyId:{editable:!1},employeeId:{editable:!1},date:{editable:!1},referenceNo:{editable:!1},recordedFor:{editable:!1},recordedBy:{editable:!1},amount:{editable:!1},currency:{editable:!1},associatedReportStatus:{editable:!1},status:{editable:!1},expenseReportId:{editable:!1}}}}});$("#AdvancePaymentGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,editable:"inline",selectable:"row",dataBound:t,columns:[{field:"expenseAdvPaymentId",hidden:!0},{field:"expenseAdvPaymentIdHash",hidden:!0},{field:"date",title:"Date",width:"200px",template:"#= kendo.toString(kendo.parseDate(date), 'dd MMM yyyy') #"},{field:"referenceNo",title:"Ref#",width:"200px"},{field:"recordedFor",title:"Recorded For",width:"200px"},{field:"recordedBy",title:"Recorded By",width:"200px"},{field:"status",title:"Status",width:"150px"},{title:"Amount",width:"150px",template:"#= currency + ' ' + kendo.toString(amount, 'n2') #"},{template:function(n){return n.associatedReportStatus==="Submitted"||n.associatedReportStatus==="Approved"||n.associatedReportStatus==="Reimbursed"?"":'<div class="pointer" title="Edit Adavnce Payment" onclick="EditAdvancedPayment(\''+n.expenseAdvPaymentId+'\')"><img src="'+baseURL+'images/edit.png" class="img-responsive" /><\/div>'},width:"50px"},{command:[{name:"destroy",text:"",visible:function(n){return n.associatedReportStatus!="Submitted"&&n.associatedReportStatus!="Approved"&&n.associatedReportStatus!="Reimbursed"}}],title:"&nbsp;",width:"50px"}]})};AdvancedPaymentViews.prototype.AdvancePaymentClearFields=function(){$("#ExpenseAdvPaymentId").val("");$("#ddlAdvPmtCurrency, #ddlAdvPmtReimburseCurrency, #ddlPaidThrough, #ddlEmployeeList").val("");$("#txtAdvPmtAmount, #txtAdvPmtReimburseAmount, #txtRef, #txtNote").val("");$("#ddladavancePaymentDate").datepicker("setDate","");$("#lblAdvPmtExchangeRate").text("");$("#CurrencyExRate").val("")};EmployeeAdvancePaymentView.prototype.Init=function(){var n=this;$("#ddladavancePaymentDate").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0});this.LoadAdvancePaymentHistoryGrid();$("#btnEditAdvPayment").click(function(n){n.preventDefault();var t=$("#ExpenseAdvPaymentId").val();EditAdvancedPayment(t)});$("#frmAdvPayment").submit(function(t){t.preventDefault();var i=AdvancePaymentObject();i!=undefined&&n.SaveAdvancePayment(i)});$("#ddlAdvPmtCurrency").change(function(){AdvancedPaymentViews.prototype.ExchangeAmountToRemiburseCurrency()});$("#txtAdvPmtAmount").blur(function(){AdvancedPaymentViews.prototype.ExchangeAmountToRemiburseCurrency()});$("#ddlEmployeeList").change(function(){if(this.value!=""){var n=$.post(baseURL+"Expense/EmployeeReimburseCurrency/",{employeeId:this.value});n.done(function(n){n&&($("#ddlAdvPmtReimburseCurrency").val(n),AdvancedPaymentViews.prototype.ExchangeAmountToRemiburseCurrency())})}})};EmployeeAdvancePaymentView.prototype.SaveAdvancePayment=function(n){var i=n.ExpenseAdvPaymentId>0?!0:!1,t=$.post(baseURL+"Expense/AddRecordAdvancePayment",n);t.done(function(){$("#recordAdvancePaymentModal").modal("hide");i?ShowAlertBox("Advance Payment Updated!"):ShowAlertBox("Advance Payment Added!");location.reload()});t.fail(function(){ShowAlertBox("Fail to save Advance Payment!")})};EmployeeAdvancePaymentView.prototype.LoadAdvancePaymentHistoryGrid=function(){var n=$("#ExpenseAdvPaymentId").val(),t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Expense/LoadExpenseAdvancedPaymentHistory",dataType:"json",data:{expenseAdvPaymentId:n}}},batch:!0,pageSize:5,schema:{model:{id:"expenseAdvPaymentId",fields:{expenseAdvPaymentId:{editable:!1},description:{editable:!1},datetime:{editable:!1}}}}});$("#AdvancePaymentHistoryGrid").kendoGrid({dataSource:t,pageable:!0,columns:[{field:"expenseAdvPaymentId",hidden:!0},{field:"description",width:"500px"},{field:"datetime",width:"200px",template:"#= kendo.toString(kendo.parseDate(datetime), 'dd MMM yyyy hh:mm tt') #"}]})};WorkPermitAlertViews.prototype.Init=function(){var n=this;this.LoadWorkPermitAlertGrid()};WorkPermitAlertViews.prototype.LoadWorkPermitAlertGrid=function(){function n(){setTimeout(function(){var n="#WorkPermitAlertGrid";$(n+" a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");$(n+" div.k-grouping-header").css("display","none");$(".k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit");$(".k-i-edit").removeClass("k-icon k-i-edit");$(".k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update");$(".k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(n+" tbody tr.k-grouping-row").find("a.k-icon").on("click",function(){$(this).hasClass("k-i-expand")&&$(n+" tbody tr.k-grouping-row").find("a.k-icon.k-i-collapse").trigger("click")})},1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Alerts/LoadWorkPermitList",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{Alerts:kendo.stringify(n.models)}}},batch:!0,group:[{field:"status"}],pageSize:10,scrollable:!0,schema:{model:{id:"employeeIdHash",fields:{employeeIdHash:{editable:!1},employeeName:{editable:!1},passType:{editable:!1},workPermitNumber:{editable:!1},issueDate:{editable:!1},expiryDate:{editable:!1},lapse:{editable:!1},status:{editable:!1}}}}});$("#WorkPermitAlertGrid").kendoGrid({dataSource:t,pageable:!0,groupable:!0,dataBound:n,cancel:n,columns:[{field:"employeeIdHash",hidden:!0},{field:"employeeName",title:"Employee Name",width:"200px"},{field:"passType",title:"Pass Type",width:"120px"},{field:"workPermitNumber",title:"WP / FIN Number",width:"150px"},{field:"issueDate",title:"Issue Date",width:"150px",template:"#= kendo.toString(kendo.parseDate(issueDate), 'dd MMM yyyy') #"},{field:"expiryDate",title:"Expiry Date",width:"150px",template:"#= kendo.toString(kendo.parseDate(expiryDate), 'dd MMM yyyy') #"},{field:"status",title:"Status",width:"130px",groupHeaderTemplate:function(n){return n.value+" ("+n.items.length+")"}},{field:"lapse",title:"Lapse",width:"200px",template:function(n){return'<input type="button" onclick="workPermit(\''+n.employeeIdHash+'\');" value="'+n.lapse+'" class="btn btn-primary alert-buttons" />'}}]})};ProbationCompletionAlertViews.prototype.Init=function(){var n=this;this.LoadProbationCompletionAlertGrid()};ProbationCompletionAlertViews.prototype.LoadProbationCompletionAlertGrid=function(){function n(){setTimeout(function(){var n="#ProbationCompletionAlertGrid";$(n+" a.k-icon.k-i-collapse").closest("p.k-reset").css("font-weight","bold");$(n+" div.k-grouping-header").css("display","none");$(".k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit");$(".k-i-edit").removeClass("k-icon k-i-edit");$(".k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update");$(".k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(n+" tbody tr.k-grouping-row").find("a.k-icon").click(function(){$(this).hasClass("k-i-expand")&&$(n+" tbody tr.k-grouping-row").find("a.k-icon.k-i-collapse").trigger("click")})},1)}var t=new kendo.data.DataSource({transport:{read:{url:baseURL+"Alerts/LoadProbationCompletionList",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{NotificationList:kendo.stringify(n.models)}}},batch:!0,group:[{field:"status"}],pageSize:10,scrollable:!0,schema:{model:{id:"employeeIdHash",fields:{employeeIdHash:{editable:!1},employeeName:{editable:!1},joiningDate:{editable:!1},probationEndDate:{editable:!1},lapse:{editable:!1},status:{editable:!1}}}}});$("#ProbationCompletionAlertGrid").kendoGrid({dataSource:t,pageable:!0,groupable:!0,resizable:!0,dataBound:n,cancel:n,columns:[{field:"employeeIdHash",hidden:!0},{field:"employeeName",title:"Employee Name",width:"200px"},{field:"joiningDate",title:"Date Joined",width:"200px",template:"#= kendo.toString(kendo.parseDate(joiningDate), 'dd MMM yyyy') #"},{field:"probationEndDate",title:"Probation End Date",width:"200px",template:"#= kendo.toString(kendo.parseDate(probationEndDate), 'dd MMM yyyy') #"},{field:"status",title:"Status",width:"200px",groupHeaderTemplate:function(n){return n.value+" ("+n.items.length+")"}},{field:"lapse",title:"Lapse",width:"200px",template:function(n){return'<input type="button" onclick="ProbationCompletion(\''+n.employeeIdHash+'\');" value="'+n.lapse+'" class="btn btn-primary alert-buttons" />'}}]})};MyAlertsView.prototype.Init=function(){var n=this;this.LoadMyAlerts();$("#btnMarkViewed").click(function(){MarkAllViewed()})};MyAlertsView.prototype.LoadMyAlerts=function(){var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Alerts/LoadMyNotifications",dataType:"json"}},batch:!0,pageSize:10,scrollable:!0,schema:{model:{id:"id",fields:{id:{editable:!1},redirectURL:{editable:!1},message:{editable:!1}}}}});$("#MyAlertsGrid").kendoGrid({dataSource:n,pageable:!0,columns:[{field:"id",hidden:!0},{field:"redirectURL",hidden:!0},{field:"message",title:"Notification",width:"400px"},{field:"id",title:"View Details",width:"100px",template:function(n){return'<input type="button" onclick="ViewDetails(\''+n.id+"', '"+n.redirectURL+'\');" value="View Details" class="btn btn-primary alert-buttons" />'}}]})};CompanySettingsView.prototype.Init=function(){var n=this;this.LoadPerDiemRateGrid();this.LoadExpenseCategoryGrid();this.LoadPayrollExchangeRateGrid();$(".accordion-toggle").on("click",function(){$(".accordion-toggle").removeClass("active");$(this).addClass("active")});$("#hdnResponseMessage").val()=="Success"?ShowAlertBox("Company settings updated successfully!"):$("#hdnResponseMessage").val()=="Fail"&&ShowAlertBox("Error occurred while saving/updating your settings.");$("#btnClear").click(function(t){t.preventDefault();n.ClearFields()});$("#linkPerDiemRate").click(function(t){t.preventDefault();$("#AddPerDiemRate").modal();n.PerDiemRateClearFields()});$("#AddPerDiemRate").on("hidden.bs.modal",function(){$(this).find("#frmPerDiemRate .has-error.has-danger").removeClass("has-error has-danger")});$("#lnkAddExpenseCategory").click(function(t){t.preventDefault();$("#hdnExpenseCategoryId").val("");$("#popExCatHdr").text("Add Expense Category");n.ExpenseCategoryClearFields();$("#ExpenseCategoryModal").modal()});$("#ddlPerDiemRateCountry").change(function(){var n=$("#ddlPerDiemRateCountry").find("option:selected").val();n!=""?($("#txtPerDiemRateCurrency").val(n),event.stopImmediatePropagation()):$("#txtPerDiemRateCurrency").val("")});$("#frmPerDiemRate").submit(function(t){var o,u,h,c;if(t.preventDefault(),!$("#btnSavePerDiemRate").hasClass("disabled")){var r=$("#PerDiemRateId").val(),f=$("#ddlPerDiemRateCountry option:selected").text(),e=$("#txtPerDiemRateCurrency").val(),s=$("#txtPerDiemRate").val();if(f!=""&&e!=""&&s!=""){for(o=!1,u=$("#PerDiemRateGrid").data("kendoGrid").dataSource._data,i=0;i<u.length;i++)u[i].currency==e&&u[i].country==f&&(r==null||r=="")&&(o=!0);o?ShowAlertBox("Per Diem Rate already exists"):(h={PerDiemRateId:r,Country:f,Currency:e,PerDiemRate:s},c=n.SavePerDiemRate(h),c==!0?(r>0?ShowAlertBox("Per Diem Rate updated successfully"):ShowAlertBox("Per Diem Rate added successfully"),$("#AddPerDiemRate").modal("hide"),refreshGrid($("#PerDiemRateGrid"))):ShowAlertBox("Error while adding per diem rate"))}}});$("#frmExpenseCategory").submit(function(t){var i;if(t.preventDefault(),!$("#btnSaveCategory").hasClass("disabled")){var h=$("#hdnExpenseCategoryId").val()==""&&$("#hdnExpenseCategoryId").val()==undefined?null:$("#hdnExpenseCategoryId").val(),f=$("#txtCategory").val().trim(),e=$("#ddlTaxPayable").val(),o=$("#ddlCPFPayable").val();if(f!=""&&e!=""&&o!=""){var r={CategoryId:h,Category:f,IsTaxPayable:parseInt(e)==1?!0:!1,IsCPFPayable:parseInt(o)==1?!0:!1},s=!1,u=$("#ExpenseCategoryGrid").data("kendoGrid").dataSource.data(),c=u.length;for(i=0;i<c;i++)if(u[i].category.trim().toLowerCase()==r.Category.trim().toLowerCase()&&u[i].categoryId!=r.CategoryId){s=!0;break}s?ShowAlertBox("Expense category is already added for the company"):n.SaveExpenseCategory(r)}}});$("#btnAddYearList").click(function(n){var t,i;if(n.preventDefault(),t=$("#ddlYearList").val(),t.length<=0){$("#ddlYearList").parent("div.form-group").addClass("has-error has-danger");return}i=ShowConfirmationAlertBox("Please make sure company leaves for the selected year are added.<br> Click OK to continue.");i.then(function(){var n=$.post(baseURL+"Settings/AddYearlyEmployeeLeaves/",{year:t});n.done(function(n){n?ShowAlertBox("Employee leaves added for the year."):ShowAlertBox("Either Company Leaves are not added or Employee leaves for selected year are already added, Please verify.")});n.fail(function(){ShowAlertBox("Error while adding employee leaves.")})})});$("#linkAddPayrollExchangeRate").click(function(t){t.preventDefault();$("#PayrollExchangeRates").modal();n.PayrollExchangeRatesClearFields()});$("#PayrollExchangeRates").on("hidden.bs.modal",function(){$(this).find("#frmPayrollExhangeRates .has-error.has-danger").removeClass("has-error has-danger")});$("#frmPayrollExhangeRates").submit(function(t){var h,r,l,a;if(t.preventDefault(),!$("#btnSavePayrollExchangeRate").hasClass("disabled")){var u=$("#ExchangeRateId").val(),o=$("#ddlPayrollExchangeRatesYear option:selected").text(),s=$("#ddlPayrollExchangeRatesMonth option:selected").text(),f=$("#ddlPayrollExchangeRatesFromCurrency option:selected").text(),e=$("#ddlPayrollExchangeRatesToCurrency option:selected").text(),c=$("#txtPayrollExchangeRate").val();if(o!=""&&s!=""&&f!=""&&e!=""&&c!=""){if(f===e){ShowAlertBox("From Currency and To Currency can not be same");return}for(h=!1,r=$("#PayrollExchangeRatesGrid").data("kendoGrid").dataSource._data,i=0;i<r.length;i++)r[i].fromCurrencyCode==f&&r[i].toCurrencyCode==e&&r[i].year==o&&r[i].month==s&&(u==null||u=="")&&(h=!0);h?ShowAlertBox("Exchange rate already exists"):(l={ExchangeRateId:u,Year:o,Month:s,Rate:c,FromCurrencyCode:f,ToCurrencyCode:e},a=n.SavePayrollExchangeRate(l),a==!0?(u>0?ShowAlertBox("Exchange rate updated successfully"):ShowAlertBox("Exchange rate added successfully"),$("#PayrollExchangeRates").modal("hide"),refreshGrid($("#PayrollExchangeRatesGrid"))):ShowAlertBox("Error while adding Exchange rate"))}}})};CompanySettingsView.prototype.SavePerDiemRate=function(n){var t=!1;return $.ajax({url:baseURL+"Settings/AddPerDiemRate",data:{perDiemRateSettings:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CompanySettingsView.prototype.deletePerDiemRate=function(n){var t=!1;return $.ajax({url:baseURL+"Settings/DeletePerDiemRate",data:{perDiemRateId:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CompanySettingsView.prototype.LoadPerDiemRateGrid=function(){function t(){setTimeout(function(){KGrdPageSizeDdlPosition("PerDiemRateGrid",0)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadPerDiemRate",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{isLoadAll:$("#isLoadAllReports").val()}}},batch:!0,scrollable:!0,pageSize:5,schema:{model:{id:"perDiemRateId",fields:{perDiemRateId:{editable:!1},country:{editable:!1},currency:{editable:!1},description:{editable:!1},perDiemRate:{editable:!1},isUsed:{editable:!1}}}}});$("#PerDiemRateGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,selectable:"row",columns:[{field:"perDiemRateId",title:"perDiemRateId",hidden:!0},{field:"country",title:"Country",width:100},{field:"currency",title:"Currency",width:100},{field:"perDiemRate",title:"Per Diem Rate",width:100},{field:"description",title:"Per Diem Rate Description",width:400},{template:'<a href="javascript: openPerDiemRateModal(#=perDiemRateId#);"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Per Diem Rate" /><\/a>',width:50},{template:function(n){return n.isUsed===!1?"<div class='pointer' title='Delete Per Diem Rate' onclick='deletePerDiemRateItem("+n.perDiemRateId+")'><img src='"+baseURL+"images/delete.png' class='img-responsive' /><\/div>":""},width:"50px"}],dataBound:t})};CompanySettingsView.prototype.PerDiemRateClearFields=function(){var n=this;$("#PerDiemRateId").val("");$("#ddlPerDiemRateCountry").val("");$("#txtPerDiemRateCurrency").val("");$("#txtPerDiemRate").val("")};CompanySettingsView.prototype.ClearFields=function(){$("#txtMileageRatePerKM").val("");$("#ddlBaseCurrency").val("")};CompanySettingsView.prototype.LoadExpenseCategoryGrid=function(){function t(){setTimeout(function(){$("#ExpenseCategoryGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("ExpenseCategoryGrid")});KGrdPageSizeDdlPosition("ExpenseCategoryGrid",1)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadExpenseCategoryList",dataType:"json"}},batch:!0,scrollable:!0,pageSize:5,schema:{model:{id:"categoryId",fields:{categoryId:{editable:!1},category:{editable:!1},isTaxPayable:{editable:!1},isCPFPayable:{editable:!1},isUsed:{editable:!1}}}}});$("#ExpenseCategoryGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,selectable:"row",columns:[{field:"categoryId",title:"categoryId",hidden:!0},{field:"category",title:"Expense Category",width:"200px"},{field:"isTaxPayable",template:function(n){return n.isTaxPayable==!0?"Yes":"No"},title:"Tax Payable",width:"80px"},{field:"isCPFPayable",template:function(n){return n.isCPFPayable==!0?"Yes":"No"},title:"CPF Payable",width:"80px"},{template:'<a href="javascript: CompanySettingsView.prototype.OpenExpenseCategoryModal(\'#:categoryId#\');"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Expense Category" /><\/a>',width:"50px"},{template:function(n){return n.isUsed===!1?"<div class='pointer' title='Delete Expense Category' onclick='CompanySettingsView.prototype.DeleteExpenseCategoryItem("+n.categoryId+")'><img src='"+baseURL+"images/delete.png' class='img-responsive' /><\/div>":""},width:"50px"}],dataBound:t,dataBinding:function(){$("#ExpenseCategoryGrid input[type=checkbox].checkAll").prop("checked",!1)}})};CompanySettingsView.prototype.ExpenseCategoryClearFields=function(){var n=this;$("#hdnExpenseCategoryId, #txtCategory, #ddlTaxPayable, #ddlCPFPayable").val("");$("#ddlTaxPayable, #ddlCPFPayable").val(0);$("#frmExpenseCategory div.form-group.has-error.has-danger").removeClass("has-error has-danger")};CompanySettingsView.prototype.OpenExpenseCategoryModal=function(n){CompanySettingsView.prototype.ExpenseCategoryClearFields();var t=$("#ExpenseCategoryGrid").data("kendoGrid").dataSource.get(n);t.categoryId!=""&&t.categoryId!=undefined&&($("#popExCatHdr").text("Edit Expense Category"),$("#hdnExpenseCategoryId").val(t.categoryId),$("#txtCategory").val(t.category.trim()),$("#ddlTaxPayable").val(t.isTaxPayable==!0?1:0),$("#ddlCPFPayable").val(t.isCPFPayable==!0?1:0),$("#ExpenseCategoryModal").modal("show"))};CompanySettingsView.prototype.DeleteExpenseCategoryItem=function(n){var t=ShowConfirmationAlertBox("Are you sure about deleting expense category?");t.then(function(){$.ajax({url:baseURL+"Settings/DeleteExpenseCategory",data:{categoryId:n},type:"POST",async:!1,success:function(t){t&&(ShowAlertBox("Expense category deleted successfully."),RemoveItemFromGrid("ExpenseCategoryGrid",n))},error:function(){ShowAlertBox("Fail to delete expense category.")}})})};CompanySettingsView.prototype.SaveExpenseCategory=function(n){var t=$.post(baseURL+"Settings/AddEditExpenseCategory",n);t.done(function(){$("#ExpenseCategoryModal").modal("hide");refreshGrid($("#ExpenseCategoryGrid"));var t="Expense category "+(n.CategoryId!=null&&n.CategoryId!=""&&n.CategoryId!=undefined?"updated":"added")+" successfully!";ShowAlertBox(t)});t.fail(function(){ShowAlertBox("Fail to save expense category!")})};CompanySettingsView.prototype.SavePayrollExchangeRate=function(n){var t=!1;return $.ajax({url:baseURL+"Settings/AddPayrollExchangeRate",data:{perDiemRateSettings:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CompanySettingsView.prototype.deletePayrollExchageRate=function(){var n=!1;return $.ajax({url:baseURL+"Settings/DeletePayrollExchangeRate",data:{perDiemRateId:perDiemRateId},type:"POST",async:!1,success:function(t){n=t},error:function(){n=!1}}),n};CompanySettingsView.prototype.PayrollExchangeRatesClearFields=function(){$("#ddlPayrollExchangeRatesYear").val("");$("#ddlPayrollExchangeRatesYear").val("");$("#ddlPayrollExchangeRatesMonth").val("");$("#ddlPayrollExchangeRatesFromCurrency").val("");$("#ddlPayrollExchangeRatesToCurrency").val("");$("#ExchangeRateId").val("");$("#txtPayrollExchangeRate").val("")};CompanySettingsView.prototype.LoadPayrollExchangeRateGrid=function(){function t(){setTimeout(function(){KGrdPageSizeDdlPosition("PayrollExchangeRatesGrid",0)},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadPayrollExchangeRate",dataType:"json"},parameterMap:function(n,t){if(t==="read")return{isLoadAll:$("#isLoadAllReports").val()}}},batch:!0,scrollable:!0,pageSize:5,schema:{model:{id:"exchangeRateId",fields:{exchangeRateId:{editable:!1},companyId:{editable:!1},year:{editable:!1},month:{editable:!1},rate:{editable:!1},fromCurrencyCode:{editable:!1},toCurrencyCode:{editable:!1}}}}});$("#PayrollExchangeRatesGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,selectable:"row",columns:[{field:"exchangeRateId",title:"exchangeRateId",hidden:!0},{field:"companyId",title:"companyId",hidden:!0},{field:"year",title:"Year",width:100},{field:"month",title:"Month",width:100},{field:"fromCurrencyCode",title:"From Currency",width:100},{field:"toCurrencyCode",title:"To Currency",width:100},{field:"rate",title:"Exchange Rate",width:100},{template:'<a href="javascript: openPayrollExchangeRateModal(#=exchangeRateId#);"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Exchange Rate" /><\/a>',width:50},{template:"<div class='pointer' title='Delete Payroll Exchange Rate' onclick='deletePayrollExchangeRate(#=exchangeRateId#)'><img src='"+baseURL+"images/delete.png' class='img-responsive' /><\/div>",width:50},],dataBound:t})};SubsciptionView.prototype.Init=function(){$("#divYearly, #divMonthy").on("click",function(){var n=$(this).attr("id")=="divYearly"?"divMonthy":"divYearly";DivYesNoSelection($(this).attr("id"),n)})};CommonDisplayFieldsView.prototype.Init=function(){var t=this,n=$("#hdnInitialListName").val(),r=$("#hdnInitialListId").val();$("#lblCommonDisplayFieldHeader").text(n);$("#hdnActiveListName").val(n);$("#hdnActiveListId").val(r);$("#nav-tabs-wrapper li a").click(function(n){n.preventDefault();$(this).parent().addClass("active").siblings().removeClass("active")});t.LoadCommonDisplayFieldsGrid();$("#linkAddCommonDisplayField").click(function(n){n.preventDefault();$("#popupHdr").text($("#lblCommonDisplayFieldHeader").text());$("#AddCommonListItem").modal()});$("#AddCommonListItem").on("hidden.bs.modal",function(){$(this).find("#frmCommonListItems .has-error.has-danger").removeClass("has-error has-danger")});$("#frmCommonListItems").submit(function(n){var t,r,u,f;if(n.preventDefault(),t=$("#txtCommonListItemName").val().trim(),!(t.length<=0)){for(r=!1,u=$("#CommonDisplayFieldsGrid").data("kendoGrid").dataSource._data,i=0;i<u.length;i++)u[i].listItemName.trim()==t.trim()&&(r=!0);if(r){ShowAlertBox("List item already exists.");return}f=$.post(baseURL+"GlobalSettings/AddCommonListItem",{commonListId:$("#hdnActiveListId").val(),listItemName:t});f.done(function(n){n?($("#AddCommonListItem").modal("hide"),ShowAlertBox("List item added successfully."),$("#txtCommonListItemName").val(""),refreshGrid($("#CommonDisplayFieldsGrid"))):ShowAlertBox("Error while adding list item.")});f.fail(function(){ShowAlertBox("Error while adding list item.")})}})};CommonDisplayFieldsView.prototype.LoadCommonDisplayFieldsGrid=function(){function t(){if(setTimeout(function(){$("#CommonDisplayFieldsGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit display field");$("#CommonDisplayFieldsGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#CommonDisplayFieldsGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update display field");$("#CommonDisplayFieldsGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$("#CommonDisplayFieldsGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete display field");$(".k-i-close").removeClass("k-icon k-i-close");$("#CommonDisplayFieldsGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("CommonDisplayFieldsGrid")},1),this.dataSource.view().length==0){var t=this.dataSource.page();t>1&&this.dataSource.page(t-1)}}function u(n){var t=$("#CommonDisplayFieldsGrid").data("kendoGrid").dataSource._data,r=!1;for(i=0;i<t.length;i++)t[i].dirty&&(r=!0);if(!r)return!0;for(i=0;i<t.length;i++)if(t[i].listItemName==n&&t[i].dirty==!1)return!1;return!0}var n=0,r=new kendo.data.DataSource({transport:{read:{url:baseURL+"GlobalSettings/GetCommonListItems",dataType:"json"},update:{url:baseURL+"GlobalSettings/UpdateCommonListItem",dataType:"json"},destroy:{url:baseURL+"GlobalSettings/DeleteCommonListItem",dataType:"json"},parameterMap:function(n,t){return t!="read"&&n.models?{commonListItem:kendo.stringify(n.models)}:t==="read"?{commonListId:$("#hdnActiveListId").val()}:void 0}},batch:!0,pageSize:5,schema:{model:{id:"commonListItemId",fields:{commonListItemId:{editable:!1},listItemName:{editable:!0,validation:{required:!0,maxlength:450,listItemValidation:function(n){return n.is("[name='listItemName']")&&n.val()!=""?(n.attr("data-listItemValidation-msg","List item already exists"),u(n.val())):!0}},nullable:!1},updatedByUserId:{editable:!1},updatedOnDate:{editable:!1}}}}});$("#CommonDisplayFieldsGrid").kendoGrid({dataSource:r,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"commonListItemId",hidden:!0},{title:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:45},{field:"listItemName",width:"300px",title:"List Item Name"},{field:"updatedByUserId",title:"Update User",width:"150px",template:"#if(updatedByUserId === null || updatedByUserId === ''){#-#}else{# #=updatedByUserId#  #}#"},{field:"updatedOnDate",title:"Update date",width:"150px",template:"#if(updatedOnDate === null || updatedOnDate === ''){#-#}else{# #=kendo.toString(kendo.parseDate(updatedOnDate), 'dd MMM yyyy')#  #}#"},{command:[{name:"edit",text:{edit:"",update:"",cancel:""}},{name:"destroy",text:""}],title:"&nbsp;",width:"100px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};CommonPayItemView.prototype.Init=function(){var n=this,t,i;n.LoadCommonPayItemsGrid();$("#frmCommonPayItems").submit(function(t){var y,p;if(t.preventDefault(),!$("#btnSaveCommonPayItem").hasClass("disabled")){var u=$("#hdnCommonPayItemId").val(),f=$("#PayItemDesc").val(),w=$("#ddlPayItemCategory option:selected").text(),e=$("#ddlTypeOfWage option:selected").text(),o=$("#ddlCPFApplicable option:selected").text(),s=$("#ddlIR8ACategory option:selected").text(),b=$("#chkIsUniversalPayItem").prop("checked"),r=$("#rdnVariable").is(":checked"),h=$("#ddlVariableAmountBasedOn option:selected").text(),c=$("#txtFixedAmount").val(),k=$("#PercentageForAmt").val(),l=$("#startDate").val(),i=$("#ddlPayItemEndDate option:selected").text(),a=$("#endDate").val(),v=$("#txtRepeatForTimes").val()===""?0:$("#txtRepeatForTimes").val(),d=r?!1:$("input:radio[name$='rdnProrate']:checked").val();if(!(f.length<=0)&&!(e.length<=0)&&!(o.length<=0)&&!(s.length<=0)&&!(l.length<=0)&&!(i.length<=0)){if(r){if(h.length<=0)return}else if(c.length<=0)return;if(i==="End Date"){if(a.length<=0)return}else if(i==="Repeat for # times"&&v.length<=0)return;y={CommonPayItemId:u,Description:f,Category:w,TypeOfWage:e,CPFApplicable:o,IR8ACategory:s,IsUniversalForAllEmployees:b,IsVariableAmount:r,VariableAmountBasedOn:h,Amount:c,AmountPercentageInCaseOfVariable:k,StartDate:l,EndsOn:i,EndDate:a,RepeatForTimes:v,IsProrate:d};p=n.SaveCommonPayItem(y);p==!0?(u>0?ShowAlertBox("Pay item updated successfully"):ShowAlertBox("Pay item added successfully"),$("#AddCommonPayItem").modal("hide"),refreshGrid($("#CommonPayItemsGrid"))):ShowAlertBox("Error while adding common pay item")}}});$("#ddlVariableAmountBasedOn").hide();$("#divPercentageForAmt").hide();$("#payItemEndDate").hide();$("#txtRepeatForTimes").hide();$("input[name$='rdnPayItemAmount']").click(function(){var t=$(this).val();n.PayItemAmountSelection(t)});$("#ddlPayItemEndDate").change(function(){var t=$(this).find("option:selected").text(),n=$(this).val();n==="End Date"?($("#payItemEndDate").show(),$("#txtRepeatForTimes").val(""),$("#txtRepeatForTimes").hide(),$("#endDate").prop("required",!0),$("#txtRepeatForTimes").removeAttr("required")):n==="Repeat for # times"?($("#payItemEndDate").hide(),$("#txtRepeatForTimes").show(),$("#txtRepeatForTimes").prop("required",!0),$("#endDate").val(""),$("#endDate").removeAttr("required")):($("#endDate").val(""),$("#txtRepeatForTimes").val(""),$("#payItemEndDate").hide(),$("#txtRepeatForTimes").hide(),$("#endDate").removeAttr("required"),$("#txtRepeatForTimes").removeAttr("required"))});$("#ddlCPFApplicable").change(function(){n.SetTypeOfWageCommon()});$("#ddlPayItemCategory").change(function(){var t=$(this).val();t==="Reimbursement"?n.ReimbursementPayItemCategory():t==="Overtime"?n.OvertimePayItemCategory():n.OtherPayItemCategory();n.SetTypeOfWageCommon()});$("#ddlVariableAmountBasedOn").change(function(){var n=$(this).val();n==="% of present month basic salary"?($("#lblTextInCaseOfVariable").text("%"),$("#divPercentageForAmt").show(),$("#PercentageForAmt").prop("required",!0)):n==="Amount per day for the days actually worked in a month"?($("#lblTextInCaseOfVariable").text("Amount per working day"),$("#divPercentageForAmt").show(),$("#PercentageForAmt").prop("required",!0)):n==="Amount per day for the total working days in a month"?($("#lblTextInCaseOfVariable").text("Amount per working day"),$("#divPercentageForAmt").show(),$("#PercentageForAmt").prop("required",!0)):n==="Other user entered amount (may differ every month)"?($("#lblTextInCaseOfVariable").text(""),$("#divPercentageForAmt").hide(),$("#PercentageForAmt").val(""),$("#PercentageForAmt").removeAttr("required")):n==="Number of times"?$("#lblTextInCaseOfVariable").text("ex: 1, 1.5"):n===""&&$("#lblTextInCaseOfVariable").text("")});t=new Date;i=new Date(t.getFullYear(),t.getMonth(),t.getDate());$("#payItemStartDate").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&AddOrMinusDayFromDate(new Date(n.date.valueOf()),"payItemEndDate",!0,1,"setStartDate")});$("#payItemEndDate").datepicker({format:"dd/M/yyyy",todayHighlight:!0,autoclose:!0}).on("changeDate",function(n){n.date!=undefined&&AddOrMinusDayFromDate(new Date(n.date.valueOf()),"payItemStartDate",!1,1,"setEndDate")});$("#linkAddCommonPayItem").click(function(t){t.preventDefault();$("#PayItemDesc").prop("disabled",!1);$("#AddCommonPayItem").modal();n.PayItemClearFields()});$("#linkDeleteCommonPayItem").click(function(t){var i;if(t.preventDefault(),i=$("#CommonPayItemsGrid tbody").find("input:checked").length,i<=0){ShowAlertBox("Please select pay item(s) to delete");return}var r=!0,u=0,f=ShowConfirmationAlertBox("Are you sure about deleting selected pay item(s)?");f.then(function(){$("#CommonPayItemsGrid").find("input:checked").each(function(){this.id!="header-chk"&&(r=n.deletePayItem(this.id),r&&(u++,RemoveItemFromGrid("CommonPayItemsGrid",this.id)))});i===u?ShowAlertBox("Pay item(s) deleted successfully"):ShowAlertBox("Error while deleting pay item(s)")})});$("#AddCommonPayItem").on("hidden.bs.modal",function(){$(this).find("#frmCommonPayItems .has-error.has-danger").removeClass("has-error has-danger");$("#frmCommonPayItems #btnSaveCommonPayItem.disabled").removeClass("disabled")})};CommonPayItemView.prototype.LoadCommonPayItemsGrid=function(){function t(){setTimeout(function(){$("#CommonPayItemsGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("CommonPayItemsGrid")});KGrdPageSizeDdlPosition("CommonPayItemsGrid")},1)}var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"GlobalSettings/LoadCommonPayItems",dataType:"json"}},pageSize:5,batch:!0,schema:{model:{id:"commonPayItemId",fields:{commonPayItemId:{editable:!1},description:{editable:!1},type:{editable:!1},category:{editable:!1},typeOfWage:{editable:!1},cpfApplicable:{editable:!1},iR8ACategory:{editable:!1},frequency:{editable:!1},amount:{editable:!1}}}}});$("#CommonPayItemsGrid").kendoGrid({dataSource:n,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{template:'<input type="checkbox" id="#:data.commonPayItemId#" class="chk-box"><label class="checkbox-inline" for="#:data.commonPayItemId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk" class="checkAll"><label class="checkbox-inline" for="header-chk"><\/label>',width:50},{field:"description",title:"Pay Item Description",width:200},{field:"type",hidden:!0},{field:"category",title:"Pay Item Category"},{field:"cpfApplicable",title:"CPF Applicable"},{field:"typeOfWage",title:"Type of Wage"},{field:"iR8ACategory",title:"IR8A Code"},{field:"frequency",title:"Frequency",width:120},{field:"amount",title:"Amount",format:"{0:c2}",width:100},{template:'<a href="javascript: openCommonPayItemModal(#=commonPayItemId#);"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Common pay item" /><\/a>',width:50},{template:'<a href="javascript: deleteCommonPayItem(#=commonPayItemId#);"><img src="'+baseURL+'images/delete.png" class="img-responsive" title="Delete Common pay item" /><\/a>',width:50}],dataBound:t,dataBinding:function(){$("#CommonPayItemsGrid input[type=checkbox].checkAll").prop("checked",!1)}});$(document).on("change",".checkAll",function(){$("#CommonPayItemsGrid tbody input:checkbox").prop("checked",this.checked)})};CommonPayItemView.prototype.PayItemClearFields=function(){var t=this,n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate());t.OtherPayItemCategory();$("#hdnCommonPayItemId").val("");$("#PayItemDesc").val("");$("#ddlPayItemCategory").val("");$("#ddlTypeOfWage").val("");$("#ddlCPFApplicable").val("");$("#ddlIR8ACategory").val("");$("#chkIsUniversalPayItem").removeAttr("checked");$("#rdnFixed").prop("checked",!0);t.PayItemAmountSelection("fixed");$("#ddlVariableAmountBasedOn").val("");$("#ddlVariableAmountBasedOn").removeAttr("required");$("#txtFixedAmount").val("");$("#PercentageForAmt").val("");$("#payItemStartDate").datepicker("setDate",i);$("#payItemStartDate").datepicker("setEndDate","");$("#ddlPayItemEndDate").val("");$("#payItemEndDate").hide();$("#txtRepeatForTimes").hide();$("#endDate").removeAttr("required");$("#txtRepeatForTimes").removeAttr("required");$("#payItemEndDate").datepicker("setDate",i);$("#txtRepeatForTimes").val("")};CommonPayItemView.prototype.PayItemAmountSelection=function(n){n==="variable"?($("#ddlVariableAmountBasedOn").show(),$("#txtFixedAmount").removeAttr("required"),$("#txtFixedAmount").val(""),$("#divPercentageForAmt").show(),$("#txtFixedAmount").hide(),$("#ddlVariableAmountBasedOn").change(),$("#ddlVariableAmountBasedOn").prop("required",!0),$("#PercentageForAmt").prop("required",!0),$("#rdnProrateNo, #rdnProrateYes").prop("checked",!1).prop("disabled",!0)):($("#txtFixedAmount").show(),$("#ddlVariableAmountBasedOn").hide(),$("#txtFixedAmount").prop("required",!0),$("#ddlVariableAmountBasedOn").removeAttr("required"),$("#divPercentageForAmt").hide(),$("#PercentageForAmt").val(""),$("#PercentageForAmt").removeAttr("required"),$("#rdnProrateNo").prop("checked",!0).prop("disabled",!1),$("#rdnProrateYes").prop("disabled",!1))};CommonPayItemView.prototype.OtherPayItemCategory=function(){$("#ddlTypeOfWage").prop("disabled",!1);$("#ddlCPFApplicable").prop("disabled",!1);$("#ddlIR8ACategory").prop("disabled",!1);$("#rdnFixed").prop("disabled",!1);$("#rdnVariable").prop("disabled",!1);$("#ddlVariableAmountBasedOn option:selected").val()=="Number of times"&&$("#ddlVariableAmountBasedOn").val("Select");$("#ddlVariableAmountBasedOn").prop("disabled",!1);ShowHideDropDownOption("ddlVariableAmountBasedOn","Number of times",!0);$("#lblTextInCaseOfVariable").text("");$("input[name$='rdnPayItemAmount']:checked").val()=="variable"&&($("#ddlVariableAmountBasedOn").prop("required",!0),$("#txtFixedAmount").removeAttr("required"))};CommonPayItemView.prototype.OvertimePayItemCategory=function(){var n=this;$("#ddlTypeOfWage").prop("disabled",!1);$("#ddlCPFApplicable").prop("disabled",!1);$("#ddlIR8ACategory").prop("disabled",!1);$("#rdnVariable").prop("checked",!0);n.PayItemAmountSelection("variable");$("#rdnFixed").prop("disabled",!0);$("#rdnVariable").prop("disabled",!0);ShowHideDropDownOption("ddlVariableAmountBasedOn","Number of times",!1);$("#ddlVariableAmountBasedOn").val("Number of times");$("#ddlVariableAmountBasedOn").prop("disabled",!0);$("#lblTextInCaseOfVariable").text("ex: 1, 1.5");$("#txtFixedAmount").removeAttr("required");$("#ddlVariableAmountBasedOn").removeAttr("required");$("#PercentageForAmt").prop("required",!0);$("#divPercentageForAmt").css("display")=="none"&&$("#divPercentageForAmt").css("display","block")};CommonPayItemView.prototype.ReimbursementPayItemCategory=function(){$("#ddlTypeOfWage").val("Additional Wages");$("#ddlTypeOfWage").prop("disabled",!0);$("#ddlCPFApplicable").val("No");$("#ddlCPFApplicable").prop("disabled",!0);$("#ddlIR8ACategory").val("Not Applicable");$("#ddlIR8ACategory").prop("disabled",!0);$("#rdnFixed").prop("disabled",!1);$("#rdnVariable").prop("disabled",!1);$("#ddlVariableAmountBasedOn option:selected").val()=="Number of times"&&$("#ddlVariableAmountBasedOn").val("Select");$("#ddlVariableAmountBasedOn").prop("disabled",!1);ShowHideDropDownOption("ddlVariableAmountBasedOn","Number of times",!0);$("#lblTextInCaseOfVariable").text("");$("input[name$='rdnPayItemAmount']:checked").val()=="variable"&&($("#ddlVariableAmountBasedOn").prop("required",!0),$("#txtFixedAmount").removeAttr("required"))};CommonPayItemView.prototype.SetTypeOfWageCommon=function(){var n=$("#ddlCPFApplicable").find("option:selected").val();n==="No"?(($('#ddlTypeOfWage option[value="Not Applicable"]').val()!=undefined||$('#ddlTypeOfWage option[value="Not Applicable"]').val()!="")&&$("#ddlTypeOfWage").append('<option value="Not Applicable">Not Applicable<\/option>'),$("#ddlTypeOfWage").val("Not Applicable"),$("#ddlTypeOfWage").prop("disabled",!0)):($("#ddlTypeOfWage option[value='Not Applicable']").remove(),$("#ddlTypeOfWage").prop("disabled",!1))};CommonPayItemView.prototype.SaveCommonPayItem=function(n){var t=!1;return $.ajax({url:baseURL+"GlobalSettings/CommonPayItems",data:{commonPayItems:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};CommonPayItemView.prototype.deletePayItem=function(n){var t=!1;return $.ajax({url:baseURL+"GlobalSettings/DeleteCommonPayItem",data:{commonPayItemId:n},type:"POST",async:!1,success:function(n){t=n},error:function(){t=!1}}),t};EmailTemplateView.prototype.Init=function(){var n=this;$("#emailTemplateEditor").kendoEditor({resizable:{content:!0},imageBrowser:{messages:{dropFilesHere:"Drop files here"},transport:{read:{url:baseURL+"ImageBrowser/Read",dataType:"json"},destroy:{url:baseURL+"ImageBrowser/Destroy",type:"POST"},uploadUrl:baseURL+"ImageBrowser/Upload",imageUrl:window.location.origin+baseURL+"ImageBrowser/Image?path={0}"}},tools:["formatting","bold","italic","underline","strikethrough","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","foreColor","backColor","subscript","superscript","tableWizard","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","cleanFormatting","fontName","fontSize"]});$("#ddlFilterByTemplate").change(function(){var r=$(this).find("option:selected").text(),t=$(this).val(),i={operationId:t};n.GetEmailTemplate(i)});$("#frmUpdateEmailTemplate").submit(function(t){var f;t.preventDefault();var i=$("#ddlFilterByTemplate").val(),r=$("#subject").val(),u=$("#emailTemplateEditor").data("kendoEditor").value();i!==""&&r!==""&&u!==""&&(f={operationId:i,subjectTemplate:r,contentTemplate:u},n.SaveEmailTemplate(f))});$("ul.k-editor-toolbar li").on("click",function(){$("div.k-animation-container").css("top",$(this).offset().top+$(this).height()+3)})};EmailTemplateView.prototype.GetEmailTemplate=function(n){var t=$.get(baseURL+"GlobalSettings/GetEmailTemplate",n);t.done(function(n){var t=$("#emailTemplateEditor").data("kendoEditor");t.value(n.contentTemplate);$("#subject").val(n.subjectTemplate)});t.fail(function(){ShowAlertBox("Error while fetching email template")})};EmailTemplateView.prototype.SaveEmailTemplate=function(n){var t=$.post(baseURL+"GlobalSettings/SaveEmailTemplate",n);t.done(function(){ShowAlertBox("Template Updated Successfully")});t.fail(function(){ShowAlertBox("Failed to update the template")})};ManageCompaniesView.prototype.Init=function(){this.LoadManageCompaniesGrid();$("#ddlFilterByStatus").on("change",function(){var n=$("#ddlFilterByStatus").find(":selected").val();doApplyGridFilter("ManageCompaniesGrid","eq","status",n==""||n=="ALL"?0:n)})};ManageCompaniesView.prototype.LoadManageCompaniesGrid=function(){function t(){setTimeout(function(){$("#ManageCompaniesGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit company status");$("#ManageCompaniesGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#ManageCompaniesGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update company status");$("#ManageCompaniesGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");$('input[type="radio"]:checked').parent().addClass("btn-info");$("#ManageCompaniesGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("ManageCompaniesGrid")},1)}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"GlobalSettings/GetOrganizationsList",dataType:"json"},update:{url:baseURL+"GlobalSettings/UpdateCompanyStatus",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{companyDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:5,schema:{model:{id:"companyId",fields:{companyId:{editable:!1},companyName:{editable:!1},registrationNumber:{editable:!1},address:{editable:!1},contactPerson:{editable:!1},mobileNumber:{editable:!1},email:{editable:!1},status:{editable:!1},isDeleted:{type:"boolean",editable:!0}}}}});$("#ManageCompaniesGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"companyId",hidden:!0},{title:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:45},{field:"companyName",width:"170px",title:"Company Name"},{field:"registrationNumber",width:"110px",title:"Reg. Number"},{field:"address",width:"240px",title:"Address",template:"#if(address === null || address === ''){# - #}else{# #=address# #}#"},{field:"contactPerson",width:"120px",title:"Contact Person",template:"#if(contactPerson === null || contactPerson === ''){# - #}else{# #=contactPerson# #}#"},{field:"mobileNumber",width:"120px",title:"Mobile",template:"#if(mobileNumber === null || mobileNumber === ''){# - #}else{# #=mobileNumber# #}#"},{field:"email",width:"160px",title:"Email",template:"#if(email === null || email === ''){# - #}else{# #=email# #}#"},{field:"status",hidden:!0},{field:"isDeleted",title:"Status",width:"165px",template:"<label class='btn btn-default grid-btn-width'><input hidden disabled type='radio' value='#: isDeleted #' #= isDeleted=== false ? 'checked' : ''# >Active<\/label><label class='btn btn-default grid-btn-width'><input hidden disabled type='radio' value='#: isDeleted #' #= isDeleted=== true ? 'checked' : ''# >Inactive<\/label>",editor:customStatusEditor},{command:[{name:"edit",text:{edit:"",update:"",cancel:""}}],title:"&nbsp;",width:"70px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}});$(document).on("change","input[type='radio']",function(){$('input[type="radio"]').parent().removeClass("btn-info");$('input[type="radio"]:checked').parent().addClass("btn-info")})};GenerateGIROView.prototype.Init=function(){var n=this;$("#hdnResponseErrors").val()!=""&&ShowAlertBox($("#hdnResponseErrors").val());$("#datePickerPaymentDate").datepicker({format:"dd/M/yyyy",autoclose:!0,todayHighlight:!0});this.InitializePageControls();this.LoadGenerateGIROGrid();$("#ddlPayrollYear, #ddlPayrollMonth, #ddlGIROCurrency").on("change",function(){n.SetBankStmtLabels();refreshGrid($("#GenerateGIROGrid"))});$("#GenerateGIROGrid tbody").on("click",":checkbox",function(){n.CalculateTotalEmpAndAmount()});$("#btnGenerateGIROFile").click(function(t){t.preventDefault();n.GenerateGIROFileClick()});$("#ddlGIROBankName").on("change",function(){var n=$("#ddlGIROBankName option:selected").text();n.includes("DBSSSGSGXXX")||n.includes("DBSSSGSG")?($("#divOriginatingBankStmtRef").addClass("hidden"),$("#lblOriginatingBankStmtRef").removeClass("required"),$("#txtOriginatingBankStmtRef").removeClass("required"),$("#divOrignizationId").removeClass("hidden"),$("#lblOrignizationId").addClass("required"),$("#txtOrignizationId").addClass("required"),$("#lblReceivingBankStmtRef").removeClass("required"),$("#txtReceivingBankStmtRef").removeClass("required")):($("#divOriginatingBankStmtRef").removeClass("hidden"),$("#lblOriginatingBankStmtRef").addClass("required"),$("#txtOriginatingBankStmtRef").addClass("required"),$("#divOrignizationId").addClass("hidden"),$("#lblOrignizationId").removeClass("required"),$("#txtOrignizationId").removeClass("required"),$("#lblReceivingBankStmtRef").addClass("required"),$("#txtReceivingBankStmtRef").addClass("required"))})};GenerateGIROView.prototype.InitializePageControls=function(){var n=new Date,i=kendo.toString(kendo.parseDate(n),"dd/MMM/yyyy").split("/")[1],t;$("#ddlPayrollYear").val(n.getFullYear());$("#ddlPayrollMonth").val(i);$("#datePickerPaymentDate").datepicker("setDate",n);GenerateGIROView.prototype.SetBankStmtLabels();$("#lblTotalEmployees").text(0);$("#lblTotalAmount").text(0);t=$("#ddlGIROBankName > option").length;t==2&&$("#ddlGIROBankName").val($("#ddlGIROBankName option:eq(1)").val()).attr("selected","selected")};GenerateGIROView.prototype.SetBankStmtLabels=function(){var n=$("#ddlPayrollYear").val(),t=$("#ddlPayrollMonth").val();$("#txtOriginatingBankStmtRef").val("Payroll "+t+" "+n);$("#txtReceivingBankStmtRef").val("Salary For "+t+" "+n)};GenerateGIROView.prototype.CalculateTotalEmpAndAmount=function(){var n=0,t=0;$("#GenerateGIROGrid tbody").find("input:checked").each(function(){var i=$("#GenerateGIROGrid").data("kendoGrid").dataSource.get(this.id);i!=null&&i!=undefined&&((i.employeeId!=null||i.employeeId!="")&&(n=n+1),(i.netPay!=null||i.netPay!="")&&(t=t+i.netPay))});$("#lblTotalEmployees").text(n);$("#lblTotalAmount").text(kendo.toString(t,"n2"))};GenerateGIROView.prototype.LoadGenerateGIROGrid=function(){function t(){setTimeout(function(){$("#GenerateGIROGrid tbody input:checkbox").on("change",function(){SetHeaderChkBoxCheckUnCheck("GenerateGIROGrid")});$("#GenerateGIROGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("GenerateGIROGrid")},1)}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payroll/LoadGRIOFileDetails",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{payrollYear:$("#ddlPayrollYear").val(),payrollMonth:$("#ddlPayrollMonth").val(),currencyCode:"SGD"}}},aggregate:[{field:"netPay",aggregate:"sum"}],batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},employeeCode:{editable:!1},employeeName:{editable:!1},idNumber:{editable:!1},payMode:{editable:!1},eBankName:{editable:!1},eBankCode:{editable:!1},eBranchCode:{editable:!1},eBankBICCode:{editable:!1},eAccountName:{editable:!1},eAccountNumber:{editable:!1},netPay:{editable:!1},currency:{editable:!1},currencySymbol:{editable:!1}}}}});$("#GenerateGIROGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{template:'<input type="checkbox" id="#:data.employeeId#" class="chk-box"><label class="checkbox-inline" for="#:data.employeeId#"><\/label>',headerTemplate:'<input type="checkbox" id="header-chk-giro" class="checkAll"><label class="checkbox-inline" for="header-chk-giro"><\/label>',width:40},{title:"Sno",field:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:50},{field:"employeeCode",width:"120px",title:"Employee Code"},{field:"employeeName",width:"150px",title:"Employee Name"},{field:"idNumber",width:"100px",title:"ID Number"},{field:"payMode",width:"100px",title:"Pay Mode"},{field:"eBankName",width:"120px",title:"Bank Name"},{field:"eBankCode",width:"100px",title:"Bank Code"},{field:"eBranchCode",title:"Branch Code",width:"100px",template:"#if(eBranchCode === null || eBranchCode === ''){# - #}else{# #=eBranchCode# #}#"},{field:"eBankBICCode",width:"120px",title:"Bank BIC Code"},{field:"eAccountName",width:"120px",title:"Account Name"},{field:"eAccountNumber",width:"120px",title:"Account Number"},{field:"netPay",width:"120px",format:"{0:n2}",title:"Net Pay",footerTemplate:function(n){return formatAmountWithCurrency(kendo.toString(n.netPay.sum,"n2"),"",$("#GenerateGIROGrid").attr("currency"))},template:function(n){return $("#GenerateGIROGrid").attr("currency",n.currencySymbol),formatAmountWithCurrency(n.netPay,n.currency,n.currencySymbol)}},],editable:"inline",edit:t,dataBound:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}});$(document).on("change",".checkAll",function(){$("#GenerateGIROGrid tbody input:checkbox").prop("checked",this.checked);GenerateGIROView.prototype.CalculateTotalEmpAndAmount()})};GenerateGIROView.prototype.GenerateGIROFileClick=function(){var n=$("#ddlGIROBankName option:selected").text(),e,t,c;if((n.includes("DBSSSGSGXXX")||n.includes("DBSSSGSG"))&&$("#txtOrignizationId").val()==""){ShowAlertBox("Please enter Organization Id assigned by DBS to generate GIRO file");return}if((n.includes("DBSSSGSGXXX")||n.includes("DBSSSGSG"))&&($("#txtOrignizationId").val().length>=13||$("#txtOrignizationId").val().length<=11)){ShowAlertBox("Organization Id assigned by DBS must be 12 characters");return}if(e=$("#GenerateGIROGrid tbody").find("input[type='checkbox']:checked").length,e<=0){ShowAlertBox("Please select employee(s) to generate GIRO file");return}var i=$("#ddlPayrollYear").val(),r=$("#ddlPayrollMonth").val(),u=$("#dtPaymentDate").val(),o=$("#txtOriginatingBankStmtRef").val(),s=$("#txtReceivingBankStmtRef").val(),f=$("#ddlGIROBankName").val(),h=$("#txtOrignizationId").val();if((n.includes("DBSSSGSGXXX")||n.includes("DBSSSGSG"))&&($("#txtOrignizationId").val().length>=13||$("#txtOrignizationId").val().length<=11)&&(i===""||r===""||u===""||h===""||f==="")){ShowAlertBox("Please fill all the required fields");return}if((!n.includes("DBSSSGSGXXX")||!n.includes("DBSSSGSG"))&&(i===""||r===""||u===""||o===""||s===""||f==="")){ShowAlertBox("Please fill all the required fields");return}t="";$("#GenerateGIROGrid tbody").find("input[type='checkbox']:checked").each(function(){t=t==""?this.id:t+","+this.id});c="SGD";window.location.href=baseURL+"Payroll/GenerateGIROFile?ids="+t+"&yr="+i+"&mnt="+r+"&dt="+u+"&oRef="+o+"&rRef="+s+"&giroid="+f+"&currencyCode="+c+"&organizationId="+h};BanksView.prototype.Init=function(){var n=this;this.LoadBanksGrid();$("#btnLinkAddBank").click(function(t){t.preventDefault();n.BankClearFields();$("#AddNewBankPopup").modal()});$("#AddNewBankPopup").on("hidden.bs.modal",function(){$(this).find("#frmAddNewBank .has-error.has-danger").removeClass("has-error has-danger")});$("#frmAddNewBank").submit(function(t){var f;t.preventDefault();var e=$("#hdnBankId").val().trim(),i=$("#txtBankCode").val().trim(),r=$("#txtBankName").val().trim(),u=$("#txtSwiftBICCode").val().trim();i!=""&&r!=""&&u!=""&&(f={BankId:e,BankCode:i,BankName:r,SwiftBICCode:u},n.AddNewBank(f))})};BanksView.prototype.BankClearFields=function(){$("#hdnBankId, #txtBankCode, #txtBankName, #txtSwiftBICCode").val("")};BanksView.prototype.LoadBanksGrid=function(){function t(){setTimeout(function(){$("#BanksGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Leave Type");$("#BanksGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#BanksGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Leave Type");$("#BanksGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$("#BanksGrid .k-grid-delete").removeClass("k-button k-button-icontext").addClass("grid-delete").attr("title","Delete Leave Type");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");$(".k-checkbox-label").removeClass("k-checkbox-label").addClass("checkbox");$("#BanksGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});KGrdPageSizeDdlPosition("BanksGrid")},1)}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"Settings/LoadBankList",dataType:"json"}},batch:!0,pageSize:5,schema:{model:{id:"bankId",fields:{bankId:{editable:!1},bankCode:{editable:!1},bankName:{editable:!1},swiftBICCode:{editable:!1},updatedByUserId:{editable:!1},isUsed:{editable:!1},updatedOnDate:{editable:!1}}}}});$("#BanksGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,scrollable:!1,sortable:!0,resizable:!0,columns:[{field:"bankId",hidden:!0},{title:"Sno",attributes:{"sr-no":"Y"},template:function(){return++n},width:45},{field:"bankCode",width:"100px",title:"Bank Code"},{field:"bankName",width:"250px",title:"Bank Name"},{field:"swiftBICCode",width:"120px",title:"Bank BIC Code"},{field:"updatedByUserId",title:"Update User",width:"120px",template:"#if(updatedByUserId === null || updatedByUserId === ''){#-#}else{# #=updatedByUserId#  #}#"},{field:"updatedOnDate",title:"Update Date",width:"120px",template:"#if(updatedOnDate === null || updatedOnDate === ''){#-#}else{# #=kendo.toString(kendo.parseDate(updatedOnDate), 'dd MMM yyyy')#  #}#"},{template:'<a href="javascript: openAddNewBankModal(#=bankId#);"><img src="'+baseURL+'images/edit.png" class="img-responsive" title="Edit Bank" /><\/a>',width:"30px"},{template:function(n){return n.isUsed===!1?"<div class='pointer' title='Delete Bank' onclick='deleteBankDetails("+n.bankId+")'><img src='"+baseURL+"images/delete.png' class='img-responsive' /><\/div>":""},width:"30px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};BanksView.prototype.AddNewBank=function(n){var i=n.BankId>0?!0:!1,t=$.post(baseURL+"Settings/SaveBankDetails",{bank:n}),r=$("#BanksGrid");t.done(function(n){n?($("#AddNewBankPopup").modal("hide"),i?ShowAlertBox("Bank details Updated!"):ShowAlertBox("Bank details Added!"),refreshGrid(r)):ShowAlertBox("Fail to save bank details!")});t.fail(function(){ShowAlertBox("Fail to save bank details!")})};LeaveReportView.prototype.Init=function(){var n=this,t=new Date;$("#ddlYear").val(t.getFullYear());this.LoadCompanyLeaveTypesDDL($("#ddlYear").val());this.LoadLeaveReportGrid();$("#ddlLeaveStatus").val("Available");$("#ddlLeaveStatus, #ddlYear").on("change",function(){this.id=="ddlYear"&&(DistroyGridDataSrc("LeaveReportGrid"),n.LoadCompanyLeaveTypesDDL(this.value));var t=$("#ddlYear").val(),i=$("#ddlLeaveStatus").val();t!=""&&i!=""&&(DistroyGridDataSrc("LeaveReportGrid"),n.LoadLeaveReportGrid())});$("#btnLeaveReportExcel").click(function(n){n.preventDefault();$("#LeaveReportGrid").getKendoGrid().saveAsExcel()});$("#btnLeaveReportPDF").click(function(n){n.preventDefault();$("#LeaveReportGrid").getKendoGrid().saveAsPDF()})};LeaveReportView.prototype.LoadCompanyLeaveTypesDDL=function(n){$("#ddlLeaveTypes").empty();$.ajax({url:baseURL+"Reports/GetCompanyLeaveTypes",data:{year:n},type:"POST",async:!1,success:function(n){$.each(n,function(n,t){$("#ddlLeaveTypes").append($("<option>",{value:t.id,text:t.name}))})},error:function(){ShowAlertBox("Fail to load Leave Type!")}})};LeaveReportView.prototype.LoadLeaveReportGrid=function(){function t(){setTimeout(function(){$("#LeaveReportGrid div.k-grid-header thead tr").find('th:not([data-title="Employee Name"])').find("a.k-header-column-menu").remove();$("#LeaveReportGrid div.k-grid-header thead tr").find('th[data-title="Employee Name"]').find("a.k-header-column-menu").attr("title","Customize Columns");KGrdPageSizeDdlPosition("LeaveReportGrid",undefined,!0)},1)}function i(){var n=[];return n.push({field:"employeeId",hidden:!0}),n.push({field:"fullName",title:"Employee Name",width:150,reorderable:!1}),$("#ddlLeaveTypes option").each(function(){var t=$(this).val(),i=$(this).text();t!=""&&n.push({field:"column"+t,title:i,headerAttributes:{style:"padding: 0.4em 0.6em 0.4em 0.6em !important;"},headerTemplate:$("#ddlLeaveTypes option").length<4?i:SetHeaderTitle(i),width:$("#ddlLeaveTypes option").length<8?100:70,template:"#if(column"+t+" === null){# - #}else{# #=kendo.toString(column"+t+")#  #}#"})}),n}GridIdForColReSize="LeaveReportGrid";var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Reports/GetLeaveReportDetails",dataType:"json"},parameterMap:function(n,t){if(t=="read")return{year:$("#ddlYear").val(),leaveStatus:$("#ddlLeaveStatus").val()}}},pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},fullName:{editable:!1}}}}});$("#LeaveReportGrid").kendoGrid({excel:{fileName:"LeaveReport.xlsx",allPages:!0,filterable:!0},excelExport:function(n){var t=$(".lblMyCompany").text()+"\nLeave Report ("+$("#ddlLeaveStatus option:selected").text()+") : "+$("#ddlYear option:selected").text();SetKGridExportExcelHeader(n.workbook.sheets[0],t,!1,!1,0,5)},pdf:{allPages:!0,avoidLinks:!0,paperSize:"A3",margin:{top:"2cm",left:"0.5cm",right:"0.5cm",bottom:"1cm"},landscape:!0,scale:.7,date:new Date,fileName:"LeaveReport.pdf",template:function(){return'<div class="page-template margin-top20"><div class="header">'+$(".lblMyCompany").text()+"<\/br>Leave Report ("+$("#ddlLeaveStatus option:selected").text()+") : "+$("#ddlYear option:selected").text()+"<\/div><\/div>"}},pdfExport:function(n){var t=$("#LeaveReportGrid").data("kendoGrid").dataSource;$("#LeaveReportGrid div.k-grid-content").addClass("grdMaxHeightNone");t.pageSize(t.data().length+1);n.promise.done(function(){t.pageSize(5);$("#LeaveReportGrid div.k-grid-content").removeClass("grdMaxHeightNone")})},columnReorder:function(n){PreventClmReorder(n,"LeaveReportGrid",1)},dataSource:n,dataBound:t,reorderable:!0,resizable:!0,columnMenuInit:function(n){KGridColumnMenuCustomize(n.container.find(".k-menu").data("kendoMenu"),"Employee Name")},columnMenu:{messages:{columns:"Customize Columns"}},pageable:KGridPagableObj(),scrollable:!0,columns:i()})};UploadPayslipView.prototype.Init=function(){var n=this;this.LoadUploadPayslipGrid();$("#btnOpenPayslip").click(function(){$("#UploadPayslipPopup").modal()});$("#filePayslipDocument").change(function(n){var t=n.target.files[0].name;$("#lblFileName").text(t)});$("#frmUploadPayslip").submit(function(n){var t;n.preventDefault();var i=$("#ddlPayslipYear").val(),r=$("#ddlPayslipMonth").val(),u=$("#ddlEmployeeName").val(),f=$("#filePayslipDocument").val();i!==""&&r!==""&&u!==""&&f!==""&&(t=new FormData(this),$.ajax({url:baseURL+"Payslip/UploadEmployeePayslip",type:"POST",data:t,success:function(n){if(n=="FAIL"){ShowAlertBox("Document already uploaded for this month and year! Please select other.");return}n=="SUCCESS"&&ShowAlertBox("Payslip uploaded successfully.");RefreshUploadPayslipGrid();$("#UploadPayslipPopup").modal("toggle");ClearUploadPayslipFields()},cache:!1,contentType:!1,processData:!1}))});$("#UploadPayslipPopup").on("hidden.bs.modal",function(){ClearUploadPayslipFields()});$("#ddlFilterEmployeeName, #ddlFilterPayslipYear, #ddlFiltrPayslipMonth").change(function(){RefreshUploadPayslipGrid()})};UploadPayslipView.prototype.LoadUploadPayslipGrid=function(){var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payslip/LoadEmployeePayslips",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#ddlFilterEmployeeName").val(),r=$("#ddlFilterPayslipYear option:selected").text(),u=$("#ddlFiltrPayslipMonth option:selected").text();return{payslipYear:r,payslipMonth:u,employeeId:i}}}},batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},companyId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},payslipYear:{editable:!1},payslipMonth:{editable:!1},assetId:{editable:!1}}}}});$("#UploadPayslipGrid").kendoGrid({dataSource:n,pageable:!0,sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{field:"companyId",hidden:!0},{field:"employeeCode",title:"Employee Code",width:"120px"},{field:"employeeName",title:"Employee Name",width:"220px"},{field:"payslipYear",title:"Year",width:"120px"},{field:"payslipMonth",title:"Month",width:"120px"},{template:function(n){return n.assetId!=null&&n.assetId>0?"<div class='pointer'><a href='"+baseURL+"Asset/Download/"+n.assetId+"'><img src='"+baseURL+"images/attached.png' class='img-responsive' title='Download Payslip'/><\/a><\/div>":""},width:"40px"}]})};RefreshUploadPayslipGrid=function(){refreshGrid($("#UploadPayslipGrid"));var n=$("#UploadPayslipGrid").data("kendoGrid");n!=undefined&&n.dataSource.group([{field:"employeeCode"}])};ClearUploadPayslipFields=function(){$("#ddlPayslipYear").val("");$("#ddlPayslipMonth").val("");$("#ddlEmployeeName").val("");$("#filePayslipDocument").val("");$("#lblFileName").text("")};DownloadPayslipView.prototype.Init=function(){this.LoadDownloadPayslipGrid();$("#ddlFilterPayslipYear, #ddlFiltrPayslipMonth").change(function(){refreshGrid($("#DownloadPayslipGrid"))})};DownloadPayslipView.prototype.LoadDownloadPayslipGrid=function(){var n=new kendo.data.DataSource({transport:{read:{url:baseURL+"Payslip/LoadEmployeePayslips",dataType:"json"},parameterMap:function(n,t){if(t==="read"){var i=$("#hdnEmployeeId").val(),r=$("#ddlFilterPayslipYear option:selected").text(),u=$("#ddlFiltrPayslipMonth option:selected").text();return{payslipYear:r,payslipMonth:u,employeeId:i}}}},batch:!0,pageSize:5,schema:{model:{id:"employeeId",fields:{employeeId:{editable:!1},companyId:{editable:!1},employeeName:{editable:!1},employeeCode:{editable:!1},payslipYear:{editable:!1},payslipMonth:{editable:!1},assetId:{editable:!1}}}}});$("#DownloadPayslipGrid").kendoGrid({dataSource:n,pageable:!0,sortable:!0,resizable:!0,columns:[{field:"employeeId",hidden:!0},{field:"companyId",hidden:!0},{field:"employeeCode",title:"Employee Code",width:"120px"},{field:"employeeName",title:"Employee Name",width:"220px"},{field:"payslipYear",title:"Year",width:"120px"},{field:"payslipMonth",title:"Month",width:"120px"},{template:function(n){return n.assetId!=null&&n.assetId>0?"<div class='pointer'><a href='"+baseURL+"Asset/Download/"+n.assetId+"'><img src='"+baseURL+"images/attached.png' class='img-responsive' title='Download Payslip'/><\/a><\/div>":""},width:"40px"}]})};PayrollReportsView.prototype.Init=function(){$("#payroll_print_lb, #Payment_Listing_lb, #CPF_Reports_lb, #PayItems_Details_lb, #GIRO_lb, #Claim_Report_lb, #Claim_Report_lb, #EmpPay_lb, #GIRO_lb, #IR8A_lb, #CPF_lb, #Leave_Report_lb").on("click",function(){url=$(this).find('a[aPayrollReport="Y"]').attr("href");window.location.href=url.indexOf(baseURL)==0?url:baseURL+url.substring(url.indexOf("/")+1,url.length)})};ManageModuleAccess.prototype.Init=function(){this.ManageModuleAccessGrid();FilterByCompanyName("ManageModuleAccessGrid")};ManageModuleAccess.prototype.ManageModuleAccessGrid=function(){function t(){setTimeout(function(){$("#ManageModuleAccessGrid .k-grid-edit").removeClass("k-button k-button-icontext").addClass("grid-edit").attr("title","Edit Company Access");$("#ManageModuleAccessGrid .k-i-edit").removeClass("k-icon k-i-edit");$("#ManageModuleAccessGrid .k-grid-update").removeClass("k-button k-button-icontext k-primary").addClass("grid-update").attr("title","Update Company Access");$("#ManageModuleAccessGrid .k-grid-cancel").removeClass("k-button k-button-icontext").addClass("grid-cancel");$(".k-i-check").removeClass("k-icon k-i-check");$(".k-i-cancel").removeClass("k-icon k-i-cancel");$(".k-i-close").removeClass("k-icon k-i-close");$("#ManageModuleAccessGrid tbody a.k-grid-cancel.grid-cancel").click(function(){n=parseInt($(this).closest("tr").find('td[sr-no="Y"]').text())-1});$("#ManageModuleAccessGrid a.k-grid-update.grid-update").on("click",function(){var n=$(this).closest("tr"),t=n.find("#chkAccessLeave"),i=n.find("#chkAccessExpense"),r=n.find("#chkAccessTimesheet"),u=n.find("#chkAccessPayroll"),f=n.find("#chkAccessReport"),e;(t.is(":checked").toString()!=t.attr("attr-ModelVal")||i.is(":checked").toString()!=i.attr("attr-ModelVal")||u.is(":checked").toString()!=u.attr("attr-ModelVal")||r.is(":checked").toString()!=r.attr("attr-ModelVal")||f.is(":checked").toString()!=f.attr("attr-ModelVal"))&&(t.attr("attr-ModelVal",t.is(":checked")),i.attr("attr-ModelVal",i.is(":checked")),u.attr("attr-ModelVal",u.is(":checked")),r.attr("attr-ModelVal",r.is(":checked")),f.attr("attr-ModelVal",f.is(":checked")),e=$("#ManageModuleAccessGrid").data("kendoGrid").dataItem(n),!e.dirty,HandleUpdateEvent("#ManageModuleAccessGrid",baseURL+"GlobalSettings/UpdateCompanyAccess",{accessDetails:JSON.stringify([e])}))});KGrdPageSizeDdlPosition("ManageModuleAccessGrid")},1)}var n=0,i=new kendo.data.DataSource({transport:{read:{url:baseURL+"GlobalSettings/GetOrganizationsAccessList",dataType:"json"},update:{url:baseURL+"GlobalSettings/UpdateCompanyAccess",dataType:"json"},parameterMap:function(n,t){if(t!="read"&&n.models)return{accessDetails:kendo.stringify(n.models)}}},batch:!0,pageSize:5,schema:{model:{id:"companyId",fields:{companyId:{editable:!1},companyName:{editable:!1},registrationNumber:{editable:!1},hasPayrollModuleAccess:{type:"boolean",editable:!0},hasExpenseModuleAccess:{type:"boolean",editable:!0},hasReportModuleAccess:{type:"boolean",editable:!0},hasLeaveModuleAccess:{type:"boolean",editable:!0},hasTimesheetModuleAccess:{type:"boolean",editable:!0}}}}});$("#ManageModuleAccessGrid").kendoGrid({dataSource:i,pageable:KGridPagableObj(),scrollable:!0,resizable:!0,columns:[{field:"companyId",hidden:!0},{title:"Sno",width:45,attributes:{"sr-no":"Y",style:"text-align:center;"},headerAttributes:{style:"text-align:center;"},template:function(){return++n}},{field:"companyName",width:"190px",title:"Company Name"},{field:"registrationNumber",width:"110px",title:"Reg. Number"},{field:"hasLeaveModuleAccess",title:"Leave Access",width:"60px",attributes:{style:"text-align:center;"},headerAttributes:{style:"text-align:center;"},template:function(n){return n.hasLeaveModuleAccess==!0?"<span style='color:green'>YES<\/span>":"<span style='color:red'>NO<\/span>"},editor:function(n,t){var i=$("<input type='checkbox' id='chkAccessLeave' attr-ModelVal="+t.model.hasLeaveModuleAccess+" data-bind='value:"+t.field+"' "+(t.model.hasLeaveModuleAccess==!0?"checked='checked'":"")+"  class='chk-box'><label class='checkbox-inline' for='chkAccessLeave'><\/label>").appendTo(n);$("#chkAccessLeave").change(function(){$(this).attr("value",$("#chkAccessLeave").is(":checked"));t.model.hasLeaveModuleAccess=$("#chkAccessLeave").is(":checked")})}},{field:"hasExpenseModuleAccess",title:"Expense Access",width:"60px",attributes:{style:"text-align:center;"},headerAttributes:{style:"text-align:center;"},template:function(n){return n.hasExpenseModuleAccess==!0?"<span style='color:green'>YES<\/span>":"<span style='color:red'>NO<\/span>"},editor:function(n,t){var i=$("<input type='checkbox' id='chkAccessExpense' attr-ModelVal="+t.model.hasExpenseModuleAccess+" data-bind='value:"+t.field+"' "+(t.model.hasExpenseModuleAccess==!0?"checked='checked'":"")+"  class='chk-box'><label class='checkbox-inline' for='chkAccessExpense'><\/label>").appendTo(n);$("#chkAccessExpense").change(function(){$(this).attr("value",$("#chkAccessExpense").is(":checked"));t.model.hasExpenseModuleAccess=$("#chkAccessExpense").is(":checked")})}},{field:"hasTimesheetModuleAccess",title:"Timesheet Access",width:"60px",attributes:{style:"text-align:center;"},headerAttributes:{style:"text-align:center;"},template:function(n){return n.hasTimesheetModuleAccess==!0?"<span style='color:green'>YES<\/span>":"<span style='color:red'>NO<\/span>"},editor:function(n,t){var i=$("<input type='checkbox' id='chkAccessTimesheet' attr-ModelVal="+t.model.hasTimesheetModuleAccess+" data-bind='value:"+t.field+"' "+(t.model.hasTimesheetModuleAccess==!0?"checked='checked'":"")+"  class='chk-box'><label class='checkbox-inline' for='chkAccessTimesheet'><\/label>").appendTo(n);$("#chkAccessTimesheet").change(function(){$(this).attr("value",$("#chkAccessTimesheet").is(":checked"));t.model.hasTimesheetModuleAccess=$("#chkAccessTimesheet").is(":checked")})}},{field:"hasPayrollModuleAccess",title:"Payroll Access",width:"60px",attributes:{style:"text-align:center;"},headerAttributes:{style:"text-align:center;"},template:function(n){return n.hasPayrollModuleAccess==!0?"<span style='color:green'>YES<\/span>":"<span style='color:red'>NO<\/span>"},editor:function(n,t){var i=$("<input type='checkbox' id='chkAccessPayroll' attr-ModelVal="+t.model.hasPayrollModuleAccess+" data-bind='value:"+t.field+"' "+(t.model.hasPayrollModuleAccess==!0?"checked='checked'":"")+"  class='chk-box'><label class='checkbox-inline' for='chkAccessPayroll'><\/label>").appendTo(n);$("#chkAccessPayroll").change(function(){$(this).attr("value",$("#chkAccessPayroll").is(":checked"));t.model.hasPayrollModuleAccess=$("#chkAccessPayroll").is(":checked")})}},{field:"hasReportModuleAccess",title:"Report Access",width:"60px",attributes:{style:"text-align:center;"},headerAttributes:{style:"text-align:center;"},template:function(n){return n.hasReportModuleAccess==!0?"<span style='color:green'>YES<\/span>":"<span style='color:red'>NO<\/span>"},editor:function(n,t){var i=$("<input type='checkbox' id='chkAccessReport' attr-ModelVal="+t.model.hasReportModuleAccess+" data-bind='value:"+t.field+"' "+(t.model.hasReportModuleAccess==!0?"checked='checked'":"")+"  class='chk-box'><label class='checkbox-inline' for='chkAccessReport'><\/label>").appendTo(n);$("#chkAccessReport").change(function(){$(this).attr("value",$("#chkAccessReport").is(":checked"));t.model.hasReportModuleAccess=$("#chkAccessReport").is(":checked")})}},{command:[{name:"edit",text:{edit:"",update:"",cancel:""}}],title:"&nbsp;",width:"40px"}],editable:"inline",edit:t,dataBound:t,cancel:t,dataBinding:function(){n=SetSerialNumberToKGrid(this)}})};